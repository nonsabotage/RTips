<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.515">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R Tips - はじめに</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../contents/books/09_Pythonで学ぶ数理最適化/ch01-基礎編.html" rel="next">
<link href="../../../contents/books/08_handbook_lightgbm/cl03_分類の予測モデル.html" rel="prev">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;800&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">R Tips</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-home" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Home</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-home">    
        <li>
    <a class="dropdown-item" href="../../../index.html">
 <span class="dropdown-text">Home</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-web-site" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Web Site</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-web-site">    
        <li class="dropdown-header">ALL</li>
        <li>
    <a class="dropdown-item" href="../../../contents/website/r4ds2e/index.html">
 <span class="dropdown-text">R for Data Science 2e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/leaflet4r/index.html">
 <span class="dropdown-text">Leaflet for R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/analizeUSCensus/index.html">
 <span class="dropdown-text">Analyzing US Census Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/graphic_design_with_ggplot2/index.html">
 <span class="dropdown-text">Graphic Design with ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/udemy_database-specialist/am-2-note.html">
 <span class="dropdown-text">Udemyデータベーススペシャリスト</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-books" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">books</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-books">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="../../../contents/books/01_Rによる実証分析_2e/index.html">
 <span class="dropdown-text">Rによる実証分析2e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/02_因果推論ミックステープ/index.html">
 <span class="dropdown-text">因果推論ミックステープ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/index.html">
 <span class="dropdown-text">数値シミュレーションで学ぶ統計の仕組み</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/05_統計的因果推論の理論と実際/index.html">
 <span class="dropdown-text">統計的因果推論の理論と実際</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Python</li>
        <li>
    <a class="dropdown-item" href="../../../contents/books/06_Pythonではじめる数理最適化/index.html">
 <span class="dropdown-text">Pythonではじめる数理最適化 2nd</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/07_NumpyInfinity/ch01_Pythonの基礎.html">
 <span class="dropdown-text">Numpy Infinity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/08_handbook_lightgbm/cl02_データ理解.html">
 <span class="dropdown-text">LightGBMハンドブック</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/09_Pythonで学ぶ数理最適化/ch01-基礎編.html">
 <span class="dropdown-text">Pythonで学ぶ数理最適化</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-libs" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">libs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-libs">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/base/working.html">
 <span class="dropdown-text">base</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/argparse/index.html">
 <span class="dropdown-text">argparse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/assertr/index.html">
 <span class="dropdown-text">assertr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggtext/working.html">
 <span class="dropdown-text">ggtext</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggfittext/working.html">
 <span class="dropdown-text">ggfittext</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/gganimate/working.html">
 <span class="dropdown-text">gganimate</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggmosaic/working.html">
 <span class="dropdown-text">ggmosaic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/treemapify/working.html">
 <span class="dropdown-text">treemapify</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/corrr/working.html">
 <span class="dropdown-text">corrr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ComplexHeatmap/working.html">
 <span class="dropdown-text">ComplexHeatmap</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/GGally/working.html">
 <span class="dropdown-text">GGally</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/sf/working.html">
 <span class="dropdown-text">sf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/igraph/index.html">
 <span class="dropdown-text">igraph</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/patchwork/working.html">
 <span class="dropdown-text">pathcwork</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggspatial/working.html">
 <span class="dropdown-text">ggspatial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/duckdb/working.html">
 <span class="dropdown-text">duckdb</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/DBI/working.html">
 <span class="dropdown-text">DBI</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Python</li>
        <li>
    <a class="dropdown-item" href="../../../contents/libs/Python/pydantic/index.html">
 <span class="dropdown-text">pydantic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/Python/pandera/index.html">
 <span class="dropdown-text">pandera</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notes" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notes">    
        <li class="dropdown-header">Notes</li>
        <li>
    <a class="dropdown-item" href="../../../contents/notes/ggplot2/working.html">
 <span class="dropdown-text">ggplot2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-utils" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Utils</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-utils">    
        <li class="dropdown-header">Utils</li>
        <li>
    <a class="dropdown-item" href="../../../contents/utils/01_写真GPS/index.html">
 <span class="dropdown-text">01_写真GPS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sql" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">sql</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sql">    
        <li class="dropdown-header">DuckDB</li>
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/documentaion/index.html">
 <span class="dropdown-text">Documentaion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/sql-bigdata/index.html">
 <span class="dropdown-text">ビッグデータレシピ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/mytips/01_.html">
 <span class="dropdown-text">My Tips</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/SpatialDataAnalysiswithDuckDB/working.html">
 <span class="dropdown-text">Spatial DataAnalysis with DuckDB</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-test" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Test</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-test">    
        <li class="dropdown-header">Test</li>
        <li>
    <a class="dropdown-item" href="../../../contents/test/bash/quick_sample.html">
 <span class="dropdown-text">Bash</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/R/renv.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/R2/renv.html">
 <span class="dropdown-text">R2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/python/notebook.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Python</li><li class="breadcrumb-item"><a href="../../../contents/books/08_handbook_lightgbm/cl02_データ理解.html">LightGBMハンドブック</a></li><li class="breadcrumb-item"><a href="../../../contents/books/08_handbook_lightgbm/cl04_回帰の予測モデル改善.html">はじめに</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Rによる実証分析2e</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch01_回帰分析の目的.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch01 回帰分析の目的</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch02_統計の基礎知識.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch02 統計の基礎知識</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch03_確率論の基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch03 確率論の基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch04_回帰分析の基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch04 回帰分析の基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch05_推測統計の基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch05 推測統計の基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch06_相関関係と因果関係.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch06 相関関係と因果関係</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch07_外生変数と内生変数.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch07 内生変数と外生変数</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch08_ランダム化実験.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch08 ランダム化実験</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch09_マッチング法.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch09 マッチング法</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch10_回帰不連続デザイン.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch10 回帰不連続デザイン</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch11_操作変数法.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch11 操作変数法</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/01_Rによる実証分析_2e/ch12_パネルデータ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch12 パネルデータ</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">因果推論ミックステープ</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch01_導入.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch01 導入</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch02_確率と回帰の概要.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch02 確率と回帰の概要</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch03_非巡回的有向グラフ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch03 非巡回的有向グラフ</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch04_潜在アウトカム因果モデル.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch04 潜在アウトカム因果モデル</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch05_マッチングと層別化.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch05 マッチングと層別化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch06_回帰不連続デザイン.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch06 回帰不連続デザイン</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch07_操作変数.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch07 操作変数</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch08_パネルデータ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch08 パネルデータ</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch09_差分の差デザイン.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch09 差分の差デザイン</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch10_合成コントロール法.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch10 合成コントロール</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/02_因果推論ミックステープ/ch11_結論.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch11 結論</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">数値シミュレーションで学ぶ統計の仕組み</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/ch01_本書の狙い.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch01 本書のねらい</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/ch02_プログラミングの基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch02 プログラミングの基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/ch03_乱数生成シミュレーションの基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch03 乱数生成シミュレーションの基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/ch04_母数の推定のシミュレーション.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch04 母数の推定</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/ch05_統計検定の論理とエラー確率のコントロール - コピー (2).html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch05 統計検定の論理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/ch06_適切な検定のためのサンプルサイズ設計.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch06 サンプルサイズ</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/ch07_回帰分析とシミュレーション.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ch07 回帰分析</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">統計的因果推論の理論と実際</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/101_統計的因果推論の基礎の基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基礎の基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/102_潜在的結果変数の枠組み.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">潜在的結果変数の枠組み</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/103_統計的因果推論における重要な仮定.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">重要な仮定</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/104_推測統計の基礎：標準誤差と信頼区間.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">標準誤差と信頼区間</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/105_回帰分析の基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">回帰分析の基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/106_図で理解する重回帰モデルの基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">重回帰分析の基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/107_最小二乗法による重回帰モデルの仮定と診断1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">最小二乗法の仮定と診断1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/108_最小二乗法による重回帰モデルの仮定と診断2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">最小二乗法の仮定と診断2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/109_交互作用項のある共分散分析.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">交互作用項のある共分散分析</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/110_傾向スコア.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">傾向スコア</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/111_傾向スコアマッチング.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">傾向スコアマッチング</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/112_傾向スコアによる層化解析法および重み付き法.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">傾向スコアによる層化解析法および重み付き法</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/113_操作変数法の基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">操作変数法の基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/114_操作変数法による非遵守への対処.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">操作変数の非遵守への対処</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/115_回帰不連続デザインの基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">回帰不連続デザイン</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/05_統計的因果推論の理論と実際/119_欠測データ処理の基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">欠損データ処理</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">Python</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false">
 <span class="menu-text">Pythonではじめる数理最適化 2nd</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/06_Pythonではじめる数理最適化/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/06_Pythonではじめる数理最適化/ch02_チュートリアル.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">数理最適化チュートリアル</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/06_Pythonではじめる数理最適化/ch03_学校のクラス編成.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">学校のクラス編成</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/06_Pythonではじめる数理最適化/ch04_クーポン.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">クーポン</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/06_Pythonではじめる数理最適化/ch05_配送計画.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">配送計画</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false">
 <span class="menu-text">Numpy Infinity</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/07_NumpyInfinity/ch01_Pythonの基礎.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Pythonの基礎</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/07_NumpyInfinity/ch02_numpyの導入.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">numpyの導入</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/07_NumpyInfinity/ch03_行列の導入.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">行列の導入</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/07_NumpyInfinity/ch04_テンソルと画像処理.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">テンソルと画像処理</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/07_NumpyInfinity/ch04_テンソルと画像処理_Q52.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Q52：セピア化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/07_NumpyInfinity/ch04_テンソルと画像処理_Q72.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Q84：CMYK色空間</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/07_NumpyInfinity/ch05_ブロードキャストの応用.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ブロードキャストの応用</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">LightGBMハンドブック</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/08_handbook_lightgbm/cl02_データ理解.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/08_handbook_lightgbm/cl03_分類の予測モデル.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/08_handbook_lightgbm/cl04_回帰の予測モデル改善.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false">
 <span class="menu-text">Pythonで学ぶ数理最適化</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/09_Pythonで学ぶ数理最適化/ch01-基礎編.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">基礎編</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/books/09_Pythonで学ぶ数理最適化/ch02_応用編.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">応用編</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#eda" id="toc-eda" class="nav-link active" data-scroll-target="#eda"><span class="header-section-number">1</span> EDA</a>
  <ul class="collapse">
  <li><a href="#変数数値" id="toc-変数数値" class="nav-link" data-scroll-target="#変数数値"><span class="header-section-number">1.1</span> 1変数数値</a></li>
  <li><a href="#変数数値-1" id="toc-変数数値-1" class="nav-link" data-scroll-target="#変数数値-1"><span class="header-section-number">1.2</span> 2変数数値</a></li>
  <li><a href="#カテゴリ変数" id="toc-カテゴリ変数" class="nav-link" data-scroll-target="#カテゴリ変数"><span class="header-section-number">1.3</span> カテゴリ変数</a></li>
  <li><a href="#前処理" id="toc-前処理" class="nav-link" data-scroll-target="#前処理"><span class="header-section-number">1.4</span> 前処理</a></li>
  <li><a href="#評価指標の選択" id="toc-評価指標の選択" class="nav-link" data-scroll-target="#評価指標の選択"><span class="header-section-number">1.5</span> 評価指標の選択</a></li>
  </ul></li>
  <li><a href="#線形回帰" id="toc-線形回帰" class="nav-link" data-scroll-target="#線形回帰"><span class="header-section-number">2</span> 線形回帰</a>
  <ul class="collapse">
  <li><a href="#lasso-回帰モデル" id="toc-lasso-回帰モデル" class="nav-link" data-scroll-target="#lasso-回帰モデル"><span class="header-section-number">2.1</span> Lasso 回帰モデル</a></li>
  </ul></li>
  <li><a href="#lightgbm回帰" id="toc-lightgbm回帰" class="nav-link" data-scroll-target="#lightgbm回帰"><span class="header-section-number">3</span> LightGBM回帰</a></li>
  <li><a href="#特徴エンジニアリング" id="toc-特徴エンジニアリング" class="nav-link" data-scroll-target="#特徴エンジニアリング"><span class="header-section-number">4</span> 特徴エンジニアリング</a>
  <ul class="collapse">
  <li><a href="#optunaを用いたハイパーパラメータチューニング" id="toc-optunaを用いたハイパーパラメータチューニング" class="nav-link" data-scroll-target="#optunaを用いたハイパーパラメータチューニング"><span class="header-section-number">4.1</span> Optunaを用いたハイパーパラメータチューニング</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Python</li><li class="breadcrumb-item"><a href="../../../contents/books/08_handbook_lightgbm/cl02_データ理解.html">LightGBMハンドブック</a></li><li class="breadcrumb-item"><a href="../../../contents/books/08_handbook_lightgbm/cl04_回帰の予測モデル改善.html">はじめに</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">はじめに</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    
  </div>
  


</header>


<div id="cell-1" class="cell" data-execution_count="1">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> importlib.util</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="cf">try</span>:</span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb1-6"><a href="#cb1-6"></a>    drive.mount(<span class="st">'/content/drive'</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>    work_dirctory <span class="op">=</span> <span class="st">'/content/drive/Othercomputers/LetsNoteSilver'</span></span>
<span id="cb1-8"><a href="#cb1-8"></a>    os.chdir(work_dirctory)</span>
<span id="cb1-9"><a href="#cb1-9"></a>    <span class="bu">print</span>(<span class="st">"mounted"</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="cf">except</span> <span class="pp">ModuleNotFoundError</span> <span class="im">as</span> e:</span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="bu">print</span>(<span class="st">"not mounted"</span>)</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="im">import</span> graphviz</span>
<span id="cb1-19"><a href="#cb1-19"></a>pd.set_option(<span class="st">'display.float_format'</span>, <span class="st">'</span><span class="sc">{:.3f}</span><span class="st">'</span>.<span class="bu">format</span>)</span>
<span id="cb1-20"><a href="#cb1-20"></a></span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> accuracy_score</span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_score</span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> recall_score</span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> f1_score</span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> confusion_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>not mounted</code></pre>
</div>
</div>
<p>本章では、ダイヤモンドデータセットを使って、価格を予測するモデルを構築する。 データセットの属性は次のとおりである。</p>
<ol type="1">
<li>carat：ダイヤモンドの従量</li>
<li>cut: カットの品質クラス</li>
<li>color：ダイヤモンドの色クラス</li>
<li>clarity：透明度のクラス</li>
<li>depth：合計深さの割合（z / mean(x, y))</li>
<li>table：上部の広く水平にカットされた面の幅</li>
<li>price：アメリカドルでの価格</li>
<li>x：長さ</li>
<li>y：幅</li>
<li>z：深さ</li>
</ol>
<div id="cell-3" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>df <span class="op">=</span> sns.load_dataset(<span class="st">"diamonds"</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">carat</th>
<th data-quarto-table-cell-role="th">cut</th>
<th data-quarto-table-cell-role="th">color</th>
<th data-quarto-table-cell-role="th">clarity</th>
<th data-quarto-table-cell-role="th">depth</th>
<th data-quarto-table-cell-role="th">table</th>
<th data-quarto-table-cell-role="th">price</th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">z</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>0.230</td>
<td>Ideal</td>
<td>E</td>
<td>SI2</td>
<td>61.500</td>
<td>55.000</td>
<td>326</td>
<td>3.950</td>
<td>3.980</td>
<td>2.430</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>0.210</td>
<td>Premium</td>
<td>E</td>
<td>SI1</td>
<td>59.800</td>
<td>61.000</td>
<td>326</td>
<td>3.890</td>
<td>3.840</td>
<td>2.310</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>0.230</td>
<td>Good</td>
<td>E</td>
<td>VS1</td>
<td>56.900</td>
<td>65.000</td>
<td>327</td>
<td>4.050</td>
<td>4.070</td>
<td>2.310</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>0.290</td>
<td>Premium</td>
<td>I</td>
<td>VS2</td>
<td>62.400</td>
<td>58.000</td>
<td>334</td>
<td>4.200</td>
<td>4.230</td>
<td>2.630</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>0.310</td>
<td>Good</td>
<td>J</td>
<td>SI2</td>
<td>63.300</td>
<td>58.000</td>
<td>335</td>
<td>4.340</td>
<td>4.350</td>
<td>2.750</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-4" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 53940 entries, 0 to 53939
Data columns (total 10 columns):
 #   Column   Non-Null Count  Dtype   
---  ------   --------------  -----   
 0   carat    53940 non-null  float64 
 1   cut      53940 non-null  category
 2   color    53940 non-null  category
 3   clarity  53940 non-null  category
 4   depth    53940 non-null  float64 
 5   table    53940 non-null  float64 
 6   price    53940 non-null  int64   
 7   x        53940 non-null  float64 
 8   y        53940 non-null  float64 
 9   z        53940 non-null  float64 
dtypes: category(3), float64(6), int64(1)
memory usage: 3.0 MB</code></pre>
</div>
</div>
<div id="cell-5" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>df.select_dtypes(include <span class="op">=</span> [<span class="st">"float"</span>, <span class="st">"int"</span>]).describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">carat</td>
<td>53940.000</td>
<td>0.798</td>
<td>0.474</td>
<td>0.200</td>
<td>0.400</td>
<td>0.700</td>
<td>1.040</td>
<td>5.010</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">depth</td>
<td>53940.000</td>
<td>61.749</td>
<td>1.433</td>
<td>43.000</td>
<td>61.000</td>
<td>61.800</td>
<td>62.500</td>
<td>79.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">table</td>
<td>53940.000</td>
<td>57.457</td>
<td>2.234</td>
<td>43.000</td>
<td>56.000</td>
<td>57.000</td>
<td>59.000</td>
<td>95.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">price</td>
<td>53940.000</td>
<td>3932.800</td>
<td>3989.440</td>
<td>326.000</td>
<td>950.000</td>
<td>2401.000</td>
<td>5324.250</td>
<td>18823.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x</td>
<td>53940.000</td>
<td>5.731</td>
<td>1.122</td>
<td>0.000</td>
<td>4.710</td>
<td>5.700</td>
<td>6.540</td>
<td>10.740</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">y</td>
<td>53940.000</td>
<td>5.735</td>
<td>1.142</td>
<td>0.000</td>
<td>4.720</td>
<td>5.710</td>
<td>6.540</td>
<td>58.900</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">z</td>
<td>53940.000</td>
<td>3.539</td>
<td>0.706</td>
<td>0.000</td>
<td>2.910</td>
<td>3.530</td>
<td>4.040</td>
<td>31.800</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-6" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>df.select_dtypes(include <span class="op">=</span> [<span class="st">"category"</span>, <span class="st">"object"</span>]).describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">unique</th>
<th data-quarto-table-cell-role="th">top</th>
<th data-quarto-table-cell-role="th">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">cut</td>
<td>53940</td>
<td>5</td>
<td>Ideal</td>
<td>21551</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">color</td>
<td>53940</td>
<td>7</td>
<td>G</td>
<td>11292</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">clarity</td>
<td>53940</td>
<td>8</td>
<td>SI1</td>
<td>13065</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="eda" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> EDA</h1>
<section id="変数数値" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="変数数値"><span class="header-section-number">1.1</span> 1変数数値</h2>
<div id="cell-8" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb8-2"><a href="#cb8-2"></a>df.hist(bins <span class="op">=</span> <span class="dv">20</span>)</span>
<span id="cb8-3"><a href="#cb8-3"></a>plt.tight_layout()</span>
<span id="cb8-4"><a href="#cb8-4"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1000x600 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-7-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="変数数値-1" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="変数数値-1"><span class="header-section-number">1.2</span> 2変数数値</h2>
<div id="cell-10" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># 目的変数と相関が高い変数を調べる</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb10-3"><a href="#cb10-3"></a>df_corr <span class="op">=</span> df.select_dtypes([<span class="st">"float"</span>, <span class="st">"int"</span>]).corr()</span>
<span id="cb10-4"><a href="#cb10-4"></a>sns.heatmap(</span>
<span id="cb10-5"><a href="#cb10-5"></a>    df_corr, </span>
<span id="cb10-6"><a href="#cb10-6"></a>    vmax <span class="op">=</span> <span class="dv">1</span>, </span>
<span id="cb10-7"><a href="#cb10-7"></a>    vmin <span class="op">=</span> <span class="op">-</span><span class="dv">1</span>, </span>
<span id="cb10-8"><a href="#cb10-8"></a>    center <span class="op">=</span> <span class="dv">0</span>, </span>
<span id="cb10-9"><a href="#cb10-9"></a>    annot <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb10-10"><a href="#cb10-10"></a>    cmap <span class="op">=</span> <span class="st">"Blues"</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-8-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># 数値の組合わせでプロット作成する</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="co"># 非線形な関係も多いのがわかる</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>sns.pairplot(</span>
<span id="cb11-4"><a href="#cb11-4"></a>    df.select_dtypes([<span class="st">"float"</span>, <span class="st">"int"</span>])</span>
<span id="cb11-5"><a href="#cb11-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-9-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="カテゴリ変数" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="カテゴリ変数"><span class="header-section-number">1.3</span> カテゴリ変数</h2>
<div id="cell-13" class="cell" data-execution_count="32">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># ユニーク値を調べる</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="bu">list</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss"> = </span><span class="sc">{</span>value[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="cf">for</span> column, value <span class="kw">in</span> df</span>
<span id="cb12-5"><a href="#cb12-5"></a>    .select_dtypes([<span class="st">"category"</span>, <span class="st">"object"</span>])</span>
<span id="cb12-6"><a href="#cb12-6"></a>    .agg(<span class="kw">lambda</span> x: [x.value_counts()])</span>
<span id="cb12-7"><a href="#cb12-7"></a>    .items()</span>
<span id="cb12-8"><a href="#cb12-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>cut = cut
Ideal        21551
Premium      13791
Very Good    12082
Good          4906
Fair          1610
Name: count, dtype: int64
color = color
G    11292
E     9797
F     9542
H     8304
D     6775
I     5422
J     2808
Name: count, dtype: int64
clarity = clarity
SI1     13065
VS2     12258
SI2      9194
VS1      8171
VVS2     5066
VVS1     3655
IF       1790
I1        741
Name: count, dtype: int64</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>[None, None, None]</code></pre>
</div>
</div>
<div id="cell-14" class="cell" data-execution_count="33">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a></span>
<span id="cb15-2"><a href="#cb15-2"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="cf">for</span> i, name <span class="kw">in</span> <span class="bu">enumerate</span>(df.select_dtypes([<span class="st">"category"</span>, <span class="st">"object"</span>]).columns):</span>
<span id="cb15-4"><a href="#cb15-4"></a>    ax <span class="op">=</span> plt.subplot(<span class="dv">2</span>,<span class="dv">2</span> , i <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a>    df[name].value_counts().plot(kind <span class="op">=</span> <span class="st">"bar"</span>, ax <span class="op">=</span> ax)</span>
<span id="cb15-6"><a href="#cb15-6"></a>    </span>
<span id="cb15-7"><a href="#cb15-7"></a>plt.tight_layout()</span>
<span id="cb15-8"><a href="#cb15-8"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-11-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="前処理" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="前処理"><span class="header-section-number">1.4</span> 前処理</h2>
<p>ここまでの計算結果を踏まえて、予測モデルの作成に悪影響を及ぼす外れ値データを除外する。 サイズの情報に０があったのでこれは除外する。</p>
<div id="cell-16" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>has_abnormal_size_value <span class="op">=</span> (</span>
<span id="cb16-4"><a href="#cb16-4"></a>    df</span>
<span id="cb16-5"><a href="#cb16-5"></a>    .<span class="bu">filter</span>(items <span class="op">=</span> [<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-6"><a href="#cb16-6"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> v: (v <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="op">|</span> (v <span class="op">&gt;=</span> <span class="dv">10</span>), axis <span class="op">=</span>  <span class="dv">0</span>)</span>
<span id="cb16-7"><a href="#cb16-7"></a>    .<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a>    .pipe(<span class="kw">lambda</span> ser: ser <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb16-9"><a href="#cb16-9"></a>)</span>
<span id="cb16-10"><a href="#cb16-10"></a>has_abnormal_size_value.<span class="bu">sum</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>0</code></pre>
</div>
</div>
<div id="cell-17" class="cell" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># 外れ値を除外する</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>df <span class="op">=</span> (</span>
<span id="cb18-3"><a href="#cb18-3"></a>    df</span>
<span id="cb18-4"><a href="#cb18-4"></a>    .query(<span class="st">"~ @has_abnormal_size_value"</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a>    .reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb18-6"><a href="#cb18-6"></a>)</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a>df.select_dtypes(include<span class="op">=</span>[<span class="st">"float"</span>, <span class="st">"int"</span>]).describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">carat</td>
<td>53911.000</td>
<td>0.797</td>
<td>0.472</td>
<td>0.200</td>
<td>0.400</td>
<td>0.700</td>
<td>1.040</td>
<td>3.670</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">depth</td>
<td>53911.000</td>
<td>61.749</td>
<td>1.432</td>
<td>43.000</td>
<td>61.000</td>
<td>61.800</td>
<td>62.500</td>
<td>79.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">table</td>
<td>53911.000</td>
<td>57.457</td>
<td>2.234</td>
<td>43.000</td>
<td>56.000</td>
<td>57.000</td>
<td>59.000</td>
<td>95.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">price</td>
<td>53911.000</td>
<td>3929.487</td>
<td>3985.130</td>
<td>326.000</td>
<td>949.000</td>
<td>2401.000</td>
<td>5321.500</td>
<td>18823.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x</td>
<td>53911.000</td>
<td>5.731</td>
<td>1.118</td>
<td>3.730</td>
<td>4.710</td>
<td>5.700</td>
<td>6.540</td>
<td>9.860</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">y</td>
<td>53911.000</td>
<td>5.733</td>
<td>1.110</td>
<td>3.680</td>
<td>4.720</td>
<td>5.710</td>
<td>6.540</td>
<td>9.810</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">z</td>
<td>53911.000</td>
<td>3.539</td>
<td>0.691</td>
<td>1.070</td>
<td>2.910</td>
<td>3.530</td>
<td>4.040</td>
<td>6.380</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="評価指標の選択" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="評価指標の選択"><span class="header-section-number">1.5</span> 評価指標の選択</h2>
<p>目的変数<code>price</code>の分布を確認すると、べき乗則やロングテールと呼ばれるような分布になっている。 このときにはRMSEだと大きな強調して評価されるので、外れ値と小さな誤差を同じ基準で評価するMAEを使うことにする。</p>
<p>この部分は少し考え方がよくわかっていない。。</p>
<div id="cell-19" class="cell" data-execution_count="98">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">6</span>, <span class="dv">4</span>))</span>
<span id="cb19-2"><a href="#cb19-2"></a>df[<span class="st">"price"</span>].hist(bins <span class="op">=</span> <span class="dv">20</span>, edgecolor <span class="op">=</span> <span class="st">"white"</span>)</span>
<span id="cb19-3"><a href="#cb19-3"></a>plt.grid(<span class="va">False</span>)</span>
<span id="cb19-4"><a href="#cb19-4"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-14-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="線形回帰" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 線形回帰</h1>
<div id="cell-21" class="cell" data-execution_count="100">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a>df <span class="op">=</span> sns.load_dataset(<span class="st">"diamonds"</span>)</span>
<span id="cb20-5"><a href="#cb20-5"></a></span>
<span id="cb20-6"><a href="#cb20-6"></a>has_abnormal_size_value <span class="op">=</span> (</span>
<span id="cb20-7"><a href="#cb20-7"></a>    df</span>
<span id="cb20-8"><a href="#cb20-8"></a>    .<span class="bu">filter</span>(items <span class="op">=</span> [<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb20-9"><a href="#cb20-9"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> v: (v <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="op">|</span> (v <span class="op">&gt;=</span> <span class="dv">10</span>), axis <span class="op">=</span>  <span class="dv">0</span>)</span>
<span id="cb20-10"><a href="#cb20-10"></a>    .<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb20-11"><a href="#cb20-11"></a>    .pipe(<span class="kw">lambda</span> ser: ser <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb20-12"><a href="#cb20-12"></a>)</span>
<span id="cb20-13"><a href="#cb20-13"></a></span>
<span id="cb20-14"><a href="#cb20-14"></a>df <span class="op">=</span> (</span>
<span id="cb20-15"><a href="#cb20-15"></a>    df</span>
<span id="cb20-16"><a href="#cb20-16"></a>    .query(<span class="st">"~ @has_abnormal_size_value"</span>)</span>
<span id="cb20-17"><a href="#cb20-17"></a>    .reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb20-18"><a href="#cb20-18"></a>)</span>
<span id="cb20-19"><a href="#cb20-19"></a></span>
<span id="cb20-20"><a href="#cb20-20"></a>df.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>(53911, 10)</code></pre>
</div>
</div>
<div id="cell-22" class="cell" data-execution_count="120">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># 特徴量と目的変数</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>X <span class="op">=</span> df.drop([<span class="st">"price"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a>y <span class="op">=</span> df[<span class="st">"price"</span>]</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># one-hot encodingを行う</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>list_X_dummies <span class="op">=</span> [</span>
<span id="cb22-7"><a href="#cb22-7"></a>    pd.get_dummies(</span>
<span id="cb22-8"><a href="#cb22-8"></a>        X[name], </span>
<span id="cb22-9"><a href="#cb22-9"></a>        prefix <span class="op">=</span> name, </span>
<span id="cb22-10"><a href="#cb22-10"></a>        drop_first <span class="op">=</span> <span class="va">True</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>    )</span>
<span id="cb22-12"><a href="#cb22-12"></a>    .astype(<span class="bu">int</span>)</span>
<span id="cb22-13"><a href="#cb22-13"></a>    <span class="cf">for</span> name <span class="kw">in</span> X.select_dtypes([<span class="st">"category"</span>]).columns</span>
<span id="cb22-14"><a href="#cb22-14"></a>]</span>
<span id="cb22-15"><a href="#cb22-15"></a></span>
<span id="cb22-16"><a href="#cb22-16"></a>X <span class="op">=</span> pd.concat(</span>
<span id="cb22-17"><a href="#cb22-17"></a>    [X.select_dtypes(exclude<span class="op">=</span>[<span class="st">"category"</span>])]</span>
<span id="cb22-18"><a href="#cb22-18"></a>    <span class="op">+</span> list_X_dummies</span>
<span id="cb22-19"><a href="#cb22-19"></a>, axis <span class="op">=</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-23" class="cell" data-execution_count="121">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># テストデータと教師データあに分割</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size <span class="op">=</span> <span class="fl">.2</span>, shuffle <span class="op">=</span> <span class="va">True</span>, random_state <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-24" class="cell" data-execution_count="122">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># 特徴量の標準化</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a>num_cols <span class="op">=</span> X.select_dtypes([<span class="st">"float"</span>]).columns</span>
<span id="cb24-5"><a href="#cb24-5"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb24-6"><a href="#cb24-6"></a>X_train[num_cols] <span class="op">=</span> scaler.fit_transform(X_train[num_cols])</span>
<span id="cb24-7"><a href="#cb24-7"></a>X_test[num_cols] <span class="op">=</span> scaler.transform(X_test[num_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-25" class="cell" data-execution_count="123">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>X.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="123">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">carat</th>
<th data-quarto-table-cell-role="th">depth</th>
<th data-quarto-table-cell-role="th">table</th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">z</th>
<th data-quarto-table-cell-role="th">cut_Premium</th>
<th data-quarto-table-cell-role="th">cut_Very Good</th>
<th data-quarto-table-cell-role="th">cut_Good</th>
<th data-quarto-table-cell-role="th">cut_Fair</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">color_H</th>
<th data-quarto-table-cell-role="th">color_I</th>
<th data-quarto-table-cell-role="th">color_J</th>
<th data-quarto-table-cell-role="th">clarity_VVS1</th>
<th data-quarto-table-cell-role="th">clarity_VVS2</th>
<th data-quarto-table-cell-role="th">clarity_VS1</th>
<th data-quarto-table-cell-role="th">clarity_VS2</th>
<th data-quarto-table-cell-role="th">clarity_SI1</th>
<th data-quarto-table-cell-role="th">clarity_SI2</th>
<th data-quarto-table-cell-role="th">clarity_I1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>...</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
<td>53911.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.797</td>
<td>61.749</td>
<td>57.457</td>
<td>5.731</td>
<td>5.733</td>
<td>3.539</td>
<td>0.256</td>
<td>0.224</td>
<td>0.091</td>
<td>0.030</td>
<td>...</td>
<td>0.154</td>
<td>0.101</td>
<td>0.052</td>
<td>0.068</td>
<td>0.094</td>
<td>0.152</td>
<td>0.227</td>
<td>0.242</td>
<td>0.170</td>
<td>0.014</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.472</td>
<td>1.432</td>
<td>2.234</td>
<td>1.118</td>
<td>1.110</td>
<td>0.691</td>
<td>0.436</td>
<td>0.417</td>
<td>0.288</td>
<td>0.170</td>
<td>...</td>
<td>0.361</td>
<td>0.301</td>
<td>0.222</td>
<td>0.251</td>
<td>0.292</td>
<td>0.359</td>
<td>0.419</td>
<td>0.428</td>
<td>0.376</td>
<td>0.116</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.200</td>
<td>43.000</td>
<td>43.000</td>
<td>3.730</td>
<td>3.680</td>
<td>1.070</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>...</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.400</td>
<td>61.000</td>
<td>56.000</td>
<td>4.710</td>
<td>4.720</td>
<td>2.910</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>...</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.700</td>
<td>61.800</td>
<td>57.000</td>
<td>5.700</td>
<td>5.710</td>
<td>3.530</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>...</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1.040</td>
<td>62.500</td>
<td>59.000</td>
<td>6.540</td>
<td>6.540</td>
<td>4.040</td>
<td>1.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>...</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
<td>0.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>3.670</td>
<td>79.000</td>
<td>95.000</td>
<td>9.860</td>
<td>9.810</td>
<td>6.380</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>...</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
<td>1.000</td>
</tr>
</tbody>
</table>

<p>8 rows × 23 columns</p>
</div>
</div>
</div>
<div id="cell-26" class="cell" data-execution_count="124">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># 学習データと検証データに分割</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>X_tr, X_va, y_tr, y_va <span class="op">=</span> train_test_split(X_train, y_train, test_size <span class="op">=</span> <span class="fl">.2</span>, shuffle <span class="op">=</span> <span class="va">True</span>, random_state <span class="op">=</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-27" class="cell" data-execution_count="126">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># モデルの学習</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a>model <span class="op">=</span> LinearRegression()</span>
<span id="cb27-5"><a href="#cb27-5"></a>model.fit(X_tr, y_tr)</span>
<span id="cb27-6"><a href="#cb27-6"></a>model.get_params()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="126">
<pre><code>{'copy_X': True, 'fit_intercept': True, 'n_jobs': None, 'positive': False}</code></pre>
</div>
</div>
<div id="cell-28" class="cell" data-execution_count="129">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># 検証データでの評価</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="co"># 平均的に720ドルの違いがある</span></span>
<span id="cb29-3"><a href="#cb29-3"></a>y_va_pred <span class="op">=</span> model.predict(X_va)</span>
<span id="cb29-4"><a href="#cb29-4"></a>mean_absolute_error(y_va, y_va_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="129">
<pre><code>720.0328680823507</code></pre>
</div>
</div>
<div id="cell-29" class="cell" data-execution_count="130">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># テストデータ</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>y_test_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb31-3"><a href="#cb31-3"></a>mean_absolute_error(y_test, y_test_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="130">
<pre><code>733.7188519877889</code></pre>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="132">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># 残差をプロットしてみてみる</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># 金額が高い方で、低い方で大きく外れていることがわかる</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>residuals <span class="op">=</span> y_test <span class="op">-</span> y_test_pred</span>
<span id="cb33-4"><a href="#cb33-4"></a></span>
<span id="cb33-5"><a href="#cb33-5"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb33-6"><a href="#cb33-6"></a>plt.scatter(y_test_pred, residuals, s <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb33-7"><a href="#cb33-7"></a>plt.xlabel(<span class="st">"Predicted values"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb33-8"><a href="#cb33-8"></a>plt.ylabel(<span class="st">"Residuals"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb33-9"><a href="#cb33-9"></a>plt.title(<span class="st">"residuals vs predicted values"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb33-10"><a href="#cb33-10"></a>plt.grid()</span>
<span id="cb33-11"><a href="#cb33-11"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-31" class="cell" data-execution_count="146">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># 係数を可視化する</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>linear_model_coefs <span class="op">=</span> (</span>
<span id="cb34-3"><a href="#cb34-3"></a>    pd.DataFrame({</span>
<span id="cb34-4"><a href="#cb34-4"></a>        <span class="st">"value"</span>:[model.intercept_] <span class="op">+</span> model.coef_.tolist(), </span>
<span id="cb34-5"><a href="#cb34-5"></a>        <span class="st">"name"</span>:[<span class="st">"intercept"</span>] <span class="op">+</span> model.feature_names_in_.tolist()</span>
<span id="cb34-6"><a href="#cb34-6"></a>    })</span>
<span id="cb34-7"><a href="#cb34-7"></a>    .sort_values(by <span class="op">=</span> <span class="st">"value"</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb34-8"><a href="#cb34-8"></a>)</span>
<span id="cb34-9"><a href="#cb34-9"></a>linear_model_coefs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="146">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">value</th>
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>5941.131</td>
<td>intercept</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>5494.603</td>
<td>carat</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">5</td>
<td>2112.956</td>
<td>y</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2</td>
<td>114.619</td>
<td>depth</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">7</td>
<td>-32.962</td>
<td>cut_Premium</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>-53.562</td>
<td>table</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">8</td>
<td>-134.701</td>
<td>cut_Very Good</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">11</td>
<td>-217.423</td>
<td>color_E</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9</td>
<td>-272.082</td>
<td>cut_Good</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">12</td>
<td>-275.241</td>
<td>color_F</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">17</td>
<td>-330.648</td>
<td>clarity_VVS1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>-368.843</td>
<td>clarity_VVS2</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">13</td>
<td>-476.343</td>
<td>color_G</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">10</td>
<td>-719.880</td>
<td>cut_Fair</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">19</td>
<td>-758.449</td>
<td>clarity_VS1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">14</td>
<td>-984.032</td>
<td>color_H</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">20</td>
<td>-1037.934</td>
<td>clarity_VS2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">15</td>
<td>-1474.249</td>
<td>color_I</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">21</td>
<td>-1648.794</td>
<td>clarity_SI1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4</td>
<td>-1657.022</td>
<td>x</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>-1804.488</td>
<td>z</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">16</td>
<td>-2376.881</td>
<td>color_J</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>-2595.885</td>
<td>clarity_SI2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">23</td>
<td>-5223.641</td>
<td>clarity_I1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-32" class="cell" data-execution_count="148">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb35-2"><a href="#cb35-2"></a>plt.title(<span class="st">"Regresssion coefficient"</span>)</span>
<span id="cb35-3"><a href="#cb35-3"></a>plt.bar(<span class="bu">range</span>(linear_model_coefs.shape[<span class="dv">0</span>]), linear_model_coefs[<span class="st">"value"</span>])</span>
<span id="cb35-4"><a href="#cb35-4"></a>plt.xticks(<span class="bu">range</span>(linear_model_coefs.shape[<span class="dv">0</span>]), linear_model_coefs[<span class="st">"name"</span>], rotation <span class="op">=</span> <span class="dv">90</span>)</span>
<span id="cb35-5"><a href="#cb35-5"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="lasso-回帰モデル" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="lasso-回帰モデル"><span class="header-section-number">2.1</span> Lasso 回帰モデル</h2>
<div id="cell-34" class="cell" data-execution_count="156">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso</span>
<span id="cb36-2"><a href="#cb36-2"></a></span>
<span id="cb36-3"><a href="#cb36-3"></a>params <span class="op">=</span> np.arange(<span class="dv">1</span>, <span class="dv">10</span>)</span>
<span id="cb36-4"><a href="#cb36-4"></a>mae_metrics <span class="op">=</span> []</span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="cf">for</span> param <span class="kw">in</span> params: </span>
<span id="cb36-6"><a href="#cb36-6"></a>    model_l1 <span class="op">=</span> Lasso(alpha <span class="op">=</span> param)</span>
<span id="cb36-7"><a href="#cb36-7"></a>    model_l1.fit(X_tr, y_tr)</span>
<span id="cb36-8"><a href="#cb36-8"></a>    y_va_pred <span class="op">=</span> model_l1.predict(X_va)</span>
<span id="cb36-9"><a href="#cb36-9"></a>    mae_metric <span class="op">=</span> mean_absolute_error(y_va, y_va_pred)</span>
<span id="cb36-10"><a href="#cb36-10"></a>    mae_metrics.append(mae_metric)</span>
<span id="cb36-11"><a href="#cb36-11"></a>    </span>
<span id="cb36-12"><a href="#cb36-12"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb36-13"><a href="#cb36-13"></a>plt.plot(params, mae_metrics)</span>
<span id="cb36-14"><a href="#cb36-14"></a>plt.xlabel(<span class="st">"alpha"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb36-15"><a href="#cb36-15"></a>plt.ylabel(<span class="st">"MAE"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb36-16"><a href="#cb36-16"></a>plt.title(<span class="st">"MAE vs alpha"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb36-17"><a href="#cb36-17"></a>plt.grid()</span>
<span id="cb36-18"><a href="#cb36-18"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>c:\pyenv\py311\Lib\site-packages\sklearn\linear_model\_coordinate_descent.py:628: ConvergenceWarning: Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 9.348e+08, tolerance: 5.462e+07
  model = cd_fast.enet_coordinate_descent(</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-27-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-35" class="cell" data-execution_count="158">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>model <span class="op">=</span> Lasso(alpha <span class="op">=</span> <span class="dv">6</span>)</span>
<span id="cb38-2"><a href="#cb38-2"></a>model.fit(X_train, y_train)</span>
<span id="cb38-3"><a href="#cb38-3"></a>y_test_pred <span class="op">=</span> model.predict(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-36" class="cell" data-execution_count="159">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1"></a>residuals <span class="op">=</span> y_test <span class="op">-</span> y_test_pred</span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb39-4"><a href="#cb39-4"></a>plt.scatter(y_test_pred, residuals, s <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb39-5"><a href="#cb39-5"></a>plt.xlabel(<span class="st">"Predicted values"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb39-6"><a href="#cb39-6"></a>plt.ylabel(<span class="st">"Residuals"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb39-7"><a href="#cb39-7"></a>plt.title(<span class="st">"residuals vs predicted values"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb39-8"><a href="#cb39-8"></a>plt.grid()</span>
<span id="cb39-9"><a href="#cb39-9"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-29-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-37" class="cell" data-execution_count="161">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># 検証データでの評価</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="co"># 平均的に720ドルの違いがある</span></span>
<span id="cb40-3"><a href="#cb40-3"></a>y_va_pred <span class="op">=</span> model.predict(X_va)</span>
<span id="cb40-4"><a href="#cb40-4"></a><span class="bu">print</span>(mean_absolute_error(y_va, y_va_pred))</span>
<span id="cb40-5"><a href="#cb40-5"></a></span>
<span id="cb40-6"><a href="#cb40-6"></a><span class="co"># テストデータ</span></span>
<span id="cb40-7"><a href="#cb40-7"></a>y_test_pred <span class="op">=</span> model.predict(X_test)</span>
<span id="cb40-8"><a href="#cb40-8"></a><span class="bu">print</span>(mean_absolute_error(y_test, y_test_pred))</span>
<span id="cb40-9"><a href="#cb40-9"></a></span>
<span id="cb40-10"><a href="#cb40-10"></a>linear_model_coefs <span class="op">=</span> (</span>
<span id="cb40-11"><a href="#cb40-11"></a>    pd.DataFrame({</span>
<span id="cb40-12"><a href="#cb40-12"></a>        <span class="st">"value"</span>:[model.intercept_] <span class="op">+</span> model.coef_.tolist(), </span>
<span id="cb40-13"><a href="#cb40-13"></a>        <span class="st">"name"</span>:[<span class="st">"intercept"</span>] <span class="op">+</span> model.feature_names_in_.tolist()</span>
<span id="cb40-14"><a href="#cb40-14"></a>    })</span>
<span id="cb40-15"><a href="#cb40-15"></a>    .sort_values(by <span class="op">=</span> <span class="st">"value"</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb40-16"><a href="#cb40-16"></a>)</span>
<span id="cb40-17"><a href="#cb40-17"></a>linear_model_coefs</span>
<span id="cb40-18"><a href="#cb40-18"></a></span>
<span id="cb40-19"><a href="#cb40-19"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb40-20"><a href="#cb40-20"></a>plt.title(<span class="st">"Regresssion coefficient"</span>)</span>
<span id="cb40-21"><a href="#cb40-21"></a>plt.bar(<span class="bu">range</span>(linear_model_coefs.shape[<span class="dv">0</span>]), linear_model_coefs[<span class="st">"value"</span>])</span>
<span id="cb40-22"><a href="#cb40-22"></a>plt.xticks(<span class="bu">range</span>(linear_model_coefs.shape[<span class="dv">0</span>]), linear_model_coefs[<span class="st">"name"</span>], rotation <span class="op">=</span> <span class="dv">90</span>)</span>
<span id="cb40-23"><a href="#cb40-23"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>710.303690827307
726.0674410050069</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-30-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="lightgbm回帰" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> LightGBM回帰</h1>
<div id="cell-39" class="cell" data-execution_count="2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a><span class="im">import</span> warnings</span>
<span id="cb42-2"><a href="#cb42-2"></a>warnings.filterwarnings(<span class="st">"ignore"</span>, category <span class="op">=</span> <span class="pp">UserWarning</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-40" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb43-2"><a href="#cb43-2"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error</span>
<span id="cb43-3"><a href="#cb43-3"></a></span>
<span id="cb43-4"><a href="#cb43-4"></a>df <span class="op">=</span> sns.load_dataset(<span class="st">"diamonds"</span>)</span>
<span id="cb43-5"><a href="#cb43-5"></a></span>
<span id="cb43-6"><a href="#cb43-6"></a>has_abnormal_size_value <span class="op">=</span> (</span>
<span id="cb43-7"><a href="#cb43-7"></a>    df</span>
<span id="cb43-8"><a href="#cb43-8"></a>    .<span class="bu">filter</span>(items <span class="op">=</span> [<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb43-9"><a href="#cb43-9"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> v: (v <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="op">|</span> (v <span class="op">&gt;=</span> <span class="dv">10</span>), axis <span class="op">=</span>  <span class="dv">0</span>)</span>
<span id="cb43-10"><a href="#cb43-10"></a>    .<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb43-11"><a href="#cb43-11"></a>    .pipe(<span class="kw">lambda</span> ser: ser <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb43-12"><a href="#cb43-12"></a>)</span>
<span id="cb43-13"><a href="#cb43-13"></a></span>
<span id="cb43-14"><a href="#cb43-14"></a>df <span class="op">=</span> (</span>
<span id="cb43-15"><a href="#cb43-15"></a>    df</span>
<span id="cb43-16"><a href="#cb43-16"></a>    .query(<span class="st">"~ @has_abnormal_size_value"</span>)</span>
<span id="cb43-17"><a href="#cb43-17"></a>    .reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb43-18"><a href="#cb43-18"></a>)</span>
<span id="cb43-19"><a href="#cb43-19"></a></span>
<span id="cb43-20"><a href="#cb43-20"></a><span class="co"># 特徴量と目的変数</span></span>
<span id="cb43-21"><a href="#cb43-21"></a>X <span class="op">=</span> df.drop([<span class="st">"price"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb43-22"><a href="#cb43-22"></a>y <span class="op">=</span> df[<span class="st">"price"</span>]</span>
<span id="cb43-23"><a href="#cb43-23"></a></span>
<span id="cb43-24"><a href="#cb43-24"></a><span class="co"># テストとトレインデータへの分割</span></span>
<span id="cb43-25"><a href="#cb43-25"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb43-26"><a href="#cb43-26"></a>    X, </span>
<span id="cb43-27"><a href="#cb43-27"></a>    y, </span>
<span id="cb43-28"><a href="#cb43-28"></a>    test_size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span id="cb43-29"><a href="#cb43-29"></a>    shuffle <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb43-30"><a href="#cb43-30"></a>    random_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-31"><a href="#cb43-31"></a>)</span>
<span id="cb43-32"><a href="#cb43-32"></a></span>
<span id="cb43-33"><a href="#cb43-33"></a><span class="co"># カテゴリ変数をラベルエンコーディング</span></span>
<span id="cb43-34"><a href="#cb43-34"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb43-35"><a href="#cb43-35"></a>cat_cols <span class="op">=</span> [<span class="st">"cut"</span>, <span class="st">"color"</span>, <span class="st">"clarity"</span>]</span>
<span id="cb43-36"><a href="#cb43-36"></a></span>
<span id="cb43-37"><a href="#cb43-37"></a><span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb43-38"><a href="#cb43-38"></a>    le <span class="op">=</span> LabelEncoder()</span>
<span id="cb43-39"><a href="#cb43-39"></a>    le.fit(X_train[c])</span>
<span id="cb43-40"><a href="#cb43-40"></a>    X_train[c] <span class="op">=</span> le.transform(X_train[c])</span>
<span id="cb43-41"><a href="#cb43-41"></a>    X_test[c] <span class="op">=</span> le.transform(X_test[c])</span>
<span id="cb43-42"><a href="#cb43-42"></a>    </span>
<span id="cb43-43"><a href="#cb43-43"></a><span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb43-44"><a href="#cb43-44"></a>    X_train[c] <span class="op">=</span> X_train[c].astype(<span class="st">"category"</span>)</span>
<span id="cb43-45"><a href="#cb43-45"></a>    X_test[c] <span class="op">=</span> X_test[c].astype(<span class="st">"category"</span>) </span>
<span id="cb43-46"><a href="#cb43-46"></a></span>
<span id="cb43-47"><a href="#cb43-47"></a>X_train.info()</span>
<span id="cb43-48"><a href="#cb43-48"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Index: 43128 entries, 2640 to 2732
Data columns (total 9 columns):
 #   Column   Non-Null Count  Dtype   
---  ------   --------------  -----   
 0   carat    43128 non-null  float64 
 1   cut      43128 non-null  category
 2   color    43128 non-null  category
 3   clarity  43128 non-null  category
 4   depth    43128 non-null  float64 
 5   table    43128 non-null  float64 
 6   x        43128 non-null  float64 
 7   y        43128 non-null  float64 
 8   z        43128 non-null  float64 
dtypes: category(3), float64(6)
memory usage: 2.4 MB</code></pre>
</div>
</div>
<div id="cell-41" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># 検証データとバリーデーション</span></span>
<span id="cb45-2"><a href="#cb45-2"></a>X_tr, X_va, y_tr, y_va <span class="op">=</span> train_test_split(</span>
<span id="cb45-3"><a href="#cb45-3"></a>    X_train, </span>
<span id="cb45-4"><a href="#cb45-4"></a>    y_train, </span>
<span id="cb45-5"><a href="#cb45-5"></a>    test_size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span id="cb45-6"><a href="#cb45-6"></a>    shuffle <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb45-7"><a href="#cb45-7"></a>    random_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-42" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># ハイパーパラメータ設定</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="im">import</span> lightgbm <span class="im">as</span> lgb</span>
<span id="cb46-3"><a href="#cb46-3"></a>lgb_train <span class="op">=</span> lgb.Dataset(X_tr, y_tr)</span>
<span id="cb46-4"><a href="#cb46-4"></a>lgb_eval <span class="op">=</span> lgb.Dataset(X_va, y_va, reference <span class="op">=</span> lgb_train)</span>
<span id="cb46-5"><a href="#cb46-5"></a></span>
<span id="cb46-6"><a href="#cb46-6"></a>params <span class="op">=</span> {</span>
<span id="cb46-7"><a href="#cb46-7"></a>    <span class="st">"objective"</span>: <span class="st">"mae"</span>, <span class="co"># mean absolute error</span></span>
<span id="cb46-8"><a href="#cb46-8"></a>    <span class="st">"seed"</span>: <span class="dv">0</span>, </span>
<span id="cb46-9"><a href="#cb46-9"></a>    <span class="st">"verbose"</span>: <span class="op">-</span><span class="dv">1</span>, </span>
<span id="cb46-10"><a href="#cb46-10"></a>}</span>
<span id="cb46-11"><a href="#cb46-11"></a></span>
<span id="cb46-12"><a href="#cb46-12"></a>evals_result <span class="op">=</span> {}</span>
<span id="cb46-13"><a href="#cb46-13"></a></span>
<span id="cb46-14"><a href="#cb46-14"></a>model <span class="op">=</span> lgb.train(</span>
<span id="cb46-15"><a href="#cb46-15"></a>    params, </span>
<span id="cb46-16"><a href="#cb46-16"></a>    lgb_train, </span>
<span id="cb46-17"><a href="#cb46-17"></a>    num_boost_round<span class="op">=</span><span class="dv">10_000</span>,</span>
<span id="cb46-18"><a href="#cb46-18"></a>    valid_sets <span class="op">=</span> [lgb_train, lgb_eval], </span>
<span id="cb46-19"><a href="#cb46-19"></a>    valid_names <span class="op">=</span> [<span class="st">"train"</span>, <span class="st">"valid"</span>], </span>
<span id="cb46-20"><a href="#cb46-20"></a>    callbacks <span class="op">=</span> [</span>
<span id="cb46-21"><a href="#cb46-21"></a>        lgb.early_stopping(<span class="dv">100</span>), </span>
<span id="cb46-22"><a href="#cb46-22"></a>        lgb.log_evaluation(<span class="dv">500</span>), </span>
<span id="cb46-23"><a href="#cb46-23"></a>        lgb.record_evaluation(evals_result)</span>
<span id="cb46-24"><a href="#cb46-24"></a>    ]</span>
<span id="cb46-25"><a href="#cb46-25"></a>)</span>
<span id="cb46-26"><a href="#cb46-26"></a></span>
<span id="cb46-27"><a href="#cb46-27"></a>y_va_pred <span class="op">=</span> model.predict(X_va, num_iteration<span class="op">=</span>model.best_iteration)</span>
<span id="cb46-28"><a href="#cb46-28"></a>score <span class="op">=</span> mean_absolute_error(y_va, y_va_pred)</span>
<span id="cb46-29"><a href="#cb46-29"></a><span class="bu">print</span>(<span class="ss">f"MAE valid: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training until validation scores don't improve for 100 rounds
[500]   train's l1: 228.505 valid's l1: 262.695
[1000]  train's l1: 206.936 valid's l1: 259.926
Early stopping, best iteration is:
[1290]  train's l1: 201.195 valid's l1: 259.42
MAE valid: 259.42</code></pre>
</div>
</div>
<div id="cell-43" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>lgb.plot_metric(evals_result)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-35-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-44" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a><span class="co"># テストデータでの値</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>y_test_pred <span class="op">=</span> model.predict(X_test, num_iteration<span class="op">=</span>model.best_iteration)</span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>mean_absolute_error(y_test_pred, y_test)<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>262.15</code></pre>
</div>
</div>
<div id="cell-45" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a>residuals <span class="op">=</span> y_test <span class="op">-</span> y_test_pred</span>
<span id="cb51-2"><a href="#cb51-2"></a></span>
<span id="cb51-3"><a href="#cb51-3"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb51-4"><a href="#cb51-4"></a>plt.scatter(y_test_pred, residuals, s <span class="op">=</span> <span class="dv">3</span>)</span>
<span id="cb51-5"><a href="#cb51-5"></a>plt.xlabel(<span class="st">"Predicted values"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb51-6"><a href="#cb51-6"></a>plt.ylabel(<span class="st">"Residuals"</span>, fontsize <span class="op">=</span> <span class="dv">14</span>)</span>
<span id="cb51-7"><a href="#cb51-7"></a>plt.title(<span class="st">"residuals vs predicted values"</span>, fontsize <span class="op">=</span> <span class="dv">16</span>)</span>
<span id="cb51-8"><a href="#cb51-8"></a>plt.grid()</span>
<span id="cb51-9"><a href="#cb51-9"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-37-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-46" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a><span class="co"># 特徴量の可視化</span></span>
<span id="cb52-2"><a href="#cb52-2"></a>importances <span class="op">=</span> model.feature_importance(importance_type <span class="op">=</span> <span class="st">"gain"</span>)</span>
<span id="cb52-3"><a href="#cb52-3"></a>indices <span class="op">=</span> np.argsort(importances)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb52-4"><a href="#cb52-4"></a></span>
<span id="cb52-5"><a href="#cb52-5"></a>plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb52-6"><a href="#cb52-6"></a>plt.title(<span class="st">"Feature Importance"</span>)</span>
<span id="cb52-7"><a href="#cb52-7"></a>plt.bar(<span class="bu">range</span>(<span class="bu">len</span>(indices)), importances[indices])</span>
<span id="cb52-8"><a href="#cb52-8"></a>plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)), X.columns[indices], rotation <span class="op">=</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>([&lt;matplotlib.axis.XTick at 0x1b0baaa7bd0&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baaa6010&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baabec10&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baaec490&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baa6dcd0&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baaf4190&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baaf63d0&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baaf86d0&gt;,
  &lt;matplotlib.axis.XTick at 0x1b0baafa810&gt;],
 [Text(0, 0, 'y'),
  Text(1, 0, 'carat'),
  Text(2, 0, 'x'),
  Text(3, 0, 'z'),
  Text(4, 0, 'clarity'),
  Text(5, 0, 'color'),
  Text(6, 0, 'depth'),
  Text(7, 0, 'table'),
  Text(8, 0, 'cut')])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-38-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-47" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># shapの可視化</span></span>
<span id="cb54-2"><a href="#cb54-2"></a><span class="im">import</span> shap</span>
<span id="cb54-3"><a href="#cb54-3"></a>explainer <span class="op">=</span> shap.TreeExplainer(</span>
<span id="cb54-4"><a href="#cb54-4"></a>    model <span class="op">=</span> model, </span>
<span id="cb54-5"><a href="#cb54-5"></a>    feature_pertubation <span class="op">=</span> <span class="st">"tree_path_dependent"</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-48" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a>shap_values <span class="op">=</span> explainer(X_test)</span>
<span id="cb55-2"><a href="#cb55-2"></a>shap.plots.waterfall(shap_values[<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-49" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>shap.plots.bar(shap_values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-41-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-50" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># クロスバリデーションのモデル評価</span></span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold</span>
<span id="cb57-4"><a href="#cb57-4"></a></span>
<span id="cb57-5"><a href="#cb57-5"></a>params <span class="op">=</span> {</span>
<span id="cb57-6"><a href="#cb57-6"></a>    <span class="st">"objective"</span>: <span class="st">"mae"</span>, </span>
<span id="cb57-7"><a href="#cb57-7"></a>    <span class="st">"seed"</span>: <span class="dv">0</span>, </span>
<span id="cb57-8"><a href="#cb57-8"></a>    <span class="st">"verbose"</span>: <span class="op">-</span><span class="dv">1</span></span>
<span id="cb57-9"><a href="#cb57-9"></a>}</span>
<span id="cb57-10"><a href="#cb57-10"></a></span>
<span id="cb57-11"><a href="#cb57-11"></a>valid_scores <span class="op">=</span> []</span>
<span id="cb57-12"><a href="#cb57-12"></a>models <span class="op">=</span> []</span>
<span id="cb57-13"><a href="#cb57-13"></a>oof <span class="op">=</span> np.zeros(<span class="bu">len</span>(X_train))</span>
<span id="cb57-14"><a href="#cb57-14"></a></span>
<span id="cb57-15"><a href="#cb57-15"></a>kf <span class="op">=</span> KFold(n_splits <span class="op">=</span> <span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>, random_state <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb57-16"><a href="#cb57-16"></a><span class="cf">for</span> fold, (tr_idx, va_idx) <span class="kw">in</span> <span class="bu">enumerate</span>(kf.split(X_train)):</span>
<span id="cb57-17"><a href="#cb57-17"></a>    X_tr, y_tr <span class="op">=</span> X_train.iloc[tr_idx], y_train.iloc[tr_idx]</span>
<span id="cb57-18"><a href="#cb57-18"></a>    X_va, y_va <span class="op">=</span> X_train.iloc[va_idx], y_train.iloc[va_idx]</span>
<span id="cb57-19"><a href="#cb57-19"></a>    </span>
<span id="cb57-20"><a href="#cb57-20"></a>    lgb_train <span class="op">=</span> lgb.Dataset(X_tr, y_tr)</span>
<span id="cb57-21"><a href="#cb57-21"></a>    lgb_eval <span class="op">=</span> lgb.Dataset(X_va, y_va, reference <span class="op">=</span> lgb_train)</span>
<span id="cb57-22"><a href="#cb57-22"></a>    </span>
<span id="cb57-23"><a href="#cb57-23"></a>    model <span class="op">=</span> lgb.train(</span>
<span id="cb57-24"><a href="#cb57-24"></a>        params, </span>
<span id="cb57-25"><a href="#cb57-25"></a>        lgb_train, </span>
<span id="cb57-26"><a href="#cb57-26"></a>        num_boost_round <span class="op">=</span> <span class="dv">10_000</span>, </span>
<span id="cb57-27"><a href="#cb57-27"></a>        valid_sets <span class="op">=</span> [lgb_train, lgb_eval], </span>
<span id="cb57-28"><a href="#cb57-28"></a>        valid_names <span class="op">=</span> [<span class="st">"train"</span>, <span class="st">"valid"</span>], </span>
<span id="cb57-29"><a href="#cb57-29"></a>        callbacks <span class="op">=</span> [lgb.early_stopping(<span class="dv">100</span>), lgb.log_evaluation(<span class="dv">500</span>)]</span>
<span id="cb57-30"><a href="#cb57-30"></a>    )</span>
<span id="cb57-31"><a href="#cb57-31"></a>    </span>
<span id="cb57-32"><a href="#cb57-32"></a>    y_va_pred <span class="op">=</span> model.predict(</span>
<span id="cb57-33"><a href="#cb57-33"></a>        X_va, </span>
<span id="cb57-34"><a href="#cb57-34"></a>        num_iteration <span class="op">=</span> model.best_iteration, </span>
<span id="cb57-35"><a href="#cb57-35"></a>    )</span>
<span id="cb57-36"><a href="#cb57-36"></a>    score <span class="op">=</span> mean_absolute_error(y_va, y_va_pred)</span>
<span id="cb57-37"><a href="#cb57-37"></a>    <span class="bu">print</span>(<span class="ss">f"fold </span><span class="sc">{</span>fold<span class="sc">}</span><span class="ss">: MAE valid: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb57-38"><a href="#cb57-38"></a>    <span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb57-39"><a href="#cb57-39"></a>    </span>
<span id="cb57-40"><a href="#cb57-40"></a>    valid_scores.append(score)</span>
<span id="cb57-41"><a href="#cb57-41"></a>    models.append(model)</span>
<span id="cb57-42"><a href="#cb57-42"></a>    oof[va_idx] <span class="op">=</span> y_va_pred</span>
<span id="cb57-43"><a href="#cb57-43"></a>    </span>
<span id="cb57-44"><a href="#cb57-44"></a>cv_score <span class="op">=</span> np.mean(valid_scores)</span>
<span id="cb57-45"><a href="#cb57-45"></a><span class="bu">print</span>(<span class="ss">f"CV score: </span><span class="sc">{</span>cv_score<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training until validation scores don't improve for 100 rounds
[500]   train's l1: 228.505 valid's l1: 262.695
[1000]  train's l1: 206.936 valid's l1: 259.926
Early stopping, best iteration is:
[1290]  train's l1: 201.195 valid's l1: 259.42
fold 0: MAE valid: 259.42

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 225.3   valid's l1: 264.835
Early stopping, best iteration is:
[887]   train's l1: 211.514 valid's l1: 263.225
fold 1: MAE valid: 263.22

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 226.438 valid's l1: 268.231
[1000]  train's l1: 207.455 valid's l1: 266.401
Early stopping, best iteration is:
[1004]  train's l1: 207.415 valid's l1: 266.381
fold 2: MAE valid: 266.38

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 224.751 valid's l1: 270.8
Early stopping, best iteration is:
[874]   train's l1: 208.878 valid's l1: 268.227
fold 3: MAE valid: 268.23

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 227.956 valid's l1: 269.463
[1000]  train's l1: 208.803 valid's l1: 266.48
Early stopping, best iteration is:
[1134]  train's l1: 206.147 valid's l1: 266.22
fold 4: MAE valid: 266.22

CV score: 264.69</code></pre>
</div>
</div>
</section>
<section id="特徴エンジニアリング" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> 特徴エンジニアリング</h1>
<p>２つの変数の組合せで新しい特徴量を追加する.</p>
<ol type="1">
<li>数値変数 x 数値変数</li>
<li>数値変数 x カテゴリ変数</li>
<li>カテゴリ変数 x カテゴリ変数</li>
</ol>
<div id="cell-52" class="cell" data-execution_count="46">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a>df <span class="op">=</span> sns.load_dataset(<span class="st">"diamonds"</span>)</span>
<span id="cb59-2"><a href="#cb59-2"></a></span>
<span id="cb59-3"><a href="#cb59-3"></a>has_abnormal_size_value <span class="op">=</span> (</span>
<span id="cb59-4"><a href="#cb59-4"></a>    df</span>
<span id="cb59-5"><a href="#cb59-5"></a>    .<span class="bu">filter</span>(items <span class="op">=</span> [<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"z"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb59-6"><a href="#cb59-6"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> v: (v <span class="op">&lt;=</span> <span class="dv">0</span>) <span class="op">|</span> (v <span class="op">&gt;=</span> <span class="dv">10</span>), axis <span class="op">=</span>  <span class="dv">0</span>)</span>
<span id="cb59-7"><a href="#cb59-7"></a>    .<span class="bu">sum</span>(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb59-8"><a href="#cb59-8"></a>    .pipe(<span class="kw">lambda</span> ser: ser <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb59-9"><a href="#cb59-9"></a>)</span>
<span id="cb59-10"><a href="#cb59-10"></a></span>
<span id="cb59-11"><a href="#cb59-11"></a>df <span class="op">=</span> (</span>
<span id="cb59-12"><a href="#cb59-12"></a>    df</span>
<span id="cb59-13"><a href="#cb59-13"></a>    .query(<span class="st">"~ @has_abnormal_size_value"</span>)</span>
<span id="cb59-14"><a href="#cb59-14"></a>    .reset_index(drop <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb59-15"><a href="#cb59-15"></a>)</span>
<span id="cb59-16"><a href="#cb59-16"></a></span>
<span id="cb59-17"><a href="#cb59-17"></a><span class="co"># 特徴量と目的変数</span></span>
<span id="cb59-18"><a href="#cb59-18"></a>X <span class="op">=</span> df.drop([<span class="st">"price"</span>], axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb59-19"><a href="#cb59-19"></a>y <span class="op">=</span> df[<span class="st">"price"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>たとえば、ダイヤモンドの大きさはバランスが大事だと考えられるので、x, y, zの比率を追加したらどうか？という仮説を考える.</p>
<div id="cell-54" class="cell" data-execution_count="47">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a><span class="co"># 密度</span></span>
<span id="cb60-2"><a href="#cb60-2"></a>X[<span class="st">"density"</span>] <span class="op">=</span> X[<span class="st">"carat"</span>] <span class="op">/</span> (X[<span class="st">"x"</span>] <span class="op">*</span> X[<span class="st">"y"</span>] <span class="op">*</span> X[<span class="st">"z"</span>])</span>
<span id="cb60-3"><a href="#cb60-3"></a></span>
<span id="cb60-4"><a href="#cb60-4"></a><span class="co"># 差分</span></span>
<span id="cb60-5"><a href="#cb60-5"></a>X[<span class="st">"x-y"</span>] <span class="op">=</span> (X[<span class="st">"x"</span>] <span class="op">-</span> X[<span class="st">"y"</span>]).<span class="bu">abs</span>()</span>
<span id="cb60-6"><a href="#cb60-6"></a>X[<span class="st">"y-z"</span>] <span class="op">=</span> (X[<span class="st">"y"</span>] <span class="op">-</span> X[<span class="st">"z"</span>]).<span class="bu">abs</span>()</span>
<span id="cb60-7"><a href="#cb60-7"></a>X[<span class="st">"z-x"</span>] <span class="op">=</span> (X[<span class="st">"z"</span>] <span class="op">-</span> X[<span class="st">"x"</span>]).<span class="bu">abs</span>()</span>
<span id="cb60-8"><a href="#cb60-8"></a></span>
<span id="cb60-9"><a href="#cb60-9"></a><span class="co"># 中央値との差分</span></span>
<span id="cb60-10"><a href="#cb60-10"></a>X[<span class="st">"x-median_x"</span>] <span class="op">=</span> (X[<span class="st">"x"</span>] <span class="op">-</span> X[<span class="st">"x"</span>].median()).<span class="bu">abs</span>()</span>
<span id="cb60-11"><a href="#cb60-11"></a>X[<span class="st">"y-median_y"</span>] <span class="op">=</span> (X[<span class="st">"y"</span>] <span class="op">-</span> X[<span class="st">"y"</span>].median()).<span class="bu">abs</span>()</span>
<span id="cb60-12"><a href="#cb60-12"></a>X[<span class="st">"z-median_z"</span>] <span class="op">=</span> (X[<span class="st">"z"</span>] <span class="op">-</span> X[<span class="st">"z"</span>].median()).<span class="bu">abs</span>()</span>
<span id="cb60-13"><a href="#cb60-13"></a></span>
<span id="cb60-14"><a href="#cb60-14"></a><span class="co"># 比率</span></span>
<span id="cb60-15"><a href="#cb60-15"></a>X[<span class="st">"x/y"</span>] <span class="op">=</span> X[<span class="st">"x"</span>] <span class="op">/</span> X[<span class="st">"y"</span>]</span>
<span id="cb60-16"><a href="#cb60-16"></a>X[<span class="st">"y/z"</span>] <span class="op">=</span> X[<span class="st">"y"</span>] <span class="op">/</span> X[<span class="st">"z"</span>]</span>
<span id="cb60-17"><a href="#cb60-17"></a>X[<span class="st">"z/x"</span>] <span class="op">=</span> X[<span class="st">"z"</span>] <span class="op">/</span> X[<span class="st">"x"</span>]</span>
<span id="cb60-18"><a href="#cb60-18"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>数値 x カテゴリカル変数として、ターゲットエンコーディングを行う.</p>
<div id="cell-56" class="cell" data-execution_count="48">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>X[<span class="st">"median_carat_by_cut"</span>] <span class="op">=</span> X.groupby(<span class="st">"cut"</span>)[<span class="st">"carat"</span>].transform(pd.Series.median)</span>
<span id="cb61-2"><a href="#cb61-2"></a>X[<span class="st">"carat-median_carat_by_cut"</span>] <span class="op">=</span> (X[<span class="st">"carat"</span>] <span class="op">-</span> X[<span class="st">"median_carat_by_cut"</span>])</span>
<span id="cb61-3"><a href="#cb61-3"></a>X[<span class="st">"carat/median_carat_by_cut"</span>] <span class="op">=</span> (X[<span class="st">"carat"</span>] <span class="op">/</span> X[<span class="st">"median_carat_by_cut"</span>])</span>
<span id="cb61-4"><a href="#cb61-4"></a></span>
<span id="cb61-5"><a href="#cb61-5"></a>X[<span class="st">"median_carat_by_color"</span>] <span class="op">=</span> X.groupby(<span class="st">"color"</span>)[<span class="st">"carat"</span>].transform(pd.Series.median)</span>
<span id="cb61-6"><a href="#cb61-6"></a>X[<span class="st">"carat-median_carat_by_color"</span>] <span class="op">=</span> (X[<span class="st">"carat"</span>] <span class="op">-</span> X[<span class="st">"median_carat_by_color"</span>])</span>
<span id="cb61-7"><a href="#cb61-7"></a>X[<span class="st">"carat/median_carat_by_color"</span>] <span class="op">=</span> (X[<span class="st">"carat"</span>] <span class="op">/</span> X[<span class="st">"median_carat_by_color"</span>])</span>
<span id="cb61-8"><a href="#cb61-8"></a></span>
<span id="cb61-9"><a href="#cb61-9"></a>X[<span class="st">"median_carat_by_clarity"</span>] <span class="op">=</span> X.groupby(<span class="st">"clarity"</span>)[<span class="st">"carat"</span>].transform(pd.Series.median)</span>
<span id="cb61-10"><a href="#cb61-10"></a>X[<span class="st">"carat-median_carat_by_clarity"</span>] <span class="op">=</span> (X[<span class="st">"carat"</span>] <span class="op">-</span> X[<span class="st">"median_carat_by_clarity"</span>])</span>
<span id="cb61-11"><a href="#cb61-11"></a>X[<span class="st">"carat/median_carat_by_clarity"</span>] <span class="op">=</span> (X[<span class="st">"carat"</span>] <span class="op">/</span> X[<span class="st">"median_carat_by_clarity"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\suzuk\AppData\Local\Temp\ipykernel_18556\712484666.py:1: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  X["median_carat_by_cut"] = X.groupby("cut")["carat"].transform(pd.Series.median)
C:\Users\suzuk\AppData\Local\Temp\ipykernel_18556\712484666.py:5: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  X["median_carat_by_color"] = X.groupby("color")["carat"].transform(pd.Series.median)
C:\Users\suzuk\AppData\Local\Temp\ipykernel_18556\712484666.py:9: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  X["median_carat_by_clarity"] = X.groupby("clarity")["carat"].transform(pd.Series.median)</code></pre>
</div>
</div>
<p>カテゴリ変数 x カテゴリ変数</p>
<p>「カテゴリ変数の出現割合」を計算する。</p>
<div id="cell-58" class="cell" data-execution_count="49">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a>X_cross <span class="op">=</span> pd.crosstab(X[<span class="st">"cut"</span>], X[<span class="st">"color"</span>], normalize <span class="op">=</span> <span class="st">"index"</span>).reset_index()</span>
<span id="cb63-2"><a href="#cb63-2"></a>X_tbl <span class="op">=</span> pd.melt(X_cross, id_vars <span class="op">=</span> <span class="st">"cut"</span>, value_name <span class="op">=</span> <span class="st">"rate_cut*color"</span>)</span>
<span id="cb63-3"><a href="#cb63-3"></a>X <span class="op">=</span> pd.merge(X, X_tbl, on <span class="op">=</span> [<span class="st">"cut"</span>, <span class="st">"color"</span>], how <span class="op">=</span> <span class="st">"left"</span>)</span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a>X_cross <span class="op">=</span> pd.crosstab(X[<span class="st">"clarity"</span>], X[<span class="st">"cut"</span>], normalize <span class="op">=</span> <span class="st">"index"</span>).reset_index()</span>
<span id="cb63-6"><a href="#cb63-6"></a>X_tbl <span class="op">=</span> pd.melt(X_cross, id_vars <span class="op">=</span> <span class="st">"clarity"</span>, value_name <span class="op">=</span> <span class="st">"rate_clarity*cut"</span>)</span>
<span id="cb63-7"><a href="#cb63-7"></a>X <span class="op">=</span> pd.merge(X, X_tbl, on <span class="op">=</span> [<span class="st">"cut"</span>, <span class="st">"clarity"</span>], how <span class="op">=</span> <span class="st">"left"</span>)</span>
<span id="cb63-8"><a href="#cb63-8"></a></span>
<span id="cb63-9"><a href="#cb63-9"></a>X_cross <span class="op">=</span> pd.crosstab(X[<span class="st">"color"</span>], X[<span class="st">"clarity"</span>], normalize <span class="op">=</span> <span class="st">"index"</span>).reset_index()</span>
<span id="cb63-10"><a href="#cb63-10"></a>X_tbl <span class="op">=</span> pd.melt(X_cross, id_vars <span class="op">=</span> <span class="st">"color"</span>, value_name <span class="op">=</span> <span class="st">"rate_color*clarity"</span>)</span>
<span id="cb63-11"><a href="#cb63-11"></a>X <span class="op">=</span> pd.merge(X, X_tbl, on <span class="op">=</span> [<span class="st">"clarity"</span>, <span class="st">"color"</span>], how <span class="op">=</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-59" class="cell" data-execution_count="50">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a>X.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 53911 entries, 0 to 53910
Data columns (total 31 columns):
 #   Column                         Non-Null Count  Dtype  
---  ------                         --------------  -----  
 0   carat                          53911 non-null  float64
 1   cut                            53911 non-null  object 
 2   color                          53911 non-null  object 
 3   clarity                        53911 non-null  object 
 4   depth                          53911 non-null  float64
 5   table                          53911 non-null  float64
 6   x                              53911 non-null  float64
 7   y                              53911 non-null  float64
 8   z                              53911 non-null  float64
 9   density                        53911 non-null  float64
 10  x-y                            53911 non-null  float64
 11  y-z                            53911 non-null  float64
 12  z-x                            53911 non-null  float64
 13  x-median_x                     53911 non-null  float64
 14  y-median_y                     53911 non-null  float64
 15  z-median_z                     53911 non-null  float64
 16  x/y                            53911 non-null  float64
 17  y/z                            53911 non-null  float64
 18  z/x                            53911 non-null  float64
 19  median_carat_by_cut            53911 non-null  float64
 20  carat-median_carat_by_cut      53911 non-null  float64
 21  carat/median_carat_by_cut      53911 non-null  float64
 22  median_carat_by_color          53911 non-null  float64
 23  carat-median_carat_by_color    53911 non-null  float64
 24  carat/median_carat_by_color    53911 non-null  float64
 25  median_carat_by_clarity        53911 non-null  float64
 26  carat-median_carat_by_clarity  53911 non-null  float64
 27  carat/median_carat_by_clarity  53911 non-null  float64
 28  rate_cut*color                 53911 non-null  float64
 29  rate_clarity*cut               53911 non-null  float64
 30  rate_color*clarity             53911 non-null  float64
dtypes: float64(28), object(3)
memory usage: 12.8+ MB</code></pre>
</div>
</div>
<div id="cell-60" class="cell" data-execution_count="79">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a><span class="co"># テストとトレインデータへの分割</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb66-3"><a href="#cb66-3"></a>    X, </span>
<span id="cb66-4"><a href="#cb66-4"></a>    y, </span>
<span id="cb66-5"><a href="#cb66-5"></a>    test_size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span id="cb66-6"><a href="#cb66-6"></a>    shuffle <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb66-7"><a href="#cb66-7"></a>    random_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb66-8"><a href="#cb66-8"></a>)</span>
<span id="cb66-9"><a href="#cb66-9"></a></span>
<span id="cb66-10"><a href="#cb66-10"></a><span class="co"># カテゴリ変数をラベルエンコーディング</span></span>
<span id="cb66-11"><a href="#cb66-11"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb66-12"><a href="#cb66-12"></a>cat_cols <span class="op">=</span> [<span class="st">"cut"</span>, <span class="st">"color"</span>, <span class="st">"clarity"</span>]</span>
<span id="cb66-13"><a href="#cb66-13"></a></span>
<span id="cb66-14"><a href="#cb66-14"></a><span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb66-15"><a href="#cb66-15"></a>    le <span class="op">=</span> LabelEncoder()</span>
<span id="cb66-16"><a href="#cb66-16"></a>    le.fit(X_train[c])</span>
<span id="cb66-17"><a href="#cb66-17"></a>    X_train[c] <span class="op">=</span> le.transform(X_train[c])</span>
<span id="cb66-18"><a href="#cb66-18"></a>    X_test[c] <span class="op">=</span> le.transform(X_test[c])</span>
<span id="cb66-19"><a href="#cb66-19"></a>    </span>
<span id="cb66-20"><a href="#cb66-20"></a><span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb66-21"><a href="#cb66-21"></a>    X_train[c] <span class="op">=</span> X_train[c].astype(<span class="st">"category"</span>)</span>
<span id="cb66-22"><a href="#cb66-22"></a>    X_test[c] <span class="op">=</span> X_test[c].astype(<span class="st">"category"</span>) </span>
<span id="cb66-23"><a href="#cb66-23"></a></span>
<span id="cb66-24"><a href="#cb66-24"></a></span>
<span id="cb66-25"><a href="#cb66-25"></a><span class="co"># 検証データとバリーデーション</span></span>
<span id="cb66-26"><a href="#cb66-26"></a>X_tr, X_va, y_tr, y_va <span class="op">=</span> train_test_split(</span>
<span id="cb66-27"><a href="#cb66-27"></a>    X_train, </span>
<span id="cb66-28"><a href="#cb66-28"></a>    y_train, </span>
<span id="cb66-29"><a href="#cb66-29"></a>    test_size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span id="cb66-30"><a href="#cb66-30"></a>    shuffle <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb66-31"><a href="#cb66-31"></a>    random_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb66-32"><a href="#cb66-32"></a>)</span>
<span id="cb66-33"><a href="#cb66-33"></a></span>
<span id="cb66-34"><a href="#cb66-34"></a><span class="co"># ハイパーパラメータ設定</span></span>
<span id="cb66-35"><a href="#cb66-35"></a><span class="im">import</span> lightgbm <span class="im">as</span> lgb</span>
<span id="cb66-36"><a href="#cb66-36"></a>lgb_train <span class="op">=</span> lgb.Dataset(X_tr, y_tr)</span>
<span id="cb66-37"><a href="#cb66-37"></a>lgb_eval <span class="op">=</span> lgb.Dataset(X_va, y_va, reference <span class="op">=</span> lgb_train)</span>
<span id="cb66-38"><a href="#cb66-38"></a></span>
<span id="cb66-39"><a href="#cb66-39"></a>params <span class="op">=</span> {</span>
<span id="cb66-40"><a href="#cb66-40"></a>    <span class="st">"objective"</span>: <span class="st">"mae"</span>, <span class="co"># mean absolute error</span></span>
<span id="cb66-41"><a href="#cb66-41"></a>    <span class="st">"seed"</span>: <span class="dv">0</span>, </span>
<span id="cb66-42"><a href="#cb66-42"></a>    <span class="st">"verbose"</span>: <span class="op">-</span><span class="dv">1</span>, </span>
<span id="cb66-43"><a href="#cb66-43"></a>}</span>
<span id="cb66-44"><a href="#cb66-44"></a></span>
<span id="cb66-45"><a href="#cb66-45"></a>evals_result <span class="op">=</span> {}</span>
<span id="cb66-46"><a href="#cb66-46"></a></span>
<span id="cb66-47"><a href="#cb66-47"></a>model <span class="op">=</span> lgb.train(</span>
<span id="cb66-48"><a href="#cb66-48"></a>    params, </span>
<span id="cb66-49"><a href="#cb66-49"></a>    lgb_train, </span>
<span id="cb66-50"><a href="#cb66-50"></a>    num_boost_round<span class="op">=</span><span class="dv">10_000</span>,</span>
<span id="cb66-51"><a href="#cb66-51"></a>    valid_sets <span class="op">=</span> [lgb_train, lgb_eval], </span>
<span id="cb66-52"><a href="#cb66-52"></a>    valid_names <span class="op">=</span> [<span class="st">"train"</span>, <span class="st">"valid"</span>], </span>
<span id="cb66-53"><a href="#cb66-53"></a>    callbacks <span class="op">=</span> [</span>
<span id="cb66-54"><a href="#cb66-54"></a>        lgb.early_stopping(<span class="dv">100</span>), </span>
<span id="cb66-55"><a href="#cb66-55"></a>        lgb.log_evaluation(<span class="dv">500</span>), </span>
<span id="cb66-56"><a href="#cb66-56"></a>        lgb.record_evaluation(evals_result)</span>
<span id="cb66-57"><a href="#cb66-57"></a>    ]</span>
<span id="cb66-58"><a href="#cb66-58"></a>)</span>
<span id="cb66-59"><a href="#cb66-59"></a></span>
<span id="cb66-60"><a href="#cb66-60"></a>y_va_pred <span class="op">=</span> model.predict(X_va, num_iteration<span class="op">=</span>model.best_iteration)</span>
<span id="cb66-61"><a href="#cb66-61"></a>score <span class="op">=</span> mean_absolute_error(y_va, y_va_pred)</span>
<span id="cb66-62"><a href="#cb66-62"></a><span class="bu">print</span>(<span class="ss">f"MAE valid: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training until validation scores don't improve for 100 rounds
[500]   train's l1: 211.66  valid's l1: 252.269
[1000]  train's l1: 190.54  valid's l1: 250.354
Early stopping, best iteration is:
[1072]  train's l1: 188.209 valid's l1: 250.238
MAE valid: 250.24</code></pre>
</div>
</div>
<div id="cell-61" class="cell" data-execution_count="53">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>X_train.describe().T</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="53">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">carat</td>
<td>43128.000</td>
<td>0.797</td>
<td>0.472</td>
<td>0.200</td>
<td>0.400</td>
<td>0.700</td>
<td>1.040</td>
<td>3.670</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">depth</td>
<td>43128.000</td>
<td>61.749</td>
<td>1.427</td>
<td>43.000</td>
<td>61.000</td>
<td>61.800</td>
<td>62.500</td>
<td>79.000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">table</td>
<td>43128.000</td>
<td>57.458</td>
<td>2.232</td>
<td>43.000</td>
<td>56.000</td>
<td>57.000</td>
<td>59.000</td>
<td>95.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x</td>
<td>43128.000</td>
<td>5.731</td>
<td>1.117</td>
<td>3.730</td>
<td>4.710</td>
<td>5.700</td>
<td>6.530</td>
<td>9.860</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">y</td>
<td>43128.000</td>
<td>5.732</td>
<td>1.109</td>
<td>3.680</td>
<td>4.720</td>
<td>5.710</td>
<td>6.530</td>
<td>9.810</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">z</td>
<td>43128.000</td>
<td>3.539</td>
<td>0.690</td>
<td>1.070</td>
<td>2.910</td>
<td>3.530</td>
<td>4.030</td>
<td>6.380</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">density</td>
<td>43128.000</td>
<td>0.006</td>
<td>0.000</td>
<td>0.003</td>
<td>0.006</td>
<td>0.006</td>
<td>0.006</td>
<td>0.023</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x-y</td>
<td>43128.000</td>
<td>0.046</td>
<td>0.037</td>
<td>0.000</td>
<td>0.030</td>
<td>0.040</td>
<td>0.060</td>
<td>2.550</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">y-z</td>
<td>43128.000</td>
<td>2.194</td>
<td>0.435</td>
<td>0.020</td>
<td>1.800</td>
<td>2.160</td>
<td>2.510</td>
<td>5.810</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">z-x</td>
<td>43128.000</td>
<td>2.192</td>
<td>0.443</td>
<td>0.050</td>
<td>1.800</td>
<td>2.150</td>
<td>2.520</td>
<td>5.900</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">x-median_x</td>
<td>43128.000</td>
<td>0.950</td>
<td>0.589</td>
<td>0.000</td>
<td>0.520</td>
<td>0.920</td>
<td>1.320</td>
<td>4.160</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">y-median_y</td>
<td>43128.000</td>
<td>0.944</td>
<td>0.583</td>
<td>0.000</td>
<td>0.510</td>
<td>0.920</td>
<td>1.320</td>
<td>4.100</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">z-median_z</td>
<td>43128.000</td>
<td>0.589</td>
<td>0.360</td>
<td>0.000</td>
<td>0.330</td>
<td>0.570</td>
<td>0.820</td>
<td>2.850</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">x/y</td>
<td>43128.000</td>
<td>0.999</td>
<td>0.011</td>
<td>0.749</td>
<td>0.993</td>
<td>0.996</td>
<td>1.007</td>
<td>1.616</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">y/z</td>
<td>43128.000</td>
<td>1.621</td>
<td>0.048</td>
<td>0.996</td>
<td>1.599</td>
<td>1.619</td>
<td>1.640</td>
<td>6.234</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">z/x</td>
<td>43128.000</td>
<td>0.618</td>
<td>0.015</td>
<td>0.162</td>
<td>0.611</td>
<td>0.619</td>
<td>0.626</td>
<td>1.010</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">median_carat_by_cut</td>
<td>43128.000</td>
<td>0.696</td>
<td>0.141</td>
<td>0.540</td>
<td>0.540</td>
<td>0.710</td>
<td>0.850</td>
<td>1.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">carat-median_carat_by_cut</td>
<td>43128.000</td>
<td>0.101</td>
<td>0.467</td>
<td>-0.780</td>
<td>-0.230</td>
<td>0.000</td>
<td>0.350</td>
<td>2.960</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">carat/median_carat_by_cut</td>
<td>43128.000</td>
<td>1.167</td>
<td>0.699</td>
<td>0.220</td>
<td>0.606</td>
<td>1.000</td>
<td>1.465</td>
<td>6.481</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">median_carat_by_color</td>
<td>43128.000</td>
<td>0.730</td>
<td>0.179</td>
<td>0.530</td>
<td>0.530</td>
<td>0.700</td>
<td>0.900</td>
<td>1.110</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">carat-median_carat_by_color</td>
<td>43128.000</td>
<td>0.067</td>
<td>0.452</td>
<td>-0.880</td>
<td>-0.260</td>
<td>0.000</td>
<td>0.330</td>
<td>2.870</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">carat/median_carat_by_color</td>
<td>43128.000</td>
<td>1.111</td>
<td>0.627</td>
<td>0.207</td>
<td>0.600</td>
<td>1.000</td>
<td>1.457</td>
<td>6.415</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">median_carat_by_clarity</td>
<td>43128.000</td>
<td>0.680</td>
<td>0.199</td>
<td>0.350</td>
<td>0.570</td>
<td>0.630</td>
<td>0.760</td>
<td>1.110</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">carat-median_carat_by_clarity</td>
<td>43128.000</td>
<td>0.117</td>
<td>0.440</td>
<td>-0.810</td>
<td>-0.200</td>
<td>0.000</td>
<td>0.360</td>
<td>2.880</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">carat/median_carat_by_clarity</td>
<td>43128.000</td>
<td>1.200</td>
<td>0.685</td>
<td>0.228</td>
<td>0.693</td>
<td>1.000</td>
<td>1.579</td>
<td>6.543</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">rate_cut*color</td>
<td>43128.000</td>
<td>0.161</td>
<td>0.044</td>
<td>0.042</td>
<td>0.132</td>
<td>0.171</td>
<td>0.190</td>
<td>0.227</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">rate_clarity*cut</td>
<td>43128.000</td>
<td>0.300</td>
<td>0.135</td>
<td>0.005</td>
<td>0.217</td>
<td>0.274</td>
<td>0.414</td>
<td>0.677</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">rate_color*clarity</td>
<td>43128.000</td>
<td>0.182</td>
<td>0.071</td>
<td>0.006</td>
<td>0.137</td>
<td>0.190</td>
<td>0.248</td>
<td>0.307</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="54">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a>X_tr.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">carat</th>
<th data-quarto-table-cell-role="th">depth</th>
<th data-quarto-table-cell-role="th">table</th>
<th data-quarto-table-cell-role="th">x</th>
<th data-quarto-table-cell-role="th">y</th>
<th data-quarto-table-cell-role="th">z</th>
<th data-quarto-table-cell-role="th">density</th>
<th data-quarto-table-cell-role="th">x-y</th>
<th data-quarto-table-cell-role="th">y-z</th>
<th data-quarto-table-cell-role="th">z-x</th>
<th data-quarto-table-cell-role="th">...</th>
<th data-quarto-table-cell-role="th">carat/median_carat_by_cut</th>
<th data-quarto-table-cell-role="th">median_carat_by_color</th>
<th data-quarto-table-cell-role="th">carat-median_carat_by_color</th>
<th data-quarto-table-cell-role="th">carat/median_carat_by_color</th>
<th data-quarto-table-cell-role="th">median_carat_by_clarity</th>
<th data-quarto-table-cell-role="th">carat-median_carat_by_clarity</th>
<th data-quarto-table-cell-role="th">carat/median_carat_by_clarity</th>
<th data-quarto-table-cell-role="th">rate_cut*color</th>
<th data-quarto-table-cell-role="th">rate_clarity*cut</th>
<th data-quarto-table-cell-role="th">rate_color*clarity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>...</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
<td>34502.000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>0.797</td>
<td>61.753</td>
<td>57.462</td>
<td>5.730</td>
<td>5.732</td>
<td>3.539</td>
<td>0.006</td>
<td>0.046</td>
<td>2.193</td>
<td>2.191</td>
<td>...</td>
<td>1.167</td>
<td>0.730</td>
<td>0.067</td>
<td>1.111</td>
<td>0.680</td>
<td>0.117</td>
<td>1.200</td>
<td>0.161</td>
<td>0.300</td>
<td>0.182</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>0.473</td>
<td>1.428</td>
<td>2.232</td>
<td>1.117</td>
<td>1.109</td>
<td>0.690</td>
<td>0.000</td>
<td>0.037</td>
<td>0.435</td>
<td>0.442</td>
<td>...</td>
<td>0.699</td>
<td>0.179</td>
<td>0.452</td>
<td>0.628</td>
<td>0.200</td>
<td>0.441</td>
<td>0.686</td>
<td>0.044</td>
<td>0.135</td>
<td>0.071</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>0.200</td>
<td>43.000</td>
<td>44.000</td>
<td>3.730</td>
<td>3.680</td>
<td>1.410</td>
<td>0.003</td>
<td>0.000</td>
<td>0.020</td>
<td>0.050</td>
<td>...</td>
<td>0.220</td>
<td>0.530</td>
<td>-0.880</td>
<td>0.207</td>
<td>0.350</td>
<td>-0.800</td>
<td>0.248</td>
<td>0.042</td>
<td>0.005</td>
<td>0.006</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>0.400</td>
<td>61.000</td>
<td>56.000</td>
<td>4.720</td>
<td>4.730</td>
<td>2.910</td>
<td>0.006</td>
<td>0.030</td>
<td>1.810</td>
<td>1.800</td>
<td>...</td>
<td>0.610</td>
<td>0.530</td>
<td>-0.260</td>
<td>0.590</td>
<td>0.570</td>
<td>-0.200</td>
<td>0.693</td>
<td>0.132</td>
<td>0.217</td>
<td>0.137</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>0.700</td>
<td>61.800</td>
<td>57.000</td>
<td>5.700</td>
<td>5.710</td>
<td>3.520</td>
<td>0.006</td>
<td>0.040</td>
<td>2.160</td>
<td>2.150</td>
<td>...</td>
<td>1.000</td>
<td>0.700</td>
<td>0.000</td>
<td>1.000</td>
<td>0.630</td>
<td>0.000</td>
<td>1.000</td>
<td>0.171</td>
<td>0.274</td>
<td>0.190</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>1.040</td>
<td>62.500</td>
<td>59.000</td>
<td>6.530</td>
<td>6.530</td>
<td>4.030</td>
<td>0.006</td>
<td>0.060</td>
<td>2.510</td>
<td>2.510</td>
<td>...</td>
<td>1.465</td>
<td>0.900</td>
<td>0.330</td>
<td>1.457</td>
<td>0.760</td>
<td>0.360</td>
<td>1.579</td>
<td>0.190</td>
<td>0.414</td>
<td>0.248</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>3.670</td>
<td>79.000</td>
<td>95.000</td>
<td>9.860</td>
<td>9.810</td>
<td>6.380</td>
<td>0.019</td>
<td>2.550</td>
<td>5.810</td>
<td>5.900</td>
<td>...</td>
<td>6.481</td>
<td>1.110</td>
<td>2.870</td>
<td>6.415</td>
<td>1.110</td>
<td>2.880</td>
<td>6.543</td>
<td>0.227</td>
<td>0.677</td>
<td>0.307</td>
</tr>
</tbody>
</table>

<p>8 rows × 28 columns</p>
</div>
</div>
</div>
<div id="cell-63" class="cell" data-execution_count="55">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># 特徴量の可視化</span></span>
<span id="cb70-2"><a href="#cb70-2"></a>importances <span class="op">=</span> model.feature_importance(importance_type <span class="op">=</span> <span class="st">"gain"</span>)</span>
<span id="cb70-3"><a href="#cb70-3"></a>indices <span class="op">=</span> np.argsort(importances)[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb70-4"><a href="#cb70-4"></a></span>
<span id="cb70-5"><a href="#cb70-5"></a>fig <span class="op">=</span> plt.figure(figsize <span class="op">=</span> (<span class="dv">8</span>, <span class="dv">4</span>))</span>
<span id="cb70-6"><a href="#cb70-6"></a>plt.title(<span class="st">"Feature Importance"</span>)</span>
<span id="cb70-7"><a href="#cb70-7"></a>plt.bar(<span class="bu">range</span>(<span class="bu">len</span>(indices)), importances[indices])</span>
<span id="cb70-8"><a href="#cb70-8"></a>plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(indices)), X.columns[indices], rotation <span class="op">=</span> <span class="dv">90</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>([&lt;matplotlib.axis.XTick at 0x2c20dc77a50&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dc0a510&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dc23a90&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da6eb10&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da70e10&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da73010&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da75290&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da72410&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da77e50&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da7de50&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da7ffd0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da86190&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20d9f79d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da98990&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da9ac50&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da9ce10&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da9e9d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20daa1310&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20da7cad0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20daa38d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20daa58d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20daa7a10&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20daadc90&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20daa26d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dab46d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dab66d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dac0850&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dac2a90&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dac21d0&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dac4f90&gt;,
  &lt;matplotlib.axis.XTick at 0x2c20dac7010&gt;],
 [Text(0, 0, 'y'),
  Text(1, 0, 'carat'),
  Text(2, 0, 'carat/median_carat_by_color'),
  Text(3, 0, 'carat/median_carat_by_clarity'),
  Text(4, 0, 'carat-median_carat_by_color'),
  Text(5, 0, 'carat-median_carat_by_clarity'),
  Text(6, 0, 'x/y'),
  Text(7, 0, 'z'),
  Text(8, 0, 'color'),
  Text(9, 0, 'carat/median_carat_by_cut'),
  Text(10, 0, 'density'),
  Text(11, 0, 'rate_color*clarity'),
  Text(12, 0, 'y/z'),
  Text(13, 0, 'carat-median_carat_by_cut'),
  Text(14, 0, 'rate_cut*color'),
  Text(15, 0, 'z/x'),
  Text(16, 0, 'y-median_y'),
  Text(17, 0, 'x'),
  Text(18, 0, 'clarity'),
  Text(19, 0, 'table'),
  Text(20, 0, 'x-median_x'),
  Text(21, 0, 'y-z'),
  Text(22, 0, 'z-x'),
  Text(23, 0, 'rate_clarity*cut'),
  Text(24, 0, 'depth'),
  Text(25, 0, 'x-y'),
  Text(26, 0, 'median_carat_by_clarity'),
  Text(27, 0, 'z-median_z'),
  Text(28, 0, 'cut'),
  Text(29, 0, 'median_carat_by_color'),
  Text(30, 0, 'median_carat_by_cut')])</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="cl04_回帰の予測モデル改善_files/figure-html/cell-51-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-64" class="cell" data-execution_count="56">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># クロスバリデーションのモデル評価</span></span>
<span id="cb72-2"><a href="#cb72-2"></a></span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> KFold</span>
<span id="cb72-4"><a href="#cb72-4"></a></span>
<span id="cb72-5"><a href="#cb72-5"></a>params <span class="op">=</span> {</span>
<span id="cb72-6"><a href="#cb72-6"></a>    <span class="st">"objective"</span>: <span class="st">"mae"</span>, </span>
<span id="cb72-7"><a href="#cb72-7"></a>    <span class="st">"seed"</span>: <span class="dv">0</span>, </span>
<span id="cb72-8"><a href="#cb72-8"></a>    <span class="st">"verbose"</span>: <span class="op">-</span><span class="dv">1</span></span>
<span id="cb72-9"><a href="#cb72-9"></a>}</span>
<span id="cb72-10"><a href="#cb72-10"></a></span>
<span id="cb72-11"><a href="#cb72-11"></a>valid_scores <span class="op">=</span> []</span>
<span id="cb72-12"><a href="#cb72-12"></a>models <span class="op">=</span> []</span>
<span id="cb72-13"><a href="#cb72-13"></a>oof <span class="op">=</span> np.zeros(<span class="bu">len</span>(X_train))</span>
<span id="cb72-14"><a href="#cb72-14"></a></span>
<span id="cb72-15"><a href="#cb72-15"></a>kf <span class="op">=</span> KFold(n_splits <span class="op">=</span> <span class="dv">5</span>, shuffle <span class="op">=</span> <span class="va">True</span>, random_state <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb72-16"><a href="#cb72-16"></a><span class="cf">for</span> fold, (tr_idx, va_idx) <span class="kw">in</span> <span class="bu">enumerate</span>(kf.split(X_train)):</span>
<span id="cb72-17"><a href="#cb72-17"></a>    X_tr, y_tr <span class="op">=</span> X_train.iloc[tr_idx], y_train.iloc[tr_idx]</span>
<span id="cb72-18"><a href="#cb72-18"></a>    X_va, y_va <span class="op">=</span> X_train.iloc[va_idx], y_train.iloc[va_idx]</span>
<span id="cb72-19"><a href="#cb72-19"></a>    </span>
<span id="cb72-20"><a href="#cb72-20"></a>    lgb_train <span class="op">=</span> lgb.Dataset(X_tr, y_tr)</span>
<span id="cb72-21"><a href="#cb72-21"></a>    lgb_eval <span class="op">=</span> lgb.Dataset(X_va, y_va, reference <span class="op">=</span> lgb_train)</span>
<span id="cb72-22"><a href="#cb72-22"></a>    </span>
<span id="cb72-23"><a href="#cb72-23"></a>    model <span class="op">=</span> lgb.train(</span>
<span id="cb72-24"><a href="#cb72-24"></a>        params, </span>
<span id="cb72-25"><a href="#cb72-25"></a>        lgb_train, </span>
<span id="cb72-26"><a href="#cb72-26"></a>        num_boost_round <span class="op">=</span> <span class="dv">10_000</span>, </span>
<span id="cb72-27"><a href="#cb72-27"></a>        valid_sets <span class="op">=</span> [lgb_train, lgb_eval], </span>
<span id="cb72-28"><a href="#cb72-28"></a>        valid_names <span class="op">=</span> [<span class="st">"train"</span>, <span class="st">"valid"</span>], </span>
<span id="cb72-29"><a href="#cb72-29"></a>        callbacks <span class="op">=</span> [lgb.early_stopping(<span class="dv">100</span>), lgb.log_evaluation(<span class="dv">500</span>)]</span>
<span id="cb72-30"><a href="#cb72-30"></a>    )</span>
<span id="cb72-31"><a href="#cb72-31"></a>    </span>
<span id="cb72-32"><a href="#cb72-32"></a>    y_va_pred <span class="op">=</span> model.predict(</span>
<span id="cb72-33"><a href="#cb72-33"></a>        X_va, </span>
<span id="cb72-34"><a href="#cb72-34"></a>        num_iteration <span class="op">=</span> model.best_iteration, </span>
<span id="cb72-35"><a href="#cb72-35"></a>    )</span>
<span id="cb72-36"><a href="#cb72-36"></a>    score <span class="op">=</span> mean_absolute_error(y_va, y_va_pred)</span>
<span id="cb72-37"><a href="#cb72-37"></a>    <span class="bu">print</span>(<span class="ss">f"fold </span><span class="sc">{</span>fold<span class="sc">}</span><span class="ss">: MAE valid: </span><span class="sc">{</span>score<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb72-38"><a href="#cb72-38"></a>    <span class="bu">print</span>(<span class="st">""</span>)</span>
<span id="cb72-39"><a href="#cb72-39"></a>    </span>
<span id="cb72-40"><a href="#cb72-40"></a>    valid_scores.append(score)</span>
<span id="cb72-41"><a href="#cb72-41"></a>    models.append(model)</span>
<span id="cb72-42"><a href="#cb72-42"></a>    oof[va_idx] <span class="op">=</span> y_va_pred</span>
<span id="cb72-43"><a href="#cb72-43"></a>    </span>
<span id="cb72-44"><a href="#cb72-44"></a>cv_score <span class="op">=</span> np.mean(valid_scores)</span>
<span id="cb72-45"><a href="#cb72-45"></a><span class="bu">print</span>(<span class="ss">f"CV score: </span><span class="sc">{</span>cv_score<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training until validation scores don't improve for 100 rounds
[500]   train's l1: 211.66  valid's l1: 252.269
[1000]  train's l1: 190.54  valid's l1: 250.354
Early stopping, best iteration is:
[1072]  train's l1: 188.209 valid's l1: 250.238
fold 0: MAE valid: 250.24

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 211.28  valid's l1: 256.264
Early stopping, best iteration is:
[462]   train's l1: 214.583 valid's l1: 255.951
fold 1: MAE valid: 255.95

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 210.92  valid's l1: 258.191
Early stopping, best iteration is:
[809]   train's l1: 194.781 valid's l1: 256.287
fold 2: MAE valid: 256.29

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 208.167 valid's l1: 263.012
[1000]  train's l1: 187.819 valid's l1: 260.239
[1500]  train's l1: 175.587 valid's l1: 258.718
Early stopping, best iteration is:
[1503]  train's l1: 175.511 valid's l1: 258.709
fold 3: MAE valid: 258.71

Training until validation scores don't improve for 100 rounds
[500]   train's l1: 211.397 valid's l1: 256.522
[1000]  train's l1: 188.966 valid's l1: 253.839
[1500]  train's l1: 178.621 valid's l1: 253.121
Early stopping, best iteration is:
[1853]  train's l1: 174.522 valid's l1: 252.696
fold 4: MAE valid: 252.70

CV score: 254.78</code></pre>
</div>
</div>
<section id="optunaを用いたハイパーパラメータチューニング" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="optunaを用いたハイパーパラメータチューニング"><span class="header-section-number">4.1</span> Optunaを用いたハイパーパラメータチューニング</h2>
<div id="cell-66" class="cell" data-execution_count="80">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a></span>
<span id="cb74-2"><a href="#cb74-2"></a>params_base <span class="op">=</span> {</span>
<span id="cb74-3"><a href="#cb74-3"></a>    <span class="st">"objective"</span>: <span class="st">"mae"</span>, </span>
<span id="cb74-4"><a href="#cb74-4"></a>    <span class="st">"random_seed"</span>: <span class="dv">1234</span>, </span>
<span id="cb74-5"><a href="#cb74-5"></a>    <span class="st">"learning_rate"</span>: <span class="fl">.02</span>, </span>
<span id="cb74-6"><a href="#cb74-6"></a>    <span class="st">"min_data_in_bin"</span>: <span class="dv">3</span>, </span>
<span id="cb74-7"><a href="#cb74-7"></a>    <span class="st">"bagging_freq"</span>: <span class="dv">1</span>, </span>
<span id="cb74-8"><a href="#cb74-8"></a>    <span class="st">"bagging_seed"</span>: <span class="dv">0</span>, </span>
<span id="cb74-9"><a href="#cb74-9"></a>    <span class="st">"verbose"</span>: <span class="op">-</span><span class="dv">1</span>, </span>
<span id="cb74-10"><a href="#cb74-10"></a>}</span>
<span id="cb74-11"><a href="#cb74-11"></a></span>
<span id="cb74-12"><a href="#cb74-12"></a><span class="kw">def</span> objective(trial): </span>
<span id="cb74-13"><a href="#cb74-13"></a>    params_tuning <span class="op">=</span> {</span>
<span id="cb74-14"><a href="#cb74-14"></a>        <span class="st">"num_leaves"</span>: trial.suggest_int(<span class="st">"num_leaves"</span>, <span class="dv">50</span>, <span class="dv">200</span>), </span>
<span id="cb74-15"><a href="#cb74-15"></a>        <span class="st">"min_data_in_leaf"</span>: trial.suggest_int(<span class="st">"min_data_in_leaf"</span>, <span class="dv">2</span>, <span class="dv">30</span>), </span>
<span id="cb74-16"><a href="#cb74-16"></a>        <span class="st">"max_bin"</span>: trial.suggest_int(<span class="st">"max_bin"</span>, <span class="dv">200</span>, <span class="dv">400</span>), </span>
<span id="cb74-17"><a href="#cb74-17"></a>        <span class="st">"bagging_fraction"</span>: trial.suggest_float(<span class="st">"bagging_fraction"</span>, <span class="fl">.8</span>, <span class="fl">.95</span>), </span>
<span id="cb74-18"><a href="#cb74-18"></a>        <span class="st">"feature_fraction"</span>: trial.suggest_float(<span class="st">"feature_fraction"</span>, <span class="fl">.35</span>, <span class="fl">.65</span>), </span>
<span id="cb74-19"><a href="#cb74-19"></a>        <span class="st">"min_gain_to_split"</span>: trial.suggest_float(<span class="st">"min_gain_to_split"</span>, <span class="fl">.01</span>, <span class="dv">1</span>, log <span class="op">=</span> <span class="va">True</span>), </span>
<span id="cb74-20"><a href="#cb74-20"></a>        <span class="st">"lambda_l1"</span>: trial.suggest_float(<span class="st">"lambda_l1"</span>, <span class="fl">.01</span>, <span class="dv">1</span>, log <span class="op">=</span> <span class="va">True</span>),</span>
<span id="cb74-21"><a href="#cb74-21"></a>        <span class="st">"lambda_l2"</span>: trial.suggest_float(<span class="st">"lambda_l2"</span>, <span class="fl">.01</span>, <span class="dv">1</span>, log <span class="op">=</span> <span class="va">True</span>),</span>
<span id="cb74-22"><a href="#cb74-22"></a>    }</span>
<span id="cb74-23"><a href="#cb74-23"></a>    </span>
<span id="cb74-24"><a href="#cb74-24"></a>    params_tuning.update(params)</span>
<span id="cb74-25"><a href="#cb74-25"></a>    lgb_train <span class="op">=</span> lgb.Dataset(X_tr, y_tr)</span>
<span id="cb74-26"><a href="#cb74-26"></a>    lgb_eval <span class="op">=</span> lgb.Dataset(X_va, y_va)</span>
<span id="cb74-27"><a href="#cb74-27"></a>    </span>
<span id="cb74-28"><a href="#cb74-28"></a>    model <span class="op">=</span> lgb.train(</span>
<span id="cb74-29"><a href="#cb74-29"></a>        params_tuning, </span>
<span id="cb74-30"><a href="#cb74-30"></a>        lgb_train, </span>
<span id="cb74-31"><a href="#cb74-31"></a>        num_boost_round <span class="op">=</span> <span class="dv">1000</span>, </span>
<span id="cb74-32"><a href="#cb74-32"></a>        valid_sets <span class="op">=</span> [lgb_train, lgb_eval], </span>
<span id="cb74-33"><a href="#cb74-33"></a>        valid_names <span class="op">=</span> [<span class="st">"train"</span>, <span class="st">"valid"</span>], </span>
<span id="cb74-34"><a href="#cb74-34"></a>        callbacks <span class="op">=</span> [lgb.early_stopping(<span class="dv">100</span>), lgb.log_evaluation(<span class="dv">500</span>)]</span>
<span id="cb74-35"><a href="#cb74-35"></a>    )</span>
<span id="cb74-36"><a href="#cb74-36"></a>    y_va_pred <span class="op">=</span> model.predict(X_va, num_iteration<span class="op">=</span>model.best_iteration)</span>
<span id="cb74-37"><a href="#cb74-37"></a>    score <span class="op">=</span> mean_absolute_error(y_va, y_va_pred)</span>
<span id="cb74-38"><a href="#cb74-38"></a>    <span class="bu">print</span>(<span class="st">"- * - "</span> <span class="op">*</span> <span class="dv">10</span>)</span>
<span id="cb74-39"><a href="#cb74-39"></a>    <span class="cf">return</span> score</span>
<span id="cb74-40"><a href="#cb74-40"></a></span>
<span id="cb74-41"><a href="#cb74-41"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb74-42"><a href="#cb74-42"></a>    X, </span>
<span id="cb74-43"><a href="#cb74-43"></a>    y, </span>
<span id="cb74-44"><a href="#cb74-44"></a>    test_size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span id="cb74-45"><a href="#cb74-45"></a>    shuffle <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb74-46"><a href="#cb74-46"></a>    random_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb74-47"><a href="#cb74-47"></a>)</span>
<span id="cb74-48"><a href="#cb74-48"></a></span>
<span id="cb74-49"><a href="#cb74-49"></a><span class="co"># カテゴリ変数をラベルエンコーディング</span></span>
<span id="cb74-50"><a href="#cb74-50"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> LabelEncoder</span>
<span id="cb74-51"><a href="#cb74-51"></a>cat_cols <span class="op">=</span> [<span class="st">"cut"</span>, <span class="st">"color"</span>, <span class="st">"clarity"</span>]</span>
<span id="cb74-52"><a href="#cb74-52"></a></span>
<span id="cb74-53"><a href="#cb74-53"></a><span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb74-54"><a href="#cb74-54"></a>    le <span class="op">=</span> LabelEncoder()</span>
<span id="cb74-55"><a href="#cb74-55"></a>    le.fit(X_train[c])</span>
<span id="cb74-56"><a href="#cb74-56"></a>    X_train[c] <span class="op">=</span> le.transform(X_train[c])</span>
<span id="cb74-57"><a href="#cb74-57"></a>    X_test[c] <span class="op">=</span> le.transform(X_test[c])</span>
<span id="cb74-58"><a href="#cb74-58"></a>    </span>
<span id="cb74-59"><a href="#cb74-59"></a><span class="cf">for</span> c <span class="kw">in</span> cat_cols:</span>
<span id="cb74-60"><a href="#cb74-60"></a>    X_train[c] <span class="op">=</span> X_train[c].astype(<span class="st">"category"</span>)</span>
<span id="cb74-61"><a href="#cb74-61"></a>    X_test[c] <span class="op">=</span> X_test[c].astype(<span class="st">"category"</span>) </span>
<span id="cb74-62"><a href="#cb74-62"></a></span>
<span id="cb74-63"><a href="#cb74-63"></a></span>
<span id="cb74-64"><a href="#cb74-64"></a><span class="co"># 検証データとバリーデーション</span></span>
<span id="cb74-65"><a href="#cb74-65"></a>X_tr, X_va, y_tr, y_va <span class="op">=</span> train_test_split(</span>
<span id="cb74-66"><a href="#cb74-66"></a>    X_train, </span>
<span id="cb74-67"><a href="#cb74-67"></a>    y_train, </span>
<span id="cb74-68"><a href="#cb74-68"></a>    test_size <span class="op">=</span> <span class="fl">.2</span>, </span>
<span id="cb74-69"><a href="#cb74-69"></a>    shuffle <span class="op">=</span> <span class="va">True</span>, </span>
<span id="cb74-70"><a href="#cb74-70"></a>    random_state <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb74-71"><a href="#cb74-71"></a>)</span>
<span id="cb74-72"><a href="#cb74-72"></a>    </span>
<span id="cb74-73"><a href="#cb74-73"></a><span class="im">import</span> optuna</span>
<span id="cb74-74"><a href="#cb74-74"></a>study <span class="op">=</span> optuna.create_study(sampler <span class="op">=</span> optuna.samplers.TPESampler(seed <span class="op">=</span> <span class="dv">0</span>), direction <span class="op">=</span> <span class="st">"minimize"</span>)</span>
<span id="cb74-75"><a href="#cb74-75"></a>study.optimize(objective, n_trials <span class="op">=</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2024-01-04 14:49:15,250] A new study created in memory with name: no-name-1e7e646f-7232-48dd-8da4-f75d4a1f3f61
[I 2024-01-04 14:49:18,073] Trial 0 finished with value: 250.21391409400061 and parameters: {'num_leaves': 132, 'min_data_in_leaf': 22, 'max_bin': 321, 'bagging_fraction': 0.8817324774495345, 'feature_fraction': 0.4770964398016714, 'min_gain_to_split': 0.19578897201213002, 'lambda_l1': 0.07501954443620121, 'lambda_l2': 0.6074996073425692}. Best is trial 0 with value: 250.21391409400061.
[I 2024-01-04 14:49:23,466] Trial 1 finished with value: 248.89774199499587 and parameters: {'num_leaves': 195, 'min_data_in_leaf': 13, 'max_bin': 359, 'bagging_fraction': 0.8793342379629356, 'feature_fraction': 0.5204133683281797, 'min_gain_to_split': 0.70989362574059, 'lambda_l1': 0.013869861245357327, 'lambda_l2': 0.014936835544198456}. Best is trial 1 with value: 248.89774199499587.
[I 2024-01-04 14:49:27,744] Trial 2 finished with value: 251.1682188777985 and parameters: {'num_leaves': 53, 'min_data_in_leaf': 26, 'max_bin': 356, 'bagging_fraction': 0.9305018222370228, 'feature_fraction': 0.6435855026698292, 'min_gain_to_split': 0.39656750817710085, 'lambda_l1': 0.08374496868436809, 'lambda_l2': 0.3639639356786389}. Best is trial 1 with value: 248.89774199499587.
[I 2024-01-04 14:49:31,469] Trial 3 finished with value: 248.09634372851536 and parameters: {'num_leaves': 67, 'min_data_in_leaf': 20, 'max_bin': 228, 'bagging_fraction': 0.9417003375574375, 'feature_fraction': 0.5065544965250215, 'min_gain_to_split': 0.06750312521595925, 'lambda_l1': 0.0338151426782029, 'lambda_l2': 0.35356346291488117}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:49:35,221] Trial 4 finished with value: 250.3613253131122 and parameters: {'num_leaves': 118, 'min_data_in_leaf': 18, 'max_bin': 203, 'bagging_fraction': 0.8926453245613816, 'feature_fraction': 0.5336287168167264, 'min_gain_to_split': 0.17134364197119656, 'lambda_l1': 0.7717846862118062, 'lambda_l2': 0.23101522250182369}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:49:39,319] Trial 5 finished with value: 249.96067468473692 and parameters: {'num_leaves': 104, 'min_data_in_leaf': 14, 'max_bin': 340, 'bagging_fraction': 0.8090338207443906, 'feature_fraction': 0.5500300146337003, 'min_gain_to_split': 0.21941976179005757, 'lambda_l1': 0.02634905974115613, 'lambda_l2': 0.01810725406663109}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:49:41,815] Trial 6 finished with value: 252.75686388504084 and parameters: {'num_leaves': 97, 'min_data_in_leaf': 12, 'max_bin': 314, 'bagging_fraction': 0.865790227019348, 'feature_fraction': 0.6465121514177679, 'min_gain_to_split': 0.015998881492631498, 'lambda_l1': 0.02616697456085447, 'lambda_l2': 0.021019338091154416}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:49:46,356] Trial 7 finished with value: 251.075044773761 and parameters: {'num_leaves': 148, 'min_data_in_leaf': 9, 'max_bin': 293, 'bagging_fraction': 0.8366638388002404, 'feature_fraction': 0.3976908750936559, 'min_gain_to_split': 0.016624564693643644, 'lambda_l1': 0.20542778286285945, 'lambda_l2': 0.018895826938026012}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:49:49,304] Trial 8 finished with value: 251.64466468240585 and parameters: {'num_leaves': 79, 'min_data_in_leaf': 12, 'max_bin': 365, 'bagging_fraction': 0.8145651913689592, 'feature_fraction': 0.6013834722496412, 'min_gain_to_split': 0.015566709318481201, 'lambda_l1': 0.8972612866432508, 'lambda_l2': 0.08655704137361815}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:49:57,996] Trial 9 finished with value: 250.14515247089747 and parameters: {'num_leaves': 197, 'min_data_in_leaf': 19, 'max_bin': 348, 'bagging_fraction': 0.8058781688381481, 'feature_fraction': 0.43484208877292285, 'min_gain_to_split': 0.017393745944806985, 'lambda_l1': 0.0391093317225106, 'lambda_l2': 0.0172764870082179}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:01,838] Trial 10 finished with value: 249.48816882293096 and parameters: {'num_leaves': 53, 'min_data_in_leaf': 30, 'max_bin': 216, 'bagging_fraction': 0.9394460532541745, 'feature_fraction': 0.3583168079743906, 'min_gain_to_split': 0.04633615565227145, 'lambda_l1': 0.34798264027596815, 'lambda_l2': 0.08310314014919823}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:06,313] Trial 11 finished with value: 253.44849239038473 and parameters: {'num_leaves': 200, 'min_data_in_leaf': 7, 'max_bin': 263, 'bagging_fraction': 0.9098251531827067, 'feature_fraction': 0.4876152746429839, 'min_gain_to_split': 0.9049911227773816, 'lambda_l1': 0.01035624395150659, 'lambda_l2': 0.18041332104924798}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:10,350] Trial 12 finished with value: 251.5387719660545 and parameters: {'num_leaves': 166, 'min_data_in_leaf': 2, 'max_bin': 390, 'bagging_fraction': 0.8571297367400855, 'feature_fraction': 0.544673579378604, 'min_gain_to_split': 0.05903843542415377, 'lambda_l1': 0.010317359922001355, 'lambda_l2': 0.041626708401802846}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:12,690] Trial 13 finished with value: 251.9364539335419 and parameters: {'num_leaves': 170, 'min_data_in_leaf': 23, 'max_bin': 245, 'bagging_fraction': 0.9167192421770464, 'feature_fraction': 0.4506710731343085, 'min_gain_to_split': 0.9258789248217179, 'lambda_l1': 0.019744509115954174, 'lambda_l2': 0.9415993291148634}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:15,543] Trial 14 finished with value: 249.44030979652362 and parameters: {'num_leaves': 78, 'min_data_in_leaf': 16, 'max_bin': 286, 'bagging_fraction': 0.9453591958376131, 'feature_fraction': 0.5192108998385663, 'min_gain_to_split': 0.08119250213072915, 'lambda_l1': 0.050829284704745216, 'lambda_l2': 0.05278815998892531}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:19,830] Trial 15 finished with value: 250.8536040025379 and parameters: {'num_leaves': 174, 'min_data_in_leaf': 7, 'max_bin': 397, 'bagging_fraction': 0.8992688886853913, 'feature_fraction': 0.587134085972304, 'min_gain_to_split': 0.44292167603597116, 'lambda_l1': 0.018231994478501216, 'lambda_l2': 0.010813279908977303}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:24,618] Trial 16 finished with value: 249.12657495393125 and parameters: {'num_leaves': 135, 'min_data_in_leaf': 20, 'max_bin': 237, 'bagging_fraction': 0.8417910063143887, 'feature_fraction': 0.5802375778365374, 'min_gain_to_split': 0.036252629637577215, 'lambda_l1': 0.17782743533092438, 'lambda_l2': 0.1814173295272962}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:29,562] Trial 17 finished with value: 250.50445590899483 and parameters: {'num_leaves': 78, 'min_data_in_leaf': 27, 'max_bin': 272, 'bagging_fraction': 0.9189647462801774, 'feature_fraction': 0.45903434228892936, 'min_gain_to_split': 0.1098171111247162, 'lambda_l1': 0.042583257296550894, 'lambda_l2': 0.356692774668329}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:34,114] Trial 18 finished with value: 248.9550384865352 and parameters: {'num_leaves': 151, 'min_data_in_leaf': 16, 'max_bin': 322, 'bagging_fraction': 0.8716312066170828, 'feature_fraction': 0.5071837914163584, 'min_gain_to_split': 0.4468007749771297, 'lambda_l1': 0.015807330543906407, 'lambda_l2': 0.05048835803217476}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:37,172] Trial 19 finished with value: 252.10286297890258 and parameters: {'num_leaves': 111, 'min_data_in_leaf': 2, 'max_bin': 374, 'bagging_fraction': 0.8325429400067575, 'feature_fraction': 0.42149367778629837, 'min_gain_to_split': 0.029560405729183267, 'lambda_l1': 0.13091458271582623, 'lambda_l2': 0.031997507243044745}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:42,182] Trial 20 finished with value: 249.92985212045812 and parameters: {'num_leaves': 85, 'min_data_in_leaf': 22, 'max_bin': 225, 'bagging_fraction': 0.8885017648065092, 'feature_fraction': 0.5005109137217618, 'min_gain_to_split': 0.09753061386801926, 'lambda_l1': 0.05639214538874004, 'lambda_l2': 0.12491887330793833}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:47,232] Trial 21 finished with value: 250.1658602721037 and parameters: {'num_leaves': 152, 'min_data_in_leaf': 15, 'max_bin': 329, 'bagging_fraction': 0.868258435789388, 'feature_fraction': 0.5102876822733665, 'min_gain_to_split': 0.5053903941351167, 'lambda_l1': 0.015210692986563492, 'lambda_l2': 0.010039807811652276}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:50,321] Trial 22 finished with value: 251.97777844993706 and parameters: {'num_leaves': 187, 'min_data_in_leaf': 12, 'max_bin': 310, 'bagging_fraction': 0.8500673029026351, 'feature_fraction': 0.5657577733713315, 'min_gain_to_split': 0.32120884027443325, 'lambda_l1': 0.028947065724439704, 'lambda_l2': 0.06035335795719644}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:50:53,891] Trial 23 finished with value: 248.64092128126634 and parameters: {'num_leaves': 151, 'min_data_in_leaf': 17, 'max_bin': 337, 'bagging_fraction': 0.8793919136403086, 'feature_fraction': 0.4795100075058391, 'min_gain_to_split': 0.6621222754479498, 'lambda_l1': 0.01581193261065942, 'lambda_l2': 0.034592807286274535}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:00,995] Trial 24 finished with value: 250.60618765624562 and parameters: {'num_leaves': 184, 'min_data_in_leaf': 18, 'max_bin': 375, 'bagging_fraction': 0.9064942629708629, 'feature_fraction': 0.4739241567506467, 'min_gain_to_split': 0.7324251718791496, 'lambda_l1': 0.01273525419811232, 'lambda_l2': 0.027794257938678468}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:03,461] Trial 25 finished with value: 250.85934486716704 and parameters: {'num_leaves': 136, 'min_data_in_leaf': 9, 'max_bin': 337, 'bagging_fraction': 0.9301129533240734, 'feature_fraction': 0.40835680299128685, 'min_gain_to_split': 0.6063175909579294, 'lambda_l1': 0.03186821507239008, 'lambda_l2': 0.013952386859597035}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:09,697] Trial 26 finished with value: 249.32406553155195 and parameters: {'num_leaves': 162, 'min_data_in_leaf': 25, 'max_bin': 304, 'bagging_fraction': 0.8234117134000855, 'feature_fraction': 0.528296879968715, 'min_gain_to_split': 0.24688004027359095, 'lambda_l1': 0.019877058199912888, 'lambda_l2': 0.027659504570199004}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:14,574] Trial 27 finished with value: 250.66320170782404 and parameters: {'num_leaves': 182, 'min_data_in_leaf': 14, 'max_bin': 267, 'bagging_fraction': 0.8784411771525241, 'feature_fraction': 0.6170190872270966, 'min_gain_to_split': 0.13005010415742133, 'lambda_l1': 0.022810822667222327, 'lambda_l2': 0.12443865861439836}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:17,797] Trial 28 finished with value: 250.11455247612324 and parameters: {'num_leaves': 68, 'min_data_in_leaf': 20, 'max_bin': 365, 'bagging_fraction': 0.8571290155469604, 'feature_fraction': 0.5622108030530639, 'min_gain_to_split': 0.30512258419876964, 'lambda_l1': 0.06373482080594682, 'lambda_l2': 0.036399534032642275}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:24,673] Trial 29 finished with value: 250.81568105494773 and parameters: {'num_leaves': 134, 'min_data_in_leaf': 22, 'max_bin': 281, 'bagging_fraction': 0.8851718480829875, 'feature_fraction': 0.47447273988302097, 'min_gain_to_split': 0.15915988875888157, 'lambda_l1': 0.03572555256703823, 'lambda_l2': 0.4807822652316}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:27,752] Trial 30 finished with value: 251.04376947889406 and parameters: {'num_leaves': 125, 'min_data_in_leaf': 17, 'max_bin': 326, 'bagging_fraction': 0.8947044549335247, 'feature_fraction': 0.4936551743068348, 'min_gain_to_split': 0.0721686502558466, 'lambda_l1': 0.013319579299624452, 'lambda_l2': 0.7243799338935034}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:32,726] Trial 31 finished with value: 250.544407442113 and parameters: {'num_leaves': 148, 'min_data_in_leaf': 16, 'max_bin': 327, 'bagging_fraction': 0.8712423675351528, 'feature_fraction': 0.5135969501452984, 'min_gain_to_split': 0.6638266788156616, 'lambda_l1': 0.014936396869515334, 'lambda_l2': 0.060910737452065745}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:37,530] Trial 32 finished with value: 249.7027420585827 and parameters: {'num_leaves': 157, 'min_data_in_leaf': 14, 'max_bin': 350, 'bagging_fraction': 0.8788416797158063, 'feature_fraction': 0.45199500086067784, 'min_gain_to_split': 0.3811469562794672, 'lambda_l1': 0.017590111612931832, 'lambda_l2': 0.04489885972641594}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:42,506] Trial 33 finished with value: 251.87091953186004 and parameters: {'num_leaves': 123, 'min_data_in_leaf': 20, 'max_bin': 301, 'bagging_fraction': 0.9019753684080398, 'feature_fraction': 0.48576561514241423, 'min_gain_to_split': 0.5502406300613208, 'lambda_l1': 0.08952723374033626, 'lambda_l2': 0.024511652118902418}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:46,484] Trial 34 finished with value: 250.30520499177402 and parameters: {'num_leaves': 141, 'min_data_in_leaf': 10, 'max_bin': 317, 'bagging_fraction': 0.8590109224366697, 'feature_fraction': 0.5448280965039918, 'min_gain_to_split': 0.9790965005819393, 'lambda_l1': 0.010426781267385363, 'lambda_l2': 0.3021205725985494}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:50,122] Trial 35 finished with value: 249.58135808842567 and parameters: {'num_leaves': 114, 'min_data_in_leaf': 18, 'max_bin': 201, 'bagging_fraction': 0.9266378740310995, 'feature_fraction': 0.5354414577300035, 'min_gain_to_split': 0.24807376268658157, 'lambda_l1': 0.0231458074291776, 'lambda_l2': 0.014008762147851484}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:53,991] Trial 36 finished with value: 249.29116763218968 and parameters: {'num_leaves': 101, 'min_data_in_leaf': 24, 'max_bin': 340, 'bagging_fraction': 0.8487920008375271, 'feature_fraction': 0.5031547685920289, 'min_gain_to_split': 0.7503950182918488, 'lambda_l1': 0.5886532361815853, 'lambda_l2': 0.08319977770180688}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:51:57,902] Trial 37 finished with value: 250.32262409359683 and parameters: {'num_leaves': 91, 'min_data_in_leaf': 13, 'max_bin': 358, 'bagging_fraction': 0.8837459784244214, 'feature_fraction': 0.5239240110127943, 'min_gain_to_split': 0.010086515934441419, 'lambda_l1': 0.014113210227790236, 'lambda_l2': 0.11487676924184388}. Best is trial 3 with value: 248.09634372851536.
[I 2024-01-04 14:52:04,137] Trial 38 finished with value: 247.9849354686687 and parameters: {'num_leaves': 179, 'min_data_in_leaf': 16, 'max_bin': 341, 'bagging_fraction': 0.8638851277375763, 'feature_fraction': 0.46847706735658934, 'min_gain_to_split': 0.3793629342470942, 'lambda_l1': 0.02546677692735338, 'lambda_l2': 0.022828556931285018}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:13,476] Trial 39 finished with value: 250.80316374229784 and parameters: {'num_leaves': 191, 'min_data_in_leaf': 10, 'max_bin': 374, 'bagging_fraction': 0.8628653253874917, 'feature_fraction': 0.3812965898538931, 'min_gain_to_split': 0.1964549825868853, 'lambda_l1': 0.04699284416866659, 'lambda_l2': 0.015763404762510726}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:21,386] Trial 40 finished with value: 251.67414506489177 and parameters: {'num_leaves': 176, 'min_data_in_leaf': 19, 'max_bin': 385, 'bagging_fraction': 0.9471933827528347, 'feature_fraction': 0.43599688479252674, 'min_gain_to_split': 0.33325813937815146, 'lambda_l1': 0.06984020810597, 'lambda_l2': 0.02442694965905298}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:29,196] Trial 41 finished with value: 251.73492357392558 and parameters: {'num_leaves': 195, 'min_data_in_leaf': 16, 'max_bin': 344, 'bagging_fraction': 0.8761728749427744, 'feature_fraction': 0.4651383363093944, 'min_gain_to_split': 0.4359610965020044, 'lambda_l1': 0.026939986865991233, 'lambda_l2': 0.02039678720107524}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:35,502] Trial 42 finished with value: 248.32141899437622 and parameters: {'num_leaves': 160, 'min_data_in_leaf': 17, 'max_bin': 357, 'bagging_fraction': 0.8703793746963912, 'feature_fraction': 0.48461347694867424, 'min_gain_to_split': 0.7410712397968472, 'lambda_l1': 0.023007730225495376, 'lambda_l2': 0.032439046783148}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:39,774] Trial 43 finished with value: 251.39844251329075 and parameters: {'num_leaves': 180, 'min_data_in_leaf': 21, 'max_bin': 361, 'bagging_fraction': 0.89325817161555, 'feature_fraction': 0.4871432174781608, 'min_gain_to_split': 0.7515363686183039, 'lambda_l1': 0.034005802446438464, 'lambda_l2': 0.03439069898800271}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:44,523] Trial 44 finished with value: 249.60137827400777 and parameters: {'num_leaves': 62, 'min_data_in_leaf': 18, 'max_bin': 355, 'bagging_fraction': 0.8522815108818905, 'feature_fraction': 0.4391521435682733, 'min_gain_to_split': 0.5286581019536897, 'lambda_l1': 0.02309828294566098, 'lambda_l2': 0.013220147475425935}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:48,456] Trial 45 finished with value: 250.1464682694806 and parameters: {'num_leaves': 167, 'min_data_in_leaf': 13, 'max_bin': 336, 'bagging_fraction': 0.8404371792598446, 'feature_fraction': 0.47264815989495895, 'min_gain_to_split': 0.05202500809789036, 'lambda_l1': 0.011998079306766319, 'lambda_l2': 0.0231796454259446}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:52,121] Trial 46 finished with value: 249.3071785385002 and parameters: {'num_leaves': 161, 'min_data_in_leaf': 11, 'max_bin': 385, 'bagging_fraction': 0.864427666250373, 'feature_fraction': 0.45064645195785213, 'min_gain_to_split': 0.7774823854270912, 'lambda_l1': 0.02022790751305002, 'lambda_l2': 0.06512511642566508}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:52:57,437] Trial 47 finished with value: 250.4896361244068 and parameters: {'num_leaves': 172, 'min_data_in_leaf': 15, 'max_bin': 368, 'bagging_fraction': 0.8274669481534371, 'feature_fraction': 0.48439218785210786, 'min_gain_to_split': 0.6126221657308327, 'lambda_l1': 0.0399024553544704, 'lambda_l2': 0.018988176652188243}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:00,929] Trial 48 finished with value: 248.25530484556936 and parameters: {'num_leaves': 144, 'min_data_in_leaf': 17, 'max_bin': 251, 'bagging_fraction': 0.912198574875855, 'feature_fraction': 0.4245859311614965, 'min_gain_to_split': 0.03688304114494748, 'lambda_l1': 0.027372181393744633, 'lambda_l2': 0.21124570356518302}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:04,264] Trial 49 finished with value: 250.12552274154018 and parameters: {'num_leaves': 142, 'min_data_in_leaf': 19, 'max_bin': 250, 'bagging_fraction': 0.93860331389313, 'feature_fraction': 0.4228570966818336, 'min_gain_to_split': 0.06235039321237215, 'lambda_l1': 0.02837435584394861, 'lambda_l2': 0.1634129372894183}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:08,741] Trial 50 finished with value: 250.0555008338255 and parameters: {'num_leaves': 144, 'min_data_in_leaf': 17, 'max_bin': 215, 'bagging_fraction': 0.9190018585664714, 'feature_fraction': 0.38784812173634753, 'min_gain_to_split': 0.02552698992959497, 'lambda_l1': 0.049733614033147515, 'lambda_l2': 0.3033509172848912}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:13,391] Trial 51 finished with value: 250.0668193115747 and parameters: {'num_leaves': 158, 'min_data_in_leaf': 17, 'max_bin': 230, 'bagging_fraction': 0.9143659594226803, 'feature_fraction': 0.3553484087432987, 'min_gain_to_split': 0.03970378506773321, 'lambda_l1': 0.018761362649450636, 'lambda_l2': 0.2414130897638689}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:19,246] Trial 52 finished with value: 252.66741046148817 and parameters: {'num_leaves': 193, 'min_data_in_leaf': 15, 'max_bin': 215, 'bagging_fraction': 0.8887818414581558, 'feature_fraction': 0.4588764251973786, 'min_gain_to_split': 0.02357027172353717, 'lambda_l1': 0.023637791700065573, 'lambda_l2': 0.4717385297408169}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:25,283] Trial 53 finished with value: 250.55319510120077 and parameters: {'num_leaves': 200, 'min_data_in_leaf': 14, 'max_bin': 256, 'bagging_fraction': 0.9361536196159126, 'feature_fraction': 0.49831985753428804, 'min_gain_to_split': 0.8874048810699154, 'lambda_l1': 0.11414794308393804, 'lambda_l2': 0.20124298488521242}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:29,377] Trial 54 finished with value: 249.93321616977968 and parameters: {'num_leaves': 166, 'min_data_in_leaf': 19, 'max_bin': 349, 'bagging_fraction': 0.8001814474250672, 'feature_fraction': 0.4172621930471628, 'min_gain_to_split': 0.040518119432069684, 'lambda_l1': 0.03179528702813117, 'lambda_l2': 0.5180314575806758}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:38,603] Trial 55 finished with value: 249.91214122610828 and parameters: {'num_leaves': 153, 'min_data_in_leaf': 21, 'max_bin': 241, 'bagging_fraction': 0.8981925907239523, 'feature_fraction': 0.5372477044213086, 'min_gain_to_split': 0.08033151294306631, 'lambda_l1': 0.016741758787073655, 'lambda_l2': 0.011847416430538263}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:42,537] Trial 56 finished with value: 251.60026883608768 and parameters: {'num_leaves': 190, 'min_data_in_leaf': 17, 'max_bin': 226, 'bagging_fraction': 0.9227978585733236, 'feature_fraction': 0.5176409770876758, 'min_gain_to_split': 0.04897255044587492, 'lambda_l1': 0.011512322218642266, 'lambda_l2': 0.016899335076097925}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:46,123] Trial 57 finished with value: 251.21917591911807 and parameters: {'num_leaves': 177, 'min_data_in_leaf': 13, 'max_bin': 333, 'bagging_fraction': 0.9053465627575883, 'feature_fraction': 0.5588810249549871, 'min_gain_to_split': 0.033583349303849944, 'lambda_l1': 0.3484544523386503, 'lambda_l2': 0.36085439193700547}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:50,614] Trial 58 finished with value: 248.9104962802268 and parameters: {'num_leaves': 130, 'min_data_in_leaf': 28, 'max_bin': 288, 'bagging_fraction': 0.8712548309119912, 'feature_fraction': 0.4445657973227514, 'min_gain_to_split': 0.38034195652092995, 'lambda_l1': 0.03940273258738886, 'lambda_l2': 0.03960739327049044}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:55,541] Trial 59 finished with value: 250.12052315432507 and parameters: {'num_leaves': 170, 'min_data_in_leaf': 23, 'max_bin': 311, 'bagging_fraction': 0.9107469825870032, 'feature_fraction': 0.4657877241528394, 'min_gain_to_split': 0.09520603372996359, 'lambda_l1': 0.026728362368755795, 'lambda_l2': 0.2777611775346086}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:53:59,528] Trial 60 finished with value: 251.7693522347827 and parameters: {'num_leaves': 185, 'min_data_in_leaf': 5, 'max_bin': 399, 'bagging_fraction': 0.882375221490412, 'feature_fraction': 0.4306868375597421, 'min_gain_to_split': 0.5072163591307811, 'lambda_l1': 0.05837647056807119, 'lambda_l2': 0.14525084112406245}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:03,761] Trial 61 finished with value: 249.64977135928768 and parameters: {'num_leaves': 120, 'min_data_in_leaf': 25, 'max_bin': 278, 'bagging_fraction': 0.8687378131288802, 'feature_fraction': 0.44342126027661843, 'min_gain_to_split': 0.3781664415222889, 'lambda_l1': 0.04126372287473671, 'lambda_l2': 0.03903589476536043}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:08,092] Trial 62 finished with value: 250.0065274362485 and parameters: {'num_leaves': 140, 'min_data_in_leaf': 15, 'max_bin': 257, 'bagging_fraction': 0.8730842097074003, 'feature_fraction': 0.47834496431046764, 'min_gain_to_split': 0.14999988696839564, 'lambda_l1': 0.02098169094289273, 'lambda_l2': 0.02824016844752199}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:11,686] Trial 63 finished with value: 251.0914408199419 and parameters: {'num_leaves': 130, 'min_data_in_leaf': 30, 'max_bin': 294, 'bagging_fraction': 0.8598215267159707, 'feature_fraction': 0.40468323367468473, 'min_gain_to_split': 0.26942027317022926, 'lambda_l1': 0.03601751073383649, 'lambda_l2': 0.04599849274464953}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:16,791] Trial 64 finished with value: 251.83636097740788 and parameters: {'num_leaves': 129, 'min_data_in_leaf': 27, 'max_bin': 232, 'bagging_fraction': 0.8889857699853351, 'feature_fraction': 0.44853731268617936, 'min_gain_to_split': 0.6599958506069021, 'lambda_l1': 0.016469558628734983, 'lambda_l2': 0.05491006606451566}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:19,185] Trial 65 finished with value: 250.57409412561648 and parameters: {'num_leaves': 115, 'min_data_in_leaf': 29, 'max_bin': 209, 'bagging_fraction': 0.8761571080949921, 'feature_fraction': 0.5071930422815497, 'min_gain_to_split': 0.8562089772195518, 'lambda_l1': 0.030135853082934972, 'lambda_l2': 0.021852474648210867}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:24,787] Trial 66 finished with value: 250.77081073868032 and parameters: {'num_leaves': 106, 'min_data_in_leaf': 28, 'max_bin': 294, 'bagging_fraction': 0.853744050602893, 'feature_fraction': 0.461424963571921, 'min_gain_to_split': 0.44739176344300347, 'lambda_l1': 0.025898174427658276, 'lambda_l2': 0.07215971601269885}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:29,165] Trial 67 finished with value: 251.5021472556768 and parameters: {'num_leaves': 146, 'min_data_in_leaf': 12, 'max_bin': 321, 'bagging_fraction': 0.8658723196583835, 'feature_fraction': 0.4307191976353449, 'min_gain_to_split': 0.590925382762307, 'lambda_l1': 0.014158552149332768, 'lambda_l2': 0.03125912169121386}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:35,989] Trial 68 finished with value: 250.58930815849988 and parameters: {'num_leaves': 153, 'min_data_in_leaf': 21, 'max_bin': 346, 'bagging_fraction': 0.8433798524309817, 'feature_fraction': 0.4930391476662174, 'min_gain_to_split': 0.01917685771883979, 'lambda_l1': 0.0195495071273504, 'lambda_l2': 0.4098824964007025}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:39,177] Trial 69 finished with value: 250.1607809531231 and parameters: {'num_leaves': 137, 'min_data_in_leaf': 16, 'max_bin': 369, 'bagging_fraction': 0.8813370673553869, 'feature_fraction': 0.48109097723896044, 'min_gain_to_split': 0.978205671355497, 'lambda_l1': 0.0784093894382671, 'lambda_l2': 0.02971625529785851}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:46,360] Trial 70 finished with value: 249.9792973179026 and parameters: {'num_leaves': 163, 'min_data_in_leaf': 18, 'max_bin': 352, 'bagging_fraction': 0.8709854958181945, 'feature_fraction': 0.5246618291519151, 'min_gain_to_split': 0.3596892235304456, 'lambda_l1': 0.035832084683306197, 'lambda_l2': 0.03976910792323768}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:52,425] Trial 71 finished with value: 249.72817911073722 and parameters: {'num_leaves': 151, 'min_data_in_leaf': 15, 'max_bin': 324, 'bagging_fraction': 0.8618225640749834, 'feature_fraction': 0.509306336015361, 'min_gain_to_split': 0.432969884548429, 'lambda_l1': 0.015465836333656141, 'lambda_l2': 0.8904885110016947}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:54:55,742] Trial 72 finished with value: 251.13781099817118 and parameters: {'num_leaves': 51, 'min_data_in_leaf': 14, 'max_bin': 342, 'bagging_fraction': 0.867635470358654, 'feature_fraction': 0.49900415163790385, 'min_gain_to_split': 0.4801177887999686, 'lambda_l1': 0.010012959291867395, 'lambda_l2': 0.04639445228706571}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:01,427] Trial 73 finished with value: 252.02368168938506 and parameters: {'num_leaves': 156, 'min_data_in_leaf': 17, 'max_bin': 317, 'bagging_fraction': 0.9435891544639423, 'feature_fraction': 0.47373156223267404, 'min_gain_to_split': 0.29846515933988327, 'lambda_l1': 0.012802733659201716, 'lambda_l2': 0.10474596200572255}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:06,369] Trial 74 finished with value: 248.7169311533382 and parameters: {'num_leaves': 149, 'min_data_in_leaf': 16, 'max_bin': 332, 'bagging_fraction': 0.8865467103300672, 'feature_fraction': 0.6336290066694925, 'min_gain_to_split': 0.7053311948728637, 'lambda_l1': 0.017957678612174736, 'lambda_l2': 0.053548432990865154}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:10,167] Trial 75 finished with value: 249.25159007245202 and parameters: {'num_leaves': 148, 'min_data_in_leaf': 18, 'max_bin': 331, 'bagging_fraction': 0.897050719742335, 'feature_fraction': 0.5973741336074612, 'min_gain_to_split': 0.6711667049913296, 'lambda_l1': 0.04495263535974253, 'lambda_l2': 0.03590483507477473}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:13,720] Trial 76 finished with value: 250.3135255299012 and parameters: {'num_leaves': 131, 'min_data_in_leaf': 20, 'max_bin': 269, 'bagging_fraction': 0.8866040372625258, 'feature_fraction': 0.6184229070427256, 'min_gain_to_split': 0.8116086939431894, 'lambda_l1': 0.02456688086247493, 'lambda_l2': 0.025237363708475614}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:19,810] Trial 77 finished with value: 249.4073645969391 and parameters: {'num_leaves': 138, 'min_data_in_leaf': 16, 'max_bin': 361, 'bagging_fraction': 0.8769526133513171, 'feature_fraction': 0.6403868124248584, 'min_gain_to_split': 0.1180940664898308, 'lambda_l1': 0.021111552431719135, 'lambda_l2': 0.07576345111579191}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:25,543] Trial 78 finished with value: 248.26322318266054 and parameters: {'num_leaves': 125, 'min_data_in_leaf': 13, 'max_bin': 307, 'bagging_fraction': 0.9326317692312726, 'feature_fraction': 0.4140174670661608, 'min_gain_to_split': 0.6869311503007131, 'lambda_l1': 0.01815070035925684, 'lambda_l2': 0.0936257508693921}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:28,090] Trial 79 finished with value: 253.43758711281492 and parameters: {'num_leaves': 57, 'min_data_in_leaf': 11, 'max_bin': 309, 'bagging_fraction': 0.9314988687015779, 'feature_fraction': 0.3703894106101037, 'min_gain_to_split': 0.5770493456902785, 'lambda_l1': 0.011463313580819107, 'lambda_l2': 0.016849307906209997}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:32,759] Trial 80 finished with value: 251.56627397206245 and parameters: {'num_leaves': 93, 'min_data_in_leaf': 8, 'max_bin': 356, 'bagging_fraction': 0.9340979490630946, 'feature_fraction': 0.39932696307514864, 'min_gain_to_split': 0.691149277295846, 'lambda_l1': 0.01729871483359858, 'lambda_l2': 0.15044731141256437}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:35,795] Trial 81 finished with value: 250.69024379236384 and parameters: {'num_leaves': 124, 'min_data_in_leaf': 12, 'max_bin': 290, 'bagging_fraction': 0.8810562603567236, 'feature_fraction': 0.41335716230832203, 'min_gain_to_split': 0.8387680283394637, 'lambda_l1': 0.018202490237123493, 'lambda_l2': 0.05081302858753658}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:40,479] Trial 82 finished with value: 251.4578613418851 and parameters: {'num_leaves': 181, 'min_data_in_leaf': 13, 'max_bin': 337, 'bagging_fraction': 0.943081644257227, 'feature_fraction': 0.4267437215730898, 'min_gain_to_split': 0.2197313823570854, 'lambda_l1': 0.029607817402509336, 'lambda_l2': 0.09550943955525955}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:46,020] Trial 83 finished with value: 249.52932925626774 and parameters: {'num_leaves': 160, 'min_data_in_leaf': 11, 'max_bin': 248, 'bagging_fraction': 0.9258748851896403, 'feature_fraction': 0.5732951707645729, 'min_gain_to_split': 0.0613510472641891, 'lambda_l1': 0.02187710677368099, 'lambda_l2': 0.019611679739961953}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:49,190] Trial 84 finished with value: 251.56861829643137 and parameters: {'num_leaves': 69, 'min_data_in_leaf': 16, 'max_bin': 304, 'bagging_fraction': 0.892512777539076, 'feature_fraction': 0.45727636582916376, 'min_gain_to_split': 0.63714039665581, 'lambda_l1': 0.02558311119399844, 'lambda_l2': 0.031997844281058306}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:55,359] Trial 85 finished with value: 251.70644749896536 and parameters: {'num_leaves': 144, 'min_data_in_leaf': 14, 'max_bin': 275, 'bagging_fraction': 0.872475557516114, 'feature_fraction': 0.4429083072124641, 'min_gain_to_split': 0.548589154978752, 'lambda_l1': 0.013954319503232233, 'lambda_l2': 0.056723765001123576}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:55:59,102] Trial 86 finished with value: 249.84699890936838 and parameters: {'num_leaves': 128, 'min_data_in_leaf': 19, 'max_bin': 285, 'bagging_fraction': 0.9498979178124701, 'feature_fraction': 0.46755014311833965, 'min_gain_to_split': 0.7361413340714015, 'lambda_l1': 0.015499703718016128, 'lambda_l2': 0.20604248285042945}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:02,885] Trial 87 finished with value: 248.82456761772468 and parameters: {'num_leaves': 83, 'min_data_in_leaf': 15, 'max_bin': 379, 'bagging_fraction': 0.9403958145148957, 'feature_fraction': 0.4910493017896031, 'min_gain_to_split': 0.40856328043545914, 'lambda_l1': 0.17534437375445006, 'lambda_l2': 0.01517075044534919}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:06,466] Trial 88 finished with value: 250.06866108092123 and parameters: {'num_leaves': 83, 'min_data_in_leaf': 15, 'max_bin': 380, 'bagging_fraction': 0.9394510495645861, 'feature_fraction': 0.49314853677553727, 'min_gain_to_split': 0.4800273796992425, 'lambda_l1': 0.26467563865775584, 'lambda_l2': 0.011069164207374384}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:11,587] Trial 89 finished with value: 251.48654753781696 and parameters: {'num_leaves': 70, 'min_data_in_leaf': 17, 'max_bin': 366, 'bagging_fraction': 0.9267013991954216, 'feature_fraction': 0.38693656744178695, 'min_gain_to_split': 0.01337832605488843, 'lambda_l1': 0.2160514985532518, 'lambda_l2': 0.01353028410372272}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:16,305] Trial 90 finished with value: 251.06212337800955 and parameters: {'num_leaves': 189, 'min_data_in_leaf': 13, 'max_bin': 391, 'bagging_fraction': 0.9194206921907717, 'feature_fraction': 0.5481623472559404, 'min_gain_to_split': 0.9125933538197182, 'lambda_l1': 0.12853512239637843, 'lambda_l2': 0.015024579963889248}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:20,871] Trial 91 finished with value: 248.74622065286144 and parameters: {'num_leaves': 74, 'min_data_in_leaf': 16, 'max_bin': 372, 'bagging_fraction': 0.940904920071612, 'feature_fraction': 0.4861611867914935, 'min_gain_to_split': 0.3992063041226488, 'lambda_l1': 0.09509968365796506, 'lambda_l2': 0.02643654722836422}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:24,020] Trial 92 finished with value: 251.6513535899103 and parameters: {'num_leaves': 75, 'min_data_in_leaf': 16, 'max_bin': 377, 'bagging_fraction': 0.9404365737726692, 'feature_fraction': 0.4898290710778477, 'min_gain_to_split': 0.583413086786081, 'lambda_l1': 0.14529420083477243, 'lambda_l2': 0.021938198092173355}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:27,842] Trial 93 finished with value: 250.1087602027009 and parameters: {'num_leaves': 73, 'min_data_in_leaf': 14, 'max_bin': 353, 'bagging_fraction': 0.9495170223847873, 'feature_fraction': 0.5325872049340957, 'min_gain_to_split': 0.41411322074544543, 'lambda_l1': 0.08692950017325465, 'lambda_l2': 0.027332183189884895}. Best is trial 38 with value: 247.9849354686687.
[I 2024-01-04 14:56:30,951] Trial 94 finished with value: 247.49181840326082 and parameters: {'num_leaves': 62, 'min_data_in_leaf': 18, 'max_bin': 393, 'bagging_fraction': 0.934585331667364, 'feature_fraction': 0.5177135550901508, 'min_gain_to_split': 0.3387131388468447, 'lambda_l1': 0.17120040101009384, 'lambda_l2': 0.018502931725623104}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:56:33,953] Trial 95 finished with value: 249.0166614600853 and parameters: {'num_leaves': 64, 'min_data_in_leaf': 18, 'max_bin': 388, 'bagging_fraction': 0.9324750234268026, 'feature_fraction': 0.5136674856499592, 'min_gain_to_split': 0.28500503754063133, 'lambda_l1': 0.19772126538595708, 'lambda_l2': 0.01782243737045975}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:56:37,477] Trial 96 finished with value: 249.72419131055995 and parameters: {'num_leaves': 63, 'min_data_in_leaf': 19, 'max_bin': 380, 'bagging_fraction': 0.9360858995391556, 'feature_fraction': 0.5034676677441003, 'min_gain_to_split': 0.33809076683711065, 'lambda_l1': 0.31802884085814237, 'lambda_l2': 0.025984508126575368}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:56:41,539] Trial 97 finished with value: 249.1373466511043 and parameters: {'num_leaves': 56, 'min_data_in_leaf': 17, 'max_bin': 392, 'bagging_fraction': 0.9298798299178433, 'feature_fraction': 0.48052916727877615, 'min_gain_to_split': 0.2386862241455436, 'lambda_l1': 0.2164421619592046, 'lambda_l2': 0.021100845377884953}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:56:48,771] Trial 98 finished with value: 249.6535043833103 and parameters: {'num_leaves': 79, 'min_data_in_leaf': 20, 'max_bin': 372, 'bagging_fraction': 0.9462939107774153, 'feature_fraction': 0.5202361925942613, 'min_gain_to_split': 0.342159550555219, 'lambda_l1': 0.14967217736142474, 'lambda_l2': 0.03417361236587591}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:56:51,787] Trial 99 finished with value: 251.72425410158846 and parameters: {'num_leaves': 58, 'min_data_in_leaf': 18, 'max_bin': 397, 'bagging_fraction': 0.9426510935596756, 'feature_fraction': 0.36618044450496384, 'min_gain_to_split': 0.49490822810590657, 'lambda_l1': 0.2584513235662528, 'lambda_l2': 0.012421646431757107}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:56:55,331] Trial 100 finished with value: 248.92427425429713 and parameters: {'num_leaves': 83, 'min_data_in_leaf': 15, 'max_bin': 362, 'bagging_fraction': 0.9225877682434708, 'feature_fraction': 0.4721310667239858, 'min_gain_to_split': 0.188648880316058, 'lambda_l1': 0.17002316584054394, 'lambda_l2': 0.6764914793110878}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:56:58,510] Trial 101 finished with value: 249.70070316398883 and parameters: {'num_leaves': 67, 'min_data_in_leaf': 16, 'max_bin': 348, 'bagging_fraction': 0.9364037805088006, 'feature_fraction': 0.4842663627936338, 'min_gain_to_split': 0.7195281634238482, 'lambda_l1': 0.18179822589041, 'lambda_l2': 0.015395368689420123}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:02,035] Trial 102 finished with value: 249.83342674579632 and parameters: {'num_leaves': 60, 'min_data_in_leaf': 17, 'max_bin': 384, 'bagging_fraction': 0.937684854217256, 'feature_fraction': 0.4963635857812554, 'min_gain_to_split': 0.06984304942955603, 'lambda_l1': 0.018467681934921012, 'lambda_l2': 0.018526282285452417}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:06,531] Trial 103 finished with value: 252.0436455562155 and parameters: {'num_leaves': 89, 'min_data_in_leaf': 15, 'max_bin': 372, 'bagging_fraction': 0.928380530374755, 'feature_fraction': 0.5387026487524951, 'min_gain_to_split': 0.4024710753539279, 'lambda_l1': 0.10664800339077712, 'lambda_l2': 0.02388292172948342}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:09,317] Trial 104 finished with value: 249.10366425832655 and parameters: {'num_leaves': 75, 'min_data_in_leaf': 14, 'max_bin': 342, 'bagging_fraction': 0.9151710184135586, 'feature_fraction': 0.555109088484512, 'min_gain_to_split': 0.05525549064086035, 'lambda_l1': 0.09648571715115122, 'lambda_l2': 0.016560405433858325}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:13,830] Trial 105 finished with value: 250.86205216793596 and parameters: {'num_leaves': 174, 'min_data_in_leaf': 13, 'max_bin': 334, 'bagging_fraction': 0.9112746447100628, 'feature_fraction': 0.5034694152945758, 'min_gain_to_split': 0.044805372171620575, 'lambda_l1': 0.9214420585824484, 'lambda_l2': 0.01481627390319592}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:18,212] Trial 106 finished with value: 250.5138341519703 and parameters: {'num_leaves': 166, 'min_data_in_leaf': 19, 'max_bin': 328, 'bagging_fraction': 0.9413722524501744, 'feature_fraction': 0.5297129792743496, 'min_gain_to_split': 0.5367315376995105, 'lambda_l1': 0.4450714139476634, 'lambda_l2': 0.010367746279363847}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:21,776] Trial 107 finished with value: 249.7833818373524 and parameters: {'num_leaves': 98, 'min_data_in_leaf': 17, 'max_bin': 358, 'bagging_fraction': 0.903783329838784, 'feature_fraction': 0.45416360713152387, 'min_gain_to_split': 0.766620338871143, 'lambda_l1': 0.022452430022556986, 'lambda_l2': 0.0432076945957621}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:24,161] Trial 108 finished with value: 250.50976906364582 and parameters: {'num_leaves': 54, 'min_data_in_leaf': 18, 'max_bin': 339, 'bagging_fraction': 0.9451482389895436, 'feature_fraction': 0.5137341733354087, 'min_gain_to_split': 0.9913107435431426, 'lambda_l1': 0.03285620956947809, 'lambda_l2': 0.24926931153569987}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:27,651] Trial 109 finished with value: 250.17361464392383 and parameters: {'num_leaves': 106, 'min_data_in_leaf': 21, 'max_bin': 320, 'bagging_fraction': 0.9340328355383452, 'feature_fraction': 0.4886736011676739, 'min_gain_to_split': 0.029140278455179913, 'lambda_l1': 0.019935473823846094, 'lambda_l2': 0.06536538615775499}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:31,668] Trial 110 finished with value: 252.23414487360895 and parameters: {'num_leaves': 155, 'min_data_in_leaf': 16, 'max_bin': 362, 'bagging_fraction': 0.9230994495796144, 'feature_fraction': 0.6387924360095123, 'min_gain_to_split': 0.6159570656333072, 'lambda_l1': 0.01678788514716962, 'lambda_l2': 0.09383239157384529}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:36,741] Trial 111 finished with value: 250.85633556996947 and parameters: {'num_leaves': 134, 'min_data_in_leaf': 26, 'max_bin': 220, 'bagging_fraction': 0.8559891642725717, 'feature_fraction': 0.4188575263345835, 'min_gain_to_split': 0.3739905716358471, 'lambda_l1': 0.03877068773241145, 'lambda_l2': 0.029925860768446787}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:39,666] Trial 112 finished with value: 248.95974784307262 and parameters: {'num_leaves': 121, 'min_data_in_leaf': 15, 'max_bin': 239, 'bagging_fraction': 0.8782062454191585, 'feature_fraction': 0.40772778202924065, 'min_gain_to_split': 0.4775323494687619, 'lambda_l1': 0.023877236189671094, 'lambda_l2': 0.03712523514958895}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:45,638] Trial 113 finished with value: 250.2461727025437 and parameters: {'num_leaves': 149, 'min_data_in_leaf': 12, 'max_bin': 260, 'bagging_fraction': 0.8696182773140307, 'feature_fraction': 0.46934064851648, 'min_gain_to_split': 0.4379782566468774, 'lambda_l1': 0.0553914321132193, 'lambda_l2': 0.12471442960268589}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:50,927] Trial 114 finished with value: 251.20537205074302 and parameters: {'num_leaves': 198, 'min_data_in_leaf': 16, 'max_bin': 298, 'bagging_fraction': 0.8630588206922851, 'feature_fraction': 0.4374227631626794, 'min_gain_to_split': 0.8111155281735318, 'lambda_l1': 0.029018538048180255, 'lambda_l2': 0.39724092489757895}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:53,405] Trial 115 finished with value: 248.51612258227803 and parameters: {'num_leaves': 66, 'min_data_in_leaf': 14, 'max_bin': 205, 'bagging_fraction': 0.8867768927320587, 'feature_fraction': 0.4459583211345064, 'min_gain_to_split': 0.6579957165972958, 'lambda_l1': 0.012466498269244643, 'lambda_l2': 0.03289431305033875}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:57:57,441] Trial 116 finished with value: 250.17846669140872 and parameters: {'num_leaves': 72, 'min_data_in_leaf': 14, 'max_bin': 207, 'bagging_fraction': 0.8894664906338506, 'feature_fraction': 0.4628956894403763, 'min_gain_to_split': 0.6967966784482668, 'lambda_l1': 0.012451036663013022, 'lambda_l2': 0.02203730685023667}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:00,695] Trial 117 finished with value: 248.41183613331293 and parameters: {'num_leaves': 65, 'min_data_in_leaf': 17, 'max_bin': 232, 'bagging_fraction': 0.885402069847634, 'feature_fraction': 0.4762431798335603, 'min_gain_to_split': 0.31245300076868454, 'lambda_l1': 0.011623287096281945, 'lambda_l2': 0.03283167419484773}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:03,810] Trial 118 finished with value: 251.82995197329285 and parameters: {'num_leaves': 66, 'min_data_in_leaf': 18, 'max_bin': 221, 'bagging_fraction': 0.8842886697781926, 'feature_fraction': 0.47621018934983783, 'min_gain_to_split': 0.32700400491739656, 'lambda_l1': 0.010945569286470974, 'lambda_l2': 0.047845492683800436}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:07,947] Trial 119 finished with value: 250.76583841554688 and parameters: {'num_leaves': 61, 'min_data_in_leaf': 15, 'max_bin': 234, 'bagging_fraction': 0.894900546204659, 'feature_fraction': 0.4818621749319611, 'min_gain_to_split': 0.26722603488616475, 'lambda_l1': 0.014976128349214921, 'lambda_l2': 0.031606876405659526}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:10,884] Trial 120 finished with value: 252.33506972689574 and parameters: {'num_leaves': 78, 'min_data_in_leaf': 17, 'max_bin': 201, 'bagging_fraction': 0.8799417652346818, 'feature_fraction': 0.4493176479372039, 'min_gain_to_split': 0.09232453265811677, 'lambda_l1': 0.013227586793373255, 'lambda_l2': 0.026681633961518215}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:13,611] Trial 121 finished with value: 251.93779447208152 and parameters: {'num_leaves': 66, 'min_data_in_leaf': 20, 'max_bin': 227, 'bagging_fraction': 0.8912065454892015, 'feature_fraction': 0.49518180663555805, 'min_gain_to_split': 0.66115149329422, 'lambda_l1': 0.014256157422869486, 'lambda_l2': 0.019592799848330764}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:16,963] Trial 122 finished with value: 250.3184260266444 and parameters: {'num_leaves': 71, 'min_data_in_leaf': 17, 'max_bin': 246, 'bagging_fraction': 0.8856662585794733, 'feature_fraction': 0.41426333445445673, 'min_gain_to_split': 0.14159917921156762, 'lambda_l1': 0.01710449923760607, 'lambda_l2': 0.03390651934738554}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:19,347] Trial 123 finished with value: 250.58048650499765 and parameters: {'num_leaves': 76, 'min_data_in_leaf': 13, 'max_bin': 214, 'bagging_fraction': 0.8741219810629283, 'feature_fraction': 0.6199540927027839, 'min_gain_to_split': 0.5409259245908115, 'lambda_l1': 0.011138679614553391, 'lambda_l2': 0.042448003067620525}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:23,209] Trial 124 finished with value: 251.156345783635 and parameters: {'num_leaves': 177, 'min_data_in_leaf': 16, 'max_bin': 253, 'bagging_fraction': 0.8663591160261164, 'feature_fraction': 0.4252727679922401, 'min_gain_to_split': 0.886215642549602, 'lambda_l1': 0.011856060263474055, 'lambda_l2': 0.025081767074579608}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:26,163] Trial 125 finished with value: 250.70174464613038 and parameters: {'num_leaves': 159, 'min_data_in_leaf': 19, 'max_bin': 210, 'bagging_fraction': 0.8754523452986147, 'feature_fraction': 0.5016741976399238, 'min_gain_to_split': 0.5972374036822362, 'lambda_l1': 0.07069957271733289, 'lambda_l2': 0.3076723263574069}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:30,338] Trial 126 finished with value: 253.98123584511205 and parameters: {'num_leaves': 169, 'min_data_in_leaf': 12, 'max_bin': 345, 'bagging_fraction': 0.9021341656245929, 'feature_fraction': 0.4872469747012896, 'min_gain_to_split': 0.4615866422450639, 'lambda_l1': 0.013128932203765296, 'lambda_l2': 0.029281769381026463}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:33,302] Trial 127 finished with value: 251.73322051878546 and parameters: {'num_leaves': 184, 'min_data_in_leaf': 15, 'max_bin': 242, 'bagging_fraction': 0.8867448935326978, 'feature_fraction': 0.40100000314299333, 'min_gain_to_split': 0.31711641893590964, 'lambda_l1': 0.015958892358391527, 'lambda_l2': 0.5442760223597346}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:36,214] Trial 128 finished with value: 251.8550244115263 and parameters: {'num_leaves': 50, 'min_data_in_leaf': 14, 'max_bin': 368, 'bagging_fraction': 0.8830395649447882, 'feature_fraction': 0.45725640791524363, 'min_gain_to_split': 0.7779594608741716, 'lambda_l1': 0.01939431345674847, 'lambda_l2': 0.023070042166038165}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:40,550] Trial 129 finished with value: 250.3489383249454 and parameters: {'num_leaves': 163, 'min_data_in_leaf': 17, 'max_bin': 350, 'bagging_fraction': 0.8961279017621276, 'feature_fraction': 0.47666950695146726, 'min_gain_to_split': 0.3951391600499149, 'lambda_l1': 0.02730738329104792, 'lambda_l2': 0.03743874867294142}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:50,398] Trial 130 finished with value: 249.70454529457095 and parameters: {'num_leaves': 194, 'min_data_in_leaf': 18, 'max_bin': 394, 'bagging_fraction': 0.9468995726395042, 'feature_fraction': 0.5083167494864842, 'min_gain_to_split': 0.522132419684433, 'lambda_l1': 0.12186387070134558, 'lambda_l2': 0.012132931456878517}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:55,591] Trial 131 finished with value: 249.0568104608024 and parameters: {'num_leaves': 140, 'min_data_in_leaf': 16, 'max_bin': 379, 'bagging_fraction': 0.8716479171578012, 'feature_fraction': 0.44163229766990203, 'min_gain_to_split': 0.3686851507962205, 'lambda_l1': 0.14201363587144775, 'lambda_l2': 0.03828096527977815}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:58:59,629] Trial 132 finished with value: 250.39021067089718 and parameters: {'num_leaves': 151, 'min_data_in_leaf': 24, 'max_bin': 223, 'bagging_fraction': 0.8794984756229808, 'feature_fraction': 0.43372368110848847, 'min_gain_to_split': 0.2968552494738383, 'lambda_l1': 0.02164458735548742, 'lambda_l2': 0.03419775649166447}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:01,459] Trial 133 finished with value: 253.12675541828912 and parameters: {'num_leaves': 64, 'min_data_in_leaf': 5, 'max_bin': 264, 'bagging_fraction': 0.859826148843883, 'feature_fraction': 0.463914702687051, 'min_gain_to_split': 0.4127571261443004, 'lambda_l1': 0.031067818536872956, 'lambda_l2': 0.042127945816306564}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:04,493] Trial 134 finished with value: 251.48970802041677 and parameters: {'num_leaves': 146, 'min_data_in_leaf': 14, 'max_bin': 385, 'bagging_fraction': 0.9083907876891837, 'feature_fraction': 0.4464426287115145, 'min_gain_to_split': 0.6299470077811208, 'lambda_l1': 0.16431677455700813, 'lambda_l2': 0.05080738552398487}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:06,785] Trial 135 finished with value: 251.66199693947357 and parameters: {'num_leaves': 59, 'min_data_in_leaf': 10, 'max_bin': 230, 'bagging_fraction': 0.8159783744186221, 'feature_fraction': 0.4701457470749345, 'min_gain_to_split': 0.26752907650799507, 'lambda_l1': 0.024731325480938156, 'lambda_l2': 0.11070581208604748}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:10,245] Trial 136 finished with value: 249.59181223390823 and parameters: {'num_leaves': 54, 'min_data_in_leaf': 15, 'max_bin': 315, 'bagging_fraction': 0.8744662953658245, 'feature_fraction': 0.5898430056890517, 'min_gain_to_split': 0.6970655058067564, 'lambda_l1': 0.03640538118270948, 'lambda_l2': 0.03218995841501966}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:14,879] Trial 137 finished with value: 248.04317891774215 and parameters: {'num_leaves': 110, 'min_data_in_leaf': 13, 'max_bin': 206, 'bagging_fraction': 0.9388498320560991, 'feature_fraction': 0.48997252259036944, 'min_gain_to_split': 0.20533415473055577, 'lambda_l1': 0.018385812417700043, 'lambda_l2': 0.18319704155125865}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:16,613] Trial 138 finished with value: 251.11241676495854 and parameters: {'num_leaves': 81, 'min_data_in_leaf': 13, 'max_bin': 218, 'bagging_fraction': 0.9399345017522797, 'feature_fraction': 0.49270780626068994, 'min_gain_to_split': 0.1724596331518652, 'lambda_l1': 0.017719317741347402, 'lambda_l2': 0.20793951051345025}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:19,621] Trial 139 finished with value: 250.65538744949382 and parameters: {'num_leaves': 88, 'min_data_in_leaf': 11, 'max_bin': 206, 'bagging_fraction': 0.9338329976145481, 'feature_fraction': 0.5223251214444021, 'min_gain_to_split': 0.8111417072336111, 'lambda_l1': 0.01440043461759758, 'lambda_l2': 0.17354325943605908}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:25,994] Trial 140 finished with value: 251.04698790041078 and parameters: {'num_leaves': 111, 'min_data_in_leaf': 16, 'max_bin': 203, 'bagging_fraction': 0.9383306874113676, 'feature_fraction': 0.4823068829767774, 'min_gain_to_split': 0.2247993963953675, 'lambda_l1': 0.020812298851880413, 'lambda_l2': 0.2612079944704039}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:33,621] Trial 141 finished with value: 250.63794108959837 and parameters: {'num_leaves': 119, 'min_data_in_leaf': 29, 'max_bin': 355, 'bagging_fraction': 0.9303409118130695, 'feature_fraction': 0.4999801388982349, 'min_gain_to_split': 0.36313047839269824, 'lambda_l1': 0.01027041769623813, 'lambda_l2': 0.02719528479802065}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:37,987] Trial 142 finished with value: 249.4343387284939 and parameters: {'num_leaves': 127, 'min_data_in_leaf': 12, 'max_bin': 212, 'bagging_fraction': 0.944176846427563, 'feature_fraction': 0.515370868306029, 'min_gain_to_split': 0.30899754839690746, 'lambda_l1': 0.01267576668159671, 'lambda_l2': 0.21914542207962828}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:41,140] Trial 143 finished with value: 249.519622286848 and parameters: {'num_leaves': 144, 'min_data_in_leaf': 13, 'max_bin': 235, 'bagging_fraction': 0.9356222169037198, 'feature_fraction': 0.4881638814692, 'min_gain_to_split': 0.20123019808522802, 'lambda_l1': 0.015606228310635234, 'lambda_l2': 0.15937319766646302}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:44,108] Trial 144 finished with value: 249.6094400918304 and parameters: {'num_leaves': 69, 'min_data_in_leaf': 17, 'max_bin': 308, 'bagging_fraction': 0.9414377552472726, 'feature_fraction': 0.4295146212348876, 'min_gain_to_split': 0.5014963474361674, 'lambda_l1': 0.0184368083580013, 'lambda_l2': 0.14169082239421313}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:47,829] Trial 145 finished with value: 253.348192378396 and parameters: {'num_leaves': 114, 'min_data_in_leaf': 15, 'max_bin': 364, 'bagging_fraction': 0.8697071294788391, 'feature_fraction': 0.47543129731600536, 'min_gain_to_split': 0.02141374252546936, 'lambda_l1': 0.023046207287368385, 'lambda_l2': 0.3392168782583177}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:51,272] Trial 146 finished with value: 250.58263956146595 and parameters: {'num_leaves': 73, 'min_data_in_leaf': 14, 'max_bin': 332, 'bagging_fraction': 0.8825892078043773, 'feature_fraction': 0.39487563570667117, 'min_gain_to_split': 0.03481408114280661, 'lambda_l1': 0.032805767852574205, 'lambda_l2': 0.018282475672863605}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:54,468] Trial 147 finished with value: 248.6428665297089 and parameters: {'num_leaves': 94, 'min_data_in_leaf': 16, 'max_bin': 373, 'bagging_fraction': 0.8667352620566177, 'feature_fraction': 0.4962524550779911, 'min_gain_to_split': 0.3460283135263791, 'lambda_l1': 0.026925711296214096, 'lambda_l2': 0.07612310865459707}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 14:59:58,054] Trial 148 finished with value: 249.802555289632 and parameters: {'num_leaves': 93, 'min_data_in_leaf': 18, 'max_bin': 376, 'bagging_fraction': 0.8774818477754576, 'feature_fraction': 0.5039614566571933, 'min_gain_to_split': 0.2665979586440173, 'lambda_l1': 0.25187933425938064, 'lambda_l2': 0.08167465490197161}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:01,726] Trial 149 finished with value: 250.89565827055307 and parameters: {'num_leaves': 102, 'min_data_in_leaf': 16, 'max_bin': 370, 'bagging_fraction': 0.9001809750486183, 'feature_fraction': 0.4949558792477762, 'min_gain_to_split': 0.5685325737610398, 'lambda_l1': 0.019952766315230745, 'lambda_l2': 0.07767854391844496}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:07,185] Trial 150 finished with value: 249.6273418243545 and parameters: {'num_leaves': 68, 'min_data_in_leaf': 17, 'max_bin': 359, 'bagging_fraction': 0.892165092143445, 'feature_fraction': 0.5095799829793023, 'min_gain_to_split': 0.08411491275213864, 'lambda_l1': 0.01665924566100667, 'lambda_l2': 0.06104710947685137}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:10,121] Trial 151 finished with value: 247.77318003627045 and parameters: {'num_leaves': 86, 'min_data_in_leaf': 16, 'max_bin': 383, 'bagging_fraction': 0.8649979641364223, 'feature_fraction': 0.4817486670392335, 'min_gain_to_split': 0.351661759777778, 'lambda_l1': 0.02814569393783445, 'lambda_l2': 0.09115484734822345}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:15,630] Trial 152 finished with value: 250.49908468171873 and parameters: {'num_leaves': 98, 'min_data_in_leaf': 16, 'max_bin': 381, 'bagging_fraction': 0.8630553645033838, 'feature_fraction': 0.4805903168993125, 'min_gain_to_split': 0.3374075480542306, 'lambda_l1': 0.027314088145799657, 'lambda_l2': 0.10356683995186587}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:23,097] Trial 153 finished with value: 249.8886119633343 and parameters: {'num_leaves': 94, 'min_data_in_leaf': 15, 'max_bin': 375, 'bagging_fraction': 0.8657861100776019, 'feature_fraction': 0.4888735972189435, 'min_gain_to_split': 0.10503290156593435, 'lambda_l1': 0.025962264908394695, 'lambda_l2': 0.0924860553034291}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:28,118] Trial 154 finished with value: 251.49764437023114 and parameters: {'num_leaves': 87, 'min_data_in_leaf': 17, 'max_bin': 205, 'bagging_fraction': 0.9379240167334084, 'feature_fraction': 0.49769888464017153, 'min_gain_to_split': 0.39254025151307914, 'lambda_l1': 0.19182087476064508, 'lambda_l2': 0.06794233230323202}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:31,648] Trial 155 finished with value: 250.25095018895524 and parameters: {'num_leaves': 85, 'min_data_in_leaf': 18, 'max_bin': 384, 'bagging_fraction': 0.8571257419293183, 'feature_fraction': 0.4714651356386285, 'min_gain_to_split': 0.24506491770932454, 'lambda_l1': 0.024394636517839432, 'lambda_l2': 0.09092915543510231}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:35,941] Trial 156 finished with value: 249.7346598592207 and parameters: {'num_leaves': 82, 'min_data_in_leaf': 16, 'max_bin': 367, 'bagging_fraction': 0.851895854933342, 'feature_fraction': 0.48437907108220346, 'min_gain_to_split': 0.44528663784812805, 'lambda_l1': 0.02900524857257388, 'lambda_l2': 0.13155925117538822}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:45,955] Trial 157 finished with value: 250.21060309985526 and parameters: {'num_leaves': 62, 'min_data_in_leaf': 19, 'max_bin': 343, 'bagging_fraction': 0.8600772973257325, 'feature_fraction': 0.6079115426268268, 'min_gain_to_split': 0.11899903724164437, 'lambda_l1': 0.01377110562969109, 'lambda_l2': 0.08547931805343581}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:50,602] Trial 158 finished with value: 252.7129997464329 and parameters: {'num_leaves': 108, 'min_data_in_leaf': 14, 'max_bin': 325, 'bagging_fraction': 0.8683469649298952, 'feature_fraction': 0.46528497408610425, 'min_gain_to_split': 0.2882774418466176, 'lambda_l1': 0.018431108808647196, 'lambda_l2': 0.06956498909470431}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:54,115] Trial 159 finished with value: 250.49388535418566 and parameters: {'num_leaves': 90, 'min_data_in_leaf': 15, 'max_bin': 390, 'bagging_fraction': 0.9478651474465936, 'feature_fraction': 0.4786896805191647, 'min_gain_to_split': 0.3511820261157441, 'lambda_l1': 0.011952526576707433, 'lambda_l2': 0.11554711078243335}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:00:57,029] Trial 160 finished with value: 250.80496353100466 and parameters: {'num_leaves': 64, 'min_data_in_leaf': 22, 'max_bin': 386, 'bagging_fraction': 0.865013315102003, 'feature_fraction': 0.4914437229742247, 'min_gain_to_split': 0.887483072136835, 'lambda_l1': 0.16095667839558572, 'lambda_l2': 0.020922945252227043}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:01:02,310] Trial 161 finished with value: 250.6346992473666 and parameters: {'num_leaves': 133, 'min_data_in_leaf': 17, 'max_bin': 374, 'bagging_fraction': 0.8720273846658164, 'feature_fraction': 0.41226036056326626, 'min_gain_to_split': 0.41644705957076983, 'lambda_l1': 0.03877136764806393, 'lambda_l2': 0.01641885293428038}. Best is trial 94 with value: 247.49181840326082.
[I 2024-01-04 15:01:06,010] Trial 162 finished with value: 247.42572016119635 and parameters: {'num_leaves': 138, 'min_data_in_leaf': 16, 'max_bin': 285, 'bagging_fraction': 0.8768652682558914, 'feature_fraction': 0.4597140389171417, 'min_gain_to_split': 0.3170777189102552, 'lambda_l1': 0.03396002472637102, 'lambda_l2': 0.014071960871027224}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:09,722] Trial 163 finished with value: 250.5795625622893 and parameters: {'num_leaves': 154, 'min_data_in_leaf': 16, 'max_bin': 283, 'bagging_fraction': 0.8756242802475784, 'feature_fraction': 0.4574107618784809, 'min_gain_to_split': 0.3096839426499339, 'lambda_l1': 0.04737132196868192, 'lambda_l2': 0.013877657975683215}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:12,783] Trial 164 finished with value: 250.36395056827382 and parameters: {'num_leaves': 137, 'min_data_in_leaf': 17, 'max_bin': 200, 'bagging_fraction': 0.8467501024159305, 'feature_fraction': 0.470569236894148, 'min_gain_to_split': 0.34165311839482404, 'lambda_l1': 0.03451910677720636, 'lambda_l2': 0.01248230520911566}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:16,905] Trial 165 finished with value: 251.41787440494195 and parameters: {'num_leaves': 142, 'min_data_in_leaf': 15, 'max_bin': 395, 'bagging_fraction': 0.8872550847984648, 'feature_fraction': 0.4638860418732246, 'min_gain_to_split': 0.662803731918857, 'lambda_l1': 0.028792708301565273, 'lambda_l2': 0.014742471644502387}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:21,382] Trial 166 finished with value: 250.39376034507342 and parameters: {'num_leaves': 147, 'min_data_in_leaf': 18, 'max_bin': 381, 'bagging_fraction': 0.8812313803002702, 'feature_fraction': 0.4767002352919301, 'min_gain_to_split': 0.03115257997439445, 'lambda_l1': 0.021456414840317704, 'lambda_l2': 0.017285738813038423}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:26,706] Trial 167 finished with value: 251.3509610837484 and parameters: {'num_leaves': 77, 'min_data_in_leaf': 13, 'max_bin': 216, 'bagging_fraction': 0.8780850319574509, 'feature_fraction': 0.48392955774606733, 'min_gain_to_split': 0.3797765825536852, 'lambda_l1': 0.6067639062950719, 'lambda_l2': 0.02398566835684493}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:30,610] Trial 168 finished with value: 249.73229539891614 and parameters: {'num_leaves': 151, 'min_data_in_leaf': 14, 'max_bin': 299, 'bagging_fraction': 0.9319677420827358, 'feature_fraction': 0.6498081331144286, 'min_gain_to_split': 0.7261892887659579, 'lambda_l1': 0.022608388450554528, 'lambda_l2': 0.02011551619134166}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:33,999] Trial 169 finished with value: 251.6314875794779 and parameters: {'num_leaves': 80, 'min_data_in_leaf': 16, 'max_bin': 277, 'bagging_fraction': 0.94396934276416, 'feature_fraction': 0.5040481953340915, 'min_gain_to_split': 0.04216889260923159, 'lambda_l1': 0.015114823160552807, 'lambda_l2': 0.10533610454431483}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:37,504] Trial 170 finished with value: 251.80344351954858 and parameters: {'num_leaves': 149, 'min_data_in_leaf': 15, 'max_bin': 337, 'bagging_fraction': 0.9256980574945003, 'feature_fraction': 0.45260591501703173, 'min_gain_to_split': 0.014424045320988075, 'lambda_l1': 0.043912975596851936, 'lambda_l2': 0.05583931970799901}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:41,339] Trial 171 finished with value: 249.90469666568038 and parameters: {'num_leaves': 127, 'min_data_in_leaf': 16, 'max_bin': 295, 'bagging_fraction': 0.869393745428101, 'feature_fraction': 0.44609833626291506, 'min_gain_to_split': 0.278571263544134, 'lambda_l1': 0.03047574275291401, 'lambda_l2': 0.02974275735067851}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:44,974] Trial 172 finished with value: 250.8258421423467 and parameters: {'num_leaves': 131, 'min_data_in_leaf': 17, 'max_bin': 252, 'bagging_fraction': 0.8720934112381963, 'feature_fraction': 0.423920384528167, 'min_gain_to_split': 0.4506275263478653, 'lambda_l1': 0.026239793128009673, 'lambda_l2': 0.03615472414875372}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:47,527] Trial 173 finished with value: 251.60834782058734 and parameters: {'num_leaves': 125, 'min_data_in_leaf': 12, 'max_bin': 271, 'bagging_fraction': 0.8667782188780679, 'feature_fraction': 0.46031501106957684, 'min_gain_to_split': 0.33368392238331, 'lambda_l1': 0.03717294315876236, 'lambda_l2': 0.040720924934878354}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:50,707] Trial 174 finished with value: 250.31464539939657 and parameters: {'num_leaves': 139, 'min_data_in_leaf': 14, 'max_bin': 287, 'bagging_fraction': 0.8744188799228743, 'feature_fraction': 0.4380410991005637, 'min_gain_to_split': 0.4058388426704497, 'lambda_l1': 0.032269544211758906, 'lambda_l2': 0.03241309448555329}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:01:56,237] Trial 175 finished with value: 249.92682837396518 and parameters: {'num_leaves': 188, 'min_data_in_leaf': 16, 'max_bin': 290, 'bagging_fraction': 0.8842697717978859, 'feature_fraction': 0.4922924762633439, 'min_gain_to_split': 0.0723306661113504, 'lambda_l1': 0.02452181367063122, 'lambda_l2': 0.046760502570766756}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:00,404] Trial 176 finished with value: 250.46833795295862 and parameters: {'num_leaves': 122, 'min_data_in_leaf': 13, 'max_bin': 349, 'bagging_fraction': 0.8802624646096726, 'feature_fraction': 0.45376253449778703, 'min_gain_to_split': 0.3701003797800777, 'lambda_l1': 0.03351211577987117, 'lambda_l2': 0.011153115787596675}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:04,443] Trial 177 finished with value: 250.44483954285164 and parameters: {'num_leaves': 117, 'min_data_in_leaf': 15, 'max_bin': 304, 'bagging_fraction': 0.9406817651593791, 'feature_fraction': 0.5179569791694056, 'min_gain_to_split': 0.30736306842420713, 'lambda_l1': 0.041555018778770464, 'lambda_l2': 0.027318118098379234}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:08,257] Trial 178 finished with value: 250.24498760231444 and parameters: {'num_leaves': 134, 'min_data_in_leaf': 17, 'max_bin': 388, 'bagging_fraction': 0.8629062737631982, 'feature_fraction': 0.49746095558774456, 'min_gain_to_split': 0.5864984672416876, 'lambda_l1': 0.016438117014245503, 'lambda_l2': 0.07400927606429505}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:11,080] Trial 179 finished with value: 249.58605700447265 and parameters: {'num_leaves': 71, 'min_data_in_leaf': 23, 'max_bin': 230, 'bagging_fraction': 0.8885125560499693, 'feature_fraction': 0.48487273414822657, 'min_gain_to_split': 0.5028568570016486, 'lambda_l1': 0.020248026119897348, 'lambda_l2': 0.1833465216422022}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:15,168] Trial 180 finished with value: 250.23992591808954 and parameters: {'num_leaves': 144, 'min_data_in_leaf': 27, 'max_bin': 225, 'bagging_fraction': 0.9362066123650771, 'feature_fraction': 0.4710387790897302, 'min_gain_to_split': 0.6273631306040175, 'lambda_l1': 0.027854099893134494, 'lambda_l2': 0.014070845671853495}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:18,000] Trial 181 finished with value: 250.80951406400357 and parameters: {'num_leaves': 75, 'min_data_in_leaf': 15, 'max_bin': 363, 'bagging_fraction': 0.9249513761759067, 'feature_fraction': 0.5727202666889106, 'min_gain_to_split': 0.1601799824052984, 'lambda_l1': 0.10408252777643323, 'lambda_l2': 0.7439220553317485}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:21,881] Trial 182 finished with value: 249.3110631129208 and parameters: {'num_leaves': 85, 'min_data_in_leaf': 14, 'max_bin': 355, 'bagging_fraction': 0.921583651147675, 'feature_fraction': 0.4783214365441769, 'min_gain_to_split': 0.19039916385246033, 'lambda_l1': 0.17138302120704588, 'lambda_l2': 0.9265749020309945}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:25,686] Trial 183 finished with value: 249.06582831940312 and parameters: {'num_leaves': 83, 'min_data_in_leaf': 16, 'max_bin': 371, 'bagging_fraction': 0.9333184089439035, 'feature_fraction': 0.6308504811107408, 'min_gain_to_split': 0.13224038945657687, 'lambda_l1': 0.1473648567032606, 'lambda_l2': 0.6216842099264523}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:30,760] Trial 184 finished with value: 249.4671541920374 and parameters: {'num_leaves': 66, 'min_data_in_leaf': 18, 'max_bin': 360, 'bagging_fraction': 0.9156317811266667, 'feature_fraction': 0.4735128933525085, 'min_gain_to_split': 0.21130356951389268, 'lambda_l1': 0.20114994165231154, 'lambda_l2': 0.0392658876765995}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:33,637] Trial 185 finished with value: 252.35905337278493 and parameters: {'num_leaves': 86, 'min_data_in_leaf': 15, 'max_bin': 243, 'bagging_fraction': 0.9275778013384998, 'feature_fraction': 0.46651952414332837, 'min_gain_to_split': 0.18710382166239822, 'lambda_l1': 0.21812980592938896, 'lambda_l2': 0.015624708091111892}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:37,152] Trial 186 finished with value: 248.93206619004684 and parameters: {'num_leaves': 79, 'min_data_in_leaf': 17, 'max_bin': 280, 'bagging_fraction': 0.9301140124271376, 'feature_fraction': 0.4865963502082907, 'min_gain_to_split': 0.7538162508538646, 'lambda_l1': 0.23606121292562693, 'lambda_l2': 0.4321523615935931}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:41,114] Trial 187 finished with value: 251.4762996175302 and parameters: {'num_leaves': 95, 'min_data_in_leaf': 15, 'max_bin': 377, 'bagging_fraction': 0.8779205992752549, 'feature_fraction': 0.4604436612977852, 'min_gain_to_split': 0.2661693882507861, 'lambda_l1': 0.0133519174276913, 'lambda_l2': 0.03522393535970835}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:43,624] Trial 188 finished with value: 249.88097802940015 and parameters: {'num_leaves': 91, 'min_data_in_leaf': 16, 'max_bin': 366, 'bagging_fraction': 0.9389526807790968, 'feature_fraction': 0.4793374229049171, 'min_gain_to_split': 0.3590274929965887, 'lambda_l1': 0.062439027824047075, 'lambda_l2': 0.797900317930234}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:49,308] Trial 189 finished with value: 250.52539819943138 and parameters: {'num_leaves': 142, 'min_data_in_leaf': 14, 'max_bin': 238, 'bagging_fraction': 0.9123231583100857, 'feature_fraction': 0.5073354200353931, 'min_gain_to_split': 0.23020703481970808, 'lambda_l1': 0.13810195568699196, 'lambda_l2': 0.6695510774298393}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:53,828] Trial 190 finished with value: 249.39028250099406 and parameters: {'num_leaves': 156, 'min_data_in_leaf': 13, 'max_bin': 267, 'bagging_fraction': 0.8684131697548491, 'feature_fraction': 0.46848449077476256, 'min_gain_to_split': 0.31658678365111476, 'lambda_l1': 0.18903977378492717, 'lambda_l2': 0.5507867349522573}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:02:58,247] Trial 191 finished with value: 249.00789052000718 and parameters: {'num_leaves': 80, 'min_data_in_leaf': 17, 'max_bin': 279, 'bagging_fraction': 0.9310167816866709, 'feature_fraction': 0.4904280251633335, 'min_gain_to_split': 0.7580540499329507, 'lambda_l1': 0.12513113755960384, 'lambda_l2': 0.38557651716229485}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:01,820] Trial 192 finished with value: 250.43111074969602 and parameters: {'num_leaves': 75, 'min_data_in_leaf': 17, 'max_bin': 329, 'bagging_fraction': 0.9360828660144469, 'feature_fraction': 0.4861984151919111, 'min_gain_to_split': 0.8308654187255212, 'lambda_l1': 0.01822501444287623, 'lambda_l2': 0.31333436083047017}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:04,419] Trial 193 finished with value: 250.01651084320216 and parameters: {'num_leaves': 77, 'min_data_in_leaf': 18, 'max_bin': 399, 'bagging_fraction': 0.9281731513142994, 'feature_fraction': 0.49845904855397394, 'min_gain_to_split': 0.7024992822543622, 'lambda_l1': 0.3049378543260431, 'lambda_l2': 0.477868250720999}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:07,666] Trial 194 finished with value: 249.31692753970492 and parameters: {'num_leaves': 83, 'min_data_in_leaf': 16, 'max_bin': 273, 'bagging_fraction': 0.9422046155386867, 'feature_fraction': 0.4743056494843865, 'min_gain_to_split': 0.7634907169090223, 'lambda_l1': 0.22763791360094718, 'lambda_l2': 0.02996993440272179}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:11,815] Trial 195 finished with value: 251.0370325059507 and parameters: {'num_leaves': 68, 'min_data_in_leaf': 16, 'max_bin': 210, 'bagging_fraction': 0.9193624363745587, 'feature_fraction': 0.4181099510827295, 'min_gain_to_split': 0.6406588831707636, 'lambda_l1': 0.1590616308434512, 'lambda_l2': 0.013163352154112367}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:15,265] Trial 196 finished with value: 248.77945517444144 and parameters: {'num_leaves': 136, 'min_data_in_leaf': 17, 'max_bin': 257, 'bagging_fraction': 0.8737106207282408, 'feature_fraction': 0.5249507724632081, 'min_gain_to_split': 0.9302512400158699, 'lambda_l1': 0.17998166233627505, 'lambda_l2': 0.42774724795455626}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:18,018] Trial 197 finished with value: 249.77307540512996 and parameters: {'num_leaves': 137, 'min_data_in_leaf': 19, 'max_bin': 372, 'bagging_fraction': 0.8725676496740775, 'feature_fraction': 0.5333837894185348, 'min_gain_to_split': 0.9852238571189288, 'lambda_l1': 0.011093601851032744, 'lambda_l2': 0.018685908076062276}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:22,177] Trial 198 finished with value: 248.88932167060125 and parameters: {'num_leaves': 135, 'min_data_in_leaf': 17, 'max_bin': 364, 'bagging_fraction': 0.8737174161802679, 'feature_fraction': 0.524724766009316, 'min_gain_to_split': 0.42620809044511215, 'lambda_l1': 0.1768223455419468, 'lambda_l2': 0.2710478694991913}. Best is trial 162 with value: 247.42572016119635.
[I 2024-01-04 15:03:27,054] Trial 199 finished with value: 248.88613639666747 and parameters: {'num_leaves': 132, 'min_data_in_leaf': 18, 'max_bin': 262, 'bagging_fraction': 0.8772487349760786, 'feature_fraction': 0.529690879192091, 'min_gain_to_split': 0.4057664939875361, 'lambda_l1': 0.18573851308642703, 'lambda_l2': 0.3267069376843893}. Best is trial 162 with value: 247.42572016119635.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[361]   train's l1: 168.729 valid's l1: 250.214
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 130.661 valid's l1: 249.112
Early stopping, best iteration is:
[441]   train's l1: 135.121 valid's l1: 248.898
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 193.668 valid's l1: 252.014
Early stopping, best iteration is:
[756]   train's l1: 180.975 valid's l1: 251.168
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 183.759 valid's l1: 248.465
Early stopping, best iteration is:
[592]   train's l1: 176.402 valid's l1: 248.096
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 156.974 valid's l1: 250.474
Early stopping, best iteration is:
[471]   train's l1: 160.618 valid's l1: 250.361
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 158.458 valid's l1: 250.116
Early stopping, best iteration is:
[452]   train's l1: 161.498 valid's l1: 249.961
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[276]   train's l1: 184.914 valid's l1: 252.757
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 143.176 valid's l1: 251.183
Early stopping, best iteration is:
[480]   train's l1: 144.414 valid's l1: 251.075
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[393]   train's l1: 176.132 valid's l1: 251.645
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 137.99  valid's l1: 250.507
Early stopping, best iteration is:
[800]   train's l1: 122.848 valid's l1: 250.145
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 195.554 valid's l1: 251.229
[1000]  train's l1: 173.411 valid's l1: 249.605
Did not meet early stopping. Best iteration is:
[943]   train's l1: 175.143 valid's l1: 249.488
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[394]   train's l1: 132.863 valid's l1: 253.448
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[211]   train's l1: 171.691 valid's l1: 251.539
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[269]   train's l1: 179.796 valid's l1: 251.863
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 172.5   valid's l1: 249.695
Early stopping, best iteration is:
[430]   train's l1: 178.031 valid's l1: 249.44
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[331]   train's l1: 148.477 valid's l1: 250.854
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 153.638 valid's l1: 249.319
Early stopping, best iteration is:
[557]   train's l1: 149.735 valid's l1: 249.127
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 180.834 valid's l1: 251.414
[1000]  train's l1: 159.118 valid's l1: 250.56
Did not meet early stopping. Best iteration is:
[957]   train's l1: 160.275 valid's l1: 250.504
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 143.83  valid's l1: 249.068
Early stopping, best iteration is:
[467]   train's l1: 146.209 valid's l1: 248.955
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[348]   train's l1: 163.549 valid's l1: 252.103
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 175.065 valid's l1: 250.818
Early stopping, best iteration is:
[846]   train's l1: 157.495 valid's l1: 249.93
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 142.941 valid's l1: 250.298
Early stopping, best iteration is:
[536]   train's l1: 140.879 valid's l1: 250.166
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[211]   train's l1: 168.132 valid's l1: 251.978
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[332]   train's l1: 161.463 valid's l1: 248.641
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 139.969 valid's l1: 250.966
Early stopping, best iteration is:
[689]   train's l1: 129.32  valid's l1: 250.606
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[195]   train's l1: 185.522 valid's l1: 250.859
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 149.085 valid's l1: 249.481
Early stopping, best iteration is:
[654]   train's l1: 140.939 valid's l1: 249.324
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 137.277 valid's l1: 250.89
Early stopping, best iteration is:
[405]   train's l1: 145.492 valid's l1: 250.663
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 182.937 valid's l1: 250.203
Early stopping, best iteration is:
[510]   train's l1: 181.888 valid's l1: 250.115
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 154.375 valid's l1: 251.136
Early stopping, best iteration is:
[825]   train's l1: 138.693 valid's l1: 250.816
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[308]   train's l1: 172.632 valid's l1: 251.044
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 147.24  valid's l1: 250.601
Early stopping, best iteration is:
[557]   train's l1: 143.155 valid's l1: 250.544
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 141.05  valid's l1: 249.847
Early stopping, best iteration is:
[403]   train's l1: 149.292 valid's l1: 249.703
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 158.408 valid's l1: 252.173
Early stopping, best iteration is:
[532]   train's l1: 155.77  valid's l1: 251.871
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[365]   train's l1: 156.3   valid's l1: 250.305
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 160.195 valid's l1: 249.744
Early stopping, best iteration is:
[421]   train's l1: 167.482 valid's l1: 249.581
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 167.748 valid's l1: 249.458
Early stopping, best iteration is:
[600]   train's l1: 162.83  valid's l1: 249.291
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 164.516 valid's l1: 250.399
Early stopping, best iteration is:
[514]   train's l1: 163.752 valid's l1: 250.323
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 139.187 valid's l1: 248.239
Early stopping, best iteration is:
[408]   train's l1: 146.249 valid's l1: 247.985
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 129.961 valid's l1: 251.06
Early stopping, best iteration is:
[575]   train's l1: 125.458 valid's l1: 250.803
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 141.845 valid's l1: 251.812
Early stopping, best iteration is:
[492]   train's l1: 142.603 valid's l1: 251.674
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 137.479 valid's l1: 251.811
Early stopping, best iteration is:
[512]   train's l1: 136.629 valid's l1: 251.735
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 144.91  valid's l1: 248.37
Early stopping, best iteration is:
[450]   train's l1: 148.083 valid's l1: 248.321
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[270]   train's l1: 165.665 valid's l1: 251.398
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 184.062 valid's l1: 250.586
[1000]  train's l1: 162.16  valid's l1: 249.606
Did not meet early stopping. Best iteration is:
[995]   train's l1: 162.356 valid's l1: 249.601
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[341]   train's l1: 154.323 valid's l1: 250.146
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[309]   train's l1: 158.43  valid's l1: 249.307
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 138.961 valid's l1: 250.66
Early stopping, best iteration is:
[449]   train's l1: 143.133 valid's l1: 250.49
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[353]   train's l1: 162.925 valid's l1: 248.255
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[358]   train's l1: 166.139 valid's l1: 250.126
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 150.623 valid's l1: 250.135
Early stopping, best iteration is:
[512]   train's l1: 150.163 valid's l1: 250.056
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 149.425 valid's l1: 250.166
Early stopping, best iteration is:
[475]   train's l1: 151.48  valid's l1: 250.067
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 137.549 valid's l1: 252.719
Early stopping, best iteration is:
[404]   train's l1: 145.238 valid's l1: 252.667
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 137.071 valid's l1: 250.707
Early stopping, best iteration is:
[418]   train's l1: 143.92  valid's l1: 250.553
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[352]   train's l1: 156.811 valid's l1: 249.933
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 147.311 valid's l1: 249.986
Early stopping, best iteration is:
[565]   train's l1: 142.989 valid's l1: 249.912
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[283]   train's l1: 162.394 valid's l1: 251.6
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[270]   train's l1: 162.445 valid's l1: 251.219
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 161.894 valid's l1: 249.203
Early stopping, best iteration is:
[563]   train's l1: 157.656 valid's l1: 248.91
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 146.433 valid's l1: 250.169
Early stopping, best iteration is:
[454]   train's l1: 149.981 valid's l1: 250.121
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[280]   train's l1: 150.375 valid's l1: 251.769
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 162.783 valid's l1: 250.022
Early stopping, best iteration is:
[536]   train's l1: 160.372 valid's l1: 249.65
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 150.494 valid's l1: 250.152
Early stopping, best iteration is:
[416]   train's l1: 157.739 valid's l1: 250.007
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[378]   train's l1: 175.261 valid's l1: 251.091
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 164.079 valid's l1: 251.876
Early stopping, best iteration is:
[496]   train's l1: 164.306 valid's l1: 251.836
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[312]   train's l1: 190.75  valid's l1: 250.574
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 169.321 valid's l1: 251.092
Early stopping, best iteration is:
[672]   train's l1: 158.933 valid's l1: 250.771
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[372]   train's l1: 153.549 valid's l1: 251.502
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 151.016 valid's l1: 250.687
Early stopping, best iteration is:
[543]   train's l1: 148.638 valid's l1: 250.589
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[327]   train's l1: 170.392 valid's l1: 250.161
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 144.141 valid's l1: 250.243
Early stopping, best iteration is:
[669]   train's l1: 133.803 valid's l1: 249.979
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 142.731 valid's l1: 249.775
Early stopping, best iteration is:
[565]   train's l1: 137.761 valid's l1: 249.728
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 188.336 valid's l1: 251.619
Early stopping, best iteration is:
[678]   train's l1: 178.939 valid's l1: 251.138
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 144.872 valid's l1: 252.145
Early stopping, best iteration is:
[540]   train's l1: 142.216 valid's l1: 252.024
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 143.648 valid's l1: 248.855
Early stopping, best iteration is:
[476]   train's l1: 145.373 valid's l1: 248.717
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[365]   train's l1: 158.647 valid's l1: 249.252
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[394]   train's l1: 164.163 valid's l1: 250.314
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 151.395 valid's l1: 249.527
Early stopping, best iteration is:
[526]   train's l1: 149.615 valid's l1: 249.407
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 151.671 valid's l1: 248.64
Early stopping, best iteration is:
[685]   train's l1: 142.201 valid's l1: 248.263
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 187.076 valid's l1: 253.484
Early stopping, best iteration is:
[480]   train's l1: 188.929 valid's l1: 253.438
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 167.685 valid's l1: 252.062
Early stopping, best iteration is:
[667]   train's l1: 156.254 valid's l1: 251.566
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[293]   train's l1: 173.606 valid's l1: 250.69
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[331]   train's l1: 152.579 valid's l1: 251.458
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 135.84  valid's l1: 249.904
Early stopping, best iteration is:
[432]   train's l1: 141.973 valid's l1: 249.529
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 178.354 valid's l1: 251.595
Early stopping, best iteration is:
[517]   train's l1: 177.413 valid's l1: 251.569
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 146.442 valid's l1: 251.888
Early stopping, best iteration is:
[680]   train's l1: 136.396 valid's l1: 251.706
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 156.556 valid's l1: 250.128
Early stopping, best iteration is:
[457]   train's l1: 160.195 valid's l1: 249.847
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 173.44  valid's l1: 248.898
Early stopping, best iteration is:
[508]   train's l1: 172.765 valid's l1: 248.825
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 172.053 valid's l1: 250.106
Early stopping, best iteration is:
[503]   train's l1: 171.553 valid's l1: 250.069
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 177.996 valid's l1: 252.176
[1000]  train's l1: 158.202 valid's l1: 251.496
Did not meet early stopping. Best iteration is:
[994]   train's l1: 158.319 valid's l1: 251.487
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[352]   train's l1: 145.912 valid's l1: 251.062
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 174.788 valid's l1: 249.122
Early stopping, best iteration is:
[799]   train's l1: 160.503 valid's l1: 248.746
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 175.412 valid's l1: 251.756
Early stopping, best iteration is:
[490]   train's l1: 176.292 valid's l1: 251.651
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 175.166 valid's l1: 250.293
Early stopping, best iteration is:
[444]   train's l1: 179.237 valid's l1: 250.109
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 182.181 valid's l1: 247.746
Early stopping, best iteration is:
[579]   train's l1: 175.968 valid's l1: 247.492
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 181.708 valid's l1: 249.248
Early stopping, best iteration is:
[543]   train's l1: 177.369 valid's l1: 249.017
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 184.344 valid's l1: 250.706
Early stopping, best iteration is:
[611]   train's l1: 175.858 valid's l1: 249.724
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 186.57  valid's l1: 249.832
Early stopping, best iteration is:
[675]   train's l1: 176.952 valid's l1: 249.137
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 174.405 valid's l1: 249.807
Early stopping, best iteration is:
[488]   train's l1: 175.78  valid's l1: 249.654
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 188.834 valid's l1: 251.886
Early stopping, best iteration is:
[481]   train's l1: 190.657 valid's l1: 251.724
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 168.434 valid's l1: 249.015
Early stopping, best iteration is:
[436]   train's l1: 172.384 valid's l1: 248.924
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 179.225 valid's l1: 249.823
Early stopping, best iteration is:
[592]   train's l1: 173.742 valid's l1: 249.701
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 183.292 valid's l1: 250.346
Early stopping, best iteration is:
[671]   train's l1: 174.617 valid's l1: 249.833
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 167.333 valid's l1: 252.248
Early stopping, best iteration is:
[513]   train's l1: 166.261 valid's l1: 252.044
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 173.67  valid's l1: 249.416
Early stopping, best iteration is:
[415]   train's l1: 179.33  valid's l1: 249.104
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[375]   train's l1: 146.642 valid's l1: 250.862
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 143.222 valid's l1: 250.537
Early stopping, best iteration is:
[401]   train's l1: 150.821 valid's l1: 250.514
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 167.092 valid's l1: 249.96
Early stopping, best iteration is:
[542]   train's l1: 164.559 valid's l1: 249.783
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 193.483 valid's l1: 250.866
Early stopping, best iteration is:
[555]   train's l1: 189.863 valid's l1: 250.51
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 162.685 valid's l1: 250.312
Early stopping, best iteration is:
[454]   train's l1: 165.626 valid's l1: 250.174
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[359]   train's l1: 155.139 valid's l1: 252.234
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 160.599 valid's l1: 250.962
Early stopping, best iteration is:
[658]   train's l1: 151.461 valid's l1: 250.856
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[371]   train's l1: 164.618 valid's l1: 248.96
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 141.604 valid's l1: 250.388
Early stopping, best iteration is:
[661]   train's l1: 131.761 valid's l1: 250.246
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 137.132 valid's l1: 251.323
Early stopping, best iteration is:
[487]   train's l1: 137.878 valid's l1: 251.205
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 182.704 valid's l1: 248.534
Early stopping, best iteration is:
[497]   train's l1: 182.833 valid's l1: 248.516
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 179.905 valid's l1: 250.855
Early stopping, best iteration is:
[811]   train's l1: 163.683 valid's l1: 250.178
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 185.407 valid's l1: 249.018
Early stopping, best iteration is:
[671]   train's l1: 174.51  valid's l1: 248.412
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 186.839 valid's l1: 252.225
Early stopping, best iteration is:
[622]   train's l1: 178.989 valid's l1: 251.83
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 185.91  valid's l1: 251.487
[1000]  train's l1: 162.83  valid's l1: 250.838
Did not meet early stopping. Best iteration is:
[901]   train's l1: 165.666 valid's l1: 250.766
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 173.969 valid's l1: 252.399
Early stopping, best iteration is:
[532]   train's l1: 171.906 valid's l1: 252.335
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 185.739 valid's l1: 252.048
Early stopping, best iteration is:
[478]   train's l1: 186.984 valid's l1: 251.938
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 179.823 valid's l1: 250.836
Early stopping, best iteration is:
[645]   train's l1: 168.705 valid's l1: 250.318
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[382]   train's l1: 184.046 valid's l1: 250.58
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 146.631 valid's l1: 251.168
Early stopping, best iteration is:
[494]   train's l1: 146.698 valid's l1: 251.156
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[286]   train's l1: 167.24  valid's l1: 250.702
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[373]   train's l1: 146.076 valid's l1: 253.981
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[238]   train's l1: 171.315 valid's l1: 251.733
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 191.934 valid's l1: 252.094
Early stopping, best iteration is:
[640]   train's l1: 182.296 valid's l1: 251.855
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[355]   train's l1: 155.962 valid's l1: 250.349
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 136.486 valid's l1: 250.308
[1000]  train's l1: 115.75  valid's l1: 249.791
Did not meet early stopping. Best iteration is:
[984]   train's l1: 116.246 valid's l1: 249.705
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 146.091 valid's l1: 249.181
Early stopping, best iteration is:
[578]   train's l1: 141.518 valid's l1: 249.057
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 152.216 valid's l1: 250.679
Early stopping, best iteration is:
[444]   train's l1: 156.347 valid's l1: 250.39
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[298]   train's l1: 200.363 valid's l1: 253.127
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[271]   train's l1: 168.782 valid's l1: 251.49
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 183.528 valid's l1: 251.912
Early stopping, best iteration is:
[456]   train's l1: 187.744 valid's l1: 251.662
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 191.624 valid's l1: 250.327
Early stopping, best iteration is:
[741]   train's l1: 177.037 valid's l1: 249.592
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 161.343 valid's l1: 248.092
Early stopping, best iteration is:
[538]   train's l1: 158.372 valid's l1: 248.043
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[252]   train's l1: 201.008 valid's l1: 251.112
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 165.51  valid's l1: 250.944
Early stopping, best iteration is:
[459]   train's l1: 168.706 valid's l1: 250.655
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 158.278 valid's l1: 251.611
Early stopping, best iteration is:
[875]   train's l1: 142.383 valid's l1: 251.047
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 165.396 valid's l1: 251.612
[1000]  train's l1: 145.703 valid's l1: 250.665
Did not meet early stopping. Best iteration is:
[999]   train's l1: 145.739 valid's l1: 250.638
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[384]   train's l1: 158.326 valid's l1: 249.434
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[308]   train's l1: 167.825 valid's l1: 249.52
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 180.098 valid's l1: 249.856
Early stopping, best iteration is:
[402]   train's l1: 187.586 valid's l1: 249.609
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[353]   train's l1: 171.498 valid's l1: 253.348
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 180.704 valid's l1: 250.635
Early stopping, best iteration is:
[501]   train's l1: 180.565 valid's l1: 250.583
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[353]   train's l1: 183.466 valid's l1: 248.643
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 166.065 valid's l1: 250.332
Early stopping, best iteration is:
[412]   train's l1: 173.583 valid's l1: 249.803
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[375]   train's l1: 172.092 valid's l1: 250.896
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 179.896 valid's l1: 250.144
Early stopping, best iteration is:
[849]   train's l1: 163.198 valid's l1: 249.627
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 168.764 valid's l1: 247.863
Early stopping, best iteration is:
[407]   train's l1: 177.174 valid's l1: 247.773
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 164.541 valid's l1: 250.733
Early stopping, best iteration is:
[624]   train's l1: 156.286 valid's l1: 250.499
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 164.098 valid's l1: 250.502
Early stopping, best iteration is:
[840]   train's l1: 147.879 valid's l1: 249.889
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 170.995 valid's l1: 251.975
Early stopping, best iteration is:
[760]   train's l1: 156.306 valid's l1: 251.498
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 170.96  valid's l1: 250.405
Early stopping, best iteration is:
[435]   train's l1: 175.308 valid's l1: 250.251
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 173.723 valid's l1: 250.295
Early stopping, best iteration is:
[576]   train's l1: 168.439 valid's l1: 249.735
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 184.577 valid's l1: 251.039
Early stopping, best iteration is:
[778]   train's l1: 171.604 valid's l1: 250.211
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[380]   train's l1: 168.748 valid's l1: 252.713
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 167.875 valid's l1: 250.731
Early stopping, best iteration is:
[429]   train's l1: 173.261 valid's l1: 250.494
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 186.952 valid's l1: 251.057
Early stopping, best iteration is:
[662]   train's l1: 179.965 valid's l1: 250.805
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 150.129 valid's l1: 250.673
Early stopping, best iteration is:
[511]   train's l1: 149.49  valid's l1: 250.635
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[394]   train's l1: 157.386 valid's l1: 247.426
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[377]   train's l1: 155.874 valid's l1: 250.58
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[326]   train's l1: 171.471 valid's l1: 250.364
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[359]   train's l1: 160.968 valid's l1: 251.418
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[343]   train's l1: 162.312 valid's l1: 250.394
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 172.241 valid's l1: 252.088
Early stopping, best iteration is:
[858]   train's l1: 153.401 valid's l1: 251.351
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[365]   train's l1: 154.769 valid's l1: 249.732
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 173.416 valid's l1: 251.747
Early stopping, best iteration is:
[526]   train's l1: 172.382 valid's l1: 251.631
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[331]   train's l1: 158.753 valid's l1: 251.803
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 151.655 valid's l1: 249.999
Early stopping, best iteration is:
[452]   train's l1: 154.989 valid's l1: 249.905
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 156.71  valid's l1: 251.002
Early stopping, best iteration is:
[405]   train's l1: 164.421 valid's l1: 250.826
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[251]   train's l1: 182.115 valid's l1: 251.608
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[311]   train's l1: 167.793 valid's l1: 250.315
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 136.601 valid's l1: 249.97
Early stopping, best iteration is:
[494]   train's l1: 136.993 valid's l1: 249.927
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 151.722 valid's l1: 250.534
Early stopping, best iteration is:
[466]   train's l1: 154.349 valid's l1: 250.468
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 157.854 valid's l1: 250.558
Early stopping, best iteration is:
[461]   train's l1: 160.596 valid's l1: 250.445
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[393]   train's l1: 161.512 valid's l1: 250.245
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 182.806 valid's l1: 249.63
Early stopping, best iteration is:
[482]   train's l1: 183.701 valid's l1: 249.586
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 156.078 valid's l1: 250.398
Early stopping, best iteration is:
[469]   train's l1: 158.785 valid's l1: 250.24
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 175.287 valid's l1: 251.082
Early stopping, best iteration is:
[419]   train's l1: 181.95  valid's l1: 250.81
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 167.988 valid's l1: 249.508
Early stopping, best iteration is:
[600]   train's l1: 162.44  valid's l1: 249.311
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 169.917 valid's l1: 249.168
Early stopping, best iteration is:
[526]   train's l1: 167.992 valid's l1: 249.066
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 183.188 valid's l1: 249.953
Early stopping, best iteration is:
[761]   train's l1: 168.11  valid's l1: 249.467
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 173.998 valid's l1: 252.76
Early stopping, best iteration is:
[443]   train's l1: 178.387 valid's l1: 252.359
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 178.136 valid's l1: 249.352
Early stopping, best iteration is:
[645]   train's l1: 169.121 valid's l1: 248.932
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 164.602 valid's l1: 251.674
Early stopping, best iteration is:
[582]   train's l1: 160.224 valid's l1: 251.476
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[336]   train's l1: 181.957 valid's l1: 249.881
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 145.384 valid's l1: 250.642
Early stopping, best iteration is:
[492]   train's l1: 146.387 valid's l1: 250.525
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[335]   train's l1: 155.849 valid's l1: 249.39
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 175.551 valid's l1: 249.713
Early stopping, best iteration is:
[739]   train's l1: 163.099 valid's l1: 249.008
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 177.762 valid's l1: 250.622
Early stopping, best iteration is:
[594]   train's l1: 172.027 valid's l1: 250.431
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[343]   train's l1: 191.068 valid's l1: 250.017
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 175.095 valid's l1: 249.34
Early stopping, best iteration is:
[509]   train's l1: 173.953 valid's l1: 249.317
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 182.756 valid's l1: 251.889
[1000]  train's l1: 158.838 valid's l1: 251.107
Did not meet early stopping. Best iteration is:
[977]   train's l1: 159.608 valid's l1: 251.037
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 162.653 valid's l1: 248.853
Early stopping, best iteration is:
[437]   train's l1: 163.86  valid's l1: 248.779
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
Early stopping, best iteration is:
[343]   train's l1: 173.275 valid's l1: 249.773
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 149.624 valid's l1: 248.989
Early stopping, best iteration is:
[466]   train's l1: 152.368 valid's l1: 248.889
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - 
Training until validation scores don't improve for 100 rounds
[500]   train's l1: 153.934 valid's l1: 249.053
Early stopping, best iteration is:
[630]   train's l1: 146.37  valid's l1: 248.886
- * - - * - - * - - * - - * - - * - - * - - * - - * - - * - </code></pre>
</div>
</div>
<div id="cell-67" class="cell" data-execution_count="81">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="im">from</span> pprint <span class="im">import</span> pprint</span>
<span id="cb77-2"><a href="#cb77-2"></a>trial <span class="op">=</span> study.best_trial</span>
<span id="cb77-3"><a href="#cb77-3"></a>pprint(<span class="ss">f"trial </span><span class="sc">{</span>trial<span class="sc">.</span>number<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb77-4"><a href="#cb77-4"></a>pprint(<span class="ss">f"MAE best: </span><span class="sc">{</span>trial<span class="sc">.</span>value<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb77-5"><a href="#cb77-5"></a>pprint(trial.params)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>'trial 162'
'MAE best: 247.4257'
{'bagging_fraction': 0.8768652682558914,
 'feature_fraction': 0.4597140389171417,
 'lambda_l1': 0.03396002472637102,
 'lambda_l2': 0.014071960871027224,
 'max_bin': 285,
 'min_data_in_leaf': 16,
 'min_gain_to_split': 0.3170777189102552,
 'num_leaves': 138}</code></pre>
</div>
</div>
<p>これを使ってもう一度学習しなおすことで大丈夫です。</p>
<div id="cell-69" class="cell" data-execution_count="82">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a>optuna.visualization.plot_param_importances(study).show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>ImportError: Tried to import 'plotly' but failed. Please make sure that the package is installed correctly to use this feature. Actual error: No module named 'plotly'.</code></pre>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="83">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="im">import</span> joblib</span>
<span id="cb81-2"><a href="#cb81-2"></a>joblib.dump(trial, <span class="st">"best-trial.joblib"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="83">
<pre><code>['best-trial.joblib']</code></pre>
</div>
</div>
<p>最適なパラメータで再学習をおこなう.</p>
<div id="cell-72" class="cell" data-execution_count="86">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a>params <span class="op">=</span> joblib.load(<span class="st">"best-trial.joblib"</span>).params</span>
<span id="cb83-2"><a href="#cb83-2"></a>params.update(params_base)</span>
<span id="cb83-3"><a href="#cb83-3"></a></span>
<span id="cb83-4"><a href="#cb83-4"></a>X_tr, X_va, y_tr, y_va <span class="op">=</span> train_test_split(X_train, y_train, test_size <span class="op">=</span> <span class="fl">.2</span>, shuffle <span class="op">=</span> <span class="va">True</span>, )</span>
<span id="cb83-5"><a href="#cb83-5"></a></span>
<span id="cb83-6"><a href="#cb83-6"></a>lgb_train <span class="op">=</span> lgb.Dataset(X_tr, y_tr)</span>
<span id="cb83-7"><a href="#cb83-7"></a>lgb_eval <span class="op">=</span> lgb.Dataset(X_va, y_va, reference<span class="op">=</span>lgb_train)</span>
<span id="cb83-8"><a href="#cb83-8"></a>model <span class="op">=</span> lgb.train(</span>
<span id="cb83-9"><a href="#cb83-9"></a>    params, </span>
<span id="cb83-10"><a href="#cb83-10"></a>    lgb_train, </span>
<span id="cb83-11"><a href="#cb83-11"></a>    num_boost_round<span class="op">=</span><span class="dv">10_000</span>,</span>
<span id="cb83-12"><a href="#cb83-12"></a>    valid_sets <span class="op">=</span> [lgb_train, lgb_eval], </span>
<span id="cb83-13"><a href="#cb83-13"></a>    valid_names <span class="op">=</span> [<span class="st">"train"</span>, <span class="st">"valid"</span>], </span>
<span id="cb83-14"><a href="#cb83-14"></a>    callbacks <span class="op">=</span> [lgb.early_stopping(<span class="dv">100</span>), lgb.log_evaluation(<span class="dv">500</span>)], </span>
<span id="cb83-15"><a href="#cb83-15"></a></span>
<span id="cb83-16"><a href="#cb83-16"></a>)</span>
<span id="cb83-17"><a href="#cb83-17"></a>y_va_pred <span class="op">=</span> model.predict(</span>
<span id="cb83-18"><a href="#cb83-18"></a>    X_va, </span>
<span id="cb83-19"><a href="#cb83-19"></a>    num_iteration<span class="op">=</span>model.best_iteration</span>
<span id="cb83-20"><a href="#cb83-20"></a>)</span>
<span id="cb83-21"><a href="#cb83-21"></a>score <span class="op">=</span> mean_absolute_error(y_va, y_va_pred)</span>
<span id="cb83-22"><a href="#cb83-22"></a><span class="bu">print</span>(<span class="ss">f"MAE valid: </span><span class="sc">{</span>score<span class="sc">: .2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Training until validation scores don't improve for 100 rounds
[500]   train's l1: 210.836 valid's l1: 254.237
[1000]  train's l1: 183.016 valid's l1: 251.676
[1500]  train's l1: 166.283 valid's l1: 250.733
[2000]  train's l1: 154.341 valid's l1: 250.346
Early stopping, best iteration is:
[1947]  train's l1: 155.381 valid's l1: 250.313
MAE valid:  250.31</code></pre>
</div>
</div>
<div id="cell-73" class="cell" data-execution_count="87">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>y_test_pred <span class="op">=</span> model.predict(X_test, num_iteration<span class="op">=</span>model.best_iteration)</span>
<span id="cb85-2"><a href="#cb85-2"></a>score <span class="op">=</span> mean_absolute_error(y_test, y_test_pred)</span>
<span id="cb85-3"><a href="#cb85-3"></a><span class="bu">print</span>(<span class="ss">f"MAE valid: </span><span class="sc">{</span>score<span class="sc">: .2f}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MAE valid:  242.05</code></pre>
</div>
</div>


</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../../contents/books/08_handbook_lightgbm/cl03_分類の予測モデル.html" class="pagination-link  aria-label=" はじめに"="">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">はじめに</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../contents/books/09_Pythonで学ぶ数理最適化/ch01-基礎編.html" class="pagination-link" aria-label="基礎編">
        <span class="nav-page-text">基礎編</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>