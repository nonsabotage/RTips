<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.515">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>R Tips - ggplot2 Tips</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;800&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">R Tips</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-home" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Home</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-home">    
        <li>
    <a class="dropdown-item" href="../../../index.html">
 <span class="dropdown-text">Home</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-web-site" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Web Site</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-web-site">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="../../../contents/website/r4ds2e/index.html">
 <span class="dropdown-text">R for Data Science 2e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/leaflet4r/index.html">
 <span class="dropdown-text">Leaflet for R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/analizeUSCensus/index.html">
 <span class="dropdown-text">Analyzing US Census Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/graphic_design_with_ggplot2/index.html">
 <span class="dropdown-text">Graphic Design with ggplot2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-books" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">books</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-books">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="../../../contents/books/01_Rによる実証分析_2e/index.html">
 <span class="dropdown-text">Rによる実証分析2e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/02_因果推論ミックステープ/index.html">
 <span class="dropdown-text">因果推論ミックステープ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/index.html">
 <span class="dropdown-text">数値シミュレーションで学ぶ統計の仕組み</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/05_統計的因果推論の理論と実際/index.html">
 <span class="dropdown-text">統計的因果推論の理論と実際</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-libs" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">libs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-libs">    
        <li class="dropdown-header">libs</li>
        <li>
    <a class="dropdown-item" href="../../../contents/libs/ggtext/working.html">
 <span class="dropdown-text">ggtext</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/ggfittext/working.html">
 <span class="dropdown-text">ggfittext</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/gganimate/working.html">
 <span class="dropdown-text">gganimate</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/ggmosaic/working.html">
 <span class="dropdown-text">ggmosaic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/treemapify/working.html">
 <span class="dropdown-text">treemapify</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/ComplexHeatmap/working.html">
 <span class="dropdown-text">ComplexHeatmap</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/GGally/working.html">
 <span class="dropdown-text">GGally</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/sf/working.html">
 <span class="dropdown-text">sf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/igraph/index.html">
 <span class="dropdown-text">igraph</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notes" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notes">    
        <li class="dropdown-header">Notes</li>
        <li>
    <a class="dropdown-item" href="../../../contents/notes/ggplot2/working.html">
 <span class="dropdown-text">ggplot2</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-utils" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Utils</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-utils">    
        <li class="dropdown-header">Utils</li>
        <li>
    <a class="dropdown-item" href="../../../contents/utils/01_写真GPS/index.html">
 <span class="dropdown-text">01_写真GPS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-test" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Test</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-test">    
        <li class="dropdown-header">Test</li>
        <li>
    <a class="dropdown-item" href="../../../contents/test/bash/quick_sample.html">
 <span class="dropdown-text">Bash</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/R/renv.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/R2/renv.html">
 <span class="dropdown-text">R2</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../contents/notes/ggplot2/working.html">Notes</a></li><li class="breadcrumb-item"><a href="../../../contents/notes/ggplot2/working.html">ggplot2</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/notes/ggplot2/working.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ggplot2</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#reference" id="toc-reference" class="nav-link" data-scroll-target="#reference"><span class="header-section-number">1.1</span> Reference</a></li>
  </ul></li>
  <li><a href="#simple-examples" id="toc-simple-examples" class="nav-link" data-scroll-target="#simple-examples"><span class="header-section-number">2</span> Simple Examples</a>
  <ul class="collapse">
  <li><a href="#カーネル密度と経験累積分布関数" id="toc-カーネル密度と経験累積分布関数" class="nav-link" data-scroll-target="#カーネル密度と経験累積分布関数"><span class="header-section-number">2.1</span> カーネル密度と経験累積分布関数</a></li>
  <li><a href="#関数曲線" id="toc-関数曲線" class="nav-link" data-scroll-target="#関数曲線"><span class="header-section-number">2.2</span> 関数曲線</a></li>
  <li><a href="#確率楕円" id="toc-確率楕円" class="nav-link" data-scroll-target="#確率楕円"><span class="header-section-number">2.3</span> 確率楕円</a></li>
  <li><a href="#annotate関数" id="toc-annotate関数" class="nav-link" data-scroll-target="#annotate関数"><span class="header-section-number">2.4</span> annotate関数</a>
  <ul class="collapse">
  <li><a href="#annotate" id="toc-annotate" class="nav-link" data-scroll-target="#annotate"><span class="header-section-number">2.4.1</span> annotate</a></li>
  </ul></li>
  <li><a href="#annotation" id="toc-annotation" class="nav-link" data-scroll-target="#annotation"><span class="header-section-number">2.5</span> annotation</a>
  <ul class="collapse">
  <li><a href="#annotation_custom" id="toc-annotation_custom" class="nav-link" data-scroll-target="#annotation_custom"><span class="header-section-number">2.5.1</span> annotation_custom</a></li>
  <li><a href="#annotation_logticks" id="toc-annotation_logticks" class="nav-link" data-scroll-target="#annotation_logticks"><span class="header-section-number">2.5.2</span> annotation_logticks</a></li>
  <li><a href="#annotation_map" id="toc-annotation_map" class="nav-link" data-scroll-target="#annotation_map"><span class="header-section-number">2.5.3</span> annotation_map</a></li>
  <li><a href="#annotation_raster" id="toc-annotation_raster" class="nav-link" data-scroll-target="#annotation_raster"><span class="header-section-number">2.5.4</span> annotation_raster</a></li>
  </ul></li>
  <li><a href="#凡例のハンドリング" id="toc-凡例のハンドリング" class="nav-link" data-scroll-target="#凡例のハンドリング"><span class="header-section-number">2.6</span> 凡例のハンドリング</a>
  <ul class="collapse">
  <li><a href="#文字や位置を微調整したい" id="toc-文字や位置を微調整したい" class="nav-link" data-scroll-target="#文字や位置を微調整したい"><span class="header-section-number">2.6.1</span> 文字や位置を微調整したい</a></li>
  </ul></li>
  <li><a href="#テキスト" id="toc-テキスト" class="nav-link" data-scroll-target="#テキスト"><span class="header-section-number">2.7</span> テキスト</a>
  <ul class="collapse">
  <li><a href="#hjustvjusts" id="toc-hjustvjusts" class="nav-link" data-scroll-target="#hjustvjusts"><span class="header-section-number">2.7.1</span> hjust/vjusts</a></li>
  <li><a href="#position" id="toc-position" class="nav-link" data-scroll-target="#position"><span class="header-section-number">2.7.2</span> position</a></li>
  </ul></li>
  <li><a href="#facet_grid" id="toc-facet_grid" class="nav-link" data-scroll-target="#facet_grid"><span class="header-section-number">2.8</span> facet_grid</a></li>
  <li><a href="#summary_stat" id="toc-summary_stat" class="nav-link" data-scroll-target="#summary_stat"><span class="header-section-number">2.9</span> summary_stat</a></li>
  <li><a href="#マルチレベルのwrap" id="toc-マルチレベルのwrap" class="nav-link" data-scroll-target="#マルチレベルのwrap"><span class="header-section-number">2.10</span> マルチレベルのwrap</a></li>
  <li><a href="#trans" id="toc-trans" class="nav-link" data-scroll-target="#trans"><span class="header-section-number">2.11</span> trans</a></li>
  <li><a href="#グラフの順番に凡例の順番を合わす" id="toc-グラフの順番に凡例の順番を合わす" class="nav-link" data-scroll-target="#グラフの順番に凡例の順番を合わす"><span class="header-section-number">2.12</span> グラフの順番に凡例の順番を合わす</a></li>
  <li><a href="#histgram" id="toc-histgram" class="nav-link" data-scroll-target="#histgram"><span class="header-section-number">2.13</span> histgram</a></li>
  <li><a href="#geom_smooth" id="toc-geom_smooth" class="nav-link" data-scroll-target="#geom_smooth"><span class="header-section-number">2.14</span> geom_smooth</a></li>
  </ul></li>
  <li><a href="#extensions" id="toc-extensions" class="nav-link" data-scroll-target="#extensions"><span class="header-section-number">3</span> Extensions</a>
  <ul class="collapse">
  <li><a href="#ggmosaic" id="toc-ggmosaic" class="nav-link" data-scroll-target="#ggmosaic"><span class="header-section-number">3.1</span> ggmosaic</a></li>
  <li><a href="#ggokabeito" id="toc-ggokabeito" class="nav-link" data-scroll-target="#ggokabeito"><span class="header-section-number">3.2</span> ggokabeito</a></li>
  <li><a href="#ggprism" id="toc-ggprism" class="nav-link" data-scroll-target="#ggprism"><span class="header-section-number">3.3</span> ggprism</a>
  <ul class="collapse">
  <li><a href="#minor-ticks" id="toc-minor-ticks" class="nav-link" data-scroll-target="#minor-ticks"><span class="header-section-number">3.3.1</span> Minor ticks</a></li>
  <li><a href="#brackets-axis" id="toc-brackets-axis" class="nav-link" data-scroll-target="#brackets-axis"><span class="header-section-number">3.3.2</span> Brackets axis</a></li>
  <li><a href="#border-with-minor-ticks" id="toc-border-with-minor-ticks" class="nav-link" data-scroll-target="#border-with-minor-ticks"><span class="header-section-number">3.3.3</span> Border with minor ticks</a></li>
  </ul></li>
  <li><a href="#gghalves" id="toc-gghalves" class="nav-link" data-scroll-target="#gghalves"><span class="header-section-number">3.4</span> gghalves</a></li>
  <li><a href="#ggally" id="toc-ggally" class="nav-link" data-scroll-target="#ggally"><span class="header-section-number">3.5</span> ggally</a>
  <ul class="collapse">
  <li><a href="#types-of-plots" id="toc-types-of-plots" class="nav-link" data-scroll-target="#types-of-plots"><span class="header-section-number">3.5.1</span> Types of Plots</a></li>
  <li><a href="#ggpairs" id="toc-ggpairs" class="nav-link" data-scroll-target="#ggpairs"><span class="header-section-number">3.5.2</span> ggpairs</a></li>
  <li><a href="#ggnetworkmap" id="toc-ggnetworkmap" class="nav-link" data-scroll-target="#ggnetworkmap"><span class="header-section-number">3.5.3</span> ggnetworkmap</a></li>
  </ul></li>
  <li><a href="#gganimate" id="toc-gganimate" class="nav-link" data-scroll-target="#gganimate"><span class="header-section-number">3.6</span> gganimate</a></li>
  <li><a href="#waffle" id="toc-waffle" class="nav-link" data-scroll-target="#waffle"><span class="header-section-number">3.7</span> waffle</a></li>
  <li><a href="#ggupset" id="toc-ggupset" class="nav-link" data-scroll-target="#ggupset"><span class="header-section-number">3.8</span> ggupset</a></li>
  <li><a href="#heat-map-with-geom_tile" id="toc-heat-map-with-geom_tile" class="nav-link" data-scroll-target="#heat-map-with-geom_tile"><span class="header-section-number">3.9</span> Heat map with geom_tile</a>
  <ul class="collapse">
  <li><a href="#sample-data" id="toc-sample-data" class="nav-link" data-scroll-target="#sample-data"><span class="header-section-number">3.9.1</span> Sample Data</a></li>
  <li><a href="#color-palette" id="toc-color-palette" class="nav-link" data-scroll-target="#color-palette"><span class="header-section-number">3.9.2</span> Color Palette</a></li>
  <li><a href="#legend-customization" id="toc-legend-customization" class="nav-link" data-scroll-target="#legend-customization"><span class="header-section-number">3.9.3</span> Legend customization</a></li>
  </ul></li>
  <li><a href="#alluvial-plot" id="toc-alluvial-plot" class="nav-link" data-scroll-target="#alluvial-plot"><span class="header-section-number">3.10</span> Alluvial plot</a>
  <ul class="collapse">
  <li><a href="#sample-dataset" id="toc-sample-dataset" class="nav-link" data-scroll-target="#sample-dataset"><span class="header-section-number">3.10.1</span> sample dataset</a></li>
  <li><a href="#plot" id="toc-plot" class="nav-link" data-scroll-target="#plot"><span class="header-section-number">3.10.2</span> plot</a></li>
  </ul></li>
  <li><a href="#ggbumps" id="toc-ggbumps" class="nav-link" data-scroll-target="#ggbumps"><span class="header-section-number">3.11</span> ggbumps</a></li>
  <li><a href="#ggridges" id="toc-ggridges" class="nav-link" data-scroll-target="#ggridges"><span class="header-section-number">3.12</span> ggridges</a></li>
  <li><a href="#ggblend" id="toc-ggblend" class="nav-link" data-scroll-target="#ggblend"><span class="header-section-number">3.13</span> ggblend</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../contents/notes/ggplot2/working.html">Notes</a></li><li class="breadcrumb-item"><a href="../../../contents/notes/ggplot2/working.html">ggplot2</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ggplot2 Tips</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 26, 2023</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>ggplot2を覚えるのは難しいので具体的な描画事例を載せていく。 描画事例はシンプルなものを中心に載せていく。 機能の網羅性は欠ける資料であるが具体例なのでコピペですぐ動かせる内容ではある。</p>
<p>すでに個別のファイルで作成した 事例があるのでそれを移植すること!</p>
<section id="reference" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="reference"><span class="header-section-number">1.1</span> Reference</h2>
<ul>
<li><a href="https://ggplot2.tidyverse.org/index.html">ggplot2</a></li>
<li><a href="https://rstudio.com/wp-content/uploads/2016/11/Rmarkdown-cheatsheet-2.0_ja.pdf">rmarkdown</a></li>
<li><a href="https://exts.ggplot2.tidyverse.org/gallery/">ggplot2 extensions</a></li>
</ul>
</section>
</section>
<section id="simple-examples" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Simple Examples</h1>
<section id="カーネル密度と経験累積分布関数" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="カーネル密度と経験累積分布関数"><span class="header-section-number">2.1</span> カーネル密度と経験累積分布関数</h2>
<p>経験累積分布関数とカーネル密度プロットは常に描画すること. できればそれを組み合わせて描画すること。 経験累積分布関数はさらに<strong>目的変数の累積分布関数と比較</strong>をすること.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-2_b14618f95cf9e1dd2fc2b89d2f70b418">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>data <span class="ot">&lt;-</span> iris</span>
<span id="cb1-2"><a href="#cb1-2"></a>g_dens <span class="ot">&lt;-</span> </span>
<span id="cb1-3"><a href="#cb1-3"></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb1-5"><a href="#cb1-5"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sepal.Length"</span>, <span class="at">y =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb1-8"><a href="#cb1-8"></a>    <span class="fu">scale_color_aaas</span>()</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; ℹ Please use `linewidth` instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-3_54a82b1ca448c5aa55ec3746a6642923">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>g_ecdf <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2"></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="fu">stat_ecdf</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb2-6"><a href="#cb2-6"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sepal.Length"</span>, <span class="at">y =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="fu">scale_color_aaas</span>() <span class="sc">+</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-4_e2bbb1f36c97d235e367292e5f423f63">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">plot_grid</span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>    g_dens <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>), </span>
<span id="cb3-4"><a href="#cb3-4"></a>    g_ecdf, </span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="at">ncol =</span> <span class="dv">1</span>,  </span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="at">align =</span> <span class="st">"v"</span>,  <span class="co"># 軸を合わせるのに必要 </span></span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="at">axis =</span> <span class="st">"tblr"</span> <span class="co"># 余白を合わせるのに必要(特に凡例があったりなかったりするとき)</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="working_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="関数曲線" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="関数曲線"><span class="header-section-number">2.2</span> 関数曲線</h2>
<p>確率密度関数などを記述するときに使う.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-5_66eb3065aa35bdaf09e35407d65c07b5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>generate_dnorm <span class="ot">&lt;-</span> <span class="cf">function</span> (param) {</span>
<span id="cb4-2"><a href="#cb4-2"></a>    <span class="fu">lift</span>( partial )(</span>
<span id="cb4-3"><a href="#cb4-3"></a>        <span class="fu">update_list</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>            param, <span class="at">.f =</span> dnorm, <span class="at">.first =</span> <span class="cn">FALSE</span> )</span>
<span id="cb4-5"><a href="#cb4-5"></a>        )</span>
<span id="cb4-6"><a href="#cb4-6"></a>}</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a>param1 <span class="ot">&lt;-</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>    <span class="fu">list</span>( <span class="at">mean =</span> <span class="fl">1.23</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>    <span class="fu">update_list</span>(</span>
<span id="cb4-11"><a href="#cb4-11"></a>        <span class="at">sd =</span>  <span class="sc">~</span> .<span class="dv">1</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>    )</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="co">#&gt; Warning: `update_list()` was deprecated in purrr 1.0.0.</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>param2 <span class="ot">&lt;-</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    param1 <span class="sc">%&gt;%</span></span>
<span id="cb4-16"><a href="#cb4-16"></a>    <span class="fu">update_list</span>(</span>
<span id="cb4-17"><a href="#cb4-17"></a>        <span class="at">mean =</span> <span class="fl">1.48631</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>    )</span>
<span id="cb4-19"><a href="#cb4-19"></a></span>
<span id="cb4-20"><a href="#cb4-20"></a>dnorm1 <span class="ot">&lt;-</span> <span class="fu">generate_dnorm</span>( param1 )</span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="co">#&gt; Warning: `lift()` was deprecated in purrr 1.0.0.</span></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co">#&gt; Warning: The `.first` argument of `partial()` is deprecated as of purrr 0.3.0.</span></span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="co">#&gt; ℹ The deprecated feature was likely used in the purrr package.</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="co">#&gt;   Please report the issue at &lt;https://github.com/tidyverse/purrr/issues&gt;.</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>dnorm2 <span class="ot">&lt;-</span> <span class="fu">generate_dnorm</span>( param2 )</span>
<span id="cb4-26"><a href="#cb4-26"></a>fill_poly <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(</span>
<span id="cb4-27"><a href="#cb4-27"></a>        <span class="at">x =</span> <span class="fu">seq</span>(<span class="fu">qnorm</span>(.<span class="dv">9</span>, <span class="at">mean =</span> param1<span class="sc">$</span>mean, <span class="at">sd =</span> param1<span class="sc">$</span>sd), <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb4-28"><a href="#cb4-28"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb4-29"><a href="#cb4-29"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">map_dbl</span>(x, dnorm1))</span>
<span id="cb4-30"><a href="#cb4-30"></a><span class="co">#&gt; Warning: `data_frame()` was deprecated in tibble 1.1.0.</span></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="co">#&gt; ℹ Please use `tibble()` instead.</span></span>
<span id="cb4-32"><a href="#cb4-32"></a></span>
<span id="cb4-33"><a href="#cb4-33"></a>grh <span class="ot">&lt;-</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>    <span class="fu">data_frame</span>( <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, .<span class="dv">01</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb4-35"><a href="#cb4-35"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb4-36"><a href="#cb4-36"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">0</span>, <span class="at">intercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fill_poly, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymax =</span> y, <span class="at">ymin =</span> <span class="dv">0</span>), <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm1, <span class="at">colour =</span> <span class="st">"red"</span>,  <span class="at">lwd =</span> <span class="fl">1.2</span> ) <span class="sc">+</span></span>
<span id="cb4-39"><a href="#cb4-39"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm2, <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.2</span> ) <span class="sc">+</span></span>
<span id="cb4-40"><a href="#cb4-40"></a>    <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb4-41"><a href="#cb4-41"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">1.8</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.9</span>, <span class="fl">1.8</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb4-42"><a href="#cb4-42"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb4-43"><a href="#cb4-43"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>    <span class="fu">theme</span>(</span>
<span id="cb4-45"><a href="#cb4-45"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-46"><a href="#cb4-46"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-47"><a href="#cb4-47"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-48"><a href="#cb4-48"></a>        <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb4-49"><a href="#cb4-49"></a>        <span class="at">axis.text.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb4-50"><a href="#cb4-50"></a>    )</span>
<span id="cb4-51"><a href="#cb4-51"></a>grh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="working_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="確率楕円" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="確率楕円"><span class="header-section-number">2.3</span> 確率楕円</h2>
<p>デフォルトでは、2次元t分布の95%確率となる領域を記述してくれる。 つまり、異常値の発見に役立つ. <code>geom</code>パラメータを変更することで塗りつぶしを行うこともできるし、 t分布の変わりに正規分布を使うことも可能である. 単純に円を記述することも可能である.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-6_7a14d34079dfa642a7a516dc8c4cb566">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>gp <span class="ot">&lt;-</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>    iris <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb5-4"><a href="#cb5-4"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb5-5"><a href="#cb5-5"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sepal.Length"</span>, <span class="at">y =</span> <span class="st">"Sepal.Width"</span>) <span class="sc">+</span> </span>
<span id="cb5-6"><a href="#cb5-6"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="fu">theme</span>(</span>
<span id="cb5-8"><a href="#cb5-8"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="st">"mm"</span>), </span>
<span id="cb5-9"><a href="#cb5-9"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)),</span>
<span id="cb5-10"><a href="#cb5-10"></a>        <span class="at">axis.text.x  =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)),</span>
<span id="cb5-11"><a href="#cb5-11"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)), </span>
<span id="cb5-12"><a href="#cb5-12"></a>        <span class="at">axis.text.y  =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)),</span>
<span id="cb5-13"><a href="#cb5-13"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"line"</span>)</span>
<span id="cb5-14"><a href="#cb5-14"></a>    ) <span class="sc">+</span> </span>
<span id="cb5-15"><a href="#cb5-15"></a>    <span class="fu">scale_color_viridis_d</span>()</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a>gp <span class="sc">+</span> </span>
<span id="cb5-18"><a href="#cb5-18"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="fu">stat_ellipse</span>() <span class="sc">+</span> </span>
<span id="cb5-20"><a href="#cb5-20"></a>    <span class="fu">stat_ellipse</span>(<span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb5-21"><a href="#cb5-21"></a>    <span class="fu">stat_ellipse</span>(<span class="at">type =</span> <span class="st">"euclid"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="working_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-7_90068ed30340147a567b4d5815a6d1dd">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>gp <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>    <span class="fu">stat_ellipse</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>        <span class="fu">aes</span>(<span class="at">fill =</span> Species), </span>
<span id="cb6-4"><a href="#cb6-4"></a>        <span class="at">type =</span> <span class="st">"norm"</span>, </span>
<span id="cb6-5"><a href="#cb6-5"></a>        <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">color =</span> <span class="st">"transparent"</span>) <span class="sc">+</span> </span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">position =</span> <span class="st">"jitter"</span>) <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>    <span class="fu">scale_fill_viridis_d</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="working_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="annotate関数" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="annotate関数"><span class="header-section-number">2.4</span> annotate関数</h2>
<section id="annotate" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="annotate"><span class="header-section-number">2.4.1</span> annotate</h3>
<p>annotate関数ではジオメトリを追加するが、 典型的な<code>geom function</code>とは方法がことなり、 ジオメトリの属性はデータフレームの変数ではなく ベクトルで与えらる。 テキストラベルなど小さなアノテーションを追加するとき、 あるいは、データフレームにしたくないデータを持っているときに有用である。</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-8_42701eb3d28df08afb63e0d9ef1a5402">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"Some text"</span>), </span>
<span id="cb7-4"><a href="#cb7-4"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"Some text"</span>), </span>
<span id="cb7-5"><a href="#cb7-5"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="dv">3</span>, <span class="at">xmax =</span> <span class="fl">4.2</span>, <span class="at">ymin =</span> <span class="dv">12</span>, <span class="at">ymax =</span> <span class="dv">21</span>, <span class="at">alpha =</span> .<span class="dv">2</span>),</span>
<span id="cb7-6"><a href="#cb7-6"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">15</span>, <span class="at">yend =</span> <span class="dv">25</span>, <span class="at">colour =</span> <span class="st">"blue"</span>),</span>
<span id="cb7-7"><a href="#cb7-7"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"pointrange"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">12</span>, <span class="at">ymax =</span> <span class="dv">28</span>, <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb7-8"><a href="#cb7-8"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">21</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"my label"</span>, <span class="st">"label 2"</span>)),</span>
<span id="cb7-9"><a href="#cb7-9"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"italic(R) ^ 2 == 0.75"</span>,   <span class="at">parse =</span> <span class="cn">TRUE</span>),</span>
<span id="cb7-10"><a href="#cb7-10"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"paste(italic(R) ^ 2, </span><span class="sc">\"</span><span class="st"> = .75</span><span class="sc">\"</span><span class="st">)"</span>, <span class="at">parse =</span> <span class="cn">TRUE</span>), </span>
<span id="cb7-11"><a href="#cb7-11"></a>    <span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb7-12"><a href="#cb7-12"></a>    <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb7-13"><a href="#cb7-13"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="working_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>なんか頑張ったら、こんなのもかけた。。。 これがあれば特定の範囲のデータについて、分布を記述することが可能となる。 めっちゃこれが便利だというシーンは思い浮かばないけどキレイなグラフを 記述するという意味では良い経験になったと思う.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-9_37f156556e348b9b67941ea56ecdfba4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>d  <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>mpg)</span>
<span id="cb8-2"><a href="#cb8-2"></a>d2 <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>wt)</span>
<span id="cb8-3"><a href="#cb8-3"></a>p <span class="sc">+</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>    <span class="fu">annotate</span>(</span>
<span id="cb8-5"><a href="#cb8-5"></a>        <span class="st">"polygon"</span>,</span>
<span id="cb8-6"><a href="#cb8-6"></a>        <span class="at">x =</span> (<span class="dv">5</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> d<span class="sc">$</span>y), <span class="co"># シフトやスケールが必要</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>        <span class="at">y =</span> d<span class="sc">$</span>x,</span>
<span id="cb8-8"><a href="#cb8-8"></a>        <span class="at">color =</span> <span class="st">"red"</span>, </span>
<span id="cb8-9"><a href="#cb8-9"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span>  </span>
<span id="cb8-10"><a href="#cb8-10"></a>    <span class="fu">annotate</span>(</span>
<span id="cb8-11"><a href="#cb8-11"></a>        <span class="st">"polygon"</span>, </span>
<span id="cb8-12"><a href="#cb8-12"></a>        <span class="at">x =</span> d2<span class="sc">$</span>x, </span>
<span id="cb8-13"><a href="#cb8-13"></a>        <span class="at">y =</span> d2<span class="sc">$</span>y <span class="sc">*</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb8-14"><a href="#cb8-14"></a>        <span class="at">color =</span> <span class="st">"blue"</span>, </span>
<span id="cb8-15"><a href="#cb8-15"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="working_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="annotation" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="annotation"><span class="header-section-number">2.5</span> annotation</h2>
<p>すべてのパネルので同じ統計アノテーションとして使う特別な<code>geom</code>である。 これらのアノテーションは<code>scale</code>には影響を与えない.</p>
<section id="annotation_custom" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="annotation_custom"><span class="header-section-number">2.5.1</span> annotation_custom</h3>
<p>下記の例を見るとなんとなく使い方はわかる. あとは記述したい絵を考えたうえで、色々と工夫を重ねるのが一番良いと思う.</p>
<p>適当な<code>Grob</code>を作成できれば後は勢いで作成できる?</p>
<p>使い方の用途としては，全体を小さく書いておき メインは全体のうち拡大したい箇所，という方法にして置くのがわかりやすい気がする．</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-10_734fff70a274685e2af1569d3058a31d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb9-2"><a href="#cb9-2"></a>    iris <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb9-5"><a href="#cb9-5"></a>    <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>))</span>
<span id="cb9-6"><a href="#cb9-6"></a></span>
<span id="cb9-7"><a href="#cb9-7"></a>g <span class="ot">&lt;-</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="fu">ggplotGrob</span>(</span>
<span id="cb9-9"><a href="#cb9-9"></a>      <span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>      <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb9-11"><a href="#cb9-11"></a>      <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb9-12"><a href="#cb9-12"></a>      <span class="fu">theme</span>(</span>
<span id="cb9-13"><a href="#cb9-13"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>), </span>
<span id="cb9-14"><a href="#cb9-14"></a>          <span class="at">plot.background  =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>), </span>
<span id="cb9-15"><a href="#cb9-15"></a>          <span class="at">panel.grid   =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb9-16"><a href="#cb9-16"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb9-17"><a href="#cb9-17"></a>          <span class="at">axis.line.y  =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb9-18"><a href="#cb9-18"></a>          <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb9-19"><a href="#cb9-19"></a>          <span class="at">axis.ticks   =</span> <span class="fu">element_blank</span>()</span>
<span id="cb9-20"><a href="#cb9-20"></a>      ))</span>
<span id="cb9-21"><a href="#cb9-21"></a><span class="co">#&gt; Warning: The `&lt;scale&gt;` argument of `guides()` cannot be `FALSE`. Use "none" instead as</span></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co">#&gt; of ggplot2 3.3.4.</span></span>
<span id="cb9-23"><a href="#cb9-23"></a> </span>
<span id="cb9-24"><a href="#cb9-24"></a>base <span class="sc">+</span> </span>
<span id="cb9-25"><a href="#cb9-25"></a>    <span class="fu">annotation_custom</span>(<span class="at">grob =</span> g, <span class="at">xmin =</span> <span class="dv">6</span>, <span class="at">xmax =</span> <span class="dv">8</span>, <span class="at">ymin =</span> <span class="dv">4</span>, <span class="at">ymax =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="working_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="annotation_logticks" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="annotation_logticks"><span class="header-section-number">2.5.2</span> annotation_logticks</h3>
<p>これではないけどマイナーグリッドにチックを入れる方法として annotateにgeom = “segment”を使う<a href="https://github.com/janeshdev/r-dataanalysis-tips/wiki/Add-minor-ticks-to-ggplot2">方法</a>が考えだされていたけど， 正直しんどい気がする．．．．</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-11_16af8205663cbc38f2797fda235df52e">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt)) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2"></a> <span class="fu">geom_point</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3"></a> <span class="fu">scale_x_log10</span>(</span>
<span id="cb10-4"><a href="#cb10-4"></a>   <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">trans_breaks</span>(<span class="st">"log10"</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="sc">^</span>x),</span>
<span id="cb10-5"><a href="#cb10-5"></a>   <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">trans_format</span>(<span class="st">"log10"</span>, scales<span class="sc">::</span><span class="fu">math_format</span>(<span class="dv">10</span><span class="sc">^</span>.x))</span>
<span id="cb10-6"><a href="#cb10-6"></a> ) <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a> <span class="fu">scale_y_log10</span>(</span>
<span id="cb10-8"><a href="#cb10-8"></a>   <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">trans_breaks</span>(<span class="st">"log10"</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="sc">^</span>x),</span>
<span id="cb10-9"><a href="#cb10-9"></a>   <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">trans_format</span>(<span class="st">"log10"</span>, scales<span class="sc">::</span><span class="fu">math_format</span>(<span class="dv">10</span><span class="sc">^</span>.x))</span>
<span id="cb10-10"><a href="#cb10-10"></a> ) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11"></a> <span class="fu">theme_bw</span>()</span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb10-14"><a href="#cb10-14"></a>    a <span class="sc">+</span> <span class="fu">annotation_logticks</span>(),               <span class="co"># Default: log ticks on bottom and left</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>    a <span class="sc">+</span> <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">"lr"</span>),   <span class="co"># Log ticks for y, on left and right</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    a <span class="sc">+</span> <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">"trbl"</span>)  <span class="co"># All four sides</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="working_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="annotation_map" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="annotation_map"><span class="header-section-number">2.5.3</span> annotation_map</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-12_3fa5ce0e82b213a14175d4ee7a30db88">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="cf">if</span> (<span class="fu">require</span>(<span class="st">"maps"</span>)) {</span>
<span id="cb11-2"><a href="#cb11-2"></a>usamap <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>seal.sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(seals, long <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">130</span> <span class="sc">&amp;</span> lat <span class="sc">&lt;</span> <span class="dv">45</span> <span class="sc">&amp;</span> lat <span class="sc">&gt;</span> <span class="dv">40</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="fu">ggplot</span>(seal.sub, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="fu">annotation_map</span>(usamap, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> long <span class="sc">+</span> delta_long, <span class="at">yend =</span> lat <span class="sc">+</span> delta_lat))</span>
<span id="cb11-8"><a href="#cb11-8"></a>}</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="co">#&gt; Loading required package: maps</span></span>
<span id="cb11-10"><a href="#cb11-10"></a><span class="co">#&gt; </span></span>
<span id="cb11-11"><a href="#cb11-11"></a><span class="co">#&gt; Attaching package: 'maps'</span></span>
<span id="cb11-12"><a href="#cb11-12"></a><span class="co">#&gt; The following object is masked from 'package:purrr':</span></span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="co">#&gt; </span></span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="co">#&gt;     map</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="working_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-13_f430a9e208537e3c5792cb60189ac46f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="cf">if</span> (<span class="fu">require</span>(<span class="st">"maps"</span>)) {</span>
<span id="cb12-2"><a href="#cb12-2"></a>seal2 <span class="ot">&lt;-</span> <span class="fu">transform</span>(seal.sub,</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="at">latr =</span> <span class="fu">cut</span>(lat, <span class="dv">2</span>),</span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="at">longr =</span> <span class="fu">cut</span>(long, <span class="dv">2</span>))</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a><span class="fu">ggplot</span>(seal2,  <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">annotation_map</span>(usamap, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> long <span class="sc">+</span> delta_long, <span class="at">yend =</span> lat <span class="sc">+</span> delta_lat)) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">facet_grid</span>(latr <span class="sc">~</span> longr, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="working_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="annotation_raster" class="level3" data-number="2.5.4">
<h3 data-number="2.5.4" class="anchored" data-anchor-id="annotation_raster"><span class="header-section-number">2.5.4</span> annotation_raster</h3>
<p>画像を読み込めば画像も行ける？ 16進数の色に変換しておけば良いのか?</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-14_4645e3f13e1bd07a23e1701dbd9af24e">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Generate data</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>rainbow <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">hcl</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">360</span>, <span class="at">length.out =</span> <span class="dv">50</span> <span class="sc">*</span> <span class="dv">50</span>), <span class="dv">80</span>, <span class="dv">70</span>), <span class="at">nrow =</span> <span class="dv">50</span>)</span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">annotation_raster</span>(rainbow, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="working_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-15_712001300fd43aed040ae3a923b57539">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># To fill up whole plot</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">annotation_raster</span>(rainbow, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="working_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-16_c10c3d3fd24dd16e99a4fea09ff2eb98">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>rainbow2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">hcl</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">360</span>, <span class="at">length.out =</span> <span class="dv">10</span>), <span class="dv">80</span>, <span class="dv">70</span>), <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">annotation_raster</span>(rainbow2, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="working_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-17_d58eb8232687a1e485433421470e43cd">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">library</span>(png)</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">library</span>(grid)</span>
<span id="cb16-3"><a href="#cb16-3"></a>img <span class="ot">&lt;-</span> <span class="fu">readPNG</span>(<span class="fu">system.file</span>(<span class="st">"img"</span>, <span class="st">"Rlogo.png"</span>, <span class="at">package =</span> <span class="st">"png"</span>))</span>
<span id="cb16-4"><a href="#cb16-4"></a>g   <span class="ot">&lt;-</span> <span class="fu">rasterGrob</span>(img, <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="fu">qplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">geom =</span> <span class="st">"blank"</span>) <span class="sc">+</span> </span>
<span id="cb16-6"><a href="#cb16-6"></a>    <span class="fu">annotation_custom</span>(g, <span class="at">xmin =</span> <span class="dv">1</span>, <span class="at">xmax =</span> <span class="dv">5</span>, <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb16-7"><a href="#cb16-7"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="co">#&gt; Warning: `qplot()` was deprecated in ggplot2 3.4.0.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="working_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="凡例のハンドリング" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="凡例のハンドリング"><span class="header-section-number">2.6</span> 凡例のハンドリング</h2>
<p>凡例の操作は難しい… とりあえず、次を操作できるようになりたい.</p>
<ul>
<li>凡例の出し入れ</li>
<li>凡例の位置(panelの中か外か)</li>
<li>凡例のタイトル</li>
<li>凡例のキーの操作</li>
<li>凡例の文字列</li>
</ul>
<p>まずは複数の凡例の順序と凡例自体の位置を制御する例. <code>theme</code>で見た目を整える事もできるけど, <code>guides(guide_legend)</code>でも 大概見た目を加工することができる. 以下の例では 標準的な出力に加えて、凡例を色々と操作してみた状態のプロット。</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-18_3284a0698c35118b090fbfd0b4df60cc">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, cty)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> hwy, <span class="at">colour =</span> cyl, <span class="at">shape =</span> drv)) <span class="sc">+</span> </span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb17-7"><a href="#cb17-7"></a>  base, </span>
<span id="cb17-8"><a href="#cb17-8"></a>  base <span class="sc">+</span> <span class="fu">guides</span>(</span>
<span id="cb17-9"><a href="#cb17-9"></a>   <span class="at">colour =</span> <span class="fu">guide_colourbar</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">draw.llim =</span> <span class="cn">FALSE</span>),</span>
<span id="cb17-10"><a href="#cb17-10"></a>   <span class="at">shape  =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>),</span>
<span id="cb17-11"><a href="#cb17-11"></a>   <span class="at">size   =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb17-12"><a href="#cb17-12"></a>     <span class="at">order =</span> <span class="dv">3</span>, </span>
<span id="cb17-13"><a href="#cb17-13"></a>     <span class="at">title =</span> <span class="st">"MyWay"</span>, </span>
<span id="cb17-14"><a href="#cb17-14"></a>     <span class="at">keywidth =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"cm"</span>),</span>
<span id="cb17-15"><a href="#cb17-15"></a>     <span class="at">reverse =</span> <span class="dv">1</span>, </span>
<span id="cb17-16"><a href="#cb17-16"></a>     <span class="at">title.position =</span> <span class="st">"top"</span>, <span class="co"># or bottom, left, right</span></span>
<span id="cb17-17"><a href="#cb17-17"></a>     <span class="at">title.theme =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">face =</span> <span class="st">"italic"</span>), </span>
<span id="cb17-18"><a href="#cb17-18"></a>     <span class="at">title.hjust =</span> <span class="dv">1</span>, </span>
<span id="cb17-19"><a href="#cb17-19"></a>     <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb17-20"><a href="#cb17-20"></a>     <span class="at">direction =</span> <span class="st">"vertical"</span></span>
<span id="cb17-21"><a href="#cb17-21"></a>    )</span>
<span id="cb17-22"><a href="#cb17-22"></a> ), </span>
<span id="cb17-23"><a href="#cb17-23"></a> <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb17-24"><a href="#cb17-24"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="working_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>カラーバーなどでの操作を細かく行うための使い方。 guidesとかlegendとかではないけど、一応凡例が操作されているといいうことで. これってスゴい便利なのでは？ 例えば普通の連続値の場合には<code>scale_fill_continuous</code>を使う.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-19_b3cfd8263efd59aae742d3240a9d5130">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">X2 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a>df<span class="sc">$</span>value <span class="ot">&lt;-</span> df<span class="sc">$</span>X1 <span class="sc">*</span> df<span class="sc">$</span>X2</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(X1, X2)) <span class="sc">+</span> <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">coord_equal</span>()</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="co"># Coloursteps guide is the default for binned colour scales</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb18-8"><a href="#cb18-8"></a>  p , </span>
<span id="cb18-9"><a href="#cb18-9"></a>  p <span class="sc">+</span> </span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb18-12"><a href="#cb18-12"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(), </span>
<span id="cb18-13"><a href="#cb18-13"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>)), </span>
<span id="cb18-14"><a href="#cb18-14"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>), <span class="at">guide =</span> <span class="fu">guide_coloursteps</span>(<span class="at">even.steps =</span> <span class="cn">FALSE</span>)), </span>
<span id="cb18-15"><a href="#cb18-15"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(<span class="at">show.limits =</span> <span class="cn">TRUE</span>),</span>
<span id="cb18-16"><a href="#cb18-16"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb18-17"><a href="#cb18-17"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-19-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="working_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>凡例をpanelの中に記述する場合の書き方は次の通り.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-20_180d8707d1987bca2be794f4fa9767d7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">z =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>))</span>
<span id="cb19-2"><a href="#cb19-2"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb19-3"><a href="#cb19-3"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> z), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb19-8"><a href="#cb19-8"></a>  base, </span>
<span id="cb19-9"><a href="#cb19-9"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb19-10"><a href="#cb19-10"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),       <span class="co"># アンカーの相対座標</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), <span class="co"># アンカーの相対座標と紐付ける凡例の相対座標</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb19-13"><a href="#cb19-13"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), </span>
<span id="cb19-14"><a href="#cb19-14"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>)),</span>
<span id="cb19-15"><a href="#cb19-15"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb19-16"><a href="#cb19-16"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), </span>
<span id="cb19-17"><a href="#cb19-17"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), </span>
<span id="cb19-18"><a href="#cb19-18"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb19-19"><a href="#cb19-19"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb19-20"><a href="#cb19-20"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb19-21"><a href="#cb19-21"></a>  ), </span>
<span id="cb19-22"><a href="#cb19-22"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb19-23"><a href="#cb19-23"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="working_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>マニュアルで凡例を作成する. <a href="https://community.rstudio.com/t/adding-manual-legend-to-ggplot2/41651">ここ</a>を参考にした. これはしっくりするやり方だと思う.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-21_f87cb7f649d4fd9394930b05800d69ba">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a></span>
<span id="cb20-2"><a href="#cb20-2"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sepal Width"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Petal Length"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Petal Width"</span> <span class="ot">=</span> <span class="st">"orange"</span>)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Sepal.Width, <span class="at">color =</span> <span class="st">"Sepal Width"</span>), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Petal.Length, <span class="at">color =</span> <span class="st">"Petal Length"</span>), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Petal.Width, <span class="at">color =</span> <span class="st">"Petal Width"</span>), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb20-9"><a href="#cb20-9"></a>         <span class="at">y =</span> <span class="st">"(%)"</span>,</span>
<span id="cb20-10"><a href="#cb20-10"></a>         <span class="at">color =</span> <span class="st">"Legend"</span>) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-21-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="working_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>凡例を消したい場合の対処方法. <a href="https://www.datanovia.com/en/blog/how-to-remove-legend-from-a-ggplot/">ここ</a>を参考にしている.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-22_fe2be8ac7de3dd45fa9729c7963735f9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># レイヤー単位で指定</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> len))<span class="sc">+</span> </span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> dose), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">scale_fill_viridis_d</span>()</span>
<span id="cb21-6"><a href="#cb21-6"></a>p</span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co">#&gt; Warning: Continuous x aesthetic</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="co">#&gt; ℹ did you forget `aes(group = ...)`?</span></span>
<span id="cb21-9"><a href="#cb21-9"></a><span class="co">#&gt; Warning: The following aesthetics were dropped during statistical transformation: fill</span></span>
<span id="cb21-10"><a href="#cb21-10"></a><span class="co">#&gt; ℹ This can happen when ggplot fails to infer the correct grouping structure in</span></span>
<span id="cb21-11"><a href="#cb21-11"></a><span class="co">#&gt;   the data.</span></span>
<span id="cb21-12"><a href="#cb21-12"></a><span class="co">#&gt; ℹ Did you forget to specify a `group` aesthetic or to convert a numerical</span></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co">#&gt;   variable into a factor?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-22-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="working_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-23_50727289dd510c515edef2fb086fb564">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># グラフを作成してから指定</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="co">#&gt; Warning: Continuous x aesthetic</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="co">#&gt; ℹ did you forget `aes(group = ...)`?</span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co">#&gt; Warning: The following aesthetics were dropped during statistical transformation: fill</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co">#&gt; ℹ This can happen when ggplot fails to infer the correct grouping structure in</span></span>
<span id="cb22-7"><a href="#cb22-7"></a><span class="co">#&gt;   the data.</span></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co">#&gt; ℹ Did you forget to specify a `group` aesthetic or to convert a numerical</span></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="co">#&gt;   variable into a factor?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-23-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="working_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-24_fc7b649898a7a179b744c424e29844ee">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># 特定の軸に対して処理をしたい場合の指定</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>mtcars<span class="sc">$</span>cyl<span class="ot">&lt;-</span><span class="fu">as.factor</span>(mtcars<span class="sc">$</span>cyl)</span>
<span id="cb23-3"><a href="#cb23-3"></a>mtcars<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>gear)</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co"># Scatter plot</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> mtcars, <span class="fu">aes</span>(<span class="at">x =</span> mpg, <span class="at">y =</span> wt))<span class="sc">+</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> cyl, <span class="at">size =</span> qsec, <span class="at">shape =</span> gear)) <span class="sc">+</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>  <span class="fu">scale_color_viridis_d</span>()</span>
<span id="cb23-9"><a href="#cb23-9"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="working_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-25_78efc038730fe2d277ea22cddb405bf7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>p2 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="working_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<section id="文字や位置を微調整したい" class="level3" data-number="2.6.1">
<h3 data-number="2.6.1" class="anchored" data-anchor-id="文字や位置を微調整したい"><span class="header-section-number">2.6.1</span> 文字や位置を微調整したい</h3>
<p><a href="https://stackoverflow.com/questions/11366964/is-there-a-way-to-change-the-spacing-between-legend-items-in-ggplot2">stackoverflow</a>が参考になる.</p>
<p>水平方向に調整する.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-26_5a6011d1510f85115b796acd5b647e0f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb25-2"><a href="#cb25-2"></a></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="fu">factor</span>(cyl), <span class="at">fill =</span> <span class="fu">factor</span>(cyl))) <span class="sc">+</span> </span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb25-5"><a href="#cb25-5"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb25-6"><a href="#cb25-6"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"Cyl"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'top'</span>, </span>
<span id="cb25-9"><a href="#cb25-9"></a>        <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">1.0</span>, <span class="st">'cm'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="working_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>鉛直方向に調整する.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-27_d516fbdcab1d52f993efb22ae0fb32cc">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(cyl), <span class="at">fill =</span> <span class="fu">factor</span>(cyl))) <span class="sc">+</span> </span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="fu">theme</span>(<span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">1.0</span>, <span class="st">'cm'</span>))  <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="do">## important additional element</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="working_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>カラーバーなどは個別に微調整するみたい. バーの長さも自分で調整ができる見たい.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-28_96ef69783d56c878059a4af38f461168">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> hp), <span class="at">pch =</span> <span class="fu">I</span>(<span class="dv">21</span>), <span class="at">size =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'top'</span>, </span>
<span id="cb27-6"><a href="#cb27-6"></a>        <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">'cm'</span>),</span>
<span id="cb27-7"><a href="#cb27-7"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title =</span> <span class="st">"HP"</span>,</span>
<span id="cb27-9"><a href="#cb27-9"></a>                               <span class="at">label.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb27-10"><a href="#cb27-10"></a>                               <span class="at">title.position =</span> <span class="st">"left"</span>, <span class="at">title.vjust =</span> <span class="dv">1</span>,</span>
<span id="cb27-11"><a href="#cb27-11"></a>                               <span class="co"># draw border around the legend</span></span>
<span id="cb27-12"><a href="#cb27-12"></a>                               <span class="at">frame.colour =</span> <span class="st">"black"</span>,</span>
<span id="cb27-13"><a href="#cb27-13"></a>                               <span class="at">barwidth =</span> <span class="dv">25</span>,</span>
<span id="cb27-14"><a href="#cb27-14"></a>                               <span class="at">barheight =</span> <span class="dv">2</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="working_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-29_16f9aa5c5a6e20f0dad00c86979c0b0a">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">ggplot</span>(mtcars) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>  <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">fill =</span> <span class="fu">factor</span>(cyl)) <span class="sc">+</span></span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"Cyl"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb28-5"><a href="#cb28-5"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-29-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-26"><img src="working_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-30_7d55618dad02c5742d7abad889b4438f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>draw_key_polygon3 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, params, size) {</span>
<span id="cb29-2"><a href="#cb29-2"></a>  lwd <span class="ot">&lt;-</span> <span class="fu">min</span>(data<span class="sc">$</span>size, <span class="fu">min</span>(size) <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a>  </span>
<span id="cb29-4"><a href="#cb29-4"></a>  grid<span class="sc">::</span><span class="fu">rectGrob</span>(</span>
<span id="cb29-5"><a href="#cb29-5"></a>    <span class="at">width =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">"npc"</span>),</span>
<span id="cb29-6"><a href="#cb29-6"></a>    <span class="at">height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">"npc"</span>),</span>
<span id="cb29-7"><a href="#cb29-7"></a>    <span class="at">gp =</span> grid<span class="sc">::</span><span class="fu">gpar</span>(</span>
<span id="cb29-8"><a href="#cb29-8"></a>      <span class="at">col =</span> data<span class="sc">$</span>colour,</span>
<span id="cb29-9"><a href="#cb29-9"></a>      <span class="at">fill =</span> <span class="fu">alpha</span>(data<span class="sc">$</span>fill, data<span class="sc">$</span>alpha),</span>
<span id="cb29-10"><a href="#cb29-10"></a>      <span class="at">lty =</span> data<span class="sc">$</span>linetype,</span>
<span id="cb29-11"><a href="#cb29-11"></a>      <span class="at">lwd =</span> lwd <span class="sc">*</span> .pt,</span>
<span id="cb29-12"><a href="#cb29-12"></a>      <span class="at">linejoin =</span> <span class="st">"mitre"</span></span>
<span id="cb29-13"><a href="#cb29-13"></a>    ))</span>
<span id="cb29-14"><a href="#cb29-14"></a>}</span>
<span id="cb29-15"><a href="#cb29-15"></a></span>
<span id="cb29-16"><a href="#cb29-16"></a><span class="do">### this step is not needed anymore per tjebo's comment below</span></span>
<span id="cb29-17"><a href="#cb29-17"></a><span class="do">### see also: https://ggplot2.tidyverse.org/reference/draw_key.html</span></span>
<span id="cb29-18"><a href="#cb29-18"></a><span class="co"># register new key drawing function, </span></span>
<span id="cb29-19"><a href="#cb29-19"></a><span class="co"># the effect is global &amp; persistent throughout the R session</span></span>
<span id="cb29-20"><a href="#cb29-20"></a><span class="co"># GeomBar$draw_key = draw_key_polygon3</span></span>
<span id="cb29-21"><a href="#cb29-21"></a></span>
<span id="cb29-22"><a href="#cb29-22"></a><span class="fu">ggplot</span>(mtcars) <span class="sc">+</span></span>
<span id="cb29-23"><a href="#cb29-23"></a>  <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">fill =</span> <span class="fu">factor</span>(cyl)) <span class="sc">+</span></span>
<span id="cb29-24"><a href="#cb29-24"></a>  <span class="fu">geom_bar</span>(<span class="at">key_glyph =</span> <span class="st">"polygon3"</span>) <span class="sc">+</span></span>
<span id="cb29-25"><a href="#cb29-25"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"Cyl"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb29-26"><a href="#cb29-26"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb29-27"><a href="#cb29-27"></a>  <span class="fu">theme</span>(<span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb29-28"><a href="#cb29-28"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span></span>
<span id="cb29-29"><a href="#cb29-29"></a>  <span class="fu">theme</span>(<span class="at">legend.title.align =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-30-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-27"><img src="working_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="テキスト" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="テキスト"><span class="header-section-number">2.7</span> テキスト</h2>
<section id="hjustvjusts" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="hjustvjusts"><span class="header-section-number">2.7.1</span> hjust/vjusts</h3>
<p>凡例の位置設定と同じ考え方が，どうやらテキストも同様の考え方で対応でてきる気がする. これをみると、ラベルの左下が(0, 0)で、右上が(1, 1)となっている. ラベルの右端を点xに合わせたい場合には、hjust=1に調整するなど下のものを 参考としてもらいたい.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-31_e9ab6f913ce988a699ff67ec58b35eed">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a></span>
<span id="cb30-2"><a href="#cb30-2"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">3</span>), </span>
<span id="cb30-4"><a href="#cb30-4"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="at">each =</span> <span class="dv">3</span>), </span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="at">hjust =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">3</span>), </span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="at">vjust =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb30-7"><a href="#cb30-7"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-9"><a href="#cb30-9"></a>    <span class="at">t =</span> <span class="fu">sprintf</span>(<span class="st">"h:%s</span><span class="sc">\n</span><span class="st">v:%s"</span>, hjust, vjust)</span>
<span id="cb30-10"><a href="#cb30-10"></a>  )</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a>g <span class="ot">&lt;-</span> </span>
<span id="cb30-13"><a href="#cb30-13"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">label =</span> t)) <span class="sc">+</span> </span>
<span id="cb30-15"><a href="#cb30-15"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb30-16"><a href="#cb30-16"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb30-17"><a href="#cb30-17"></a></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="fu">plot</span>(</span>
<span id="cb30-19"><a href="#cb30-19"></a>  g <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">hjust =</span> hjust, <span class="at">vjust =</span> vjust)) <span class="sc">+</span> </span>
<span id="cb30-21"><a href="#cb30-21"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"gold"</span>, <span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb30-22"><a href="#cb30-22"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-31-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-28"><img src="working_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="position" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="position"><span class="header-section-number">2.7.2</span> position</h3>
<p>position系の関数を使うと気の利いた調整が行える.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-32_7d8b92a8f0a5c437fa5bb3da0f7664eb">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="at">x =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="at">grp =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb31-5"><a href="#cb31-5"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-33_1f86f9879b9ac1d550bd55e32e628ed5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(x, y, <span class="at">group =</span> grp)) <span class="sc">+</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> grp), <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="co"># x軸の中心からそれぞれどれだけ離すか</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> y), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-33-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-29"><img src="working_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-34_835bebe79780ad2cc39d7675b3063318">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># Use you can't nudge and dodge text, so instead adjust the y position</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(x, y, <span class="at">group =</span> grp)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> grp), <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb33-5"><a href="#cb33-5"></a>    <span class="fu">aes</span>(<span class="at">label =</span> y, <span class="at">y =</span> y <span class="sc">+</span> <span class="fl">0.05</span>),</span>
<span id="cb33-6"><a href="#cb33-6"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>),</span>
<span id="cb33-7"><a href="#cb33-7"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-34-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-30"><img src="working_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-35_ae3702ad898f2c2bdf32a96adbbf178d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># To place text in the middle of each bar in a stacked barplot, you</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="co"># need to set the vjust parameter of position_stack()</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(x, y, <span class="at">group =</span> grp)) <span class="sc">+</span></span>
<span id="cb34-4"><a href="#cb34-4"></a> <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> grp)) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5"></a> <span class="co"># スタックされているところは，つまり，境界のところ</span></span>
<span id="cb34-6"><a href="#cb34-6"></a> <span class="co"># この場合のvjustはスタックされているところで調整してくれている(文字の大きさでない)</span></span>
<span id="cb34-7"><a href="#cb34-7"></a> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> y), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-35-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-31"><img src="working_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="facet_grid" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="facet_grid"><span class="header-section-number">2.8</span> facet_grid</h2>
<p>基本的な使い方はいいが，ここではストリップラベルをずらす例を紹介．</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-36_f5d1a7d8961b292e9406cf6a92252c6b">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">tibble</span>(</span>
<span id="cb35-3"><a href="#cb35-3"></a>    <span class="at">rows =</span> <span class="fu">sprintf</span>(<span class="st">"row_%d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), </span>
<span id="cb35-4"><a href="#cb35-4"></a>    <span class="at">cols =</span> <span class="fu">sprintf</span>(<span class="st">"col_%d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb35-5"><a href="#cb35-5"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(rows, cols) <span class="sc">%&gt;%</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>  <span class="fu">mutate</span>(</span>
<span id="cb35-9"><a href="#cb35-9"></a>    <span class="at">data =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)))</span>
<span id="cb35-10"><a href="#cb35-10"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">unnest</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-37_ca44822faf0ff7e691f76ebcca5e67b3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(x, y), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">coord_equal</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)) <span class="sc">+</span> </span>
<span id="cb36-5"><a href="#cb36-5"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span> </span>
<span id="cb36-6"><a href="#cb36-6"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb36-7"><a href="#cb36-7"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(rows), </span>
<span id="cb36-8"><a href="#cb36-8"></a>    <span class="at">cols =</span> <span class="fu">vars</span>(cols), </span>
<span id="cb36-9"><a href="#cb36-9"></a>    <span class="at">switch =</span> <span class="st">"y"</span> <span class="co"># 行のラベルを左に置く</span></span>
<span id="cb36-10"><a href="#cb36-10"></a>  ) <span class="sc">+</span> </span>
<span id="cb36-11"><a href="#cb36-11"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position =</span> <span class="st">"right"</span>) <span class="sc">+</span> </span>
<span id="cb36-12"><a href="#cb36-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb36-13"><a href="#cb36-13"></a>    <span class="co"># RStudioの予測にも出てこないけど，</span></span>
<span id="cb36-14"><a href="#cb36-14"></a>    <span class="co"># leftにおいたyのstripにアングルを与えるには次を使うこと</span></span>
<span id="cb36-15"><a href="#cb36-15"></a>    <span class="at">strip.text.y.left =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb36-16"><a href="#cb36-16"></a>  ) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-37-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-32"><img src="working_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="summary_stat" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="summary_stat"><span class="header-section-number">2.9</span> summary_stat</h2>
<p>geom関数とstat関数は一緒の関係であるが, stat_summaryにより関数を適用してプロットを行うことが可能となる. 正直使いにくいイメージがあるので，個人的には 事前に集計したレイヤーを重ねるという方法を常に選択しがちである．</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-38_1e2fe24ccba1fa73cf743d98ba3fbbc1">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb37-3"><a href="#cb37-3"></a>    <span class="at">data =</span> <span class="fu">filter</span>(penguins, <span class="fu">complete.cases</span>(penguins)), </span>
<span id="cb37-4"><a href="#cb37-4"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb37-5"><a href="#cb37-5"></a>      <span class="at">x =</span> species,</span>
<span id="cb37-6"><a href="#cb37-6"></a>      <span class="at">y =</span> bill_length_mm</span>
<span id="cb37-7"><a href="#cb37-7"></a>    )</span>
<span id="cb37-8"><a href="#cb37-8"></a>  ) <span class="sc">+</span> </span>
<span id="cb37-9"><a href="#cb37-9"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb37-10"><a href="#cb37-10"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-11"><a href="#cb37-11"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb37-12"><a href="#cb37-12"></a>  )</span>
<span id="cb37-13"><a href="#cb37-13"></a></span>
<span id="cb37-14"><a href="#cb37-14"></a>p <span class="sc">+</span> </span>
<span id="cb37-15"><a href="#cb37-15"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb37-16"><a href="#cb37-16"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb37-17"><a href="#cb37-17"></a><span class="co">#&gt; Warning: Removed 3 rows containing missing values (`geom_segment()`).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-38-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-33"><img src="working_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="マルチレベルのwrap" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="マルチレベルのwrap"><span class="header-section-number">2.10</span> マルチレベルのwrap</h2>
<p>自然言語処理でドキュメントごとに単語頻度上位N件の 度数をバープロットで描画するときなど， ドキュメントでfacetしてその中でwordを並び変えてプロットしたいときがある．</p>
<p>このとき，何も考えずに行うと期待したプロットが作成できない． これに対処するには，並び換えを全体で行えるようにkeyを調整した上で， プロットする際にキーラベル名を調整するという処理が必要である.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-39_39f529ea8f48e1f5e6eab43ded5b0da7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">tibble</span>(</span>
<span id="cb38-3"><a href="#cb38-3"></a>    <span class="at">key   =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>), </span>
<span id="cb38-4"><a href="#cb38-4"></a>    <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), </span>
<span id="cb38-5"><a href="#cb38-5"></a>    <span class="at">term  =</span> <span class="fu">c</span>(<span class="st">"w1"</span>, <span class="st">"w2"</span>, <span class="st">"w1"</span>, <span class="st">"w2"</span>)</span>
<span id="cb38-6"><a href="#cb38-6"></a>  )</span>
<span id="cb38-7"><a href="#cb38-7"></a></span>
<span id="cb38-8"><a href="#cb38-8"></a><span class="co"># 並び変えてプロットしても</span></span>
<span id="cb38-9"><a href="#cb38-9"></a><span class="co"># グラフは同じ順番になってしまう</span></span>
<span id="cb38-10"><a href="#cb38-10"></a><span class="co"># これをfacetごとに降順に並び変えたい</span></span>
<span id="cb38-11"><a href="#cb38-11"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb38-12"><a href="#cb38-12"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb38-13"><a href="#cb38-13"></a>  <span class="fu">arrange</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb38-14"><a href="#cb38-14"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-15"><a href="#cb38-15"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(term, value), value)) <span class="sc">+</span> </span>
<span id="cb38-16"><a href="#cb38-16"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb38-17"><a href="#cb38-17"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(key), <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-39-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-34"><img src="working_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>一応このようにやれば対応が可能である.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-40_69c866cdb58f0cf1d27592e4a4fd3e32">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">mutate</span>(<span class="at">new_key =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(term, key, <span class="at">sep =</span> <span class="st">"___"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">arrange</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(new_key, value), value)) <span class="sc">+</span> </span>
<span id="cb39-5"><a href="#cb39-5"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb39-6"><a href="#cb39-6"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(key), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb39-7"><a href="#cb39-7"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">label =</span> <span class="cf">function</span>(x) <span class="fu">sub</span>(<span class="st">"___.+$"</span>, <span class="st">""</span>, x), <span class="at">drop =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-40-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-35"><img src="working_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="trans" class="level2" data-number="2.11">
<h2 data-number="2.11" class="anchored" data-anchor-id="trans"><span class="header-section-number">2.11</span> trans</h2>
<p>trans系やscale系の関数を使うことで，データをggplot内で変換することが可能となるはず． たとえば<code>scale_x_log</code>などがそれに該当する.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-41_73e2c28f2b3a7974adb48b1f7e61d001">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="fu">tibble</span>(</span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb40-6"><a href="#cb40-6"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb40-7"><a href="#cb40-7"></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-41-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-36"><img src="working_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>同じことを違う遣り方で実行してみる.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-42_62ec4bd404655bcd8579f31c3d15b6b3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="fu">tibble</span>(</span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb41-4"><a href="#cb41-4"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-5"><a href="#cb41-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb41-6"><a href="#cb41-6"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb41-7"><a href="#cb41-7"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">"log10"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-42-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-37"><img src="working_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>さらに別のやり方を試す.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-43_ecd75e7c811cdcf04ed54a0f29b1291d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">tibble</span>(</span>
<span id="cb42-2"><a href="#cb42-2"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb42-4"><a href="#cb42-4"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="#cb42-5"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb42-6"><a href="#cb42-6"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb42-7"><a href="#cb42-7"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb42-8"><a href="#cb42-8"></a>    <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">trans_new</span>(<span class="st">"log10"</span>, log10, <span class="cf">function</span>(x) <span class="dv">10</span> <span class="sc">**</span> x), </span>
<span id="cb42-9"><a href="#cb42-9"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, .<span class="dv">5</span>), </span>
<span id="cb42-10"><a href="#cb42-10"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">10</span>)</span>
<span id="cb42-11"><a href="#cb42-11"></a>  ) <span class="sc">+</span> </span>
<span id="cb42-12"><a href="#cb42-12"></a>  <span class="fu">theme</span>(</span>
<span id="cb42-13"><a href="#cb42-13"></a>    <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="st">"mm"</span>)</span>
<span id="cb42-14"><a href="#cb42-14"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-43-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-38"><img src="working_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="グラフの順番に凡例の順番を合わす" class="level2" data-number="2.12">
<h2 data-number="2.12" class="anchored" data-anchor-id="グラフの順番に凡例の順番を合わす"><span class="header-section-number">2.12</span> グラフの順番に凡例の順番を合わす</h2>
<p><a href="https://www.nsgrantham.com/reorder-legend-ggplot2">参考文献</a></p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-44_0aa8c085c1f530aa3b9ccc3ab6ecd295">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># 1.3.0</span></span>
<span id="cb43-2"><a href="#cb43-2"></a></span>
<span id="cb43-3"><a href="#cb43-3"></a>usa_crop_yields <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-01/key_crop_yields.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">(tonnes per hectare</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, .)) <span class="sc">%&gt;%</span></span>
<span id="cb43-5"><a href="#cb43-5"></a>  <span class="fu">pivot_longer</span>(Wheat<span class="sc">:</span>Bananas, <span class="at">names_to =</span> <span class="st">"crop"</span>, <span class="at">values_to =</span> <span class="st">"yield"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6"></a>  <span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span></span>
<span id="cb43-7"><a href="#cb43-7"></a>  <span class="fu">filter</span>(entity <span class="sc">==</span> <span class="st">"United States"</span>, <span class="sc">!</span><span class="fu">is.na</span>(yield)) <span class="sc">%&gt;%</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>  <span class="fu">select</span>(year, crop, yield)</span>
<span id="cb43-9"><a href="#cb43-9"></a><span class="co">#&gt; Rows: 13075 Columns: 14</span></span>
<span id="cb43-10"><a href="#cb43-10"></a><span class="co">#&gt; ── Column specification ────────────────────────────────────────────────────────</span></span>
<span id="cb43-11"><a href="#cb43-11"></a><span class="co">#&gt; Delimiter: ","</span></span>
<span id="cb43-12"><a href="#cb43-12"></a><span class="co">#&gt; chr  (2): Entity, Code</span></span>
<span id="cb43-13"><a href="#cb43-13"></a><span class="co">#&gt; dbl (12): Year, Wheat (tonnes per hectare), Rice (tonnes per hectare), Maize...</span></span>
<span id="cb43-14"><a href="#cb43-14"></a><span class="co">#&gt; </span></span>
<span id="cb43-15"><a href="#cb43-15"></a><span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span></span>
<span id="cb43-16"><a href="#cb43-16"></a><span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span id="cb43-17"><a href="#cb43-17"></a></span>
<span id="cb43-18"><a href="#cb43-18"></a>usa_crop_yields</span>
<span id="cb43-19"><a href="#cb43-19"></a><span class="co">#&gt; # A tibble: 522 × 3</span></span>
<span id="cb43-20"><a href="#cb43-20"></a><span class="co">#&gt;     year crop     yield</span></span>
<span id="cb43-21"><a href="#cb43-21"></a><span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt;</span></span>
<span id="cb43-22"><a href="#cb43-22"></a><span class="co">#&gt;  1  1961 Wheat     1.61</span></span>
<span id="cb43-23"><a href="#cb43-23"></a><span class="co">#&gt;  2  1961 Rice      3.82</span></span>
<span id="cb43-24"><a href="#cb43-24"></a><span class="co">#&gt;  3  1961 Maize     3.92</span></span>
<span id="cb43-25"><a href="#cb43-25"></a><span class="co">#&gt;  4  1961 Soybeans  1.69</span></span>
<span id="cb43-26"><a href="#cb43-26"></a><span class="co">#&gt;  5  1961 Potatoes 22.2 </span></span>
<span id="cb43-27"><a href="#cb43-27"></a><span class="co">#&gt;  6  1961 Beans     1.54</span></span>
<span id="cb43-28"><a href="#cb43-28"></a><span class="co">#&gt;  7  1961 Peas      1.19</span></span>
<span id="cb43-29"><a href="#cb43-29"></a><span class="co">#&gt;  8  1961 Barley    1.65</span></span>
<span id="cb43-30"><a href="#cb43-30"></a><span class="co">#&gt;  9  1961 Bananas  10.5 </span></span>
<span id="cb43-31"><a href="#cb43-31"></a><span class="co">#&gt; 10  1962 Wheat     1.68</span></span>
<span id="cb43-32"><a href="#cb43-32"></a><span class="co">#&gt; # ℹ 512 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-45_d74b0c526039364ff5134bb85652b14d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>usa_crop_yields <span class="sc">%&gt;%</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>  <span class="fu">mutate</span>(<span class="at">crop =</span> <span class="fu">fct_reorder2</span>(crop, year, yield)) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, yield, <span class="at">color =</span> crop)) <span class="sc">+</span></span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-45-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-39"><img src="working_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="histgram" class="level2" data-number="2.13">
<h2 data-number="2.13" class="anchored" data-anchor-id="histgram"><span class="header-section-number">2.13</span> histgram</h2>
<p>ヒストグラムをきれいに書きたい.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-46_906d41e6e1c7ee67ffec0ac6dcf0ac6f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">runif</span>(<span class="dv">100</span>), <span class="at">b =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb45-2"><a href="#cb45-2"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> a)) <span class="sc">+</span> </span>
<span id="cb45-4"><a href="#cb45-4"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> b), <span class="at">center =</span> <span class="dv">0</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>), <span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">closed =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb45-6"><a href="#cb45-6"></a>    <span class="at">stat =</span> <span class="st">"bin"</span>,</span>
<span id="cb45-7"><a href="#cb45-7"></a>    <span class="co"># count, dnesity, ncount, ndensity</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>    <span class="fu">aes</span>(<span class="at">label =</span> ..count.., <span class="at">y =</span> ..count.., <span class="at">fill =</span> b),</span>
<span id="cb45-9"><a href="#cb45-9"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>),</span>
<span id="cb45-10"><a href="#cb45-10"></a>    <span class="at">closed =</span> <span class="st">"left"</span>,</span>
<span id="cb45-11"><a href="#cb45-11"></a>    <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>,</span>
<span id="cb45-12"><a href="#cb45-12"></a>    <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> .<span class="dv">5</span>)</span>
<span id="cb45-13"><a href="#cb45-13"></a>  ) <span class="sc">+</span> </span>
<span id="cb45-14"><a href="#cb45-14"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb45-15"><a href="#cb45-15"></a>    <span class="at">stat =</span> <span class="st">"bin"</span>, </span>
<span id="cb45-16"><a href="#cb45-16"></a>    <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">label =</span> <span class="fu">after_stat</span>(count), <span class="at">y =</span> <span class="fu">after_stat</span>(count)), </span>
<span id="cb45-17"><a href="#cb45-17"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>), </span>
<span id="cb45-18"><a href="#cb45-18"></a>    <span class="at">closed =</span> <span class="st">"left"</span>, </span>
<span id="cb45-19"><a href="#cb45-19"></a>    <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, </span>
<span id="cb45-20"><a href="#cb45-20"></a>    <span class="at">data =</span> data</span>
<span id="cb45-21"><a href="#cb45-21"></a>  ) <span class="sc">+</span></span>
<span id="cb45-22"><a href="#cb45-22"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>))</span>
<span id="cb45-23"><a href="#cb45-23"></a><span class="co">#&gt; Warning in geom_text(stat = "bin", aes(label = ..count.., y = ..count.., :</span></span>
<span id="cb45-24"><a href="#cb45-24"></a><span class="co">#&gt; Ignoring unknown aesthetics: fill</span></span>
<span id="cb45-25"><a href="#cb45-25"></a><span class="co">#&gt; Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb45-26"><a href="#cb45-26"></a><span class="co">#&gt; ℹ Please use `after_stat(count)` instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-46-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-40"><img src="working_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>左に閉じたときにどのような挙動になるのかを確認したい. [0, .1), [.1, .2), …., [.9, 1.]となっていることがわかる.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-47_ca98910c4f285a61d8210bfd7798fdda">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>, .<span class="dv">5</span>,  <span class="fl">1.</span>), <span class="dv">100</span>, <span class="cn">TRUE</span>), <span class="at">b =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb46-2"><a href="#cb46-2"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> a)) <span class="sc">+</span> </span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb46-5"><a href="#cb46-5"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> b), </span>
<span id="cb46-6"><a href="#cb46-6"></a>    <span class="at">center =</span> <span class="dv">0</span>,</span>
<span id="cb46-7"><a href="#cb46-7"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>), </span>
<span id="cb46-8"><a href="#cb46-8"></a>    <span class="at">color =</span> <span class="st">"lightgrey"</span>, </span>
<span id="cb46-9"><a href="#cb46-9"></a>    <span class="at">closed =</span> <span class="st">"left"</span></span>
<span id="cb46-10"><a href="#cb46-10"></a>  ) <span class="sc">+</span></span>
<span id="cb46-11"><a href="#cb46-11"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb46-12"><a href="#cb46-12"></a>    <span class="at">stat =</span> <span class="st">"bin"</span>,</span>
<span id="cb46-13"><a href="#cb46-13"></a>    <span class="fu">aes</span>(<span class="at">label =</span> ..count.., <span class="at">y =</span> ..count.., <span class="at">group =</span> b),</span>
<span id="cb46-14"><a href="#cb46-14"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>),</span>
<span id="cb46-15"><a href="#cb46-15"></a>    <span class="at">closed =</span> <span class="st">"left"</span>,</span>
<span id="cb46-16"><a href="#cb46-16"></a>    <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>,</span>
<span id="cb46-17"><a href="#cb46-17"></a>    <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> .<span class="dv">5</span>)</span>
<span id="cb46-18"><a href="#cb46-18"></a>  ) <span class="sc">+</span> </span>
<span id="cb46-19"><a href="#cb46-19"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-47-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-41"><img src="working_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="geom_smooth" class="level2" data-number="2.14">
<h2 data-number="2.14" class="anchored" data-anchor-id="geom_smooth"><span class="header-section-number">2.14</span> geom_smooth</h2>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-48_91793f01a631ad559799b6503da304dd">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb47-2"><a href="#cb47-2"></a>    <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">1</span>), </span>
<span id="cb47-3"><a href="#cb47-3"></a>    <span class="at">e =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb47-4"><a href="#cb47-4"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb47-5"><a href="#cb47-5"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> x <span class="sc">*</span> .<span class="dv">05</span> <span class="sc">+</span> e)</span>
<span id="cb47-6"><a href="#cb47-6"></a></span>
<span id="cb47-7"><a href="#cb47-7"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb47-8"><a href="#cb47-8"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb47-9"><a href="#cb47-9"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb47-10"><a href="#cb47-10"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="sc">~</span> . <span class="sc">|&gt;</span> <span class="fu">filter</span>(x <span class="sc">&lt;=</span> <span class="dv">50</span>), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb47-11"><a href="#cb47-11"></a>    <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="sc">~</span> . <span class="sc">|&gt;</span> <span class="fu">filter</span>(x <span class="sc">&gt;</span> <span class="dv">50</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb47-12"><a href="#cb47-12"></a><span class="co">#&gt; `geom_smooth()` using method = 'loess' and formula = 'y ~ x'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-48-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-42"><img src="working_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="extensions" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Extensions</h1>
<section id="ggmosaic" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="ggmosaic"><span class="header-section-number">3.1</span> ggmosaic</h2>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-49_275c97d1cd9fc590fabfe0f17e0abf67">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="fu">library</span>(ggmosaic)</span>
<span id="cb48-3"><a href="#cb48-3"></a><span class="co">#&gt; </span></span>
<span id="cb48-4"><a href="#cb48-4"></a><span class="co">#&gt; Attaching package: 'ggmosaic'</span></span>
<span id="cb48-5"><a href="#cb48-5"></a><span class="co">#&gt; The following object is masked from 'package:GGally':</span></span>
<span id="cb48-6"><a href="#cb48-6"></a><span class="co">#&gt; </span></span>
<span id="cb48-7"><a href="#cb48-7"></a><span class="co">#&gt;     happy</span></span>
<span id="cb48-8"><a href="#cb48-8"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb48-9"><a href="#cb48-9"></a></span>
<span id="cb48-10"><a href="#cb48-10"></a>cc <span class="ot">&lt;-</span> <span class="fu">count</span>(diamonds, cut, clarity)</span>
<span id="cb48-11"><a href="#cb48-11"></a></span>
<span id="cb48-12"><a href="#cb48-12"></a><span class="fu">ggplot</span>(cc) <span class="sc">+</span> </span>
<span id="cb48-13"><a href="#cb48-13"></a>    <span class="fu">geom_mosaic</span>(</span>
<span id="cb48-14"><a href="#cb48-14"></a>        <span class="fu">aes</span>(<span class="at">weight =</span> n, <span class="at">x =</span> <span class="fu">product</span>(cut), <span class="at">fill =</span> clarity)</span>
<span id="cb48-15"><a href="#cb48-15"></a>    )</span>
<span id="cb48-16"><a href="#cb48-16"></a><span class="co">#&gt; Warning: `unite_()` was deprecated in tidyr 1.2.0.</span></span>
<span id="cb48-17"><a href="#cb48-17"></a><span class="co">#&gt; ℹ Please use `unite()` instead.</span></span>
<span id="cb48-18"><a href="#cb48-18"></a><span class="co">#&gt; ℹ The deprecated feature was likely used in the ggmosaic package.</span></span>
<span id="cb48-19"><a href="#cb48-19"></a><span class="co">#&gt;   Please report the issue at &lt;https://github.com/haleyjeppson/ggmosaic&gt;.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-49-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-43"><img src="working_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggokabeito" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="ggokabeito"><span class="header-section-number">3.2</span> ggokabeito</h2>
<p>safecolorらしい．</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-50_0f0e6401799475ef6fa9edcc90f24c91">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb49-2"><a href="#cb49-2"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb49-3"><a href="#cb49-3"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb49-4"><a href="#cb49-4"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb49-5"><a href="#cb49-5"></a>    <span class="fu">scale_color_okabe_ito</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-50-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-44"><img src="working_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggprism" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="ggprism"><span class="header-section-number">3.3</span> ggprism</h2>
<p><a href="https://cran.r-project.org/web/packages/ggprism/vignettes/axes.html">マイナーチック</a> を打てるようです.</p>
<p>他にも色々軸の加工が可能なためいろいろとチェックしてみるのがいい．</p>
<section id="minor-ticks" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="minor-ticks"><span class="header-section-number">3.3.1</span> Minor ticks</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-51_1a6aeffcd4a72d9786a4f4b4a6051ca6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb50-2"><a href="#cb50-2"></a>  <span class="at">data =</span> ToothGrowth, </span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb50-4"><a href="#cb50-4"></a>    <span class="at">x =</span> <span class="fu">factor</span>(supp), </span>
<span id="cb50-5"><a href="#cb50-5"></a>    <span class="at">y =</span> len</span>
<span id="cb50-6"><a href="#cb50-6"></a>  )</span>
<span id="cb50-7"><a href="#cb50-7"></a>) <span class="sc">+</span> </span>
<span id="cb50-8"><a href="#cb50-8"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(supp))) <span class="sc">+</span> </span>
<span id="cb50-9"><a href="#cb50-9"></a>  <span class="fu">theme_prism</span>() <span class="sc">+</span> </span>
<span id="cb50-10"><a href="#cb50-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb50-11"><a href="#cb50-11"></a>p1 <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">guide =</span> <span class="fu">guide_prism_minor</span>())</span>
<span id="cb50-12"><a href="#cb50-12"></a>p2 <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">y =</span> <span class="fu">guide_prism_minor</span>())</span>
<span id="cb50-13"><a href="#cb50-13"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-51-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-45"><img src="working_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-52_58253efbb0eba81a1af2369eacb3a4d5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb51-2"><a href="#cb51-2"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb51-3"><a href="#cb51-3"></a>    <span class="at">data =</span> ToothGrowth, </span>
<span id="cb51-4"><a href="#cb51-4"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb51-5"><a href="#cb51-5"></a>      <span class="at">x =</span> <span class="fu">factor</span>(dose), </span>
<span id="cb51-6"><a href="#cb51-6"></a>      <span class="at">y =</span> len</span>
<span id="cb51-7"><a href="#cb51-7"></a>    )</span>
<span id="cb51-8"><a href="#cb51-8"></a>  ) <span class="sc">+</span> </span>
<span id="cb51-9"><a href="#cb51-9"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb51-10"><a href="#cb51-10"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(dose)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb51-11"><a href="#cb51-11"></a>    <span class="at">geom =</span> <span class="st">"col"</span>, <span class="at">fun =</span> mean, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> .<span class="dv">9</span></span>
<span id="cb51-12"><a href="#cb51-12"></a>  ) <span class="sc">+</span> </span>
<span id="cb51-13"><a href="#cb51-13"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb51-14"><a href="#cb51-14"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb51-15"><a href="#cb51-15"></a></span>
<span id="cb51-16"><a href="#cb51-16"></a></span>
<span id="cb51-17"><a href="#cb51-17"></a><span class="co"># 書きたかったグラフはこれや！！！！！</span></span>
<span id="cb51-18"><a href="#cb51-18"></a><span class="co"># これが土木学会のグラフや</span></span>
<span id="cb51-19"><a href="#cb51-19"></a>p <span class="sc">+</span> </span>
<span id="cb51-20"><a href="#cb51-20"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb51-21"><a href="#cb51-21"></a>    <span class="at">guide =</span> <span class="st">"prism_minor"</span>, </span>
<span id="cb51-22"><a href="#cb51-22"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>), </span>
<span id="cb51-23"><a href="#cb51-23"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb51-24"><a href="#cb51-24"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>)</span>
<span id="cb51-25"><a href="#cb51-25"></a>  ) <span class="sc">+</span> </span>
<span id="cb51-26"><a href="#cb51-26"></a>  <span class="fu">theme</span>(</span>
<span id="cb51-27"><a href="#cb51-27"></a>    <span class="at">axis.ticks.length.y =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"pt"</span>), </span>
<span id="cb51-28"><a href="#cb51-28"></a>    <span class="at">prism.ticks.length.y =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"pt"</span>)</span>
<span id="cb51-29"><a href="#cb51-29"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-52-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-46"><img src="working_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="brackets-axis" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="brackets-axis"><span class="header-section-number">3.3.2</span> Brackets axis</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-53_3d130f8da3d12a1c99c7fe9260722243">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(dose), <span class="at">y =</span> len)) <span class="sc">+</span> </span>
<span id="cb52-2"><a href="#cb52-2"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(dose)), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3"></a>  <span class="fu">scale_shape_prism</span>() <span class="sc">+</span> </span>
<span id="cb52-4"><a href="#cb52-4"></a>  <span class="fu">theme_prism</span>() <span class="sc">+</span> </span>
<span id="cb52-5"><a href="#cb52-5"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb52-6"><a href="#cb52-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40</span>), <span class="at">guide =</span> <span class="st">"prism_offset"</span>)</span>
<span id="cb52-7"><a href="#cb52-7"></a></span>
<span id="cb52-8"><a href="#cb52-8"></a>p2 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="st">"prism_bracket"</span>)</span>
<span id="cb52-9"><a href="#cb52-9"></a></span>
<span id="cb52-10"><a href="#cb52-10"></a>p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-53-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-47"><img src="working_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="border-with-minor-ticks" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="border-with-minor-ticks"><span class="header-section-number">3.3.3</span> Border with minor ticks</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-54_70f8a47c67659527ce505fdf7697ff6b">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb53-2"><a href="#cb53-2"></a>  <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> cty)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> class))</span>
<span id="cb53-4"><a href="#cb53-4"></a>base</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-54-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-48"><img src="working_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>annotation_ticksを使うをスゴく簡単にチックを打てる.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-55_0ed19f1ec9bb727e09a83c31b477f4ed">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>p <span class="ot">&lt;-</span> base <span class="sc">+</span> <span class="fu">theme_prism</span>(<span class="at">border =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span> </span>
<span id="cb54-4"><a href="#cb54-4"></a>  <span class="fu">guides</span>(</span>
<span id="cb54-5"><a href="#cb54-5"></a>    <span class="at">x =</span> <span class="st">"prism_minor"</span>, <span class="at">y =</span> <span class="st">"prism_minor"</span></span>
<span id="cb54-6"><a href="#cb54-6"></a>  )</span>
<span id="cb54-7"><a href="#cb54-7"></a>p_annot <span class="ot">&lt;-</span> </span>
<span id="cb54-8"><a href="#cb54-8"></a>  p <span class="sc">+</span> </span>
<span id="cb54-9"><a href="#cb54-9"></a>  <span class="fu">annotation_ticks</span>(</span>
<span id="cb54-10"><a href="#cb54-10"></a>    <span class="at">sides =</span> <span class="st">"tr"</span>, </span>
<span id="cb54-11"><a href="#cb54-11"></a>    <span class="at">type =</span> <span class="st">"both"</span>, </span>
<span id="cb54-12"><a href="#cb54-12"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb54-13"><a href="#cb54-13"></a>    <span class="at">outside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb54-14"><a href="#cb54-14"></a>    <span class="at">tick.length =</span> <span class="fu">unit</span>(<span class="dv">14</span><span class="sc">/</span><span class="dv">2</span>, <span class="st">"pt"</span>),</span>
<span id="cb54-15"><a href="#cb54-15"></a>    <span class="at">minor.length =</span> <span class="fu">unit</span>(<span class="dv">14</span><span class="sc">/</span><span class="dv">4</span>, <span class="st">"pt"</span>))</span>
<span id="cb54-16"><a href="#cb54-16"></a>p_annot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-55-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-49"><img src="working_files/figure-html/unnamed-chunk-55-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>離散値の場合にも出来るようでしたがあまりにも トリッキーにつき省略いたします.</p>
</section>
</section>
<section id="gghalves" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="gghalves"><span class="header-section-number">3.4</span> gghalves</h2>
<ul>
<li>(gghalves)[<a href="https://github.com/erocoar/gghalves" class="uri">https://github.com/erocoar/gghalves</a>]</li>
</ul>
<p>ggplo2によるハーフ＆ハーフのプロットの合成を容易にする。</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-56_5332d3d90208df15260bbef60623cddf">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="fu">library</span>(gghalves)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-57_83fe6dceef7dda4e313c0d47bd66a1e3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>iris <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Species, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb56-3"><a href="#cb56-3"></a>  <span class="fu">geom_half_point</span>() <span class="sc">+</span> </span>
<span id="cb56-4"><a href="#cb56-4"></a>  <span class="fu">geom_half_violin</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-57-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-50"><img src="working_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggally" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="ggally"><span class="header-section-number">3.5</span> ggally</h2>
<ul>
<li><a href="https://ggobi.github.io/ggally/index.html">ggally</a></li>
</ul>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-58_8f8e2cf69aa94ff561156d81b44c957c">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="types-of-plots" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="types-of-plots"><span class="header-section-number">3.5.1</span> Types of Plots</h3>
<ul>
<li>continuous: when both x and y variables are continuous</li>
<li>comboHorizontal: when x is continuous and y is discrete</li>
<li>comboVorizontal: when x is discrete and y is continuous</li>
<li>discrete: when both x and y variables are discrete</li>
<li>na: when all x data and all y data is NA</li>
</ul>
</section>
<section id="ggpairs" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="ggpairs"><span class="header-section-number">3.5.2</span> ggpairs</h3>
<p>いろいろカスタマイズができるのはわかるが、 やりたいものがないとどのようなグラフを作成すべきであるのかがわからない。 こんため</p>
<section id="basic-example" class="level4" data-number="3.5.2.1">
<h4 data-number="3.5.2.1" class="anchored" data-anchor-id="basic-example"><span class="header-section-number">3.5.2.1</span> basic example</h4>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-59_75e3ddc6ff1fe43d5e69f15c2038429e">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a>pm <span class="ot">&lt;-</span> </span>
<span id="cb58-2"><a href="#cb58-2"></a>  iris <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb58-4"><a href="#cb58-4"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species), </span>
<span id="cb58-5"><a href="#cb58-5"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Species"</span>)</span>
<span id="cb58-6"><a href="#cb58-6"></a>  ) <span class="sc">+</span> </span>
<span id="cb58-7"><a href="#cb58-7"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb58-8"><a href="#cb58-8"></a>pm</span>
<span id="cb58-9"><a href="#cb58-9"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb58-10"><a href="#cb58-10"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-59-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-51"><img src="working_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-60_a5018d9d8957aad5560eb2c91b0b13b6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>pm <span class="ot">&lt;-</span> </span>
<span id="cb59-2"><a href="#cb59-2"></a>  iris <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb59-4"><a href="#cb59-4"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species), </span>
<span id="cb59-5"><a href="#cb59-5"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Species"</span>), </span>
<span id="cb59-6"><a href="#cb59-6"></a>    <span class="at">lower   =</span> <span class="fu">list</span>(</span>
<span id="cb59-7"><a href="#cb59-7"></a>      <span class="at">continuous =</span> <span class="st">"smooth"</span>, </span>
<span id="cb59-8"><a href="#cb59-8"></a>      <span class="at">combo =</span> <span class="st">"facetdensity"</span>, </span>
<span id="cb59-9"><a href="#cb59-9"></a>      <span class="at">mappping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species)</span>
<span id="cb59-10"><a href="#cb59-10"></a>    )</span>
<span id="cb59-11"><a href="#cb59-11"></a>  ) <span class="sc">+</span> </span>
<span id="cb59-12"><a href="#cb59-12"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb59-13"><a href="#cb59-13"></a>pm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-60-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-52"><img src="working_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-61_9c306bf994deb5608bda09345b335bb7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>pm <span class="ot">&lt;-</span> </span>
<span id="cb60-2"><a href="#cb60-2"></a>  iris <span class="sc">%&gt;%</span></span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb60-4"><a href="#cb60-4"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species), </span>
<span id="cb60-5"><a href="#cb60-5"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Species"</span>), </span>
<span id="cb60-6"><a href="#cb60-6"></a>    <span class="at">upper =</span> <span class="st">"blank"</span>, </span>
<span id="cb60-7"><a href="#cb60-7"></a>    <span class="at">diag  =</span> <span class="cn">NULL</span>, </span>
<span id="cb60-8"><a href="#cb60-8"></a>    <span class="at">lower   =</span> <span class="fu">list</span>(</span>
<span id="cb60-9"><a href="#cb60-9"></a>      <span class="at">continuous =</span> <span class="st">"smooth"</span>, </span>
<span id="cb60-10"><a href="#cb60-10"></a>      <span class="at">combo =</span> <span class="st">"facetdensity"</span>, </span>
<span id="cb60-11"><a href="#cb60-11"></a>      <span class="at">mappping =</span> <span class="fu">aes</span>()</span>
<span id="cb60-12"><a href="#cb60-12"></a>    )</span>
<span id="cb60-13"><a href="#cb60-13"></a>  ) <span class="sc">+</span> </span>
<span id="cb60-14"><a href="#cb60-14"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb60-15"><a href="#cb60-15"></a>pm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-61-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-53"><img src="working_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="custom-functions" class="level4" data-number="3.5.2.2">
<h4 data-number="3.5.2.2" class="anchored" data-anchor-id="custom-functions"><span class="header-section-number">3.5.2.2</span> custom functions</h4>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-62_a7bd0321698f509f0d29d00e5010f1cc">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="fu">data</span>(tips, <span class="at">package =</span> <span class="st">"reshape"</span>)</span>
<span id="cb61-2"><a href="#cb61-2"></a>my_bin <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ..., <span class="at">low =</span> <span class="st">"#132B43"</span>, <span class="at">high =</span> <span class="st">"#56B1F7"</span>) {</span>
<span id="cb61-3"><a href="#cb61-3"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4"></a>    <span class="fu">geom_bin2d</span>(...) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> low, <span class="at">high =</span> high) <span class="sc">+</span> </span>
<span id="cb61-6"><a href="#cb61-6"></a>    <span class="fu">theme</span>(</span>
<span id="cb61-7"><a href="#cb61-7"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb61-8"><a href="#cb61-8"></a>    )</span>
<span id="cb61-9"><a href="#cb61-9"></a>}</span>
<span id="cb61-10"><a href="#cb61-10"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb61-11"><a href="#cb61-11"></a>  tips, </span>
<span id="cb61-12"><a href="#cb61-12"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"total_bill"</span>, <span class="st">"time"</span>, <span class="st">"tip"</span>), </span>
<span id="cb61-13"><a href="#cb61-13"></a>  <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb61-14"><a href="#cb61-14"></a>    <span class="at">continuous =</span> my_bin</span>
<span id="cb61-15"><a href="#cb61-15"></a>  )</span>
<span id="cb61-16"><a href="#cb61-16"></a>)</span>
<span id="cb61-17"><a href="#cb61-17"></a>pm</span>
<span id="cb61-18"><a href="#cb61-18"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb61-19"><a href="#cb61-19"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-62-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-54"><img src="working_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-63_d3d754f343c7917d7d820a490108df17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb62-2"><a href="#cb62-2"></a>  tips, <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"total_bill"</span>, <span class="st">"time"</span>, <span class="st">"tip"</span>),</span>
<span id="cb62-3"><a href="#cb62-3"></a>  <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb62-4"><a href="#cb62-4"></a>    <span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">binwidth =</span> <span class="dv">1</span>),</span>
<span id="cb62-5"><a href="#cb62-5"></a>    <span class="at">continuous =</span> <span class="fu">wrap</span>(my_bin, <span class="at">binwidth =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">0.5</span>), <span class="at">high =</span> <span class="st">"red"</span>)</span>
<span id="cb62-6"><a href="#cb62-6"></a>  )</span>
<span id="cb62-7"><a href="#cb62-7"></a>)</span>
<span id="cb62-8"><a href="#cb62-8"></a>pm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-63-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-55"><img src="working_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-matrix-subsetting" class="level4" data-number="3.5.2.3">
<h4 data-number="3.5.2.3" class="anchored" data-anchor-id="plot-matrix-subsetting"><span class="header-section-number">3.5.2.3</span> plot matrix subsetting</h4>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-64_822acfdab67ac18960bb69cdc3d98c51">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(tips, <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"total_bill"</span>, <span class="st">"time"</span>, <span class="st">"tip"</span>))</span>
<span id="cb63-2"><a href="#cb63-2"></a>p  <span class="ot">&lt;-</span> pm[<span class="dv">3</span>, <span class="dv">1</span>]</span>
<span id="cb63-3"><a href="#cb63-3"></a>p  <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">color =</span> time)</span>
<span id="cb63-4"><a href="#cb63-4"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-64-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-56"><img src="working_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-65_8cf1d9e4d3d8656d099a17a82e607ebe">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a>pm[<span class="dv">3</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> p</span>
<span id="cb64-2"><a href="#cb64-2"></a>pm</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-65-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-57"><img src="working_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-66_4cea547dd4745e21b4d3cd3a26a2ccd5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a>custom_car <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(mtcars[, <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"wt"</span>, <span class="st">"cyl"</span>)], </span>
<span id="cb65-2"><a href="#cb65-2"></a>                      <span class="at">upper =</span> <span class="st">"blank"</span>, <span class="at">title =</span> <span class="st">"Custom Example"</span>)</span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="co"># ggplot example taken from example(geom_text)</span></span>
<span id="cb65-4"><a href="#cb65-4"></a>plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(mtcars, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>wt, <span class="at">y=</span>mpg, <span class="at">label=</span><span class="fu">rownames</span>(mtcars)))</span>
<span id="cb65-5"><a href="#cb65-5"></a>plot <span class="ot">&lt;-</span> plot <span class="sc">+</span></span>
<span id="cb65-6"><a href="#cb65-6"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">colour=</span><span class="fu">factor</span>(cyl)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb65-7"><a href="#cb65-7"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_colour_discrete</span>(<span class="at">l=</span><span class="dv">40</span>)</span>
<span id="cb65-8"><a href="#cb65-8"></a>custom_car[<span class="dv">1</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> plot</span>
<span id="cb65-9"><a href="#cb65-9"></a>personal_plot <span class="ot">&lt;-</span> <span class="fu">ggally_text</span>(</span>
<span id="cb65-10"><a href="#cb65-10"></a>  <span class="st">"ggpairs allows you</span><span class="sc">\n</span><span class="st">to put in your</span><span class="sc">\n</span><span class="st">own plot.</span><span class="sc">\n</span><span class="st">Like that one.</span><span class="sc">\n</span><span class="st"> &lt;---"</span></span>
<span id="cb65-11"><a href="#cb65-11"></a>)</span>
<span id="cb65-12"><a href="#cb65-12"></a>custom_car[<span class="dv">1</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> personal_plot</span>
<span id="cb65-13"><a href="#cb65-13"></a>(custom_car)</span>
<span id="cb65-14"><a href="#cb65-14"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span>
<span id="cb65-15"><a href="#cb65-15"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-66-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-58"><img src="working_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-67_2d3bcde3156e71869ad7de237e4424a2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a><span class="do">## Remove binwidth warning from ggplot2</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(tips, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>)))</span>
<span id="cb66-3"><a href="#cb66-3"></a>pm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-67-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-59"><img src="working_files/figure-html/unnamed-chunk-67-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-68_9a1a79ee63b5363baebf9a7f94201f5f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="do">## Remove panel grid lines from correlation plots</span></span>
<span id="cb67-2"><a href="#cb67-2"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb67-3"><a href="#cb67-3"></a>  flea, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb67-4"><a href="#cb67-4"></a>  <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">display_grid =</span> <span class="cn">FALSE</span>))</span>
<span id="cb67-5"><a href="#cb67-5"></a>)</span>
<span id="cb67-6"><a href="#cb67-6"></a>pm <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb67-7"><a href="#cb67-7"></a>  <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"black"</span>), </span>
<span id="cb67-8"><a href="#cb67-8"></a>  <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-68-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-60"><img src="working_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ggnetworkmap" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="ggnetworkmap"><span class="header-section-number">3.5.3</span> ggnetworkmap</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-69_48ba945db523c2ee23d196857732baba">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(ggplot2))</span>
<span id="cb68-2"><a href="#cb68-2"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(maps))</span>
<span id="cb68-3"><a href="#cb68-3"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(network))</span>
<span id="cb68-4"><a href="#cb68-4"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(sna))</span>
<span id="cb68-5"><a href="#cb68-5"></a></span>
<span id="cb68-6"><a href="#cb68-6"></a>airports <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"http://datasets.flowingdata.com/tuts/maparcs/airports.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-7"><a href="#cb68-7"></a><span class="fu">rownames</span>(airports) <span class="ot">&lt;-</span> airports<span class="sc">$</span>iata</span>
<span id="cb68-8"><a href="#cb68-8"></a></span>
<span id="cb68-9"><a href="#cb68-9"></a><span class="co"># select some random flights</span></span>
<span id="cb68-10"><a href="#cb68-10"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb68-11"><a href="#cb68-11"></a>flights <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb68-12"><a href="#cb68-12"></a>  <span class="at">origin =</span> <span class="fu">sample</span>(airports[<span class="dv">200</span><span class="sc">:</span><span class="dv">400</span>, ]<span class="sc">$</span>iata, <span class="dv">200</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb68-13"><a href="#cb68-13"></a>  <span class="at">destination =</span> <span class="fu">sample</span>(airports[<span class="dv">200</span><span class="sc">:</span><span class="dv">400</span>, ]<span class="sc">$</span>iata, <span class="dv">200</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-14"><a href="#cb68-14"></a>)</span>
<span id="cb68-15"><a href="#cb68-15"></a></span>
<span id="cb68-16"><a href="#cb68-16"></a><span class="co"># convert to network</span></span>
<span id="cb68-17"><a href="#cb68-17"></a>flights <span class="ot">&lt;-</span> <span class="fu">network</span>(flights, <span class="at">directed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-18"><a href="#cb68-18"></a></span>
<span id="cb68-19"><a href="#cb68-19"></a><span class="co"># add geographic coordinates</span></span>
<span id="cb68-20"><a href="#cb68-20"></a>flights <span class="sc">%v%</span> <span class="st">"lat"</span> <span class="ot">&lt;-</span> airports[ <span class="fu">network.vertex.names</span>(flights), <span class="st">"lat"</span> ]</span>
<span id="cb68-21"><a href="#cb68-21"></a>flights <span class="sc">%v%</span> <span class="st">"lon"</span> <span class="ot">&lt;-</span> airports[ <span class="fu">network.vertex.names</span>(flights), <span class="st">"long"</span> ]</span>
<span id="cb68-22"><a href="#cb68-22"></a></span>
<span id="cb68-23"><a href="#cb68-23"></a><span class="co"># drop isolated airports</span></span>
<span id="cb68-24"><a href="#cb68-24"></a><span class="fu">delete.vertices</span>(flights, <span class="fu">which</span>(<span class="fu">degree</span>(flights) <span class="sc">&lt;</span> <span class="dv">2</span>))</span>
<span id="cb68-25"><a href="#cb68-25"></a></span>
<span id="cb68-26"><a href="#cb68-26"></a><span class="co"># compute degree centrality</span></span>
<span id="cb68-27"><a href="#cb68-27"></a>flights <span class="sc">%v%</span> <span class="st">"degree"</span> <span class="ot">&lt;-</span> <span class="fu">degree</span>(flights, <span class="at">gmode =</span> <span class="st">"digraph"</span>)</span>
<span id="cb68-28"><a href="#cb68-28"></a></span>
<span id="cb68-29"><a href="#cb68-29"></a><span class="co"># add random groups</span></span>
<span id="cb68-30"><a href="#cb68-30"></a>flights <span class="sc">%v%</span> <span class="st">"mygroup"</span> <span class="ot">&lt;-</span> <span class="fu">sample</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="fu">network.size</span>(flights), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb68-31"><a href="#cb68-31"></a></span>
<span id="cb68-32"><a href="#cb68-32"></a><span class="co"># create a map of the USA</span></span>
<span id="cb68-33"><a href="#cb68-33"></a>usa <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">map_data</span>(<span class="st">"usa"</span>), <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb68-34"><a href="#cb68-34"></a>  <span class="fu">geom_polygon</span>(<span class="fu">aes</span>(<span class="at">group =</span> group), <span class="at">color =</span> <span class="st">"grey65"</span>,</span>
<span id="cb68-35"><a href="#cb68-35"></a>               <span class="at">fill =</span> <span class="st">"#f9f9f9"</span>, <span class="at">size =</span> <span class="fl">0.2</span>)</span>
<span id="cb68-36"><a href="#cb68-36"></a></span>
<span id="cb68-37"><a href="#cb68-37"></a><span class="co"># trim flights</span></span>
<span id="cb68-38"><a href="#cb68-38"></a><span class="fu">delete.vertices</span>(flights, <span class="fu">which</span>(flights <span class="sc">%v%</span> <span class="st">"lon"</span> <span class="sc">&lt;</span> <span class="fu">min</span>(usa<span class="sc">$</span>data<span class="sc">$</span>long)))</span>
<span id="cb68-39"><a href="#cb68-39"></a><span class="fu">delete.vertices</span>(flights, <span class="fu">which</span>(flights <span class="sc">%v%</span> <span class="st">"lon"</span> <span class="sc">&gt;</span> <span class="fu">max</span>(usa<span class="sc">$</span>data<span class="sc">$</span>long)))</span>
<span id="cb68-40"><a href="#cb68-40"></a><span class="fu">delete.vertices</span>(flights, <span class="fu">which</span>(flights <span class="sc">%v%</span> <span class="st">"lat"</span> <span class="sc">&lt;</span> <span class="fu">min</span>(usa<span class="sc">$</span>data<span class="sc">$</span>lat)))</span>
<span id="cb68-41"><a href="#cb68-41"></a><span class="fu">delete.vertices</span>(flights, <span class="fu">which</span>(flights <span class="sc">%v%</span> <span class="st">"lat"</span> <span class="sc">&gt;</span> <span class="fu">max</span>(usa<span class="sc">$</span>data<span class="sc">$</span>lat)))</span>
<span id="cb68-42"><a href="#cb68-42"></a></span>
<span id="cb68-43"><a href="#cb68-43"></a><span class="co"># overlay network data to map</span></span>
<span id="cb68-44"><a href="#cb68-44"></a><span class="fu">ggnetworkmap</span>(usa, flights, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">great.circles =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-45"><a href="#cb68-45"></a>             <span class="at">node.group =</span> mygroup, <span class="at">segment.color =</span> <span class="st">"steelblue"</span>,</span>
<span id="cb68-46"><a href="#cb68-46"></a>             <span class="at">ring.group =</span> degree, <span class="at">weight =</span> degree)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="gganimate" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="gganimate"><span class="header-section-number">3.6</span> gganimate</h2>
<p><a href="https://gganimate.com/">github</a></p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-70_92b16772662669fa3d8a2d2d76faad60">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb69-2"><a href="#cb69-2"></a></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="fu">factor</span>(cyl), mpg)) <span class="sc">+</span> </span>
<span id="cb69-4"><a href="#cb69-4"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb69-5"><a href="#cb69-5"></a>  <span class="fu">transition_states</span>(</span>
<span id="cb69-6"><a href="#cb69-6"></a>    gear, </span>
<span id="cb69-7"><a href="#cb69-7"></a>    <span class="at">transition_length =</span> <span class="dv">2</span>, </span>
<span id="cb69-8"><a href="#cb69-8"></a>    <span class="at">state_length =</span> <span class="dv">1</span></span>
<span id="cb69-9"><a href="#cb69-9"></a>  ) <span class="sc">+</span> </span>
<span id="cb69-10"><a href="#cb69-10"></a>  <span class="fu">enter_fade</span>() <span class="sc">+</span> </span>
<span id="cb69-11"><a href="#cb69-11"></a>  <span class="fu">exit_shrink</span>() <span class="sc">+</span> </span>
<span id="cb69-12"><a href="#cb69-12"></a>  <span class="fu">ease_aes</span>(<span class="st">'sine-in-out'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="waffle" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="waffle"><span class="header-section-number">3.7</span> waffle</h2>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-71_25ec9bee3a2b258cb30e8e3596a4e273">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="fu">waffle</span>(<span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">25</span>, <span class="dv">20</span>, <span class="dv">5</span>), <span class="at">rows =</span> <span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-71-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-61"><img src="working_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggupset" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="ggupset"><span class="header-section-number">3.8</span> ggupset</h2>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-72_777ca471baa95b7d81a0924d5616339b">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="fu">library</span>(ggupset)</span>
<span id="cb71-3"><a href="#cb71-3"></a><span class="fu">ggplot</span>(tidy_movies[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ], <span class="fu">aes</span>(<span class="at">x=</span>Genres)) <span class="sc">+</span></span>
<span id="cb71-4"><a href="#cb71-4"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb71-5"><a href="#cb71-5"></a>  <span class="fu">scale_x_upset</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>, <span class="at">sets=</span><span class="fu">c</span>(<span class="st">"Drama"</span>, <span class="st">"Action"</span>))</span>
<span id="cb71-6"><a href="#cb71-6"></a><span class="co">#&gt; Warning: Removed 33 rows containing non-finite values (`stat_count()`).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-72-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-62"><img src="working_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a></span>
<span id="cb72-2"><a href="#cb72-2"></a> <span class="fu">ggplot</span>(tidy_movies[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ], <span class="fu">aes</span>(<span class="at">x=</span>Genres)) <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3"></a>   <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4"></a>   <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">5</span>, <span class="at">ytrans=</span><span class="st">"sqrt"</span>)</span>
<span id="cb72-5"><a href="#cb72-5"></a><span class="co">#&gt; Warning: Removed 28 rows containing non-finite values (`stat_count()`).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-72-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-63"><img src="working_files/figure-html/unnamed-chunk-72-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1"></a></span>
<span id="cb73-2"><a href="#cb73-2"></a> <span class="fu">ggplot</span>(tidy_movies[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ], <span class="fu">aes</span>(<span class="at">x=</span>Genres, <span class="at">y=</span>year)) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3"></a>   <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4"></a>   <span class="fu">scale_x_upset</span>(<span class="at">intersections =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"Drama"</span>, <span class="st">"Comedy"</span>), <span class="fu">c</span>(<span class="st">"Short"</span>), <span class="fu">c</span>(<span class="st">"Short"</span>, <span class="st">"Animation"</span>)),</span>
<span id="cb73-5"><a href="#cb73-5"></a>                 <span class="at">sets =</span> <span class="fu">c</span>(<span class="st">"Drama"</span>, <span class="st">"Comedy"</span>, <span class="st">"Short"</span>, <span class="st">"Animation"</span>, <span class="st">"Horror"</span>))</span>
<span id="cb73-6"><a href="#cb73-6"></a><span class="co">#&gt; Warning: Removed 90 rows containing missing values (`stat_boxplot()`).</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-72-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-64"><img src="working_files/figure-html/unnamed-chunk-72-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="heat-map-with-geom_tile" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="heat-map-with-geom_tile"><span class="header-section-number">3.9</span> Heat map with geom_tile</h2>
<section id="sample-data" class="level3" data-number="3.9.1">
<h3 data-number="3.9.1" class="anchored" data-anchor-id="sample-data"><span class="header-section-number">3.9.1</span> Sample Data</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-73_69b5a17eb492576f4596ff8714c2dd05">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="fu">library</span>(reshape)</span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="co">#&gt; </span></span>
<span id="cb74-3"><a href="#cb74-3"></a><span class="co">#&gt; Attaching package: 'reshape'</span></span>
<span id="cb74-4"><a href="#cb74-4"></a><span class="co">#&gt; The following object is masked from 'package:cowplot':</span></span>
<span id="cb74-5"><a href="#cb74-5"></a><span class="co">#&gt; </span></span>
<span id="cb74-6"><a href="#cb74-6"></a><span class="co">#&gt;     stamp</span></span>
<span id="cb74-7"><a href="#cb74-7"></a><span class="co">#&gt; The following object is masked from 'package:lubridate':</span></span>
<span id="cb74-8"><a href="#cb74-8"></a><span class="co">#&gt; </span></span>
<span id="cb74-9"><a href="#cb74-9"></a><span class="co">#&gt;     stamp</span></span>
<span id="cb74-10"><a href="#cb74-10"></a><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span id="cb74-11"><a href="#cb74-11"></a><span class="co">#&gt; </span></span>
<span id="cb74-12"><a href="#cb74-12"></a><span class="co">#&gt;     rename</span></span>
<span id="cb74-13"><a href="#cb74-13"></a><span class="co">#&gt; The following objects are masked from 'package:tidyr':</span></span>
<span id="cb74-14"><a href="#cb74-14"></a><span class="co">#&gt; </span></span>
<span id="cb74-15"><a href="#cb74-15"></a><span class="co">#&gt;     expand, smiths</span></span>
<span id="cb74-16"><a href="#cb74-16"></a></span>
<span id="cb74-17"><a href="#cb74-17"></a><span class="co"># Data </span></span>
<span id="cb74-18"><a href="#cb74-18"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb74-19"><a href="#cb74-19"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">200</span>), <span class="dv">2</span>), <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb74-20"><a href="#cb74-20"></a><span class="co">#&gt; Warning in matrix(round(rnorm(200), 2), 10, 10): data length differs from size</span></span>
<span id="cb74-21"><a href="#cb74-21"></a><span class="co">#&gt; of matrix: [200 != 10 x 10]</span></span>
<span id="cb74-22"><a href="#cb74-22"></a><span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Col"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb74-23"><a href="#cb74-23"></a><span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Row"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb74-24"><a href="#cb74-24"></a></span>
<span id="cb74-25"><a href="#cb74-25"></a><span class="co"># Transform the matrix in long format</span></span>
<span id="cb74-26"><a href="#cb74-26"></a>df <span class="ot">&lt;-</span> <span class="fu">melt</span>(m)</span>
<span id="cb74-27"><a href="#cb74-27"></a><span class="co">#&gt; Warning in type.convert.default(X[[i]], ...): 'as.is' should be specified by</span></span>
<span id="cb74-28"><a href="#cb74-28"></a><span class="co">#&gt; the caller; using TRUE</span></span>
<span id="cb74-29"><a href="#cb74-29"></a><span class="co">#&gt; Warning in type.convert.default(X[[i]], ...): 'as.is' should be specified by</span></span>
<span id="cb74-30"><a href="#cb74-30"></a><span class="co">#&gt; the caller; using TRUE</span></span>
<span id="cb74-31"><a href="#cb74-31"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"value"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-74_9f58e9e1adb955e4e86dcd8eb267af00">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb75-2"><a href="#cb75-2"></a>  <span class="fu">geom_tile</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-74-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-65"><img src="working_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-75_fff2cbb3026dd2c2d445d6b51657577c">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb76-2"><a href="#cb76-2"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> </span>
<span id="cb76-3"><a href="#cb76-3"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-75-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-66"><img src="working_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-76_a4cafa2ee8f6ba97e9f9aae8ca4a9165">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb77-2"><a href="#cb77-2"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb77-3"><a href="#cb77-3"></a>    <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb77-4"><a href="#cb77-4"></a>    <span class="at">lwd =</span> <span class="fl">1.5</span>, </span>
<span id="cb77-5"><a href="#cb77-5"></a>    <span class="at">linetype =</span> <span class="fl">1.</span></span>
<span id="cb77-6"><a href="#cb77-6"></a>  ) <span class="sc">+</span> </span>
<span id="cb77-7"><a href="#cb77-7"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-76-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-67"><img src="working_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-77_7dd19d28ed0cdadfba1eef8cafa6a077">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb78-2"><a href="#cb78-2"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb78-3"><a href="#cb78-3"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> value), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb78-4"><a href="#cb78-4"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-77-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-68"><img src="working_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="color-palette" class="level3" data-number="3.9.2">
<h3 data-number="3.9.2" class="anchored" data-anchor-id="color-palette"><span class="header-section-number">3.9.2</span> Color Palette</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-78_8800bbf0c2700779c8cee130aade3e08">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb79-2"><a href="#cb79-2"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb79-3"><a href="#cb79-3"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-78-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-69"><img src="working_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-79_560c341ff4096f81786f35add704357d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb80-2"><a href="#cb80-2"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb80-3"><a href="#cb80-3"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb80-4"><a href="#cb80-4"></a>    <span class="at">low =</span> <span class="st">"#075AFF"</span>, </span>
<span id="cb80-5"><a href="#cb80-5"></a>    <span class="at">mid =</span> <span class="st">"#FFFFCC"</span>, </span>
<span id="cb80-6"><a href="#cb80-6"></a>    <span class="at">high =</span> <span class="st">"#FF0000"</span></span>
<span id="cb80-7"><a href="#cb80-7"></a>  ) <span class="sc">+</span> </span>
<span id="cb80-8"><a href="#cb80-8"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-79-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-70"><img src="working_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-80_1370cd7d2d0095c8973a961d597b15a4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb81-2"><a href="#cb81-2"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb81-3"><a href="#cb81-3"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">"RdYlGn"</span>)) <span class="sc">+</span></span>
<span id="cb81-4"><a href="#cb81-4"></a>  <span class="fu">coord_fixed</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-80-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-71"><img src="working_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="legend-customization" class="level3" data-number="3.9.3">
<h3 data-number="3.9.3" class="anchored" data-anchor-id="legend-customization"><span class="header-section-number">3.9.3</span> Legend customization</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-81_f9b0ab55efd444b3b3fb0de15a3c9c8d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb82-2"><a href="#cb82-2"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb82-3"><a href="#cb82-3"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb82-4"><a href="#cb82-4"></a>  <span class="fu">guides</span>(</span>
<span id="cb82-5"><a href="#cb82-5"></a>    <span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">barwidth =</span> .<span class="dv">5</span>, <span class="at">barheight =</span> <span class="dv">20</span>)</span>
<span id="cb82-6"><a href="#cb82-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-81-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-72"><img src="working_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-82_0345656bbc4dacf9f5b7409b0a3cbc93">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb83-3"><a href="#cb83-3"></a></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb83-5"><a href="#cb83-5"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb83-7"><a href="#cb83-7"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">title =</span> <span class="st">"Title"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-82-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-73"><img src="working_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-83_f64ccdc7e46ea89c69832a96a21c6b96">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb84-3"><a href="#cb84-3"></a></span>
<span id="cb84-4"><a href="#cb84-4"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb84-5"><a href="#cb84-5"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">label =</span> <span class="cn">FALSE</span>,</span>
<span id="cb84-8"><a href="#cb84-8"></a>                                <span class="at">ticks =</span> <span class="cn">FALSE</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-83-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-74"><img src="working_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-84_cddfc90c48dbed131c3da934bacdce2f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb85-3"><a href="#cb85-3"></a></span>
<span id="cb85-4"><a href="#cb85-4"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-84-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-75"><img src="working_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="alluvial-plot" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="alluvial-plot"><span class="header-section-number">3.10</span> Alluvial plot</h2>
<section id="sample-dataset" class="level3" data-number="3.10.1">
<h3 data-number="3.10.1" class="anchored" data-anchor-id="sample-dataset"><span class="header-section-number">3.10.1</span> sample dataset</h3>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-85_9971f764f314b0eb27c80ac9faaa422c">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="fu">data</span>(<span class="st">"vaccinations"</span>)</span>
<span id="cb86-2"><a href="#cb86-2"></a>vaccinations</span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="co">#&gt;        survey freq subject  response start_date   end_date</span></span>
<span id="cb86-4"><a href="#cb86-4"></a><span class="co">#&gt; 1   ms153_NSA   48       1    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-5"><a href="#cb86-5"></a><span class="co">#&gt; 2   ms153_NSA    9       2    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-6"><a href="#cb86-6"></a><span class="co">#&gt; 3   ms153_NSA   66       3    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-7"><a href="#cb86-7"></a><span class="co">#&gt; 4   ms153_NSA    1       4    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-8"><a href="#cb86-8"></a><span class="co">#&gt; 5   ms153_NSA   11       5    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-9"><a href="#cb86-9"></a><span class="co">#&gt; 6   ms153_NSA    1       6    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-10"><a href="#cb86-10"></a><span class="co">#&gt; 7   ms153_NSA    5       7    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-11"><a href="#cb86-11"></a><span class="co">#&gt; 8   ms153_NSA    4       8    Always 2010-09-22 2010-10-25</span></span>
<span id="cb86-12"><a href="#cb86-12"></a><span class="co">#&gt; 9   ms153_NSA   24       9   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-13"><a href="#cb86-13"></a><span class="co">#&gt; 10  ms153_NSA    4      10   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-14"><a href="#cb86-14"></a><span class="co">#&gt; 11  ms153_NSA   29      11   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-15"><a href="#cb86-15"></a><span class="co">#&gt; 12  ms153_NSA    1      12   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-16"><a href="#cb86-16"></a><span class="co">#&gt; 13  ms153_NSA    1      13   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-17"><a href="#cb86-17"></a><span class="co">#&gt; 14  ms153_NSA    9      14   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-18"><a href="#cb86-18"></a><span class="co">#&gt; 15  ms153_NSA   10      15   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-19"><a href="#cb86-19"></a><span class="co">#&gt; 16  ms153_NSA   14      16   Missing 2010-09-22 2010-10-25</span></span>
<span id="cb86-20"><a href="#cb86-20"></a><span class="co">#&gt; 17  ms153_NSA    3      17     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-21"><a href="#cb86-21"></a><span class="co">#&gt; 18  ms153_NSA    7      18     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-22"><a href="#cb86-22"></a><span class="co">#&gt; 19  ms153_NSA   42      19     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-23"><a href="#cb86-23"></a><span class="co">#&gt; 20  ms153_NSA   20      20     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-24"><a href="#cb86-24"></a><span class="co">#&gt; 21  ms153_NSA    2      21     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-25"><a href="#cb86-25"></a><span class="co">#&gt; 22  ms153_NSA   36      22     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-26"><a href="#cb86-26"></a><span class="co">#&gt; 23  ms153_NSA    7      23     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-27"><a href="#cb86-27"></a><span class="co">#&gt; 24  ms153_NSA    2      24     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-28"><a href="#cb86-28"></a><span class="co">#&gt; 25  ms153_NSA    4      25     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-29"><a href="#cb86-29"></a><span class="co">#&gt; 26  ms153_NSA    9      26     Never 2010-09-22 2010-10-25</span></span>
<span id="cb86-30"><a href="#cb86-30"></a><span class="co">#&gt; 27  ms153_NSA   48      27 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-31"><a href="#cb86-31"></a><span class="co">#&gt; 28  ms153_NSA   11      28 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-32"><a href="#cb86-32"></a><span class="co">#&gt; 29  ms153_NSA   99      29 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-33"><a href="#cb86-33"></a><span class="co">#&gt; 30  ms153_NSA    3      30 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-34"><a href="#cb86-34"></a><span class="co">#&gt; 31  ms153_NSA   41      31 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-35"><a href="#cb86-35"></a><span class="co">#&gt; 32  ms153_NSA  168      32 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-36"><a href="#cb86-36"></a><span class="co">#&gt; 33  ms153_NSA    2      33 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-37"><a href="#cb86-37"></a><span class="co">#&gt; 34  ms153_NSA   23      34 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-38"><a href="#cb86-38"></a><span class="co">#&gt; 35  ms153_NSA   22      35 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-39"><a href="#cb86-39"></a><span class="co">#&gt; 36  ms153_NSA   38      36 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-40"><a href="#cb86-40"></a><span class="co">#&gt; 37  ms153_NSA    1      37 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-41"><a href="#cb86-41"></a><span class="co">#&gt; 38  ms153_NSA   15      38 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-42"><a href="#cb86-42"></a><span class="co">#&gt; 39  ms153_NSA  113      39 Sometimes 2010-09-22 2010-10-25</span></span>
<span id="cb86-43"><a href="#cb86-43"></a><span class="co">#&gt; 40  ms432_NSA   48       1    Always 2015-06-04 2015-10-05</span></span>
<span id="cb86-44"><a href="#cb86-44"></a><span class="co">#&gt; 41  ms432_NSA    9       2    Always 2015-06-04 2015-10-05</span></span>
<span id="cb86-45"><a href="#cb86-45"></a><span class="co">#&gt; 42  ms432_NSA   66       3   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-46"><a href="#cb86-46"></a><span class="co">#&gt; 43  ms432_NSA    1       4   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-47"><a href="#cb86-47"></a><span class="co">#&gt; 44  ms432_NSA   11       5   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-48"><a href="#cb86-48"></a><span class="co">#&gt; 45  ms432_NSA    1       6     Never 2015-06-04 2015-10-05</span></span>
<span id="cb86-49"><a href="#cb86-49"></a><span class="co">#&gt; 46  ms432_NSA    5       7 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-50"><a href="#cb86-50"></a><span class="co">#&gt; 47  ms432_NSA    4       8 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-51"><a href="#cb86-51"></a><span class="co">#&gt; 48  ms432_NSA   24       9    Always 2015-06-04 2015-10-05</span></span>
<span id="cb86-52"><a href="#cb86-52"></a><span class="co">#&gt; 49  ms432_NSA    4      10    Always 2015-06-04 2015-10-05</span></span>
<span id="cb86-53"><a href="#cb86-53"></a><span class="co">#&gt; 50  ms432_NSA   29      11   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-54"><a href="#cb86-54"></a><span class="co">#&gt; 51  ms432_NSA    1      12   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-55"><a href="#cb86-55"></a><span class="co">#&gt; 52  ms432_NSA    1      13   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-56"><a href="#cb86-56"></a><span class="co">#&gt; 53  ms432_NSA    9      14   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-57"><a href="#cb86-57"></a><span class="co">#&gt; 54  ms432_NSA   10      15 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-58"><a href="#cb86-58"></a><span class="co">#&gt; 55  ms432_NSA   14      16 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-59"><a href="#cb86-59"></a><span class="co">#&gt; 56  ms432_NSA    3      17    Always 2015-06-04 2015-10-05</span></span>
<span id="cb86-60"><a href="#cb86-60"></a><span class="co">#&gt; 57  ms432_NSA    7      18   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-61"><a href="#cb86-61"></a><span class="co">#&gt; 58  ms432_NSA   42      19   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-62"><a href="#cb86-62"></a><span class="co">#&gt; 59  ms432_NSA   20      20   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-63"><a href="#cb86-63"></a><span class="co">#&gt; 60  ms432_NSA    2      21     Never 2015-06-04 2015-10-05</span></span>
<span id="cb86-64"><a href="#cb86-64"></a><span class="co">#&gt; 61  ms432_NSA   36      22     Never 2015-06-04 2015-10-05</span></span>
<span id="cb86-65"><a href="#cb86-65"></a><span class="co">#&gt; 62  ms432_NSA    7      23     Never 2015-06-04 2015-10-05</span></span>
<span id="cb86-66"><a href="#cb86-66"></a><span class="co">#&gt; 63  ms432_NSA    2      24 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-67"><a href="#cb86-67"></a><span class="co">#&gt; 64  ms432_NSA    4      25 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-68"><a href="#cb86-68"></a><span class="co">#&gt; 65  ms432_NSA    9      26 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-69"><a href="#cb86-69"></a><span class="co">#&gt; 66  ms432_NSA   48      27    Always 2015-06-04 2015-10-05</span></span>
<span id="cb86-70"><a href="#cb86-70"></a><span class="co">#&gt; 67  ms432_NSA   11      28    Always 2015-06-04 2015-10-05</span></span>
<span id="cb86-71"><a href="#cb86-71"></a><span class="co">#&gt; 68  ms432_NSA   99      29   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-72"><a href="#cb86-72"></a><span class="co">#&gt; 69  ms432_NSA    3      30   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-73"><a href="#cb86-73"></a><span class="co">#&gt; 70  ms432_NSA   41      31   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-74"><a href="#cb86-74"></a><span class="co">#&gt; 71  ms432_NSA  168      32   Missing 2015-06-04 2015-10-05</span></span>
<span id="cb86-75"><a href="#cb86-75"></a><span class="co">#&gt; 72  ms432_NSA    2      33     Never 2015-06-04 2015-10-05</span></span>
<span id="cb86-76"><a href="#cb86-76"></a><span class="co">#&gt; 73  ms432_NSA   23      34     Never 2015-06-04 2015-10-05</span></span>
<span id="cb86-77"><a href="#cb86-77"></a><span class="co">#&gt; 74  ms432_NSA   22      35     Never 2015-06-04 2015-10-05</span></span>
<span id="cb86-78"><a href="#cb86-78"></a><span class="co">#&gt; 75  ms432_NSA   38      36 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-79"><a href="#cb86-79"></a><span class="co">#&gt; 76  ms432_NSA    1      37 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-80"><a href="#cb86-80"></a><span class="co">#&gt; 77  ms432_NSA   15      38 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-81"><a href="#cb86-81"></a><span class="co">#&gt; 78  ms432_NSA  113      39 Sometimes 2015-06-04 2015-10-05</span></span>
<span id="cb86-82"><a href="#cb86-82"></a><span class="co">#&gt; 79  ms460_NSA   48       1    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-83"><a href="#cb86-83"></a><span class="co">#&gt; 80  ms460_NSA    9       2 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-84"><a href="#cb86-84"></a><span class="co">#&gt; 81  ms460_NSA   66       3    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-85"><a href="#cb86-85"></a><span class="co">#&gt; 82  ms460_NSA    1       4     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-86"><a href="#cb86-86"></a><span class="co">#&gt; 83  ms460_NSA   11       5 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-87"><a href="#cb86-87"></a><span class="co">#&gt; 84  ms460_NSA    1       6    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-88"><a href="#cb86-88"></a><span class="co">#&gt; 85  ms460_NSA    5       7    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-89"><a href="#cb86-89"></a><span class="co">#&gt; 86  ms460_NSA    4       8 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-90"><a href="#cb86-90"></a><span class="co">#&gt; 87  ms460_NSA   24       9    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-91"><a href="#cb86-91"></a><span class="co">#&gt; 88  ms460_NSA    4      10 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-92"><a href="#cb86-92"></a><span class="co">#&gt; 89  ms460_NSA   29      11    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-93"><a href="#cb86-93"></a><span class="co">#&gt; 90  ms460_NSA    1      12   Missing 2016-09-27 2016-10-25</span></span>
<span id="cb86-94"><a href="#cb86-94"></a><span class="co">#&gt; 91  ms460_NSA    1      13     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-95"><a href="#cb86-95"></a><span class="co">#&gt; 92  ms460_NSA    9      14 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-96"><a href="#cb86-96"></a><span class="co">#&gt; 93  ms460_NSA   10      15    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-97"><a href="#cb86-97"></a><span class="co">#&gt; 94  ms460_NSA   14      16 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-98"><a href="#cb86-98"></a><span class="co">#&gt; 95  ms460_NSA    3      17    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-99"><a href="#cb86-99"></a><span class="co">#&gt; 96  ms460_NSA    7      18    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-100"><a href="#cb86-100"></a><span class="co">#&gt; 97  ms460_NSA   42      19     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-101"><a href="#cb86-101"></a><span class="co">#&gt; 98  ms460_NSA   20      20 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-102"><a href="#cb86-102"></a><span class="co">#&gt; 99  ms460_NSA    2      21   Missing 2016-09-27 2016-10-25</span></span>
<span id="cb86-103"><a href="#cb86-103"></a><span class="co">#&gt; 100 ms460_NSA   36      22     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-104"><a href="#cb86-104"></a><span class="co">#&gt; 101 ms460_NSA    7      23 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-105"><a href="#cb86-105"></a><span class="co">#&gt; 102 ms460_NSA    2      24    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-106"><a href="#cb86-106"></a><span class="co">#&gt; 103 ms460_NSA    4      25     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-107"><a href="#cb86-107"></a><span class="co">#&gt; 104 ms460_NSA    9      26 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-108"><a href="#cb86-108"></a><span class="co">#&gt; 105 ms460_NSA   48      27    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-109"><a href="#cb86-109"></a><span class="co">#&gt; 106 ms460_NSA   11      28 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-110"><a href="#cb86-110"></a><span class="co">#&gt; 107 ms460_NSA   99      29    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-111"><a href="#cb86-111"></a><span class="co">#&gt; 108 ms460_NSA    3      30   Missing 2016-09-27 2016-10-25</span></span>
<span id="cb86-112"><a href="#cb86-112"></a><span class="co">#&gt; 109 ms460_NSA   41      31     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-113"><a href="#cb86-113"></a><span class="co">#&gt; 110 ms460_NSA  168      32 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-114"><a href="#cb86-114"></a><span class="co">#&gt; 111 ms460_NSA    2      33    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-115"><a href="#cb86-115"></a><span class="co">#&gt; 112 ms460_NSA   23      34     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-116"><a href="#cb86-116"></a><span class="co">#&gt; 113 ms460_NSA   22      35 Sometimes 2016-09-27 2016-10-25</span></span>
<span id="cb86-117"><a href="#cb86-117"></a><span class="co">#&gt; 114 ms460_NSA   38      36    Always 2016-09-27 2016-10-25</span></span>
<span id="cb86-118"><a href="#cb86-118"></a><span class="co">#&gt; 115 ms460_NSA    1      37   Missing 2016-09-27 2016-10-25</span></span>
<span id="cb86-119"><a href="#cb86-119"></a><span class="co">#&gt; 116 ms460_NSA   15      38     Never 2016-09-27 2016-10-25</span></span>
<span id="cb86-120"><a href="#cb86-120"></a><span class="co">#&gt; 117 ms460_NSA  113      39 Sometimes 2016-09-27 2016-10-25</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="plot" class="level3" data-number="3.10.2">
<h3 data-number="3.10.2" class="anchored" data-anchor-id="plot"><span class="header-section-number">3.10.2</span> plot</h3>
<p>次の２つを使うことができるようになるのでコレを使うこと. 曲線の形は色々と選択することが可能である.</p>
<ul>
<li>geom_alluvium</li>
<li>geom_stratum</li>
</ul>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-86_20246f524c28783471eb62c1652d5480">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a></span>
<span id="cb87-2"><a href="#cb87-2"></a><span class="fu">ggplot</span>(</span>
<span id="cb87-3"><a href="#cb87-3"></a>  <span class="at">data =</span> vaccinations, </span>
<span id="cb87-4"><a href="#cb87-4"></a>  <span class="fu">aes</span>(</span>
<span id="cb87-5"><a href="#cb87-5"></a>    <span class="at">axis1 =</span> survey, </span>
<span id="cb87-6"><a href="#cb87-6"></a>    <span class="at">axis2 =</span> response, </span>
<span id="cb87-7"><a href="#cb87-7"></a>    <span class="at">y =</span> freq</span>
<span id="cb87-8"><a href="#cb87-8"></a>  )) <span class="sc">+</span> </span>
<span id="cb87-9"><a href="#cb87-9"></a>  <span class="fu">geom_alluvium</span>(<span class="fu">aes</span>(<span class="at">fill =</span> response), <span class="at">curve_type =</span> <span class="st">"sine"</span>) <span class="sc">+</span> </span>
<span id="cb87-10"><a href="#cb87-10"></a>  <span class="fu">geom_stratum</span>() <span class="sc">+</span> </span>
<span id="cb87-11"><a href="#cb87-11"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb87-12"><a href="#cb87-12"></a>    <span class="at">stat =</span> <span class="st">"stratum"</span>, </span>
<span id="cb87-13"><a href="#cb87-13"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(stratum))</span>
<span id="cb87-14"><a href="#cb87-14"></a>  ) <span class="sc">+</span> </span>
<span id="cb87-15"><a href="#cb87-15"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Survey"</span>, <span class="st">"Response"</span>), <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">05</span>)) <span class="sc">+</span></span>
<span id="cb87-16"><a href="#cb87-16"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-86-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-76"><img src="working_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>もちろん色のカスタマイズも可能である.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-87_665686001e4efb73bdf86c2493999732">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="dv">4</span>, <span class="st">"Red-Blue"</span>)</span>
<span id="cb88-2"><a href="#cb88-2"></a></span>
<span id="cb88-3"><a href="#cb88-3"></a></span>
<span id="cb88-4"><a href="#cb88-4"></a><span class="fu">ggplot</span>(</span>
<span id="cb88-5"><a href="#cb88-5"></a>  <span class="at">data =</span> vaccinations, </span>
<span id="cb88-6"><a href="#cb88-6"></a>  <span class="fu">aes</span>(</span>
<span id="cb88-7"><a href="#cb88-7"></a>    <span class="at">axis1 =</span> survey, </span>
<span id="cb88-8"><a href="#cb88-8"></a>    <span class="at">axis2 =</span> response, </span>
<span id="cb88-9"><a href="#cb88-9"></a>    <span class="at">y =</span> freq</span>
<span id="cb88-10"><a href="#cb88-10"></a>  ) </span>
<span id="cb88-11"><a href="#cb88-11"></a>) <span class="sc">+</span> </span>
<span id="cb88-12"><a href="#cb88-12"></a>  <span class="fu">geom_alluvium</span>(<span class="fu">aes</span>(<span class="at">fill =</span> response)) <span class="sc">+</span> </span>
<span id="cb88-13"><a href="#cb88-13"></a>  <span class="fu">geom_stratum</span>() <span class="sc">+</span> </span>
<span id="cb88-14"><a href="#cb88-14"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb88-15"><a href="#cb88-15"></a>    <span class="at">stat =</span> <span class="st">"stratum"</span>, </span>
<span id="cb88-16"><a href="#cb88-16"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(stratum))</span>
<span id="cb88-17"><a href="#cb88-17"></a>  ) <span class="sc">+</span> </span>
<span id="cb88-18"><a href="#cb88-18"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Survey"</span>, <span class="st">"Response"</span>), <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">05</span>)) <span class="sc">+</span> </span>
<span id="cb88-19"><a href="#cb88-19"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span> </span>
<span id="cb88-20"><a href="#cb88-20"></a>  <span class="fu">theme_void</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-87-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-77"><img src="working_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-88_717663ba62dd8d4af6c3017c03e064b4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a><span class="fu">hcl.colors</span>(<span class="dv">4</span>, <span class="st">"Red-Blue"</span>)</span>
<span id="cb89-2"><a href="#cb89-2"></a><span class="co">#&gt; [1] "#A93154" "#BC569E" "#B788CD" "#AEB6E5"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="ggbumps" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="ggbumps"><span class="header-section-number">3.11</span> ggbumps</h2>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-89_d49fe3681d4e8eaac76c16fb2c98dd19">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="fu">library</span>(ggbump)</span>
<span id="cb90-3"><a href="#cb90-3"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><a href="https://github.com/davidsjoberg/ggbump">github</a></p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-90_075903be8ea4cb904f992689893a9fc0">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1"></a></span>
<span id="cb91-2"><a href="#cb91-2"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">country =</span> <span class="fu">c</span>(<span class="st">"India"</span>, <span class="st">"India"</span>, <span class="st">"India"</span>, <span class="st">"Sweden"</span>, <span class="st">"Sweden"</span>, <span class="st">"Sweden"</span>, <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"Finland"</span>, <span class="st">"Finland"</span>, <span class="st">"Finland"</span>),</span>
<span id="cb91-3"><a href="#cb91-3"></a>             <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>),</span>
<span id="cb91-4"><a href="#cb91-4"></a>             <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">492</span>, <span class="dv">246</span>, <span class="dv">246</span>, <span class="dv">369</span>, <span class="dv">123</span>, <span class="dv">492</span>, <span class="dv">246</span>, <span class="dv">369</span>, <span class="dv">123</span>, <span class="dv">123</span>, <span class="dv">492</span>, <span class="dv">369</span>))</span>
<span id="cb91-5"><a href="#cb91-5"></a></span>
<span id="cb91-6"><a href="#cb91-6"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb91-7"><a href="#cb91-7"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb91-8"><a href="#cb91-8"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(value, <span class="at">ties.method =</span> <span class="st">"random"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb91-9"><a href="#cb91-9"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb91-10"><a href="#cb91-10"></a></span>
<span id="cb91-11"><a href="#cb91-11"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">country</th>
<th style="text-align: right;">year</th>
<th style="text-align: right;">value</th>
<th style="text-align: right;">rank</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">India</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">492</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">India</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">246</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">India</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">246</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sweden</td>
<td style="text-align: right;">2011</td>
<td style="text-align: right;">369</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sweden</td>
<td style="text-align: right;">2012</td>
<td style="text-align: right;">123</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sweden</td>
<td style="text-align: right;">2013</td>
<td style="text-align: right;">492</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-91_d4164a4cb956bd33cb4a7517e6cc011e">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(year, rank, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2"></a>    <span class="fu">geom_bump</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-91-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-78"><img src="working_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-92_38858679c1833a35d287544695870bf9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, cowplot, wesanderson)</span>
<span id="cb93-2"><a href="#cb93-2"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(year, rank, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb93-4"><a href="#cb93-4"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">min</span>(year)),</span>
<span id="cb93-5"><a href="#cb93-5"></a>            <span class="fu">aes</span>(<span class="at">x =</span> year <span class="sc">-</span> .<span class="dv">1</span>, <span class="at">label =</span> country), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb93-6"><a href="#cb93-6"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)),</span>
<span id="cb93-7"><a href="#cb93-7"></a>            <span class="fu">aes</span>(<span class="at">x =</span> year <span class="sc">+</span> .<span class="dv">1</span>, <span class="at">label =</span> country), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb93-8"><a href="#cb93-8"></a>  <span class="fu">geom_bump</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">smooth =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb93-9"><a href="#cb93-9"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">2010.6</span>, <span class="fl">2013.4</span>),</span>
<span id="cb93-10"><a href="#cb93-10"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2011</span>, <span class="dv">2013</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb93-11"><a href="#cb93-11"></a>  <span class="fu">theme_minimal_grid</span>(<span class="at">font_size =</span> <span class="dv">14</span>, <span class="at">line_size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb93-12"><a href="#cb93-12"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb93-13"><a href="#cb93-13"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb93-14"><a href="#cb93-14"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"RANK"</span>,</span>
<span id="cb93-15"><a href="#cb93-15"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb93-16"><a href="#cb93-16"></a>  <span class="fu">scale_y_reverse</span>() <span class="sc">+</span></span>
<span id="cb93-17"><a href="#cb93-17"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">name =</span> <span class="st">"GrandBudapest1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-92-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-79"><img src="working_files/figure-html/unnamed-chunk-92-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-93_a927c49c2a5e7d7060c70902c64a6b23">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a><span class="co"># Original df</span></span>
<span id="cb94-2"><a href="#cb94-2"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">season =</span> <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>, </span>
<span id="cb94-3"><a href="#cb94-3"></a>                        <span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>, </span>
<span id="cb94-4"><a href="#cb94-4"></a>                        <span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>,</span>
<span id="cb94-5"><a href="#cb94-5"></a>                        <span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>),</span>
<span id="cb94-6"><a href="#cb94-6"></a>             <span class="at">rank =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>,</span>
<span id="cb94-7"><a href="#cb94-7"></a>                      <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>,</span>
<span id="cb94-8"><a href="#cb94-8"></a>                      <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>,</span>
<span id="cb94-9"><a href="#cb94-9"></a>                      <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb94-10"><a href="#cb94-10"></a>             <span class="at">player =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"David"</span>, <span class="dv">6</span>),</span>
<span id="cb94-11"><a href="#cb94-11"></a>                        <span class="fu">rep</span>(<span class="st">"Anna"</span>, <span class="dv">6</span>),</span>
<span id="cb94-12"><a href="#cb94-12"></a>                        <span class="fu">rep</span>(<span class="st">"Franz"</span>, <span class="dv">6</span>),</span>
<span id="cb94-13"><a href="#cb94-13"></a>                        <span class="fu">rep</span>(<span class="st">"Ika"</span>, <span class="dv">6</span>)))</span>
<span id="cb94-14"><a href="#cb94-14"></a></span>
<span id="cb94-15"><a href="#cb94-15"></a><span class="co"># Create factors and order factor</span></span>
<span id="cb94-16"><a href="#cb94-16"></a><span class="co"># チュートリアルでは文字列などでも描画出来ていたけどここではうまくいかなった</span></span>
<span id="cb94-17"><a href="#cb94-17"></a><span class="co"># x軸を数値に変更すると上手く描画できる</span></span>
<span id="cb94-18"><a href="#cb94-18"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb94-19"><a href="#cb94-19"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">unique</span>(season), <span class="at">ordered =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb94-20"><a href="#cb94-20"></a></span>
<span id="cb94-21"><a href="#cb94-21"></a><span class="co"># Add manual axis labels to plot</span></span>
<span id="cb94-22"><a href="#cb94-22"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(season, rank, <span class="at">color =</span> player)) <span class="sc">+</span></span>
<span id="cb94-23"><a href="#cb94-23"></a>  <span class="fu">geom_bump</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">smooth =</span> <span class="dv">20</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb94-24"><a href="#cb94-24"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> player)) <span class="sc">+</span></span>
<span id="cb94-25"><a href="#cb94-25"></a>  <span class="fu">theme_minimal_grid</span>(<span class="at">font_size =</span> <span class="dv">10</span>, <span class="at">line_size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb94-26"><a href="#cb94-26"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb94-27"><a href="#cb94-27"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb94-28"><a href="#cb94-28"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">name =</span> <span class="st">"IsleofDogs1"</span>))</span>
<span id="cb94-29"><a href="#cb94-29"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-30"><a href="#cb94-30"></a><span class="co">#&gt; group</span></span>
<span id="cb94-31"><a href="#cb94-31"></a></span>
<span id="cb94-32"><a href="#cb94-32"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-33"><a href="#cb94-33"></a><span class="co">#&gt; group</span></span>
<span id="cb94-34"><a href="#cb94-34"></a></span>
<span id="cb94-35"><a href="#cb94-35"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-36"><a href="#cb94-36"></a><span class="co">#&gt; group</span></span>
<span id="cb94-37"><a href="#cb94-37"></a></span>
<span id="cb94-38"><a href="#cb94-38"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-39"><a href="#cb94-39"></a><span class="co">#&gt; group</span></span>
<span id="cb94-40"><a href="#cb94-40"></a></span>
<span id="cb94-41"><a href="#cb94-41"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-42"><a href="#cb94-42"></a><span class="co">#&gt; group</span></span>
<span id="cb94-43"><a href="#cb94-43"></a></span>
<span id="cb94-44"><a href="#cb94-44"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-45"><a href="#cb94-45"></a><span class="co">#&gt; group</span></span>
<span id="cb94-46"><a href="#cb94-46"></a></span>
<span id="cb94-47"><a href="#cb94-47"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-48"><a href="#cb94-48"></a><span class="co">#&gt; group</span></span>
<span id="cb94-49"><a href="#cb94-49"></a></span>
<span id="cb94-50"><a href="#cb94-50"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-51"><a href="#cb94-51"></a><span class="co">#&gt; group</span></span>
<span id="cb94-52"><a href="#cb94-52"></a></span>
<span id="cb94-53"><a href="#cb94-53"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-54"><a href="#cb94-54"></a><span class="co">#&gt; group</span></span>
<span id="cb94-55"><a href="#cb94-55"></a></span>
<span id="cb94-56"><a href="#cb94-56"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-57"><a href="#cb94-57"></a><span class="co">#&gt; group</span></span>
<span id="cb94-58"><a href="#cb94-58"></a></span>
<span id="cb94-59"><a href="#cb94-59"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-60"><a href="#cb94-60"></a><span class="co">#&gt; group</span></span>
<span id="cb94-61"><a href="#cb94-61"></a></span>
<span id="cb94-62"><a href="#cb94-62"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-63"><a href="#cb94-63"></a><span class="co">#&gt; group</span></span>
<span id="cb94-64"><a href="#cb94-64"></a></span>
<span id="cb94-65"><a href="#cb94-65"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-66"><a href="#cb94-66"></a><span class="co">#&gt; group</span></span>
<span id="cb94-67"><a href="#cb94-67"></a></span>
<span id="cb94-68"><a href="#cb94-68"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-69"><a href="#cb94-69"></a><span class="co">#&gt; group</span></span>
<span id="cb94-70"><a href="#cb94-70"></a></span>
<span id="cb94-71"><a href="#cb94-71"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-72"><a href="#cb94-72"></a><span class="co">#&gt; group</span></span>
<span id="cb94-73"><a href="#cb94-73"></a></span>
<span id="cb94-74"><a href="#cb94-74"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-75"><a href="#cb94-75"></a><span class="co">#&gt; group</span></span>
<span id="cb94-76"><a href="#cb94-76"></a></span>
<span id="cb94-77"><a href="#cb94-77"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-78"><a href="#cb94-78"></a><span class="co">#&gt; group</span></span>
<span id="cb94-79"><a href="#cb94-79"></a></span>
<span id="cb94-80"><a href="#cb94-80"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-81"><a href="#cb94-81"></a><span class="co">#&gt; group</span></span>
<span id="cb94-82"><a href="#cb94-82"></a></span>
<span id="cb94-83"><a href="#cb94-83"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-84"><a href="#cb94-84"></a><span class="co">#&gt; group</span></span>
<span id="cb94-85"><a href="#cb94-85"></a></span>
<span id="cb94-86"><a href="#cb94-86"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-87"><a href="#cb94-87"></a><span class="co">#&gt; group</span></span>
<span id="cb94-88"><a href="#cb94-88"></a></span>
<span id="cb94-89"><a href="#cb94-89"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-90"><a href="#cb94-90"></a><span class="co">#&gt; group</span></span>
<span id="cb94-91"><a href="#cb94-91"></a></span>
<span id="cb94-92"><a href="#cb94-92"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-93"><a href="#cb94-93"></a><span class="co">#&gt; group</span></span>
<span id="cb94-94"><a href="#cb94-94"></a></span>
<span id="cb94-95"><a href="#cb94-95"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-96"><a href="#cb94-96"></a><span class="co">#&gt; group</span></span>
<span id="cb94-97"><a href="#cb94-97"></a></span>
<span id="cb94-98"><a href="#cb94-98"></a><span class="co">#&gt; Warning in compute_group(...): 'StatBump' needs at least two observations per</span></span>
<span id="cb94-99"><a href="#cb94-99"></a><span class="co">#&gt; group</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-93-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-80"><img src="working_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggridges" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="ggridges"><span class="header-section-number">3.12</span> ggridges</h2>
<p><a href="https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html">公式ページ</a>をみるのが１番．どのようなグラフが描けるのかは，サンプルを見て欲しい．グラフの幅が拡がること間違いなし．</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-94_6c0ab6f2e2d8941df72bd8c00f503c92">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>))</span>
<span id="cb95-2"><a href="#cb95-2"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(x, y, <span class="at">height =</span> height)) <span class="sc">+</span> <span class="fu">geom_ridgeline</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-94-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-81"><img src="working_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-95_bfc44da26ed36a0f9205e1e2e4e4a2cd">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a></span>
<span id="cb96-2"><a href="#cb96-2"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb96-3"><a href="#cb96-3"></a>plot_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(x, y, <span class="at">height =</span> height))</span>
<span id="cb96-4"><a href="#cb96-4"></a></span>
<span id="cb96-5"><a href="#cb96-5"></a>plot_base <span class="sc">+</span> <span class="fu">geom_ridgeline</span>() <span class="sc">|</span> plot_base <span class="sc">+</span> <span class="fu">geom_ridgeline</span>(<span class="at">min_height =</span> <span class="sc">-</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-95-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-82"><img src="working_files/figure-html/unnamed-chunk-95-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-96_8228cd3f4c3f5dbe66ea1d756f303f7e">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Species, <span class="at">fill =</span> <span class="fu">factor</span>(<span class="fu">stat</span>(quantile)))) <span class="sc">+</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>  <span class="fu">stat_density_ridges</span>(</span>
<span id="cb97-3"><a href="#cb97-3"></a>    <span class="at">geom =</span> <span class="st">"density_ridges_gradient"</span>, <span class="at">calc_ecdf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb97-4"><a href="#cb97-4"></a>    <span class="at">quantiles =</span> <span class="dv">4</span>, <span class="at">quantile_lines =</span> <span class="cn">TRUE</span></span>
<span id="cb97-5"><a href="#cb97-5"></a>  ) <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="st">"Quartiles"</span>)</span>
<span id="cb97-7"><a href="#cb97-7"></a><span class="co">#&gt; Warning: `stat(quantile)` was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb97-8"><a href="#cb97-8"></a><span class="co">#&gt; ℹ Please use `after_stat(quantile)` instead.</span></span>
<span id="cb97-9"><a href="#cb97-9"></a><span class="co">#&gt; Picking joint bandwidth of 0.181</span></span>
<span id="cb97-10"><a href="#cb97-10"></a><span class="co">#&gt; Warning: Using the `size` aesthetic with geom_segment was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb97-11"><a href="#cb97-11"></a><span class="co">#&gt; ℹ Please use the `linewidth` aesthetic instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-96-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-83"><img src="working_files/figure-html/unnamed-chunk-96-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-97_11f86254f942880e4797d70b34c599d2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Species, <span class="at">fill =</span> <span class="fu">factor</span>(<span class="fu">stat</span>(quantile)))) <span class="sc">+</span></span>
<span id="cb98-2"><a href="#cb98-2"></a>  <span class="fu">stat_density_ridges</span>(</span>
<span id="cb98-3"><a href="#cb98-3"></a>    <span class="at">geom =</span> <span class="st">"density_ridges_gradient"</span>,</span>
<span id="cb98-4"><a href="#cb98-4"></a>    <span class="at">calc_ecdf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb98-5"><a href="#cb98-5"></a>    <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)</span>
<span id="cb98-6"><a href="#cb98-6"></a>  ) <span class="sc">+</span></span>
<span id="cb98-7"><a href="#cb98-7"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb98-8"><a href="#cb98-8"></a>    <span class="at">name =</span> <span class="st">"Probability"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#FF0000A0"</span>, <span class="st">"#A0A0A0A0"</span>, <span class="st">"#0000FFA0"</span>),</span>
<span id="cb98-9"><a href="#cb98-9"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"(0, 0.025]"</span>, <span class="st">"(0.025, 0.975]"</span>, <span class="st">"(0.975, 1]"</span>)</span>
<span id="cb98-10"><a href="#cb98-10"></a>  )</span>
<span id="cb98-11"><a href="#cb98-11"></a><span class="co">#&gt; Picking joint bandwidth of 0.181</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-97-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-84"><img src="working_files/figure-html/unnamed-chunk-97-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-98_812f964d1b8f89bf1afc8504748504ea">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Species)) <span class="sc">+</span></span>
<span id="cb99-2"><a href="#cb99-2"></a>  <span class="fu">geom_density_ridges</span>(</span>
<span id="cb99-3"><a href="#cb99-3"></a>    <span class="at">jittered_points =</span> <span class="cn">TRUE</span>, <span class="at">quantile_lines =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="fl">0.9</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb99-4"><a href="#cb99-4"></a>    <span class="at">vline_size =</span> <span class="dv">1</span>, <span class="at">vline_color =</span> <span class="st">"red"</span>,</span>
<span id="cb99-5"><a href="#cb99-5"></a>    <span class="at">point_size =</span> <span class="fl">0.4</span>, <span class="at">point_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb99-6"><a href="#cb99-6"></a>    <span class="at">position =</span> <span class="fu">position_raincloud</span>(<span class="at">adjust_vlines =</span> <span class="cn">TRUE</span>)</span>
<span id="cb99-7"><a href="#cb99-7"></a>  )</span>
<span id="cb99-8"><a href="#cb99-8"></a><span class="co">#&gt; Picking joint bandwidth of 0.181</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-98-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-85"><img src="working_files/figure-html/unnamed-chunk-98-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>スケールは縦スケールである．重なりを避けたい場合には小さくすればいいし，重なりがあっても強調したい場合には大きい値を設定すればよい.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-99_f7ce836a678db8d06e4efedabfcabb03">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a><span class="fu">ggplot</span>(lincoln_weather, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Mean Temperature [F]</span><span class="st">`</span>, <span class="at">y =</span> Month, <span class="at">fill =</span> <span class="fu">stat</span>(x))) <span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2"></a>  <span class="fu">geom_density_ridges_gradient</span>(<span class="at">scale =</span> <span class="dv">3</span>, <span class="at">rel_min_height =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb100-3"><a href="#cb100-3"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">"Temp. [F]"</span>, <span class="at">option =</span> <span class="st">"C"</span>) <span class="sc">+</span></span>
<span id="cb100-4"><a href="#cb100-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Temperatures in Lincoln NE in 2016'</span>)</span>
<span id="cb100-5"><a href="#cb100-5"></a><span class="co">#&gt; Picking joint bandwidth of 3.37</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-99-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-86"><img src="working_files/figure-html/unnamed-chunk-99-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ggblend" class="level2" data-number="3.13">
<h2 data-number="3.13" class="anchored" data-anchor-id="ggblend"><span class="header-section-number">3.13</span> ggblend</h2>
<p><a href="https://mjskay.github.io/ggblend/">link</a></p>
<p>透過色でグラフを記述すると，レンダリングの順番でグラフの見え方が変わる. pngにしているとブレンドが機能しないとのことである. RStudioのレンダリングを<code>cario png</code>にするとRStudio上でレンダリングすることが可能であった.</p>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-100_e9e541d00adf84fc6eeca3257ead2b2d">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb101-2"><a href="#cb101-2"></a><span class="fu">library</span>(ggblend)</span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="fu">theme_set</span>(ggdist<span class="sc">::</span><span class="fu">theme_ggdist</span>() <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb101-4"><a href="#cb101-4"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">lineheight =</span> <span class="fl">1.1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb101-5"><a href="#cb101-5"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb101-6"><a href="#cb101-6"></a>  <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray75"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb101-7"><a href="#cb101-7"></a>))</span>
<span id="cb101-8"><a href="#cb101-8"></a></span>
<span id="cb101-9"><a href="#cb101-9"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb101-10"><a href="#cb101-10"></a>df_a <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">0</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">1</span>), <span class="at">set =</span> <span class="st">"a"</span>)</span>
<span id="cb101-11"><a href="#cb101-11"></a>df_b <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">2</span>), <span class="at">set =</span> <span class="st">"b"</span>)</span>
<span id="cb101-12"><a href="#cb101-12"></a></span>
<span id="cb101-13"><a href="#cb101-13"></a>df_ab <span class="ot">=</span> <span class="fu">rbind</span>(df_a, df_b) <span class="sc">|&gt;</span></span>
<span id="cb101-14"><a href="#cb101-14"></a>  <span class="fu">transform</span>(<span class="at">order =</span> <span class="st">"draw a then b"</span>)</span>
<span id="cb101-15"><a href="#cb101-15"></a></span>
<span id="cb101-16"><a href="#cb101-16"></a>df_ba <span class="ot">=</span> <span class="fu">rbind</span>(df_b, df_a) <span class="sc">|&gt;</span></span>
<span id="cb101-17"><a href="#cb101-17"></a>  <span class="fu">transform</span>(<span class="at">order =</span> <span class="st">"draw b then a"</span>)</span>
<span id="cb101-18"><a href="#cb101-18"></a></span>
<span id="cb101-19"><a href="#cb101-19"></a>df <span class="ot">=</span> <span class="fu">rbind</span>(df_ab, df_ba)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-101_3fb4861c3542a755b66660615120d740">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb102-2"><a href="#cb102-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> set)) <span class="sc">+</span></span>
<span id="cb102-3"><a href="#cb102-3"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb102-5"><a href="#cb102-5"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> order) <span class="sc">+</span></span>
<span id="cb102-6"><a href="#cb102-6"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"geom_point() without blending"</span>, <span class="at">subtitle =</span> <span class="st">"Draw order matters."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-101-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-87"><img src="working_files/figure-html/unnamed-chunk-101-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="working_cache/html/unnamed-chunk-102_81e99d665f85bf9bad13457702e49fcf">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1"></a><span class="fu">options</span>(<span class="at">ggblend.check_blend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb103-2"><a href="#cb103-2"></a>df <span class="sc">|&gt;</span></span>
<span id="cb103-3"><a href="#cb103-3"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> set)) <span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span> <span class="fu">blend</span>(<span class="st">"multiply"</span>) <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb103-6"><a href="#cb103-6"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> order) <span class="sc">+</span></span>
<span id="cb103-7"><a href="#cb103-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb103-8"><a href="#cb103-8"></a>    <span class="at">title =</span> <span class="st">"geom_point(alpha = 0.5) |&gt; blend('multiply')"</span>,</span>
<span id="cb103-9"><a href="#cb103-9"></a>    <span class="at">subtitle =</span> <span class="st">"Draw order does not matter, but color is too dark."</span></span>
<span id="cb103-10"><a href="#cb103-10"></a>  )</span>
<span id="cb103-11"><a href="#cb103-11"></a><span class="co">#&gt; Warning in drawDetails.GridGroup(x, recording = FALSE): Group definition failed</span></span>
<span id="cb103-12"><a href="#cb103-12"></a></span>
<span id="cb103-13"><a href="#cb103-13"></a><span class="co">#&gt; Warning in drawDetails.GridGroup(x, recording = FALSE): Group definition failed</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="working_files/figure-html/unnamed-chunk-102-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-88"><img src="working_files/figure-html/unnamed-chunk-102-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    const typesetMath = (el) => {
      if (window.MathJax) {
        // MathJax Typeset
        window.MathJax.typeset([el]);
      } else if (window.katex) {
        // KaTeX Render
        var mathElements = el.getElementsByClassName("math");
        var macros = [];
        for (var i = 0; i < mathElements.length; i++) {
          var texText = mathElements[i].firstChild;
          if (mathElements[i].tagName == "SPAN") {
            window.katex.render(texText.data, mathElements[i], {
              displayMode: mathElements[i].classList.contains('display'),
              throwOnError: false,
              macros: macros,
              fleqn: false
            });
          }
        }
      }
    }
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        typesetMath(container);
        return container.innerHTML
      } else {
        typesetMath(note);
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      typesetMath(note);
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb104" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb104-1"><a href="#cb104-1"></a><span class="co">---</span></span>
<span id="cb104-2"><a href="#cb104-2"></a><span class="an">title:</span><span class="co"> "ggplot2 Tips"</span></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="co">  cache: true</span></span>
<span id="cb104-5"><a href="#cb104-5"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb104-6"><a href="#cb104-6"></a><span class="an">filters:</span></span>
<span id="cb104-7"><a href="#cb104-7"></a><span class="co">   - lightbox</span></span>
<span id="cb104-8"><a href="#cb104-8"></a><span class="an">lightbox:</span><span class="co"> auto</span></span>
<span id="cb104-9"><a href="#cb104-9"></a><span class="co">---</span></span>
<span id="cb104-10"><a href="#cb104-10"></a></span>
<span id="cb104-11"><a href="#cb104-11"></a></span>
<span id="cb104-12"><a href="#cb104-12"></a></span>
<span id="cb104-15"><a href="#cb104-15"></a><span class="in">```{r}</span></span>
<span id="cb104-16"><a href="#cb104-16"></a><span class="co">#| echo: false</span></span>
<span id="cb104-17"><a href="#cb104-17"></a><span class="co">#| warning: false</span></span>
<span id="cb104-18"><a href="#cb104-18"></a><span class="co">#| message: false</span></span>
<span id="cb104-19"><a href="#cb104-19"></a></span>
<span id="cb104-20"><a href="#cb104-20"></a>renv<span class="sc">::</span><span class="fu">activate</span>(here<span class="sc">::</span><span class="fu">here</span>())</span>
<span id="cb104-21"><a href="#cb104-21"></a></span>
<span id="cb104-22"><a href="#cb104-22"></a>cur_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"contents/notes/ggplot2"</span>)</span>
<span id="cb104-23"><a href="#cb104-23"></a></span>
<span id="cb104-24"><a href="#cb104-24"></a></span>
<span id="cb104-25"><a href="#cb104-25"></a>showtext<span class="sc">::</span><span class="fu">showtext_auto</span>()</span>
<span id="cb104-26"><a href="#cb104-26"></a>sysfonts<span class="sc">::</span><span class="fu">font_add_google</span>(<span class="st">"Noto Sans JP"</span>)</span>
<span id="cb104-27"><a href="#cb104-27"></a></span>
<span id="cb104-28"><a href="#cb104-28"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb104-29"><a href="#cb104-29"></a>    tidyverse, </span>
<span id="cb104-30"><a href="#cb104-30"></a>    here, </span>
<span id="cb104-31"><a href="#cb104-31"></a>    showtext,</span>
<span id="cb104-32"><a href="#cb104-32"></a>    ggplot2, </span>
<span id="cb104-33"><a href="#cb104-33"></a>    ggridges,</span>
<span id="cb104-34"><a href="#cb104-34"></a>    cowplot, </span>
<span id="cb104-35"><a href="#cb104-35"></a>    ggsci, </span>
<span id="cb104-36"><a href="#cb104-36"></a>    GGally,</span>
<span id="cb104-37"><a href="#cb104-37"></a>    ggprism,</span>
<span id="cb104-38"><a href="#cb104-38"></a>    palmerpenguins, </span>
<span id="cb104-39"><a href="#cb104-39"></a>    ggalluvial, </span>
<span id="cb104-40"><a href="#cb104-40"></a>    waffle,</span>
<span id="cb104-41"><a href="#cb104-41"></a>    ggokabeito, </span>
<span id="cb104-42"><a href="#cb104-42"></a>    patchwork</span>
<span id="cb104-43"><a href="#cb104-43"></a>)</span>
<span id="cb104-44"><a href="#cb104-44"></a><span class="in">```</span></span>
<span id="cb104-45"><a href="#cb104-45"></a></span>
<span id="cb104-46"><a href="#cb104-46"></a></span>
<span id="cb104-47"><a href="#cb104-47"></a></span>
<span id="cb104-48"><a href="#cb104-48"></a><span class="fu"># Introduction</span></span>
<span id="cb104-49"><a href="#cb104-49"></a></span>
<span id="cb104-50"><a href="#cb104-50"></a>ggplot2を覚えるのは難しいので具体的な描画事例を載せていく。</span>
<span id="cb104-51"><a href="#cb104-51"></a>描画事例はシンプルなものを中心に載せていく。</span>
<span id="cb104-52"><a href="#cb104-52"></a>機能の網羅性は欠ける資料であるが具体例なのでコピペですぐ動かせる内容ではある。</span>
<span id="cb104-53"><a href="#cb104-53"></a></span>
<span id="cb104-54"><a href="#cb104-54"></a>すでに個別のファイルで作成した 事例があるのでそれを移植すること!</span>
<span id="cb104-55"><a href="#cb104-55"></a></span>
<span id="cb104-56"><a href="#cb104-56"></a><span class="fu">## Reference</span></span>
<span id="cb104-57"><a href="#cb104-57"></a></span>
<span id="cb104-58"><a href="#cb104-58"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">ggplot2</span><span class="co">](https://ggplot2.tidyverse.org/index.html)</span></span>
<span id="cb104-59"><a href="#cb104-59"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">rmarkdown</span><span class="co">](https://rstudio.com/wp-content/uploads/2016/11/Rmarkdown-cheatsheet-2.0_ja.pdf)</span></span>
<span id="cb104-60"><a href="#cb104-60"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">ggplot2 extensions</span><span class="co">](https://exts.ggplot2.tidyverse.org/gallery/)</span></span>
<span id="cb104-61"><a href="#cb104-61"></a></span>
<span id="cb104-62"><a href="#cb104-62"></a></span>
<span id="cb104-63"><a href="#cb104-63"></a><span class="fu"># Simple Examples</span></span>
<span id="cb104-64"><a href="#cb104-64"></a></span>
<span id="cb104-65"><a href="#cb104-65"></a><span class="fu">## カーネル密度と経験累積分布関数</span></span>
<span id="cb104-66"><a href="#cb104-66"></a></span>
<span id="cb104-67"><a href="#cb104-67"></a>経験累積分布関数とカーネル密度プロットは常に描画すること.</span>
<span id="cb104-68"><a href="#cb104-68"></a>できればそれを組み合わせて描画すること。</span>
<span id="cb104-69"><a href="#cb104-69"></a>経験累積分布関数はさらに**目的変数の累積分布関数と比較**をすること.</span>
<span id="cb104-70"><a href="#cb104-70"></a></span>
<span id="cb104-73"><a href="#cb104-73"></a><span class="in">```{r}</span></span>
<span id="cb104-74"><a href="#cb104-74"></a>data <span class="ot">&lt;-</span> iris</span>
<span id="cb104-75"><a href="#cb104-75"></a>g_dens <span class="ot">&lt;-</span> </span>
<span id="cb104-76"><a href="#cb104-76"></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb104-77"><a href="#cb104-77"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb104-78"><a href="#cb104-78"></a>    <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"density"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb104-79"><a href="#cb104-79"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb104-80"><a href="#cb104-80"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sepal.Length"</span>, <span class="at">y =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb104-81"><a href="#cb104-81"></a>    <span class="fu">scale_color_aaas</span>()</span>
<span id="cb104-82"><a href="#cb104-82"></a><span class="in">```</span></span>
<span id="cb104-83"><a href="#cb104-83"></a></span>
<span id="cb104-86"><a href="#cb104-86"></a><span class="in">```{r}</span></span>
<span id="cb104-87"><a href="#cb104-87"></a>g_ecdf <span class="ot">&lt;-</span> </span>
<span id="cb104-88"><a href="#cb104-88"></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb104-89"><a href="#cb104-89"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb104-90"><a href="#cb104-90"></a>    <span class="fu">stat_ecdf</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> </span>
<span id="cb104-91"><a href="#cb104-91"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb104-92"><a href="#cb104-92"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sepal.Length"</span>, <span class="at">y =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb104-93"><a href="#cb104-93"></a>    <span class="fu">scale_color_aaas</span>() <span class="sc">+</span></span>
<span id="cb104-94"><a href="#cb104-94"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>)</span>
<span id="cb104-95"><a href="#cb104-95"></a><span class="in">```</span></span>
<span id="cb104-96"><a href="#cb104-96"></a></span>
<span id="cb104-99"><a href="#cb104-99"></a><span class="in">```{r}</span></span>
<span id="cb104-100"><a href="#cb104-100"></a><span class="fu">plot_grid</span>(</span>
<span id="cb104-101"><a href="#cb104-101"></a>    g_dens <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>), </span>
<span id="cb104-102"><a href="#cb104-102"></a>    g_ecdf, </span>
<span id="cb104-103"><a href="#cb104-103"></a>    <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), </span>
<span id="cb104-104"><a href="#cb104-104"></a>    <span class="at">ncol =</span> <span class="dv">1</span>,  </span>
<span id="cb104-105"><a href="#cb104-105"></a>    <span class="at">align =</span> <span class="st">"v"</span>,  <span class="co"># 軸を合わせるのに必要 </span></span>
<span id="cb104-106"><a href="#cb104-106"></a>    <span class="at">axis =</span> <span class="st">"tblr"</span> <span class="co"># 余白を合わせるのに必要(特に凡例があったりなかったりするとき)</span></span>
<span id="cb104-107"><a href="#cb104-107"></a>)</span>
<span id="cb104-108"><a href="#cb104-108"></a><span class="in">```</span></span>
<span id="cb104-109"><a href="#cb104-109"></a></span>
<span id="cb104-110"><a href="#cb104-110"></a><span class="fu">## 関数曲線</span></span>
<span id="cb104-111"><a href="#cb104-111"></a></span>
<span id="cb104-112"><a href="#cb104-112"></a>確率密度関数などを記述するときに使う.</span>
<span id="cb104-113"><a href="#cb104-113"></a></span>
<span id="cb104-116"><a href="#cb104-116"></a><span class="in">```{r}</span></span>
<span id="cb104-117"><a href="#cb104-117"></a>generate_dnorm <span class="ot">&lt;-</span> <span class="cf">function</span> (param) {</span>
<span id="cb104-118"><a href="#cb104-118"></a>    <span class="fu">lift</span>( partial )(</span>
<span id="cb104-119"><a href="#cb104-119"></a>        <span class="fu">update_list</span>(</span>
<span id="cb104-120"><a href="#cb104-120"></a>            param, <span class="at">.f =</span> dnorm, <span class="at">.first =</span> <span class="cn">FALSE</span> )</span>
<span id="cb104-121"><a href="#cb104-121"></a>        )</span>
<span id="cb104-122"><a href="#cb104-122"></a>}</span>
<span id="cb104-123"><a href="#cb104-123"></a></span>
<span id="cb104-124"><a href="#cb104-124"></a>param1 <span class="ot">&lt;-</span></span>
<span id="cb104-125"><a href="#cb104-125"></a>    <span class="fu">list</span>( <span class="at">mean =</span> <span class="fl">1.23</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb104-126"><a href="#cb104-126"></a>    <span class="fu">update_list</span>(</span>
<span id="cb104-127"><a href="#cb104-127"></a>        <span class="at">sd =</span>  <span class="sc">~</span> .<span class="dv">1</span></span>
<span id="cb104-128"><a href="#cb104-128"></a>    )</span>
<span id="cb104-129"><a href="#cb104-129"></a>param2 <span class="ot">&lt;-</span></span>
<span id="cb104-130"><a href="#cb104-130"></a>    param1 <span class="sc">%&gt;%</span></span>
<span id="cb104-131"><a href="#cb104-131"></a>    <span class="fu">update_list</span>(</span>
<span id="cb104-132"><a href="#cb104-132"></a>        <span class="at">mean =</span> <span class="fl">1.48631</span></span>
<span id="cb104-133"><a href="#cb104-133"></a>    )</span>
<span id="cb104-134"><a href="#cb104-134"></a></span>
<span id="cb104-135"><a href="#cb104-135"></a>dnorm1 <span class="ot">&lt;-</span> <span class="fu">generate_dnorm</span>( param1 )</span>
<span id="cb104-136"><a href="#cb104-136"></a>dnorm2 <span class="ot">&lt;-</span> <span class="fu">generate_dnorm</span>( param2 )</span>
<span id="cb104-137"><a href="#cb104-137"></a>fill_poly <span class="ot">&lt;-</span> <span class="fu">data_frame</span>(</span>
<span id="cb104-138"><a href="#cb104-138"></a>        <span class="at">x =</span> <span class="fu">seq</span>(<span class="fu">qnorm</span>(.<span class="dv">9</span>, <span class="at">mean =</span> param1<span class="sc">$</span>mean, <span class="at">sd =</span> param1<span class="sc">$</span>sd), <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">20</span>)</span>
<span id="cb104-139"><a href="#cb104-139"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb104-140"><a href="#cb104-140"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">map_dbl</span>(x, dnorm1))</span>
<span id="cb104-141"><a href="#cb104-141"></a></span>
<span id="cb104-142"><a href="#cb104-142"></a>grh <span class="ot">&lt;-</span></span>
<span id="cb104-143"><a href="#cb104-143"></a>    <span class="fu">data_frame</span>( <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, .<span class="dv">01</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb104-144"><a href="#cb104-144"></a>    <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb104-145"><a href="#cb104-145"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">0</span>, <span class="at">intercept =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb104-146"><a href="#cb104-146"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data =</span> fill_poly, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">ymax =</span> y, <span class="at">ymin =</span> <span class="dv">0</span>), <span class="at">fill =</span> <span class="st">"pink"</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb104-147"><a href="#cb104-147"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm1, <span class="at">colour =</span> <span class="st">"red"</span>,  <span class="at">lwd =</span> <span class="fl">1.2</span> ) <span class="sc">+</span></span>
<span id="cb104-148"><a href="#cb104-148"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm2, <span class="at">colour =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="fl">1.2</span> ) <span class="sc">+</span></span>
<span id="cb104-149"><a href="#cb104-149"></a>    <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb104-150"><a href="#cb104-150"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">0.9</span>, <span class="fl">1.8</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fl">0.9</span>, <span class="fl">1.8</span>, .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb104-151"><a href="#cb104-151"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb104-152"><a href="#cb104-152"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb104-153"><a href="#cb104-153"></a>    <span class="fu">theme</span>(</span>
<span id="cb104-154"><a href="#cb104-154"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-155"><a href="#cb104-155"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-156"><a href="#cb104-156"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-157"><a href="#cb104-157"></a>        <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-158"><a href="#cb104-158"></a>        <span class="at">axis.text.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb104-159"><a href="#cb104-159"></a>    )</span>
<span id="cb104-160"><a href="#cb104-160"></a>grh</span>
<span id="cb104-161"><a href="#cb104-161"></a><span class="in">```</span></span>
<span id="cb104-162"><a href="#cb104-162"></a></span>
<span id="cb104-163"><a href="#cb104-163"></a><span class="fu">## 確率楕円</span></span>
<span id="cb104-164"><a href="#cb104-164"></a></span>
<span id="cb104-165"><a href="#cb104-165"></a>デフォルトでは、2次元t分布の95%確率となる領域を記述してくれる。</span>
<span id="cb104-166"><a href="#cb104-166"></a>つまり、異常値の発見に役立つ.</span>
<span id="cb104-167"><a href="#cb104-167"></a><span class="in">`geom`</span>パラメータを変更することで塗りつぶしを行うこともできるし、</span>
<span id="cb104-168"><a href="#cb104-168"></a>t分布の変わりに正規分布を使うことも可能である.</span>
<span id="cb104-169"><a href="#cb104-169"></a>単純に円を記述することも可能である.</span>
<span id="cb104-170"><a href="#cb104-170"></a></span>
<span id="cb104-173"><a href="#cb104-173"></a><span class="in">```{r}</span></span>
<span id="cb104-174"><a href="#cb104-174"></a>gp <span class="ot">&lt;-</span></span>
<span id="cb104-175"><a href="#cb104-175"></a>    iris <span class="sc">%&gt;%</span> </span>
<span id="cb104-176"><a href="#cb104-176"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb104-177"><a href="#cb104-177"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb104-178"><a href="#cb104-178"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Sepal.Length"</span>, <span class="at">y =</span> <span class="st">"Sepal.Width"</span>) <span class="sc">+</span> </span>
<span id="cb104-179"><a href="#cb104-179"></a>    <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb104-180"><a href="#cb104-180"></a>    <span class="fu">theme</span>(</span>
<span id="cb104-181"><a href="#cb104-181"></a>        <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="st">"mm"</span>), </span>
<span id="cb104-182"><a href="#cb104-182"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)),</span>
<span id="cb104-183"><a href="#cb104-183"></a>        <span class="at">axis.text.x  =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)),</span>
<span id="cb104-184"><a href="#cb104-184"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)), </span>
<span id="cb104-185"><a href="#cb104-185"></a>        <span class="at">axis.text.y  =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">1</span>, <span class="at">unit =</span> <span class="st">"line"</span>)),</span>
<span id="cb104-186"><a href="#cb104-186"></a>        <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="st">"line"</span>)</span>
<span id="cb104-187"><a href="#cb104-187"></a>    ) <span class="sc">+</span> </span>
<span id="cb104-188"><a href="#cb104-188"></a>    <span class="fu">scale_color_viridis_d</span>()</span>
<span id="cb104-189"><a href="#cb104-189"></a></span>
<span id="cb104-190"><a href="#cb104-190"></a>gp <span class="sc">+</span> </span>
<span id="cb104-191"><a href="#cb104-191"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb104-192"><a href="#cb104-192"></a>    <span class="fu">stat_ellipse</span>() <span class="sc">+</span> </span>
<span id="cb104-193"><a href="#cb104-193"></a>    <span class="fu">stat_ellipse</span>(<span class="at">type =</span> <span class="st">"norm"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb104-194"><a href="#cb104-194"></a>    <span class="fu">stat_ellipse</span>(<span class="at">type =</span> <span class="st">"euclid"</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb104-195"><a href="#cb104-195"></a></span>
<span id="cb104-196"><a href="#cb104-196"></a><span class="in">```</span></span>
<span id="cb104-197"><a href="#cb104-197"></a></span>
<span id="cb104-200"><a href="#cb104-200"></a><span class="in">```{r}</span></span>
<span id="cb104-201"><a href="#cb104-201"></a>gp <span class="sc">+</span> </span>
<span id="cb104-202"><a href="#cb104-202"></a>    <span class="fu">stat_ellipse</span>(</span>
<span id="cb104-203"><a href="#cb104-203"></a>        <span class="fu">aes</span>(<span class="at">fill =</span> Species), </span>
<span id="cb104-204"><a href="#cb104-204"></a>        <span class="at">type =</span> <span class="st">"norm"</span>, </span>
<span id="cb104-205"><a href="#cb104-205"></a>        <span class="at">geom =</span> <span class="st">"polygon"</span>, <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">color =</span> <span class="st">"transparent"</span>) <span class="sc">+</span> </span>
<span id="cb104-206"><a href="#cb104-206"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">position =</span> <span class="st">"jitter"</span>) <span class="sc">+</span></span>
<span id="cb104-207"><a href="#cb104-207"></a>    <span class="fu">scale_fill_viridis_d</span>()</span>
<span id="cb104-208"><a href="#cb104-208"></a><span class="in">```</span></span>
<span id="cb104-209"><a href="#cb104-209"></a></span>
<span id="cb104-210"><a href="#cb104-210"></a><span class="fu">## annotate関数</span></span>
<span id="cb104-211"><a href="#cb104-211"></a></span>
<span id="cb104-212"><a href="#cb104-212"></a><span class="fu">### annotate</span></span>
<span id="cb104-213"><a href="#cb104-213"></a></span>
<span id="cb104-214"><a href="#cb104-214"></a>annotate関数ではジオメトリを追加するが、</span>
<span id="cb104-215"><a href="#cb104-215"></a>典型的な<span class="in">`geom function`</span>とは方法がことなり、</span>
<span id="cb104-216"><a href="#cb104-216"></a>ジオメトリの属性はデータフレームの変数ではなく ベクトルで与えらる。</span>
<span id="cb104-217"><a href="#cb104-217"></a>テキストラベルなど小さなアノテーションを追加するとき、</span>
<span id="cb104-218"><a href="#cb104-218"></a>あるいは、データフレームにしたくないデータを持っているときに有用である。</span>
<span id="cb104-219"><a href="#cb104-219"></a></span>
<span id="cb104-222"><a href="#cb104-222"></a><span class="in">```{r}</span></span>
<span id="cb104-223"><a href="#cb104-223"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb104-224"><a href="#cb104-224"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb104-225"><a href="#cb104-225"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"Some text"</span>), </span>
<span id="cb104-226"><a href="#cb104-226"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"Some text"</span>), </span>
<span id="cb104-227"><a href="#cb104-227"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="dv">3</span>, <span class="at">xmax =</span> <span class="fl">4.2</span>, <span class="at">ymin =</span> <span class="dv">12</span>, <span class="at">ymax =</span> <span class="dv">21</span>, <span class="at">alpha =</span> .<span class="dv">2</span>),</span>
<span id="cb104-228"><a href="#cb104-228"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"segment"</span>, <span class="at">x =</span> <span class="fl">2.5</span>, <span class="at">xend =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">15</span>, <span class="at">yend =</span> <span class="dv">25</span>, <span class="at">colour =</span> <span class="st">"blue"</span>),</span>
<span id="cb104-229"><a href="#cb104-229"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"pointrange"</span>, <span class="at">x =</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">ymin =</span> <span class="dv">12</span>, <span class="at">ymax =</span> <span class="dv">28</span>, <span class="at">colour =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.5</span>),</span>
<span id="cb104-230"><a href="#cb104-230"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">20</span><span class="sc">:</span><span class="dv">21</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"my label"</span>, <span class="st">"label 2"</span>)),</span>
<span id="cb104-231"><a href="#cb104-231"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"italic(R) ^ 2 == 0.75"</span>,   <span class="at">parse =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-232"><a href="#cb104-232"></a>    p <span class="sc">+</span> <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"paste(italic(R) ^ 2, </span><span class="sc">\"</span><span class="st"> = .75</span><span class="sc">\"</span><span class="st">)"</span>, <span class="at">parse =</span> <span class="cn">TRUE</span>), </span>
<span id="cb104-233"><a href="#cb104-233"></a>    <span class="at">ncol =</span> <span class="dv">2</span>, </span>
<span id="cb104-234"><a href="#cb104-234"></a>    <span class="at">rel_heights =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb104-235"><a href="#cb104-235"></a>))</span>
<span id="cb104-236"><a href="#cb104-236"></a></span>
<span id="cb104-237"><a href="#cb104-237"></a><span class="in">```</span></span>
<span id="cb104-238"><a href="#cb104-238"></a></span>
<span id="cb104-239"><a href="#cb104-239"></a>なんか頑張ったら、こんなのもかけた。。。</span>
<span id="cb104-240"><a href="#cb104-240"></a>これがあれば特定の範囲のデータについて、分布を記述することが可能となる。</span>
<span id="cb104-241"><a href="#cb104-241"></a>めっちゃこれが便利だというシーンは思い浮かばないけどキレイなグラフを</span>
<span id="cb104-242"><a href="#cb104-242"></a>記述するという意味では良い経験になったと思う.</span>
<span id="cb104-243"><a href="#cb104-243"></a></span>
<span id="cb104-246"><a href="#cb104-246"></a><span class="in">```{r}</span></span>
<span id="cb104-247"><a href="#cb104-247"></a>d  <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>mpg)</span>
<span id="cb104-248"><a href="#cb104-248"></a>d2 <span class="ot">&lt;-</span> <span class="fu">density</span>(mtcars<span class="sc">$</span>wt)</span>
<span id="cb104-249"><a href="#cb104-249"></a>p <span class="sc">+</span> </span>
<span id="cb104-250"><a href="#cb104-250"></a>    <span class="fu">annotate</span>(</span>
<span id="cb104-251"><a href="#cb104-251"></a>        <span class="st">"polygon"</span>,</span>
<span id="cb104-252"><a href="#cb104-252"></a>        <span class="at">x =</span> (<span class="dv">5</span> <span class="sc">-</span> <span class="dv">4</span> <span class="sc">*</span> d<span class="sc">$</span>y), <span class="co"># シフトやスケールが必要</span></span>
<span id="cb104-253"><a href="#cb104-253"></a>        <span class="at">y =</span> d<span class="sc">$</span>x,</span>
<span id="cb104-254"><a href="#cb104-254"></a>        <span class="at">color =</span> <span class="st">"red"</span>, </span>
<span id="cb104-255"><a href="#cb104-255"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span>  </span>
<span id="cb104-256"><a href="#cb104-256"></a>    <span class="fu">annotate</span>(</span>
<span id="cb104-257"><a href="#cb104-257"></a>        <span class="st">"polygon"</span>, </span>
<span id="cb104-258"><a href="#cb104-258"></a>        <span class="at">x =</span> d2<span class="sc">$</span>x, </span>
<span id="cb104-259"><a href="#cb104-259"></a>        <span class="at">y =</span> d2<span class="sc">$</span>y <span class="sc">*</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb104-260"><a href="#cb104-260"></a>        <span class="at">color =</span> <span class="st">"blue"</span>, </span>
<span id="cb104-261"><a href="#cb104-261"></a>        <span class="at">fill =</span> <span class="st">"transparent"</span>)</span>
<span id="cb104-262"><a href="#cb104-262"></a></span>
<span id="cb104-263"><a href="#cb104-263"></a><span class="in">```</span></span>
<span id="cb104-264"><a href="#cb104-264"></a></span>
<span id="cb104-265"><a href="#cb104-265"></a><span class="fu">## annotation</span></span>
<span id="cb104-266"><a href="#cb104-266"></a></span>
<span id="cb104-267"><a href="#cb104-267"></a>すべてのパネルので同じ統計アノテーションとして使う特別な<span class="in">`geom`</span>である。</span>
<span id="cb104-268"><a href="#cb104-268"></a>これらのアノテーションは<span class="in">`scale`</span>には影響を与えない.</span>
<span id="cb104-269"><a href="#cb104-269"></a></span>
<span id="cb104-270"><a href="#cb104-270"></a><span class="fu">### annotation_custom</span></span>
<span id="cb104-271"><a href="#cb104-271"></a></span>
<span id="cb104-272"><a href="#cb104-272"></a>下記の例を見るとなんとなく使い方はわかる.</span>
<span id="cb104-273"><a href="#cb104-273"></a>あとは記述したい絵を考えたうえで、色々と工夫を重ねるのが一番良いと思う.</span>
<span id="cb104-274"><a href="#cb104-274"></a></span>
<span id="cb104-275"><a href="#cb104-275"></a>適当な<span class="in">`Grob`</span>を作成できれば後は勢いで作成できる?</span>
<span id="cb104-276"><a href="#cb104-276"></a></span>
<span id="cb104-277"><a href="#cb104-277"></a>使い方の用途としては，全体を小さく書いておき</span>
<span id="cb104-278"><a href="#cb104-278"></a>メインは全体のうち拡大したい箇所，という方法にして置くのがわかりやすい気がする．</span>
<span id="cb104-279"><a href="#cb104-279"></a></span>
<span id="cb104-282"><a href="#cb104-282"></a><span class="in">```{r}</span></span>
<span id="cb104-283"><a href="#cb104-283"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb104-284"><a href="#cb104-284"></a>    iris <span class="sc">%&gt;%</span> </span>
<span id="cb104-285"><a href="#cb104-285"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb104-286"><a href="#cb104-286"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb104-287"><a href="#cb104-287"></a>    <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>))</span>
<span id="cb104-288"><a href="#cb104-288"></a></span>
<span id="cb104-289"><a href="#cb104-289"></a>g <span class="ot">&lt;-</span></span>
<span id="cb104-290"><a href="#cb104-290"></a>  <span class="fu">ggplotGrob</span>(</span>
<span id="cb104-291"><a href="#cb104-291"></a>      <span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb104-292"><a href="#cb104-292"></a>      <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"density"</span>) <span class="sc">+</span> </span>
<span id="cb104-293"><a href="#cb104-293"></a>      <span class="fu">guides</span>(<span class="at">color =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb104-294"><a href="#cb104-294"></a>      <span class="fu">theme</span>(</span>
<span id="cb104-295"><a href="#cb104-295"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>), </span>
<span id="cb104-296"><a href="#cb104-296"></a>          <span class="at">plot.background  =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"transparent"</span>), </span>
<span id="cb104-297"><a href="#cb104-297"></a>          <span class="at">panel.grid   =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb104-298"><a href="#cb104-298"></a>          <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb104-299"><a href="#cb104-299"></a>          <span class="at">axis.line.y  =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb104-300"><a href="#cb104-300"></a>          <span class="at">axis.text.y  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-301"><a href="#cb104-301"></a>          <span class="at">axis.ticks   =</span> <span class="fu">element_blank</span>()</span>
<span id="cb104-302"><a href="#cb104-302"></a>      ))</span>
<span id="cb104-303"><a href="#cb104-303"></a> </span>
<span id="cb104-304"><a href="#cb104-304"></a>base <span class="sc">+</span> </span>
<span id="cb104-305"><a href="#cb104-305"></a>    <span class="fu">annotation_custom</span>(<span class="at">grob =</span> g, <span class="at">xmin =</span> <span class="dv">6</span>, <span class="at">xmax =</span> <span class="dv">8</span>, <span class="at">ymin =</span> <span class="dv">4</span>, <span class="at">ymax =</span> <span class="dv">5</span>)</span>
<span id="cb104-306"><a href="#cb104-306"></a><span class="in">```</span></span>
<span id="cb104-307"><a href="#cb104-307"></a></span>
<span id="cb104-308"><a href="#cb104-308"></a><span class="fu">### annotation_logticks</span></span>
<span id="cb104-309"><a href="#cb104-309"></a></span>
<span id="cb104-310"><a href="#cb104-310"></a>これではないけどマイナーグリッドにチックを入れる方法として</span>
<span id="cb104-311"><a href="#cb104-311"></a>annotateにgeom =</span>
<span id="cb104-312"><a href="#cb104-312"></a>"segment"を使う<span class="co">[</span><span class="ot">方法</span><span class="co">](https://github.com/janeshdev/r-dataanalysis-tips/wiki/Add-minor-ticks-to-ggplot2)</span>が考えだされていたけど，</span>
<span id="cb104-313"><a href="#cb104-313"></a>正直しんどい気がする．．．．</span>
<span id="cb104-314"><a href="#cb104-314"></a></span>
<span id="cb104-317"><a href="#cb104-317"></a><span class="in">```{r}</span></span>
<span id="cb104-318"><a href="#cb104-318"></a>a <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(msleep, <span class="fu">aes</span>(bodywt, brainwt)) <span class="sc">+</span></span>
<span id="cb104-319"><a href="#cb104-319"></a> <span class="fu">geom_point</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb104-320"><a href="#cb104-320"></a> <span class="fu">scale_x_log10</span>(</span>
<span id="cb104-321"><a href="#cb104-321"></a>   <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">trans_breaks</span>(<span class="st">"log10"</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="sc">^</span>x),</span>
<span id="cb104-322"><a href="#cb104-322"></a>   <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">trans_format</span>(<span class="st">"log10"</span>, scales<span class="sc">::</span><span class="fu">math_format</span>(<span class="dv">10</span><span class="sc">^</span>.x))</span>
<span id="cb104-323"><a href="#cb104-323"></a> ) <span class="sc">+</span></span>
<span id="cb104-324"><a href="#cb104-324"></a> <span class="fu">scale_y_log10</span>(</span>
<span id="cb104-325"><a href="#cb104-325"></a>   <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">trans_breaks</span>(<span class="st">"log10"</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="sc">^</span>x),</span>
<span id="cb104-326"><a href="#cb104-326"></a>   <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">trans_format</span>(<span class="st">"log10"</span>, scales<span class="sc">::</span><span class="fu">math_format</span>(<span class="dv">10</span><span class="sc">^</span>.x))</span>
<span id="cb104-327"><a href="#cb104-327"></a> ) <span class="sc">+</span></span>
<span id="cb104-328"><a href="#cb104-328"></a> <span class="fu">theme_bw</span>()</span>
<span id="cb104-329"><a href="#cb104-329"></a></span>
<span id="cb104-330"><a href="#cb104-330"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb104-331"><a href="#cb104-331"></a>    a <span class="sc">+</span> <span class="fu">annotation_logticks</span>(),               <span class="co"># Default: log ticks on bottom and left</span></span>
<span id="cb104-332"><a href="#cb104-332"></a>    a <span class="sc">+</span> <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">"lr"</span>),   <span class="co"># Log ticks for y, on left and right</span></span>
<span id="cb104-333"><a href="#cb104-333"></a>    a <span class="sc">+</span> <span class="fu">annotation_logticks</span>(<span class="at">sides =</span> <span class="st">"trbl"</span>)  <span class="co"># All four sides</span></span>
<span id="cb104-334"><a href="#cb104-334"></a>))</span>
<span id="cb104-335"><a href="#cb104-335"></a></span>
<span id="cb104-336"><a href="#cb104-336"></a><span class="in">```</span></span>
<span id="cb104-337"><a href="#cb104-337"></a></span>
<span id="cb104-338"><a href="#cb104-338"></a><span class="fu">### annotation_map</span></span>
<span id="cb104-339"><a href="#cb104-339"></a></span>
<span id="cb104-342"><a href="#cb104-342"></a><span class="in">```{r}</span></span>
<span id="cb104-343"><a href="#cb104-343"></a><span class="cf">if</span> (<span class="fu">require</span>(<span class="st">"maps"</span>)) {</span>
<span id="cb104-344"><a href="#cb104-344"></a>usamap <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"state"</span>)</span>
<span id="cb104-345"><a href="#cb104-345"></a></span>
<span id="cb104-346"><a href="#cb104-346"></a>seal.sub <span class="ot">&lt;-</span> <span class="fu">subset</span>(seals, long <span class="sc">&gt;</span> <span class="sc">-</span><span class="dv">130</span> <span class="sc">&amp;</span> lat <span class="sc">&lt;</span> <span class="dv">45</span> <span class="sc">&amp;</span> lat <span class="sc">&gt;</span> <span class="dv">40</span>)</span>
<span id="cb104-347"><a href="#cb104-347"></a><span class="fu">ggplot</span>(seal.sub, <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb104-348"><a href="#cb104-348"></a>  <span class="fu">annotation_map</span>(usamap, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb104-349"><a href="#cb104-349"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> long <span class="sc">+</span> delta_long, <span class="at">yend =</span> lat <span class="sc">+</span> delta_lat))</span>
<span id="cb104-350"><a href="#cb104-350"></a>}</span>
<span id="cb104-351"><a href="#cb104-351"></a></span>
<span id="cb104-352"><a href="#cb104-352"></a><span class="in">```</span></span>
<span id="cb104-353"><a href="#cb104-353"></a></span>
<span id="cb104-356"><a href="#cb104-356"></a><span class="in">```{r}</span></span>
<span id="cb104-357"><a href="#cb104-357"></a><span class="cf">if</span> (<span class="fu">require</span>(<span class="st">"maps"</span>)) {</span>
<span id="cb104-358"><a href="#cb104-358"></a>seal2 <span class="ot">&lt;-</span> <span class="fu">transform</span>(seal.sub,</span>
<span id="cb104-359"><a href="#cb104-359"></a>  <span class="at">latr =</span> <span class="fu">cut</span>(lat, <span class="dv">2</span>),</span>
<span id="cb104-360"><a href="#cb104-360"></a>  <span class="at">longr =</span> <span class="fu">cut</span>(long, <span class="dv">2</span>))</span>
<span id="cb104-361"><a href="#cb104-361"></a></span>
<span id="cb104-362"><a href="#cb104-362"></a><span class="fu">ggplot</span>(seal2,  <span class="fu">aes</span>(<span class="at">x =</span> long, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb104-363"><a href="#cb104-363"></a>  <span class="fu">annotation_map</span>(usamap, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">colour =</span> <span class="st">"grey50"</span>) <span class="sc">+</span></span>
<span id="cb104-364"><a href="#cb104-364"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> long <span class="sc">+</span> delta_long, <span class="at">yend =</span> lat <span class="sc">+</span> delta_lat)) <span class="sc">+</span></span>
<span id="cb104-365"><a href="#cb104-365"></a>  <span class="fu">facet_grid</span>(latr <span class="sc">~</span> longr, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">space =</span> <span class="st">"free"</span>)</span>
<span id="cb104-366"><a href="#cb104-366"></a>}</span>
<span id="cb104-367"><a href="#cb104-367"></a></span>
<span id="cb104-368"><a href="#cb104-368"></a><span class="in">```</span></span>
<span id="cb104-369"><a href="#cb104-369"></a></span>
<span id="cb104-370"><a href="#cb104-370"></a><span class="fu">### annotation_raster</span></span>
<span id="cb104-371"><a href="#cb104-371"></a></span>
<span id="cb104-372"><a href="#cb104-372"></a>画像を読み込めば画像も行ける？ 16進数の色に変換しておけば良いのか?</span>
<span id="cb104-373"><a href="#cb104-373"></a></span>
<span id="cb104-376"><a href="#cb104-376"></a><span class="in">```{r}</span></span>
<span id="cb104-377"><a href="#cb104-377"></a><span class="co"># Generate data</span></span>
<span id="cb104-378"><a href="#cb104-378"></a>rainbow <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">hcl</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">360</span>, <span class="at">length.out =</span> <span class="dv">50</span> <span class="sc">*</span> <span class="dv">50</span>), <span class="dv">80</span>, <span class="dv">70</span>), <span class="at">nrow =</span> <span class="dv">50</span>)</span>
<span id="cb104-379"><a href="#cb104-379"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb104-380"><a href="#cb104-380"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb104-381"><a href="#cb104-381"></a>  <span class="fu">annotation_raster</span>(rainbow, <span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">3</span>, <span class="dv">4</span>)</span>
<span id="cb104-382"><a href="#cb104-382"></a><span class="in">```</span></span>
<span id="cb104-383"><a href="#cb104-383"></a></span>
<span id="cb104-386"><a href="#cb104-386"></a><span class="in">```{r}</span></span>
<span id="cb104-387"><a href="#cb104-387"></a><span class="co"># To fill up whole plot</span></span>
<span id="cb104-388"><a href="#cb104-388"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb104-389"><a href="#cb104-389"></a>  <span class="fu">annotation_raster</span>(rainbow, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb104-390"><a href="#cb104-390"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb104-391"><a href="#cb104-391"></a><span class="in">```</span></span>
<span id="cb104-392"><a href="#cb104-392"></a></span>
<span id="cb104-395"><a href="#cb104-395"></a><span class="in">```{r}</span></span>
<span id="cb104-396"><a href="#cb104-396"></a>rainbow2 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">hcl</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">360</span>, <span class="at">length.out =</span> <span class="dv">10</span>), <span class="dv">80</span>, <span class="dv">70</span>), <span class="at">nrow =</span> <span class="dv">1</span>)</span>
<span id="cb104-397"><a href="#cb104-397"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb104-398"><a href="#cb104-398"></a>  <span class="fu">annotation_raster</span>(rainbow2, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>, <span class="sc">-</span><span class="cn">Inf</span>, <span class="cn">Inf</span>) <span class="sc">+</span></span>
<span id="cb104-399"><a href="#cb104-399"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb104-400"><a href="#cb104-400"></a><span class="in">```</span></span>
<span id="cb104-401"><a href="#cb104-401"></a></span>
<span id="cb104-404"><a href="#cb104-404"></a><span class="in">```{r}</span></span>
<span id="cb104-405"><a href="#cb104-405"></a><span class="fu">library</span>(png)</span>
<span id="cb104-406"><a href="#cb104-406"></a><span class="fu">library</span>(grid)</span>
<span id="cb104-407"><a href="#cb104-407"></a>img <span class="ot">&lt;-</span> <span class="fu">readPNG</span>(<span class="fu">system.file</span>(<span class="st">"img"</span>, <span class="st">"Rlogo.png"</span>, <span class="at">package =</span> <span class="st">"png"</span>))</span>
<span id="cb104-408"><a href="#cb104-408"></a>g   <span class="ot">&lt;-</span> <span class="fu">rasterGrob</span>(img, <span class="at">interpolate =</span> <span class="cn">TRUE</span>)</span>
<span id="cb104-409"><a href="#cb104-409"></a><span class="fu">qplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">geom =</span> <span class="st">"blank"</span>) <span class="sc">+</span> </span>
<span id="cb104-410"><a href="#cb104-410"></a>    <span class="fu">annotation_custom</span>(g, <span class="at">xmin =</span> <span class="dv">1</span>, <span class="at">xmax =</span> <span class="dv">5</span>, <span class="at">ymin =</span> <span class="dv">1</span>, <span class="at">ymax =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb104-411"><a href="#cb104-411"></a>    <span class="fu">geom_point</span>()</span>
<span id="cb104-412"><a href="#cb104-412"></a></span>
<span id="cb104-413"><a href="#cb104-413"></a><span class="in">```</span></span>
<span id="cb104-414"><a href="#cb104-414"></a></span>
<span id="cb104-415"><a href="#cb104-415"></a><span class="fu">## 凡例のハンドリング</span></span>
<span id="cb104-416"><a href="#cb104-416"></a></span>
<span id="cb104-417"><a href="#cb104-417"></a></span>
<span id="cb104-418"><a href="#cb104-418"></a>凡例の操作は難しい... とりあえず、次を操作できるようになりたい.</span>
<span id="cb104-419"><a href="#cb104-419"></a></span>
<span id="cb104-420"><a href="#cb104-420"></a><span class="ss">-   </span>凡例の出し入れ</span>
<span id="cb104-421"><a href="#cb104-421"></a><span class="ss">-   </span>凡例の位置(panelの中か外か)</span>
<span id="cb104-422"><a href="#cb104-422"></a><span class="ss">-   </span>凡例のタイトル</span>
<span id="cb104-423"><a href="#cb104-423"></a><span class="ss">-   </span>凡例のキーの操作</span>
<span id="cb104-424"><a href="#cb104-424"></a><span class="ss">-   </span>凡例の文字列</span>
<span id="cb104-425"><a href="#cb104-425"></a></span>
<span id="cb104-426"><a href="#cb104-426"></a>まずは複数の凡例の順序と凡例自体の位置を制御する例.</span>
<span id="cb104-427"><a href="#cb104-427"></a><span class="in">`theme`</span>で見た目を整える事もできるけど, <span class="in">`guides(guide_legend)`</span>でも</span>
<span id="cb104-428"><a href="#cb104-428"></a>大概見た目を加工することができる. 以下の例では</span>
<span id="cb104-429"><a href="#cb104-429"></a>標準的な出力に加えて、凡例を色々と操作してみた状態のプロット。</span>
<span id="cb104-430"><a href="#cb104-430"></a></span>
<span id="cb104-433"><a href="#cb104-433"></a><span class="in">```{r}</span></span>
<span id="cb104-434"><a href="#cb104-434"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb104-435"><a href="#cb104-435"></a>  <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, cty)) <span class="sc">+</span></span>
<span id="cb104-436"><a href="#cb104-436"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> hwy, <span class="at">colour =</span> cyl, <span class="at">shape =</span> drv)) <span class="sc">+</span> </span>
<span id="cb104-437"><a href="#cb104-437"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb104-438"><a href="#cb104-438"></a></span>
<span id="cb104-439"><a href="#cb104-439"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb104-440"><a href="#cb104-440"></a>  base, </span>
<span id="cb104-441"><a href="#cb104-441"></a>  base <span class="sc">+</span> <span class="fu">guides</span>(</span>
<span id="cb104-442"><a href="#cb104-442"></a>   <span class="at">colour =</span> <span class="fu">guide_colourbar</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">draw.llim =</span> <span class="cn">FALSE</span>),</span>
<span id="cb104-443"><a href="#cb104-443"></a>   <span class="at">shape  =</span> <span class="fu">guide_legend</span>(<span class="at">order =</span> <span class="dv">2</span>),</span>
<span id="cb104-444"><a href="#cb104-444"></a>   <span class="at">size   =</span> <span class="fu">guide_legend</span>(</span>
<span id="cb104-445"><a href="#cb104-445"></a>     <span class="at">order =</span> <span class="dv">3</span>, </span>
<span id="cb104-446"><a href="#cb104-446"></a>     <span class="at">title =</span> <span class="st">"MyWay"</span>, </span>
<span id="cb104-447"><a href="#cb104-447"></a>     <span class="at">keywidth =</span> <span class="fu">unit</span>(<span class="dv">2</span>, <span class="st">"cm"</span>),</span>
<span id="cb104-448"><a href="#cb104-448"></a>     <span class="at">reverse =</span> <span class="dv">1</span>, </span>
<span id="cb104-449"><a href="#cb104-449"></a>     <span class="at">title.position =</span> <span class="st">"top"</span>, <span class="co"># or bottom, left, right</span></span>
<span id="cb104-450"><a href="#cb104-450"></a>     <span class="at">title.theme =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">face =</span> <span class="st">"italic"</span>), </span>
<span id="cb104-451"><a href="#cb104-451"></a>     <span class="at">title.hjust =</span> <span class="dv">1</span>, </span>
<span id="cb104-452"><a href="#cb104-452"></a>     <span class="at">label.theme =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>),</span>
<span id="cb104-453"><a href="#cb104-453"></a>     <span class="at">direction =</span> <span class="st">"vertical"</span></span>
<span id="cb104-454"><a href="#cb104-454"></a>    )</span>
<span id="cb104-455"><a href="#cb104-455"></a> ), </span>
<span id="cb104-456"><a href="#cb104-456"></a> <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb104-457"><a href="#cb104-457"></a>))</span>
<span id="cb104-458"><a href="#cb104-458"></a></span>
<span id="cb104-459"><a href="#cb104-459"></a></span>
<span id="cb104-460"><a href="#cb104-460"></a><span class="in">```</span></span>
<span id="cb104-461"><a href="#cb104-461"></a></span>
<span id="cb104-462"><a href="#cb104-462"></a>カラーバーなどでの操作を細かく行うための使い方。</span>
<span id="cb104-463"><a href="#cb104-463"></a>guidesとかlegendとかではないけど、一応凡例が操作されているといいうことで.</span>
<span id="cb104-464"><a href="#cb104-464"></a>これってスゴい便利なのでは？</span>
<span id="cb104-465"><a href="#cb104-465"></a>例えば普通の連続値の場合には<span class="in">`scale_fill_continuous`</span>を使う.</span>
<span id="cb104-466"><a href="#cb104-466"></a></span>
<span id="cb104-469"><a href="#cb104-469"></a><span class="in">```{r}</span></span>
<span id="cb104-470"><a href="#cb104-470"></a>df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">X1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">X2 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb104-471"><a href="#cb104-471"></a>df<span class="sc">$</span>value <span class="ot">&lt;-</span> df<span class="sc">$</span>X1 <span class="sc">*</span> df<span class="sc">$</span>X2</span>
<span id="cb104-472"><a href="#cb104-472"></a></span>
<span id="cb104-473"><a href="#cb104-473"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(X1, X2)) <span class="sc">+</span> <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> value)) <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">coord_equal</span>()</span>
<span id="cb104-474"><a href="#cb104-474"></a></span>
<span id="cb104-475"><a href="#cb104-475"></a><span class="co"># Coloursteps guide is the default for binned colour scales</span></span>
<span id="cb104-476"><a href="#cb104-476"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb104-477"><a href="#cb104-477"></a>  p , </span>
<span id="cb104-478"><a href="#cb104-478"></a>  p <span class="sc">+</span> </span>
<span id="cb104-479"><a href="#cb104-479"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">lty =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb104-480"><a href="#cb104-480"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">lty =</span> <span class="dv">2</span>),</span>
<span id="cb104-481"><a href="#cb104-481"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(), </span>
<span id="cb104-482"><a href="#cb104-482"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>)), </span>
<span id="cb104-483"><a href="#cb104-483"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">50</span>), <span class="at">guide =</span> <span class="fu">guide_coloursteps</span>(<span class="at">even.steps =</span> <span class="cn">FALSE</span>)), </span>
<span id="cb104-484"><a href="#cb104-484"></a>  p <span class="sc">+</span> <span class="fu">scale_fill_binned</span>(<span class="at">show.limits =</span> <span class="cn">TRUE</span>),</span>
<span id="cb104-485"><a href="#cb104-485"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb104-486"><a href="#cb104-486"></a>))</span>
<span id="cb104-487"><a href="#cb104-487"></a></span>
<span id="cb104-488"><a href="#cb104-488"></a><span class="in">```</span></span>
<span id="cb104-489"><a href="#cb104-489"></a></span>
<span id="cb104-490"><a href="#cb104-490"></a>凡例をpanelの中に記述する場合の書き方は次の通り.</span>
<span id="cb104-491"><a href="#cb104-491"></a></span>
<span id="cb104-494"><a href="#cb104-494"></a><span class="in">```{r}</span></span>
<span id="cb104-495"><a href="#cb104-495"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">z =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>))</span>
<span id="cb104-496"><a href="#cb104-496"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb104-497"><a href="#cb104-497"></a>  df <span class="sc">%&gt;%</span></span>
<span id="cb104-498"><a href="#cb104-498"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> z), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb104-499"><a href="#cb104-499"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb104-500"><a href="#cb104-500"></a></span>
<span id="cb104-501"><a href="#cb104-501"></a><span class="fu">lift</span>(plot_grid)(<span class="fu">list</span>(</span>
<span id="cb104-502"><a href="#cb104-502"></a>  base, </span>
<span id="cb104-503"><a href="#cb104-503"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb104-504"><a href="#cb104-504"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),       <span class="co"># アンカーの相対座標</span></span>
<span id="cb104-505"><a href="#cb104-505"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), <span class="co"># アンカーの相対座標と紐付ける凡例の相対座標</span></span>
<span id="cb104-506"><a href="#cb104-506"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb104-507"><a href="#cb104-507"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), </span>
<span id="cb104-508"><a href="#cb104-508"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>)),</span>
<span id="cb104-509"><a href="#cb104-509"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb104-510"><a href="#cb104-510"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>), </span>
<span id="cb104-511"><a href="#cb104-511"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)), </span>
<span id="cb104-512"><a href="#cb104-512"></a>  base <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb104-513"><a href="#cb104-513"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb104-514"><a href="#cb104-514"></a>    <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb104-515"><a href="#cb104-515"></a>  ), </span>
<span id="cb104-516"><a href="#cb104-516"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb104-517"><a href="#cb104-517"></a>))</span>
<span id="cb104-518"><a href="#cb104-518"></a><span class="in">```</span></span>
<span id="cb104-519"><a href="#cb104-519"></a></span>
<span id="cb104-520"><a href="#cb104-520"></a>マニュアルで凡例を作成する. <span class="co">[</span><span class="ot">ここ</span><span class="co">](https://community.rstudio.com/t/adding-manual-legend-to-ggplot2/41651)</span>を参考にした.</span>
<span id="cb104-521"><a href="#cb104-521"></a>これはしっくりするやり方だと思う. </span>
<span id="cb104-522"><a href="#cb104-522"></a></span>
<span id="cb104-523"><a href="#cb104-523"></a></span>
<span id="cb104-526"><a href="#cb104-526"></a><span class="in">```{r}</span></span>
<span id="cb104-527"><a href="#cb104-527"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Sepal Width"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"Petal Length"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Petal Width"</span> <span class="ot">=</span> <span class="st">"orange"</span>)</span>
<span id="cb104-528"><a href="#cb104-528"></a></span>
<span id="cb104-529"><a href="#cb104-529"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length)) <span class="sc">+</span></span>
<span id="cb104-530"><a href="#cb104-530"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Sepal.Width, <span class="at">color =</span> <span class="st">"Sepal Width"</span>), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb104-531"><a href="#cb104-531"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Petal.Length, <span class="at">color =</span> <span class="st">"Petal Length"</span>), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb104-532"><a href="#cb104-532"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Petal.Width, <span class="at">color =</span> <span class="st">"Petal Width"</span>), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb104-533"><a href="#cb104-533"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb104-534"><a href="#cb104-534"></a>         <span class="at">y =</span> <span class="st">"(%)"</span>,</span>
<span id="cb104-535"><a href="#cb104-535"></a>         <span class="at">color =</span> <span class="st">"Legend"</span>) <span class="sc">+</span></span>
<span id="cb104-536"><a href="#cb104-536"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors)</span>
<span id="cb104-537"><a href="#cb104-537"></a><span class="in">```</span></span>
<span id="cb104-538"><a href="#cb104-538"></a></span>
<span id="cb104-539"><a href="#cb104-539"></a></span>
<span id="cb104-540"><a href="#cb104-540"></a>凡例を消したい場合の対処方法. <span class="co">[</span><span class="ot">ここ</span><span class="co">](https://www.datanovia.com/en/blog/how-to-remove-legend-from-a-ggplot/)</span>を参考にしている. </span>
<span id="cb104-541"><a href="#cb104-541"></a></span>
<span id="cb104-544"><a href="#cb104-544"></a><span class="in">```{r}</span></span>
<span id="cb104-545"><a href="#cb104-545"></a><span class="co"># レイヤー単位で指定</span></span>
<span id="cb104-546"><a href="#cb104-546"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb104-547"><a href="#cb104-547"></a>  <span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> len))<span class="sc">+</span> </span>
<span id="cb104-548"><a href="#cb104-548"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> dose), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb104-549"><a href="#cb104-549"></a>  <span class="fu">scale_fill_viridis_d</span>()</span>
<span id="cb104-550"><a href="#cb104-550"></a>p</span>
<span id="cb104-551"><a href="#cb104-551"></a><span class="in">```</span></span>
<span id="cb104-552"><a href="#cb104-552"></a></span>
<span id="cb104-553"><a href="#cb104-553"></a></span>
<span id="cb104-556"><a href="#cb104-556"></a><span class="in">```{r}</span></span>
<span id="cb104-557"><a href="#cb104-557"></a><span class="co"># グラフを作成してから指定</span></span>
<span id="cb104-558"><a href="#cb104-558"></a>p <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb104-559"><a href="#cb104-559"></a><span class="in">```</span></span>
<span id="cb104-560"><a href="#cb104-560"></a></span>
<span id="cb104-561"><a href="#cb104-561"></a></span>
<span id="cb104-564"><a href="#cb104-564"></a><span class="in">```{r}</span></span>
<span id="cb104-565"><a href="#cb104-565"></a><span class="co"># 特定の軸に対して処理をしたい場合の指定</span></span>
<span id="cb104-566"><a href="#cb104-566"></a>mtcars<span class="sc">$</span>cyl<span class="ot">&lt;-</span><span class="fu">as.factor</span>(mtcars<span class="sc">$</span>cyl)</span>
<span id="cb104-567"><a href="#cb104-567"></a>mtcars<span class="sc">$</span>gear <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(mtcars<span class="sc">$</span>gear)</span>
<span id="cb104-568"><a href="#cb104-568"></a></span>
<span id="cb104-569"><a href="#cb104-569"></a><span class="co"># Scatter plot</span></span>
<span id="cb104-570"><a href="#cb104-570"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> mtcars, <span class="fu">aes</span>(<span class="at">x =</span> mpg, <span class="at">y =</span> wt))<span class="sc">+</span></span>
<span id="cb104-571"><a href="#cb104-571"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> cyl, <span class="at">size =</span> qsec, <span class="at">shape =</span> gear)) <span class="sc">+</span></span>
<span id="cb104-572"><a href="#cb104-572"></a>  <span class="fu">scale_color_viridis_d</span>()</span>
<span id="cb104-573"><a href="#cb104-573"></a>p2</span>
<span id="cb104-574"><a href="#cb104-574"></a><span class="in">```</span></span>
<span id="cb104-575"><a href="#cb104-575"></a></span>
<span id="cb104-578"><a href="#cb104-578"></a><span class="in">```{r}</span></span>
<span id="cb104-579"><a href="#cb104-579"></a>p2 <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="st">"none"</span>, <span class="at">size =</span> <span class="st">"none"</span>)</span>
<span id="cb104-580"><a href="#cb104-580"></a><span class="in">```</span></span>
<span id="cb104-581"><a href="#cb104-581"></a></span>
<span id="cb104-582"><a href="#cb104-582"></a></span>
<span id="cb104-583"><a href="#cb104-583"></a><span class="fu">### 文字や位置を微調整したい</span></span>
<span id="cb104-584"><a href="#cb104-584"></a></span>
<span id="cb104-585"><a href="#cb104-585"></a><span class="co">[</span><span class="ot">stackoverflow</span><span class="co">](https://stackoverflow.com/questions/11366964/is-there-a-way-to-change-the-spacing-between-legend-items-in-ggplot2)</span>が参考になる. </span>
<span id="cb104-586"><a href="#cb104-586"></a></span>
<span id="cb104-587"><a href="#cb104-587"></a>水平方向に調整する. </span>
<span id="cb104-588"><a href="#cb104-588"></a></span>
<span id="cb104-591"><a href="#cb104-591"></a><span class="in">```{r}</span></span>
<span id="cb104-592"><a href="#cb104-592"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-593"><a href="#cb104-593"></a></span>
<span id="cb104-594"><a href="#cb104-594"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="fu">factor</span>(cyl), <span class="at">fill =</span> <span class="fu">factor</span>(cyl))) <span class="sc">+</span> </span>
<span id="cb104-595"><a href="#cb104-595"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb104-596"><a href="#cb104-596"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb104-597"><a href="#cb104-597"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"Cyl"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb104-598"><a href="#cb104-598"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb104-599"><a href="#cb104-599"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'top'</span>, </span>
<span id="cb104-600"><a href="#cb104-600"></a>        <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">1.0</span>, <span class="st">'cm'</span>))</span>
<span id="cb104-601"><a href="#cb104-601"></a><span class="in">```</span></span>
<span id="cb104-602"><a href="#cb104-602"></a></span>
<span id="cb104-603"><a href="#cb104-603"></a>鉛直方向に調整する. </span>
<span id="cb104-604"><a href="#cb104-604"></a></span>
<span id="cb104-607"><a href="#cb104-607"></a><span class="in">```{r}</span></span>
<span id="cb104-608"><a href="#cb104-608"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-609"><a href="#cb104-609"></a></span>
<span id="cb104-610"><a href="#cb104-610"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(cyl), <span class="at">fill =</span> <span class="fu">factor</span>(cyl))) <span class="sc">+</span> </span>
<span id="cb104-611"><a href="#cb104-611"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb104-612"><a href="#cb104-612"></a>  <span class="fu">theme</span>(<span class="at">legend.spacing.y =</span> <span class="fu">unit</span>(<span class="fl">1.0</span>, <span class="st">'cm'</span>))  <span class="sc">+</span></span>
<span id="cb104-613"><a href="#cb104-613"></a>  <span class="do">## important additional element</span></span>
<span id="cb104-614"><a href="#cb104-614"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb104-615"><a href="#cb104-615"></a><span class="in">```</span></span>
<span id="cb104-616"><a href="#cb104-616"></a></span>
<span id="cb104-617"><a href="#cb104-617"></a></span>
<span id="cb104-618"><a href="#cb104-618"></a>カラーバーなどは個別に微調整するみたい. </span>
<span id="cb104-619"><a href="#cb104-619"></a>バーの長さも自分で調整ができる見たい. </span>
<span id="cb104-620"><a href="#cb104-620"></a></span>
<span id="cb104-621"><a href="#cb104-621"></a></span>
<span id="cb104-624"><a href="#cb104-624"></a><span class="in">```{r}</span></span>
<span id="cb104-625"><a href="#cb104-625"></a><span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(mpg, wt)) <span class="sc">+</span></span>
<span id="cb104-626"><a href="#cb104-626"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> hp), <span class="at">pch =</span> <span class="fu">I</span>(<span class="dv">21</span>), <span class="at">size =</span> <span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb104-627"><a href="#cb104-627"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb104-628"><a href="#cb104-628"></a>  <span class="fu">theme_classic</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb104-629"><a href="#cb104-629"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">'top'</span>, </span>
<span id="cb104-630"><a href="#cb104-630"></a>        <span class="at">legend.spacing.x =</span> <span class="fu">unit</span>(<span class="fl">0.5</span>, <span class="st">'cm'</span>),</span>
<span id="cb104-631"><a href="#cb104-631"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">10</span>))) <span class="sc">+</span></span>
<span id="cb104-632"><a href="#cb104-632"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title =</span> <span class="st">"HP"</span>,</span>
<span id="cb104-633"><a href="#cb104-633"></a>                               <span class="at">label.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb104-634"><a href="#cb104-634"></a>                               <span class="at">title.position =</span> <span class="st">"left"</span>, <span class="at">title.vjust =</span> <span class="dv">1</span>,</span>
<span id="cb104-635"><a href="#cb104-635"></a>                               <span class="co"># draw border around the legend</span></span>
<span id="cb104-636"><a href="#cb104-636"></a>                               <span class="at">frame.colour =</span> <span class="st">"black"</span>,</span>
<span id="cb104-637"><a href="#cb104-637"></a>                               <span class="at">barwidth =</span> <span class="dv">25</span>,</span>
<span id="cb104-638"><a href="#cb104-638"></a>                               <span class="at">barheight =</span> <span class="dv">2</span>)) </span>
<span id="cb104-639"><a href="#cb104-639"></a><span class="in">```</span></span>
<span id="cb104-640"><a href="#cb104-640"></a></span>
<span id="cb104-643"><a href="#cb104-643"></a><span class="in">```{r}</span></span>
<span id="cb104-644"><a href="#cb104-644"></a><span class="fu">ggplot</span>(mtcars) <span class="sc">+</span></span>
<span id="cb104-645"><a href="#cb104-645"></a>  <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">fill =</span> <span class="fu">factor</span>(cyl)) <span class="sc">+</span></span>
<span id="cb104-646"><a href="#cb104-646"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb104-647"><a href="#cb104-647"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"Cyl"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb104-648"><a href="#cb104-648"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb104-649"><a href="#cb104-649"></a>  <span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>))</span>
<span id="cb104-650"><a href="#cb104-650"></a></span>
<span id="cb104-651"><a href="#cb104-651"></a><span class="in">```</span></span>
<span id="cb104-652"><a href="#cb104-652"></a></span>
<span id="cb104-655"><a href="#cb104-655"></a><span class="in">```{r}</span></span>
<span id="cb104-656"><a href="#cb104-656"></a>draw_key_polygon3 <span class="ot">&lt;-</span> <span class="cf">function</span>(data, params, size) {</span>
<span id="cb104-657"><a href="#cb104-657"></a>  lwd <span class="ot">&lt;-</span> <span class="fu">min</span>(data<span class="sc">$</span>size, <span class="fu">min</span>(size) <span class="sc">/</span> <span class="dv">4</span>)</span>
<span id="cb104-658"><a href="#cb104-658"></a>  </span>
<span id="cb104-659"><a href="#cb104-659"></a>  grid<span class="sc">::</span><span class="fu">rectGrob</span>(</span>
<span id="cb104-660"><a href="#cb104-660"></a>    <span class="at">width =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">"npc"</span>),</span>
<span id="cb104-661"><a href="#cb104-661"></a>    <span class="at">height =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fl">0.6</span>, <span class="st">"npc"</span>),</span>
<span id="cb104-662"><a href="#cb104-662"></a>    <span class="at">gp =</span> grid<span class="sc">::</span><span class="fu">gpar</span>(</span>
<span id="cb104-663"><a href="#cb104-663"></a>      <span class="at">col =</span> data<span class="sc">$</span>colour,</span>
<span id="cb104-664"><a href="#cb104-664"></a>      <span class="at">fill =</span> <span class="fu">alpha</span>(data<span class="sc">$</span>fill, data<span class="sc">$</span>alpha),</span>
<span id="cb104-665"><a href="#cb104-665"></a>      <span class="at">lty =</span> data<span class="sc">$</span>linetype,</span>
<span id="cb104-666"><a href="#cb104-666"></a>      <span class="at">lwd =</span> lwd <span class="sc">*</span> .pt,</span>
<span id="cb104-667"><a href="#cb104-667"></a>      <span class="at">linejoin =</span> <span class="st">"mitre"</span></span>
<span id="cb104-668"><a href="#cb104-668"></a>    ))</span>
<span id="cb104-669"><a href="#cb104-669"></a>}</span>
<span id="cb104-670"><a href="#cb104-670"></a></span>
<span id="cb104-671"><a href="#cb104-671"></a><span class="do">### this step is not needed anymore per tjebo's comment below</span></span>
<span id="cb104-672"><a href="#cb104-672"></a><span class="do">### see also: https://ggplot2.tidyverse.org/reference/draw_key.html</span></span>
<span id="cb104-673"><a href="#cb104-673"></a><span class="co"># register new key drawing function, </span></span>
<span id="cb104-674"><a href="#cb104-674"></a><span class="co"># the effect is global &amp; persistent throughout the R session</span></span>
<span id="cb104-675"><a href="#cb104-675"></a><span class="co"># GeomBar$draw_key = draw_key_polygon3</span></span>
<span id="cb104-676"><a href="#cb104-676"></a></span>
<span id="cb104-677"><a href="#cb104-677"></a><span class="fu">ggplot</span>(mtcars) <span class="sc">+</span></span>
<span id="cb104-678"><a href="#cb104-678"></a>  <span class="fu">aes</span>(<span class="at">x =</span> cyl, <span class="at">fill =</span> <span class="fu">factor</span>(cyl)) <span class="sc">+</span></span>
<span id="cb104-679"><a href="#cb104-679"></a>  <span class="fu">geom_bar</span>(<span class="at">key_glyph =</span> <span class="st">"polygon3"</span>) <span class="sc">+</span></span>
<span id="cb104-680"><a href="#cb104-680"></a>  <span class="fu">scale_fill_brewer</span>(<span class="st">"Cyl"</span>, <span class="at">palette =</span> <span class="st">"Dark2"</span>) <span class="sc">+</span></span>
<span id="cb104-681"><a href="#cb104-681"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb104-682"><a href="#cb104-682"></a>  <span class="fu">theme</span>(<span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="cn">NA</span>, <span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb104-683"><a href="#cb104-683"></a>        <span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"cm"</span>)) <span class="sc">+</span></span>
<span id="cb104-684"><a href="#cb104-684"></a>  <span class="fu">theme</span>(<span class="at">legend.title.align =</span> <span class="fl">0.5</span>)</span>
<span id="cb104-685"><a href="#cb104-685"></a><span class="in">```</span></span>
<span id="cb104-686"><a href="#cb104-686"></a></span>
<span id="cb104-687"><a href="#cb104-687"></a></span>
<span id="cb104-688"><a href="#cb104-688"></a></span>
<span id="cb104-689"><a href="#cb104-689"></a></span>
<span id="cb104-690"><a href="#cb104-690"></a></span>
<span id="cb104-691"><a href="#cb104-691"></a></span>
<span id="cb104-692"><a href="#cb104-692"></a><span class="fu">## テキスト</span></span>
<span id="cb104-693"><a href="#cb104-693"></a></span>
<span id="cb104-694"><a href="#cb104-694"></a><span class="fu">### hjust/vjusts</span></span>
<span id="cb104-695"><a href="#cb104-695"></a></span>
<span id="cb104-696"><a href="#cb104-696"></a>凡例の位置設定と同じ考え方が，どうやらテキストも同様の考え方で対応でてきる気がする.</span>
<span id="cb104-697"><a href="#cb104-697"></a>これをみると、ラベルの左下が(0, 0)で、右上が(1, 1)となっている.</span>
<span id="cb104-698"><a href="#cb104-698"></a>ラベルの右端を点xに合わせたい場合には、hjust=1に調整するなど下のものを</span>
<span id="cb104-699"><a href="#cb104-699"></a>参考としてもらいたい.</span>
<span id="cb104-700"><a href="#cb104-700"></a></span>
<span id="cb104-703"><a href="#cb104-703"></a><span class="in">```{r}</span></span>
<span id="cb104-704"><a href="#cb104-704"></a>d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb104-705"><a href="#cb104-705"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">3</span>), </span>
<span id="cb104-706"><a href="#cb104-706"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="at">each =</span> <span class="dv">3</span>), </span>
<span id="cb104-707"><a href="#cb104-707"></a>  <span class="at">hjust =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="dv">3</span>), </span>
<span id="cb104-708"><a href="#cb104-708"></a>  <span class="at">vjust =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">rep</span>(<span class="at">each =</span> <span class="dv">3</span>)</span>
<span id="cb104-709"><a href="#cb104-709"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb104-710"><a href="#cb104-710"></a>  <span class="fu">mutate</span>(</span>
<span id="cb104-711"><a href="#cb104-711"></a>    <span class="at">t =</span> <span class="fu">sprintf</span>(<span class="st">"h:%s</span><span class="sc">\n</span><span class="st">v:%s"</span>, hjust, vjust)</span>
<span id="cb104-712"><a href="#cb104-712"></a>  )</span>
<span id="cb104-713"><a href="#cb104-713"></a></span>
<span id="cb104-714"><a href="#cb104-714"></a>g <span class="ot">&lt;-</span> </span>
<span id="cb104-715"><a href="#cb104-715"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb104-716"><a href="#cb104-716"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">label =</span> t)) <span class="sc">+</span> </span>
<span id="cb104-717"><a href="#cb104-717"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span> </span>
<span id="cb104-718"><a href="#cb104-718"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb104-719"><a href="#cb104-719"></a></span>
<span id="cb104-720"><a href="#cb104-720"></a><span class="fu">plot</span>(</span>
<span id="cb104-721"><a href="#cb104-721"></a>  g <span class="sc">+</span></span>
<span id="cb104-722"><a href="#cb104-722"></a>    <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">hjust =</span> hjust, <span class="at">vjust =</span> vjust)) <span class="sc">+</span> </span>
<span id="cb104-723"><a href="#cb104-723"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"gold"</span>, <span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb104-724"><a href="#cb104-724"></a>  )</span>
<span id="cb104-725"><a href="#cb104-725"></a></span>
<span id="cb104-726"><a href="#cb104-726"></a><span class="in">```</span></span>
<span id="cb104-727"><a href="#cb104-727"></a></span>
<span id="cb104-728"><a href="#cb104-728"></a><span class="fu">### position</span></span>
<span id="cb104-729"><a href="#cb104-729"></a></span>
<span id="cb104-730"><a href="#cb104-730"></a>position系の関数を使うと気の利いた調整が行える.</span>
<span id="cb104-731"><a href="#cb104-731"></a></span>
<span id="cb104-734"><a href="#cb104-734"></a><span class="in">```{r}</span></span>
<span id="cb104-735"><a href="#cb104-735"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb104-736"><a href="#cb104-736"></a>  <span class="at">x =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)),</span>
<span id="cb104-737"><a href="#cb104-737"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb104-738"><a href="#cb104-738"></a>  <span class="at">grp =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>)</span>
<span id="cb104-739"><a href="#cb104-739"></a>)</span>
<span id="cb104-740"><a href="#cb104-740"></a></span>
<span id="cb104-741"><a href="#cb104-741"></a><span class="in">```</span></span>
<span id="cb104-742"><a href="#cb104-742"></a></span>
<span id="cb104-745"><a href="#cb104-745"></a><span class="in">```{r}</span></span>
<span id="cb104-746"><a href="#cb104-746"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(x, y, <span class="at">group =</span> grp)) <span class="sc">+</span></span>
<span id="cb104-747"><a href="#cb104-747"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> grp), <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb104-748"><a href="#cb104-748"></a>  <span class="co"># x軸の中心からそれぞれどれだけ離すか</span></span>
<span id="cb104-749"><a href="#cb104-749"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> y), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>))</span>
<span id="cb104-750"><a href="#cb104-750"></a></span>
<span id="cb104-751"><a href="#cb104-751"></a><span class="in">```</span></span>
<span id="cb104-752"><a href="#cb104-752"></a></span>
<span id="cb104-755"><a href="#cb104-755"></a><span class="in">```{r}</span></span>
<span id="cb104-756"><a href="#cb104-756"></a><span class="co"># Use you can't nudge and dodge text, so instead adjust the y position</span></span>
<span id="cb104-757"><a href="#cb104-757"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(x, y, <span class="at">group =</span> grp)) <span class="sc">+</span></span>
<span id="cb104-758"><a href="#cb104-758"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> grp), <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb104-759"><a href="#cb104-759"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb104-760"><a href="#cb104-760"></a>    <span class="fu">aes</span>(<span class="at">label =</span> y, <span class="at">y =</span> y <span class="sc">+</span> <span class="fl">0.05</span>),</span>
<span id="cb104-761"><a href="#cb104-761"></a>    <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>),</span>
<span id="cb104-762"><a href="#cb104-762"></a>    <span class="at">vjust =</span> <span class="dv">0</span></span>
<span id="cb104-763"><a href="#cb104-763"></a>  )</span>
<span id="cb104-764"><a href="#cb104-764"></a><span class="in">```</span></span>
<span id="cb104-765"><a href="#cb104-765"></a></span>
<span id="cb104-768"><a href="#cb104-768"></a><span class="in">```{r}</span></span>
<span id="cb104-769"><a href="#cb104-769"></a><span class="co"># To place text in the middle of each bar in a stacked barplot, you</span></span>
<span id="cb104-770"><a href="#cb104-770"></a><span class="co"># need to set the vjust parameter of position_stack()</span></span>
<span id="cb104-771"><a href="#cb104-771"></a><span class="fu">ggplot</span>(<span class="at">data =</span> df, <span class="fu">aes</span>(x, y, <span class="at">group =</span> grp)) <span class="sc">+</span></span>
<span id="cb104-772"><a href="#cb104-772"></a> <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill =</span> grp)) <span class="sc">+</span></span>
<span id="cb104-773"><a href="#cb104-773"></a> <span class="co"># スタックされているところは，つまり，境界のところ</span></span>
<span id="cb104-774"><a href="#cb104-774"></a> <span class="co"># この場合のvjustはスタックされているところで調整してくれている(文字の大きさでない)</span></span>
<span id="cb104-775"><a href="#cb104-775"></a> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> y), <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb104-776"><a href="#cb104-776"></a><span class="in">```</span></span>
<span id="cb104-777"><a href="#cb104-777"></a></span>
<span id="cb104-778"><a href="#cb104-778"></a><span class="fu">## facet_grid</span></span>
<span id="cb104-779"><a href="#cb104-779"></a></span>
<span id="cb104-780"><a href="#cb104-780"></a>基本的な使い方はいいが，ここではストリップラベルをずらす例を紹介．</span>
<span id="cb104-781"><a href="#cb104-781"></a></span>
<span id="cb104-784"><a href="#cb104-784"></a><span class="in">```{r}</span></span>
<span id="cb104-785"><a href="#cb104-785"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb104-786"><a href="#cb104-786"></a>  <span class="fu">tibble</span>(</span>
<span id="cb104-787"><a href="#cb104-787"></a>    <span class="at">rows =</span> <span class="fu">sprintf</span>(<span class="st">"row_%d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>), </span>
<span id="cb104-788"><a href="#cb104-788"></a>    <span class="at">cols =</span> <span class="fu">sprintf</span>(<span class="st">"col_%d"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb104-789"><a href="#cb104-789"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb104-790"><a href="#cb104-790"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(rows, cols) <span class="sc">%&gt;%</span></span>
<span id="cb104-791"><a href="#cb104-791"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb104-792"><a href="#cb104-792"></a>  <span class="fu">mutate</span>(</span>
<span id="cb104-793"><a href="#cb104-793"></a>    <span class="at">data =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>)))</span>
<span id="cb104-794"><a href="#cb104-794"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb104-795"><a href="#cb104-795"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb104-796"><a href="#cb104-796"></a></span>
<span id="cb104-797"><a href="#cb104-797"></a><span class="in">```</span></span>
<span id="cb104-798"><a href="#cb104-798"></a></span>
<span id="cb104-801"><a href="#cb104-801"></a><span class="in">```{r}</span></span>
<span id="cb104-802"><a href="#cb104-802"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb104-803"><a href="#cb104-803"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb104-804"><a href="#cb104-804"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(x, y), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb104-805"><a href="#cb104-805"></a>  <span class="fu">coord_equal</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>)) <span class="sc">+</span> </span>
<span id="cb104-806"><a href="#cb104-806"></a>  <span class="fu">theme_cowplot</span>() <span class="sc">+</span> </span>
<span id="cb104-807"><a href="#cb104-807"></a>  <span class="fu">facet_grid</span>(</span>
<span id="cb104-808"><a href="#cb104-808"></a>    <span class="at">rows =</span> <span class="fu">vars</span>(rows), </span>
<span id="cb104-809"><a href="#cb104-809"></a>    <span class="at">cols =</span> <span class="fu">vars</span>(cols), </span>
<span id="cb104-810"><a href="#cb104-810"></a>    <span class="at">switch =</span> <span class="st">"y"</span> <span class="co"># 行のラベルを左に置く</span></span>
<span id="cb104-811"><a href="#cb104-811"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-812"><a href="#cb104-812"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">position =</span> <span class="st">"right"</span>) <span class="sc">+</span> </span>
<span id="cb104-813"><a href="#cb104-813"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-814"><a href="#cb104-814"></a>    <span class="co"># RStudioの予測にも出てこないけど，</span></span>
<span id="cb104-815"><a href="#cb104-815"></a>    <span class="co"># leftにおいたyのstripにアングルを与えるには次を使うこと</span></span>
<span id="cb104-816"><a href="#cb104-816"></a>    <span class="at">strip.text.y.left =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb104-817"><a href="#cb104-817"></a>  ) </span>
<span id="cb104-818"><a href="#cb104-818"></a><span class="in">```</span></span>
<span id="cb104-819"><a href="#cb104-819"></a></span>
<span id="cb104-820"><a href="#cb104-820"></a></span>
<span id="cb104-821"><a href="#cb104-821"></a></span>
<span id="cb104-822"><a href="#cb104-822"></a></span>
<span id="cb104-823"><a href="#cb104-823"></a></span>
<span id="cb104-824"><a href="#cb104-824"></a></span>
<span id="cb104-825"><a href="#cb104-825"></a></span>
<span id="cb104-826"><a href="#cb104-826"></a><span class="fu">## summary_stat</span></span>
<span id="cb104-827"><a href="#cb104-827"></a></span>
<span id="cb104-828"><a href="#cb104-828"></a>geom関数とstat関数は一緒の関係であるが,</span>
<span id="cb104-829"><a href="#cb104-829"></a>stat_summaryにより関数を適用してプロットを行うことが可能となる.</span>
<span id="cb104-830"><a href="#cb104-830"></a>正直使いにくいイメージがあるので，個人的には</span>
<span id="cb104-831"><a href="#cb104-831"></a>事前に集計したレイヤーを重ねるという方法を常に選択しがちである．</span>
<span id="cb104-832"><a href="#cb104-832"></a></span>
<span id="cb104-835"><a href="#cb104-835"></a><span class="in">```{r}</span></span>
<span id="cb104-836"><a href="#cb104-836"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb104-837"><a href="#cb104-837"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb104-838"><a href="#cb104-838"></a>    <span class="at">data =</span> <span class="fu">filter</span>(penguins, <span class="fu">complete.cases</span>(penguins)), </span>
<span id="cb104-839"><a href="#cb104-839"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb104-840"><a href="#cb104-840"></a>      <span class="at">x =</span> species,</span>
<span id="cb104-841"><a href="#cb104-841"></a>      <span class="at">y =</span> bill_length_mm</span>
<span id="cb104-842"><a href="#cb104-842"></a>    )</span>
<span id="cb104-843"><a href="#cb104-843"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-844"><a href="#cb104-844"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb104-845"><a href="#cb104-845"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-846"><a href="#cb104-846"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>)</span>
<span id="cb104-847"><a href="#cb104-847"></a>  )</span>
<span id="cb104-848"><a href="#cb104-848"></a></span>
<span id="cb104-849"><a href="#cb104-849"></a>p <span class="sc">+</span> </span>
<span id="cb104-850"><a href="#cb104-850"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb104-851"><a href="#cb104-851"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> <span class="st">"mean"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb104-852"><a href="#cb104-852"></a><span class="in">```</span></span>
<span id="cb104-853"><a href="#cb104-853"></a></span>
<span id="cb104-854"><a href="#cb104-854"></a></span>
<span id="cb104-855"><a href="#cb104-855"></a></span>
<span id="cb104-856"><a href="#cb104-856"></a><span class="fu">## マルチレベルのwrap</span></span>
<span id="cb104-857"><a href="#cb104-857"></a></span>
<span id="cb104-858"><a href="#cb104-858"></a></span>
<span id="cb104-859"><a href="#cb104-859"></a>自然言語処理でドキュメントごとに単語頻度上位N件の</span>
<span id="cb104-860"><a href="#cb104-860"></a>度数をバープロットで描画するときなど，</span>
<span id="cb104-861"><a href="#cb104-861"></a>ドキュメントでfacetしてその中でwordを並び変えてプロットしたいときがある．</span>
<span id="cb104-862"><a href="#cb104-862"></a></span>
<span id="cb104-863"><a href="#cb104-863"></a>このとき，何も考えずに行うと期待したプロットが作成できない．</span>
<span id="cb104-864"><a href="#cb104-864"></a>これに対処するには，並び換えを全体で行えるようにkeyを調整した上で，</span>
<span id="cb104-865"><a href="#cb104-865"></a>プロットする際にキーラベル名を調整するという処理が必要である. </span>
<span id="cb104-866"><a href="#cb104-866"></a></span>
<span id="cb104-869"><a href="#cb104-869"></a><span class="in">```{r}</span></span>
<span id="cb104-870"><a href="#cb104-870"></a>data <span class="ot">&lt;-</span> </span>
<span id="cb104-871"><a href="#cb104-871"></a>  <span class="fu">tibble</span>(</span>
<span id="cb104-872"><a href="#cb104-872"></a>    <span class="at">key   =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"b"</span>), </span>
<span id="cb104-873"><a href="#cb104-873"></a>    <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), </span>
<span id="cb104-874"><a href="#cb104-874"></a>    <span class="at">term  =</span> <span class="fu">c</span>(<span class="st">"w1"</span>, <span class="st">"w2"</span>, <span class="st">"w1"</span>, <span class="st">"w2"</span>)</span>
<span id="cb104-875"><a href="#cb104-875"></a>  )</span>
<span id="cb104-876"><a href="#cb104-876"></a></span>
<span id="cb104-877"><a href="#cb104-877"></a><span class="co"># 並び変えてプロットしても</span></span>
<span id="cb104-878"><a href="#cb104-878"></a><span class="co"># グラフは同じ順番になってしまう</span></span>
<span id="cb104-879"><a href="#cb104-879"></a><span class="co"># これをfacetごとに降順に並び変えたい</span></span>
<span id="cb104-880"><a href="#cb104-880"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb104-881"><a href="#cb104-881"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb104-882"><a href="#cb104-882"></a>  <span class="fu">arrange</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb104-883"><a href="#cb104-883"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-884"><a href="#cb104-884"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(term, value), value)) <span class="sc">+</span> </span>
<span id="cb104-885"><a href="#cb104-885"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb104-886"><a href="#cb104-886"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(key), <span class="at">scales =</span> <span class="st">"free"</span>)</span>
<span id="cb104-887"><a href="#cb104-887"></a><span class="in">```</span></span>
<span id="cb104-888"><a href="#cb104-888"></a></span>
<span id="cb104-889"><a href="#cb104-889"></a></span>
<span id="cb104-890"><a href="#cb104-890"></a>一応このようにやれば対応が可能である. </span>
<span id="cb104-891"><a href="#cb104-891"></a></span>
<span id="cb104-894"><a href="#cb104-894"></a><span class="in">```{r}</span></span>
<span id="cb104-895"><a href="#cb104-895"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb104-896"><a href="#cb104-896"></a>  <span class="fu">mutate</span>(<span class="at">new_key =</span> <span class="fu">factor</span>(<span class="fu">str_c</span>(term, key, <span class="at">sep =</span> <span class="st">"___"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb104-897"><a href="#cb104-897"></a>  <span class="fu">arrange</span>(value) <span class="sc">%&gt;%</span></span>
<span id="cb104-898"><a href="#cb104-898"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="fu">reorder</span>(new_key, value), value)) <span class="sc">+</span> </span>
<span id="cb104-899"><a href="#cb104-899"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span> </span>
<span id="cb104-900"><a href="#cb104-900"></a>  <span class="fu">facet_wrap</span>(<span class="fu">vars</span>(key), <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span> </span>
<span id="cb104-901"><a href="#cb104-901"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">label =</span> <span class="cf">function</span>(x) <span class="fu">sub</span>(<span class="st">"___.+$"</span>, <span class="st">""</span>, x), <span class="at">drop =</span> <span class="cn">TRUE</span>)</span>
<span id="cb104-902"><a href="#cb104-902"></a><span class="in">```</span></span>
<span id="cb104-903"><a href="#cb104-903"></a></span>
<span id="cb104-904"><a href="#cb104-904"></a></span>
<span id="cb104-905"><a href="#cb104-905"></a><span class="fu">## trans</span></span>
<span id="cb104-906"><a href="#cb104-906"></a></span>
<span id="cb104-907"><a href="#cb104-907"></a>trans系やscale系の関数を使うことで，データをggplot内で変換することが可能となるはず．</span>
<span id="cb104-908"><a href="#cb104-908"></a>たとえば<span class="in">`scale_x_log`</span>などがそれに該当する. </span>
<span id="cb104-909"><a href="#cb104-909"></a></span>
<span id="cb104-912"><a href="#cb104-912"></a><span class="in">```{r}</span></span>
<span id="cb104-913"><a href="#cb104-913"></a><span class="fu">tibble</span>(</span>
<span id="cb104-914"><a href="#cb104-914"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb104-915"><a href="#cb104-915"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb104-916"><a href="#cb104-916"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-917"><a href="#cb104-917"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb104-918"><a href="#cb104-918"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb104-919"><a href="#cb104-919"></a>  <span class="fu">scale_y_log10</span>()</span>
<span id="cb104-920"><a href="#cb104-920"></a><span class="in">```</span></span>
<span id="cb104-921"><a href="#cb104-921"></a></span>
<span id="cb104-922"><a href="#cb104-922"></a>同じことを違う遣り方で実行してみる. </span>
<span id="cb104-923"><a href="#cb104-923"></a></span>
<span id="cb104-926"><a href="#cb104-926"></a><span class="in">```{r}</span></span>
<span id="cb104-927"><a href="#cb104-927"></a><span class="fu">tibble</span>(</span>
<span id="cb104-928"><a href="#cb104-928"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb104-929"><a href="#cb104-929"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb104-930"><a href="#cb104-930"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-931"><a href="#cb104-931"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb104-932"><a href="#cb104-932"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb104-933"><a href="#cb104-933"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="st">"log10"</span>)</span>
<span id="cb104-934"><a href="#cb104-934"></a><span class="in">```</span></span>
<span id="cb104-935"><a href="#cb104-935"></a></span>
<span id="cb104-936"><a href="#cb104-936"></a></span>
<span id="cb104-937"><a href="#cb104-937"></a>さらに別のやり方を試す. </span>
<span id="cb104-938"><a href="#cb104-938"></a></span>
<span id="cb104-941"><a href="#cb104-941"></a><span class="in">```{r}</span></span>
<span id="cb104-942"><a href="#cb104-942"></a><span class="fu">tibble</span>(</span>
<span id="cb104-943"><a href="#cb104-943"></a>  <span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, </span>
<span id="cb104-944"><a href="#cb104-944"></a>  <span class="at">y =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb104-945"><a href="#cb104-945"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-946"><a href="#cb104-946"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb104-947"><a href="#cb104-947"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb104-948"><a href="#cb104-948"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb104-949"><a href="#cb104-949"></a>    <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">trans_new</span>(<span class="st">"log10"</span>, log10, <span class="cf">function</span>(x) <span class="dv">10</span> <span class="sc">**</span> x), </span>
<span id="cb104-950"><a href="#cb104-950"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, .<span class="dv">5</span>), </span>
<span id="cb104-951"><a href="#cb104-951"></a>    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">10</span>)</span>
<span id="cb104-952"><a href="#cb104-952"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-953"><a href="#cb104-953"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-954"><a href="#cb104-954"></a>    <span class="at">axis.ticks.length =</span> <span class="fu">unit</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="st">"mm"</span>)</span>
<span id="cb104-955"><a href="#cb104-955"></a>  )</span>
<span id="cb104-956"><a href="#cb104-956"></a><span class="in">```</span></span>
<span id="cb104-957"><a href="#cb104-957"></a></span>
<span id="cb104-958"><a href="#cb104-958"></a></span>
<span id="cb104-959"><a href="#cb104-959"></a><span class="fu">## グラフの順番に凡例の順番を合わす</span></span>
<span id="cb104-960"><a href="#cb104-960"></a></span>
<span id="cb104-961"><a href="#cb104-961"></a><span class="co">[</span><span class="ot">参考文献</span><span class="co">](https://www.nsgrantham.com/reorder-legend-ggplot2)</span></span>
<span id="cb104-962"><a href="#cb104-962"></a></span>
<span id="cb104-965"><a href="#cb104-965"></a><span class="in">```{r}</span></span>
<span id="cb104-966"><a href="#cb104-966"></a><span class="fu">library</span>(tidyverse)  <span class="co"># 1.3.0</span></span>
<span id="cb104-967"><a href="#cb104-967"></a></span>
<span id="cb104-968"><a href="#cb104-968"></a>usa_crop_yields <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-09-01/key_crop_yields.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-969"><a href="#cb104-969"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">" </span><span class="sc">\\</span><span class="st">(tonnes per hectare</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>, .)) <span class="sc">%&gt;%</span></span>
<span id="cb104-970"><a href="#cb104-970"></a>  <span class="fu">pivot_longer</span>(Wheat<span class="sc">:</span>Bananas, <span class="at">names_to =</span> <span class="st">"crop"</span>, <span class="at">values_to =</span> <span class="st">"yield"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-971"><a href="#cb104-971"></a>  <span class="fu">rename_with</span>(tolower) <span class="sc">%&gt;%</span></span>
<span id="cb104-972"><a href="#cb104-972"></a>  <span class="fu">filter</span>(entity <span class="sc">==</span> <span class="st">"United States"</span>, <span class="sc">!</span><span class="fu">is.na</span>(yield)) <span class="sc">%&gt;%</span></span>
<span id="cb104-973"><a href="#cb104-973"></a>  <span class="fu">select</span>(year, crop, yield)</span>
<span id="cb104-974"><a href="#cb104-974"></a></span>
<span id="cb104-975"><a href="#cb104-975"></a>usa_crop_yields</span>
<span id="cb104-976"><a href="#cb104-976"></a><span class="in">```</span></span>
<span id="cb104-977"><a href="#cb104-977"></a></span>
<span id="cb104-980"><a href="#cb104-980"></a><span class="in">```{r}</span></span>
<span id="cb104-981"><a href="#cb104-981"></a>usa_crop_yields <span class="sc">%&gt;%</span></span>
<span id="cb104-982"><a href="#cb104-982"></a>  <span class="fu">mutate</span>(<span class="at">crop =</span> <span class="fu">fct_reorder2</span>(crop, year, yield)) <span class="sc">%&gt;%</span></span>
<span id="cb104-983"><a href="#cb104-983"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, yield, <span class="at">color =</span> crop)) <span class="sc">+</span></span>
<span id="cb104-984"><a href="#cb104-984"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb104-985"><a href="#cb104-985"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">color =</span> <span class="cn">NULL</span>)</span>
<span id="cb104-986"><a href="#cb104-986"></a><span class="in">```</span></span>
<span id="cb104-987"><a href="#cb104-987"></a></span>
<span id="cb104-988"><a href="#cb104-988"></a><span class="fu">## histgram</span></span>
<span id="cb104-989"><a href="#cb104-989"></a></span>
<span id="cb104-990"><a href="#cb104-990"></a></span>
<span id="cb104-991"><a href="#cb104-991"></a>ヒストグラムをきれいに書きたい. </span>
<span id="cb104-992"><a href="#cb104-992"></a></span>
<span id="cb104-995"><a href="#cb104-995"></a><span class="in">```{r}</span></span>
<span id="cb104-996"><a href="#cb104-996"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">runif</span>(<span class="dv">100</span>), <span class="at">b =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb104-997"><a href="#cb104-997"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb104-998"><a href="#cb104-998"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> a)) <span class="sc">+</span> </span>
<span id="cb104-999"><a href="#cb104-999"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">fill =</span> b), <span class="at">center =</span> <span class="dv">0</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>), <span class="at">color =</span> <span class="st">"lightgrey"</span>, <span class="at">closed =</span> <span class="st">"left"</span>) <span class="sc">+</span></span>
<span id="cb104-1000"><a href="#cb104-1000"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb104-1001"><a href="#cb104-1001"></a>    <span class="at">stat =</span> <span class="st">"bin"</span>,</span>
<span id="cb104-1002"><a href="#cb104-1002"></a>    <span class="co"># count, dnesity, ncount, ndensity</span></span>
<span id="cb104-1003"><a href="#cb104-1003"></a>    <span class="fu">aes</span>(<span class="at">label =</span> ..count.., <span class="at">y =</span> ..count.., <span class="at">fill =</span> b),</span>
<span id="cb104-1004"><a href="#cb104-1004"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>),</span>
<span id="cb104-1005"><a href="#cb104-1005"></a>    <span class="at">closed =</span> <span class="st">"left"</span>,</span>
<span id="cb104-1006"><a href="#cb104-1006"></a>    <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>,</span>
<span id="cb104-1007"><a href="#cb104-1007"></a>    <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> .<span class="dv">5</span>)</span>
<span id="cb104-1008"><a href="#cb104-1008"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1009"><a href="#cb104-1009"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb104-1010"><a href="#cb104-1010"></a>    <span class="at">stat =</span> <span class="st">"bin"</span>, </span>
<span id="cb104-1011"><a href="#cb104-1011"></a>    <span class="fu">aes</span>(<span class="at">x =</span> a, <span class="at">label =</span> <span class="fu">after_stat</span>(count), <span class="at">y =</span> <span class="fu">after_stat</span>(count)), </span>
<span id="cb104-1012"><a href="#cb104-1012"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>), </span>
<span id="cb104-1013"><a href="#cb104-1013"></a>    <span class="at">closed =</span> <span class="st">"left"</span>, </span>
<span id="cb104-1014"><a href="#cb104-1014"></a>    <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, </span>
<span id="cb104-1015"><a href="#cb104-1015"></a>    <span class="at">data =</span> data</span>
<span id="cb104-1016"><a href="#cb104-1016"></a>  ) <span class="sc">+</span></span>
<span id="cb104-1017"><a href="#cb104-1017"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>))</span>
<span id="cb104-1018"><a href="#cb104-1018"></a></span>
<span id="cb104-1019"><a href="#cb104-1019"></a><span class="in">```</span></span>
<span id="cb104-1020"><a href="#cb104-1020"></a></span>
<span id="cb104-1021"><a href="#cb104-1021"></a></span>
<span id="cb104-1022"><a href="#cb104-1022"></a>左に閉じたときにどのような挙動になるのかを確認したい. </span>
<span id="cb104-1023"><a href="#cb104-1023"></a><span class="co">[</span><span class="ot">0, .1), [.1, .2), ...., [.9, 1.</span><span class="co">]</span>となっていることがわかる. </span>
<span id="cb104-1024"><a href="#cb104-1024"></a></span>
<span id="cb104-1025"><a href="#cb104-1025"></a></span>
<span id="cb104-1026"><a href="#cb104-1026"></a></span>
<span id="cb104-1029"><a href="#cb104-1029"></a><span class="in">```{r}</span></span>
<span id="cb104-1030"><a href="#cb104-1030"></a>data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">a =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>, .<span class="dv">5</span>,  <span class="fl">1.</span>), <span class="dv">100</span>, <span class="cn">TRUE</span>), <span class="at">b =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>), <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb104-1031"><a href="#cb104-1031"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb104-1032"><a href="#cb104-1032"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> a)) <span class="sc">+</span> </span>
<span id="cb104-1033"><a href="#cb104-1033"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb104-1034"><a href="#cb104-1034"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> b), </span>
<span id="cb104-1035"><a href="#cb104-1035"></a>    <span class="at">center =</span> <span class="dv">0</span>,</span>
<span id="cb104-1036"><a href="#cb104-1036"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>), </span>
<span id="cb104-1037"><a href="#cb104-1037"></a>    <span class="at">color =</span> <span class="st">"lightgrey"</span>, </span>
<span id="cb104-1038"><a href="#cb104-1038"></a>    <span class="at">closed =</span> <span class="st">"left"</span></span>
<span id="cb104-1039"><a href="#cb104-1039"></a>  ) <span class="sc">+</span></span>
<span id="cb104-1040"><a href="#cb104-1040"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb104-1041"><a href="#cb104-1041"></a>    <span class="at">stat =</span> <span class="st">"bin"</span>,</span>
<span id="cb104-1042"><a href="#cb104-1042"></a>    <span class="fu">aes</span>(<span class="at">label =</span> ..count.., <span class="at">y =</span> ..count.., <span class="at">group =</span> b),</span>
<span id="cb104-1043"><a href="#cb104-1043"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>),</span>
<span id="cb104-1044"><a href="#cb104-1044"></a>    <span class="at">closed =</span> <span class="st">"left"</span>,</span>
<span id="cb104-1045"><a href="#cb104-1045"></a>    <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>,</span>
<span id="cb104-1046"><a href="#cb104-1046"></a>    <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> .<span class="dv">5</span>)</span>
<span id="cb104-1047"><a href="#cb104-1047"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1048"><a href="#cb104-1048"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1.</span>, .<span class="dv">1</span>))</span>
<span id="cb104-1049"><a href="#cb104-1049"></a></span>
<span id="cb104-1050"><a href="#cb104-1050"></a><span class="in">```</span></span>
<span id="cb104-1051"><a href="#cb104-1051"></a></span>
<span id="cb104-1052"><a href="#cb104-1052"></a><span class="fu">## geom_smooth</span></span>
<span id="cb104-1053"><a href="#cb104-1053"></a></span>
<span id="cb104-1056"><a href="#cb104-1056"></a><span class="in">```{r}</span></span>
<span id="cb104-1057"><a href="#cb104-1057"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb104-1058"><a href="#cb104-1058"></a>    <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">100</span>, <span class="dv">1</span>), </span>
<span id="cb104-1059"><a href="#cb104-1059"></a>    <span class="at">e =</span> <span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb104-1060"><a href="#cb104-1060"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb104-1061"><a href="#cb104-1061"></a>    <span class="fu">mutate</span>(<span class="at">y =</span> x <span class="sc">*</span> .<span class="dv">05</span> <span class="sc">+</span> e)</span>
<span id="cb104-1062"><a href="#cb104-1062"></a></span>
<span id="cb104-1063"><a href="#cb104-1063"></a>df <span class="sc">|&gt;</span> </span>
<span id="cb104-1064"><a href="#cb104-1064"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span> </span>
<span id="cb104-1065"><a href="#cb104-1065"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb104-1066"><a href="#cb104-1066"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="sc">~</span> . <span class="sc">|&gt;</span> <span class="fu">filter</span>(x <span class="sc">&lt;=</span> <span class="dv">50</span>), <span class="at">col =</span> <span class="st">"red"</span>) <span class="sc">+</span> </span>
<span id="cb104-1067"><a href="#cb104-1067"></a>    <span class="fu">geom_smooth</span>(<span class="at">data =</span> <span class="sc">~</span> . <span class="sc">|&gt;</span> <span class="fu">filter</span>(x <span class="sc">&gt;</span> <span class="dv">50</span>), <span class="at">col =</span> <span class="st">"blue"</span>)</span>
<span id="cb104-1068"><a href="#cb104-1068"></a></span>
<span id="cb104-1069"><a href="#cb104-1069"></a><span class="in">```</span></span>
<span id="cb104-1070"><a href="#cb104-1070"></a></span>
<span id="cb104-1071"><a href="#cb104-1071"></a></span>
<span id="cb104-1072"><a href="#cb104-1072"></a></span>
<span id="cb104-1073"><a href="#cb104-1073"></a><span class="fu"># Extensions</span></span>
<span id="cb104-1074"><a href="#cb104-1074"></a></span>
<span id="cb104-1075"><a href="#cb104-1075"></a><span class="fu">## ggmosaic</span></span>
<span id="cb104-1076"><a href="#cb104-1076"></a></span>
<span id="cb104-1079"><a href="#cb104-1079"></a><span class="in">```{r}</span></span>
<span id="cb104-1080"><a href="#cb104-1080"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-1081"><a href="#cb104-1081"></a><span class="fu">library</span>(ggmosaic)</span>
<span id="cb104-1082"><a href="#cb104-1082"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb104-1083"><a href="#cb104-1083"></a></span>
<span id="cb104-1084"><a href="#cb104-1084"></a>cc <span class="ot">&lt;-</span> <span class="fu">count</span>(diamonds, cut, clarity)</span>
<span id="cb104-1085"><a href="#cb104-1085"></a></span>
<span id="cb104-1086"><a href="#cb104-1086"></a><span class="fu">ggplot</span>(cc) <span class="sc">+</span> </span>
<span id="cb104-1087"><a href="#cb104-1087"></a>    <span class="fu">geom_mosaic</span>(</span>
<span id="cb104-1088"><a href="#cb104-1088"></a>        <span class="fu">aes</span>(<span class="at">weight =</span> n, <span class="at">x =</span> <span class="fu">product</span>(cut), <span class="at">fill =</span> clarity)</span>
<span id="cb104-1089"><a href="#cb104-1089"></a>    )</span>
<span id="cb104-1090"><a href="#cb104-1090"></a></span>
<span id="cb104-1091"><a href="#cb104-1091"></a></span>
<span id="cb104-1092"><a href="#cb104-1092"></a><span class="in">```</span></span>
<span id="cb104-1093"><a href="#cb104-1093"></a></span>
<span id="cb104-1094"><a href="#cb104-1094"></a></span>
<span id="cb104-1095"><a href="#cb104-1095"></a><span class="fu">## ggokabeito</span></span>
<span id="cb104-1096"><a href="#cb104-1096"></a></span>
<span id="cb104-1097"><a href="#cb104-1097"></a>safecolorらしい．</span>
<span id="cb104-1098"><a href="#cb104-1098"></a></span>
<span id="cb104-1101"><a href="#cb104-1101"></a><span class="in">```{r}</span></span>
<span id="cb104-1102"><a href="#cb104-1102"></a>iris <span class="sc">|&gt;</span> </span>
<span id="cb104-1103"><a href="#cb104-1103"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(Sepal.Length, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb104-1104"><a href="#cb104-1104"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb104-1105"><a href="#cb104-1105"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb104-1106"><a href="#cb104-1106"></a>    <span class="fu">scale_color_okabe_ito</span>()</span>
<span id="cb104-1107"><a href="#cb104-1107"></a><span class="in">```</span></span>
<span id="cb104-1108"><a href="#cb104-1108"></a></span>
<span id="cb104-1109"><a href="#cb104-1109"></a></span>
<span id="cb104-1110"><a href="#cb104-1110"></a></span>
<span id="cb104-1111"><a href="#cb104-1111"></a><span class="fu">## ggprism</span></span>
<span id="cb104-1112"><a href="#cb104-1112"></a></span>
<span id="cb104-1113"><a href="#cb104-1113"></a><span class="co">[</span><span class="ot">マイナーチック</span><span class="co">](https://cran.r-project.org/web/packages/ggprism/vignettes/axes.html)</span></span>
<span id="cb104-1114"><a href="#cb104-1114"></a>を打てるようです.</span>
<span id="cb104-1115"><a href="#cb104-1115"></a></span>
<span id="cb104-1116"><a href="#cb104-1116"></a>他にも色々軸の加工が可能なためいろいろとチェックしてみるのがいい．</span>
<span id="cb104-1117"><a href="#cb104-1117"></a></span>
<span id="cb104-1118"><a href="#cb104-1118"></a><span class="fu">### Minor ticks</span></span>
<span id="cb104-1119"><a href="#cb104-1119"></a></span>
<span id="cb104-1122"><a href="#cb104-1122"></a><span class="in">```{r}</span></span>
<span id="cb104-1123"><a href="#cb104-1123"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb104-1124"><a href="#cb104-1124"></a>  <span class="at">data =</span> ToothGrowth, </span>
<span id="cb104-1125"><a href="#cb104-1125"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb104-1126"><a href="#cb104-1126"></a>    <span class="at">x =</span> <span class="fu">factor</span>(supp), </span>
<span id="cb104-1127"><a href="#cb104-1127"></a>    <span class="at">y =</span> len</span>
<span id="cb104-1128"><a href="#cb104-1128"></a>  )</span>
<span id="cb104-1129"><a href="#cb104-1129"></a>) <span class="sc">+</span> </span>
<span id="cb104-1130"><a href="#cb104-1130"></a>  <span class="fu">geom_boxplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(supp))) <span class="sc">+</span> </span>
<span id="cb104-1131"><a href="#cb104-1131"></a>  <span class="fu">theme_prism</span>() <span class="sc">+</span> </span>
<span id="cb104-1132"><a href="#cb104-1132"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb104-1133"><a href="#cb104-1133"></a>p1 <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">guide =</span> <span class="fu">guide_prism_minor</span>())</span>
<span id="cb104-1134"><a href="#cb104-1134"></a>p2 <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">y =</span> <span class="fu">guide_prism_minor</span>())</span>
<span id="cb104-1135"><a href="#cb104-1135"></a>p2</span>
<span id="cb104-1136"><a href="#cb104-1136"></a><span class="in">```</span></span>
<span id="cb104-1137"><a href="#cb104-1137"></a></span>
<span id="cb104-1140"><a href="#cb104-1140"></a><span class="in">```{r}</span></span>
<span id="cb104-1141"><a href="#cb104-1141"></a>p <span class="ot">&lt;-</span> </span>
<span id="cb104-1142"><a href="#cb104-1142"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb104-1143"><a href="#cb104-1143"></a>    <span class="at">data =</span> ToothGrowth, </span>
<span id="cb104-1144"><a href="#cb104-1144"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb104-1145"><a href="#cb104-1145"></a>      <span class="at">x =</span> <span class="fu">factor</span>(dose), </span>
<span id="cb104-1146"><a href="#cb104-1146"></a>      <span class="at">y =</span> len</span>
<span id="cb104-1147"><a href="#cb104-1147"></a>    )</span>
<span id="cb104-1148"><a href="#cb104-1148"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1149"><a href="#cb104-1149"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb104-1150"><a href="#cb104-1150"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">factor</span>(dose)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>, </span>
<span id="cb104-1151"><a href="#cb104-1151"></a>    <span class="at">geom =</span> <span class="st">"col"</span>, <span class="at">fun =</span> mean, <span class="at">colour =</span> <span class="st">"black"</span>, <span class="at">size =</span> .<span class="dv">9</span></span>
<span id="cb104-1152"><a href="#cb104-1152"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1153"><a href="#cb104-1153"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span> </span>
<span id="cb104-1154"><a href="#cb104-1154"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb104-1155"><a href="#cb104-1155"></a></span>
<span id="cb104-1156"><a href="#cb104-1156"></a></span>
<span id="cb104-1157"><a href="#cb104-1157"></a><span class="co"># 書きたかったグラフはこれや！！！！！</span></span>
<span id="cb104-1158"><a href="#cb104-1158"></a><span class="co"># これが土木学会のグラフや</span></span>
<span id="cb104-1159"><a href="#cb104-1159"></a>p <span class="sc">+</span> </span>
<span id="cb104-1160"><a href="#cb104-1160"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb104-1161"><a href="#cb104-1161"></a>    <span class="at">guide =</span> <span class="st">"prism_minor"</span>, </span>
<span id="cb104-1162"><a href="#cb104-1162"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">30</span>), </span>
<span id="cb104-1163"><a href="#cb104-1163"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), </span>
<span id="cb104-1164"><a href="#cb104-1164"></a>    <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>)</span>
<span id="cb104-1165"><a href="#cb104-1165"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1166"><a href="#cb104-1166"></a>  <span class="fu">theme</span>(</span>
<span id="cb104-1167"><a href="#cb104-1167"></a>    <span class="at">axis.ticks.length.y =</span> <span class="fu">unit</span>(<span class="dv">10</span>, <span class="st">"pt"</span>), </span>
<span id="cb104-1168"><a href="#cb104-1168"></a>    <span class="at">prism.ticks.length.y =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">"pt"</span>)</span>
<span id="cb104-1169"><a href="#cb104-1169"></a>  )</span>
<span id="cb104-1170"><a href="#cb104-1170"></a><span class="in">```</span></span>
<span id="cb104-1171"><a href="#cb104-1171"></a></span>
<span id="cb104-1172"><a href="#cb104-1172"></a><span class="fu">### Brackets axis</span></span>
<span id="cb104-1173"><a href="#cb104-1173"></a></span>
<span id="cb104-1176"><a href="#cb104-1176"></a><span class="in">```{r}</span></span>
<span id="cb104-1177"><a href="#cb104-1177"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ToothGrowth, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(dose), <span class="at">y =</span> len)) <span class="sc">+</span> </span>
<span id="cb104-1178"><a href="#cb104-1178"></a>  <span class="fu">geom_jitter</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(dose)), <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb104-1179"><a href="#cb104-1179"></a>  <span class="fu">scale_shape_prism</span>() <span class="sc">+</span> </span>
<span id="cb104-1180"><a href="#cb104-1180"></a>  <span class="fu">theme_prism</span>() <span class="sc">+</span> </span>
<span id="cb104-1181"><a href="#cb104-1181"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span> </span>
<span id="cb104-1182"><a href="#cb104-1182"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40</span>), <span class="at">guide =</span> <span class="st">"prism_offset"</span>)</span>
<span id="cb104-1183"><a href="#cb104-1183"></a></span>
<span id="cb104-1184"><a href="#cb104-1184"></a>p2 <span class="ot">&lt;-</span> p1 <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="st">"prism_bracket"</span>)</span>
<span id="cb104-1185"><a href="#cb104-1185"></a></span>
<span id="cb104-1186"><a href="#cb104-1186"></a>p2</span>
<span id="cb104-1187"><a href="#cb104-1187"></a><span class="in">```</span></span>
<span id="cb104-1188"><a href="#cb104-1188"></a></span>
<span id="cb104-1189"><a href="#cb104-1189"></a><span class="fu">### Border with minor ticks</span></span>
<span id="cb104-1190"><a href="#cb104-1190"></a></span>
<span id="cb104-1193"><a href="#cb104-1193"></a><span class="in">```{r}</span></span>
<span id="cb104-1194"><a href="#cb104-1194"></a>base <span class="ot">&lt;-</span> </span>
<span id="cb104-1195"><a href="#cb104-1195"></a>  <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(<span class="at">x =</span> displ, <span class="at">y =</span> cty)) <span class="sc">+</span></span>
<span id="cb104-1196"><a href="#cb104-1196"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> class))</span>
<span id="cb104-1197"><a href="#cb104-1197"></a>base</span>
<span id="cb104-1198"><a href="#cb104-1198"></a><span class="in">```</span></span>
<span id="cb104-1199"><a href="#cb104-1199"></a></span>
<span id="cb104-1200"><a href="#cb104-1200"></a>annotation_ticksを使うをスゴく簡単にチックを打てる.</span>
<span id="cb104-1201"><a href="#cb104-1201"></a></span>
<span id="cb104-1204"><a href="#cb104-1204"></a><span class="in">```{r}</span></span>
<span id="cb104-1205"><a href="#cb104-1205"></a>p <span class="ot">&lt;-</span> base <span class="sc">+</span> <span class="fu">theme_prism</span>(<span class="at">border =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb104-1206"><a href="#cb104-1206"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb104-1207"><a href="#cb104-1207"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span> </span>
<span id="cb104-1208"><a href="#cb104-1208"></a>  <span class="fu">guides</span>(</span>
<span id="cb104-1209"><a href="#cb104-1209"></a>    <span class="at">x =</span> <span class="st">"prism_minor"</span>, <span class="at">y =</span> <span class="st">"prism_minor"</span></span>
<span id="cb104-1210"><a href="#cb104-1210"></a>  )</span>
<span id="cb104-1211"><a href="#cb104-1211"></a>p_annot <span class="ot">&lt;-</span> </span>
<span id="cb104-1212"><a href="#cb104-1212"></a>  p <span class="sc">+</span> </span>
<span id="cb104-1213"><a href="#cb104-1213"></a>  <span class="fu">annotation_ticks</span>(</span>
<span id="cb104-1214"><a href="#cb104-1214"></a>    <span class="at">sides =</span> <span class="st">"tr"</span>, </span>
<span id="cb104-1215"><a href="#cb104-1215"></a>    <span class="at">type =</span> <span class="st">"both"</span>, </span>
<span id="cb104-1216"><a href="#cb104-1216"></a>    <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb104-1217"><a href="#cb104-1217"></a>    <span class="at">outside =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-1218"><a href="#cb104-1218"></a>    <span class="at">tick.length =</span> <span class="fu">unit</span>(<span class="dv">14</span><span class="sc">/</span><span class="dv">2</span>, <span class="st">"pt"</span>),</span>
<span id="cb104-1219"><a href="#cb104-1219"></a>    <span class="at">minor.length =</span> <span class="fu">unit</span>(<span class="dv">14</span><span class="sc">/</span><span class="dv">4</span>, <span class="st">"pt"</span>))</span>
<span id="cb104-1220"><a href="#cb104-1220"></a>p_annot</span>
<span id="cb104-1221"><a href="#cb104-1221"></a><span class="in">```</span></span>
<span id="cb104-1222"><a href="#cb104-1222"></a></span>
<span id="cb104-1223"><a href="#cb104-1223"></a>離散値の場合にも出来るようでしたがあまりにも</span>
<span id="cb104-1224"><a href="#cb104-1224"></a>トリッキーにつき省略いたします.</span>
<span id="cb104-1225"><a href="#cb104-1225"></a></span>
<span id="cb104-1226"><a href="#cb104-1226"></a><span class="fu">## gghalves</span></span>
<span id="cb104-1227"><a href="#cb104-1227"></a></span>
<span id="cb104-1228"><a href="#cb104-1228"></a><span class="ss">-   </span>(gghalves)<span class="co">[</span><span class="ot">&lt;https://github.com/erocoar/gghalves&gt;</span><span class="co">]</span></span>
<span id="cb104-1229"><a href="#cb104-1229"></a></span>
<span id="cb104-1230"><a href="#cb104-1230"></a>ggplo2によるハーフ＆ハーフのプロットの合成を容易にする。</span>
<span id="cb104-1231"><a href="#cb104-1231"></a></span>
<span id="cb104-1234"><a href="#cb104-1234"></a><span class="in">```{r}</span></span>
<span id="cb104-1235"><a href="#cb104-1235"></a><span class="fu">library</span>(gghalves)</span>
<span id="cb104-1236"><a href="#cb104-1236"></a><span class="in">```</span></span>
<span id="cb104-1237"><a href="#cb104-1237"></a></span>
<span id="cb104-1240"><a href="#cb104-1240"></a><span class="in">```{r}</span></span>
<span id="cb104-1241"><a href="#cb104-1241"></a>iris <span class="sc">%&gt;%</span></span>
<span id="cb104-1242"><a href="#cb104-1242"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Species, Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span> </span>
<span id="cb104-1243"><a href="#cb104-1243"></a>  <span class="fu">geom_half_point</span>() <span class="sc">+</span> </span>
<span id="cb104-1244"><a href="#cb104-1244"></a>  <span class="fu">geom_half_violin</span>()</span>
<span id="cb104-1245"><a href="#cb104-1245"></a><span class="in">```</span></span>
<span id="cb104-1246"><a href="#cb104-1246"></a></span>
<span id="cb104-1247"><a href="#cb104-1247"></a><span class="fu">## ggally</span></span>
<span id="cb104-1248"><a href="#cb104-1248"></a></span>
<span id="cb104-1249"><a href="#cb104-1249"></a><span class="ss">-   </span><span class="co">[</span><span class="ot">ggally</span><span class="co">](https://ggobi.github.io/ggally/index.html)</span></span>
<span id="cb104-1250"><a href="#cb104-1250"></a></span>
<span id="cb104-1253"><a href="#cb104-1253"></a><span class="in">```{r}</span></span>
<span id="cb104-1254"><a href="#cb104-1254"></a><span class="fu">library</span>(GGally)</span>
<span id="cb104-1255"><a href="#cb104-1255"></a><span class="in">```</span></span>
<span id="cb104-1256"><a href="#cb104-1256"></a></span>
<span id="cb104-1257"><a href="#cb104-1257"></a><span class="fu">### Types of Plots</span></span>
<span id="cb104-1258"><a href="#cb104-1258"></a></span>
<span id="cb104-1259"><a href="#cb104-1259"></a><span class="ss">-   </span>continuous: when both x and y variables are continuous</span>
<span id="cb104-1260"><a href="#cb104-1260"></a><span class="ss">-   </span>comboHorizontal: when x is continuous and y is discrete</span>
<span id="cb104-1261"><a href="#cb104-1261"></a><span class="ss">-   </span>comboVorizontal: when x is discrete and y is continuous</span>
<span id="cb104-1262"><a href="#cb104-1262"></a><span class="ss">-   </span>discrete: when both x and y variables are discrete</span>
<span id="cb104-1263"><a href="#cb104-1263"></a><span class="ss">-   </span>na: when all x data and all y data is NA</span>
<span id="cb104-1264"><a href="#cb104-1264"></a></span>
<span id="cb104-1265"><a href="#cb104-1265"></a><span class="fu">### ggpairs</span></span>
<span id="cb104-1266"><a href="#cb104-1266"></a></span>
<span id="cb104-1267"><a href="#cb104-1267"></a>いろいろカスタマイズができるのはわかるが、</span>
<span id="cb104-1268"><a href="#cb104-1268"></a>やりたいものがないとどのようなグラフを作成すべきであるのかがわからない。</span>
<span id="cb104-1269"><a href="#cb104-1269"></a>こんため</span>
<span id="cb104-1270"><a href="#cb104-1270"></a></span>
<span id="cb104-1271"><a href="#cb104-1271"></a><span class="fu">#### basic example</span></span>
<span id="cb104-1272"><a href="#cb104-1272"></a></span>
<span id="cb104-1275"><a href="#cb104-1275"></a><span class="in">```{r}</span></span>
<span id="cb104-1276"><a href="#cb104-1276"></a>pm <span class="ot">&lt;-</span> </span>
<span id="cb104-1277"><a href="#cb104-1277"></a>  iris <span class="sc">%&gt;%</span></span>
<span id="cb104-1278"><a href="#cb104-1278"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb104-1279"><a href="#cb104-1279"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species), </span>
<span id="cb104-1280"><a href="#cb104-1280"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Species"</span>)</span>
<span id="cb104-1281"><a href="#cb104-1281"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1282"><a href="#cb104-1282"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb104-1283"><a href="#cb104-1283"></a>pm</span>
<span id="cb104-1284"><a href="#cb104-1284"></a><span class="in">```</span></span>
<span id="cb104-1285"><a href="#cb104-1285"></a></span>
<span id="cb104-1288"><a href="#cb104-1288"></a><span class="in">```{r}</span></span>
<span id="cb104-1289"><a href="#cb104-1289"></a>pm <span class="ot">&lt;-</span> </span>
<span id="cb104-1290"><a href="#cb104-1290"></a>  iris <span class="sc">%&gt;%</span></span>
<span id="cb104-1291"><a href="#cb104-1291"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb104-1292"><a href="#cb104-1292"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species), </span>
<span id="cb104-1293"><a href="#cb104-1293"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Species"</span>), </span>
<span id="cb104-1294"><a href="#cb104-1294"></a>    <span class="at">lower   =</span> <span class="fu">list</span>(</span>
<span id="cb104-1295"><a href="#cb104-1295"></a>      <span class="at">continuous =</span> <span class="st">"smooth"</span>, </span>
<span id="cb104-1296"><a href="#cb104-1296"></a>      <span class="at">combo =</span> <span class="st">"facetdensity"</span>, </span>
<span id="cb104-1297"><a href="#cb104-1297"></a>      <span class="at">mappping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species)</span>
<span id="cb104-1298"><a href="#cb104-1298"></a>    )</span>
<span id="cb104-1299"><a href="#cb104-1299"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1300"><a href="#cb104-1300"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb104-1301"><a href="#cb104-1301"></a>pm</span>
<span id="cb104-1302"><a href="#cb104-1302"></a><span class="in">```</span></span>
<span id="cb104-1303"><a href="#cb104-1303"></a></span>
<span id="cb104-1306"><a href="#cb104-1306"></a><span class="in">```{r}</span></span>
<span id="cb104-1307"><a href="#cb104-1307"></a>pm <span class="ot">&lt;-</span> </span>
<span id="cb104-1308"><a href="#cb104-1308"></a>  iris <span class="sc">%&gt;%</span></span>
<span id="cb104-1309"><a href="#cb104-1309"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb104-1310"><a href="#cb104-1310"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">color =</span> Species), </span>
<span id="cb104-1311"><a href="#cb104-1311"></a>    <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span>, <span class="st">"Species"</span>), </span>
<span id="cb104-1312"><a href="#cb104-1312"></a>    <span class="at">upper =</span> <span class="st">"blank"</span>, </span>
<span id="cb104-1313"><a href="#cb104-1313"></a>    <span class="at">diag  =</span> <span class="cn">NULL</span>, </span>
<span id="cb104-1314"><a href="#cb104-1314"></a>    <span class="at">lower   =</span> <span class="fu">list</span>(</span>
<span id="cb104-1315"><a href="#cb104-1315"></a>      <span class="at">continuous =</span> <span class="st">"smooth"</span>, </span>
<span id="cb104-1316"><a href="#cb104-1316"></a>      <span class="at">combo =</span> <span class="st">"facetdensity"</span>, </span>
<span id="cb104-1317"><a href="#cb104-1317"></a>      <span class="at">mappping =</span> <span class="fu">aes</span>()</span>
<span id="cb104-1318"><a href="#cb104-1318"></a>    )</span>
<span id="cb104-1319"><a href="#cb104-1319"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1320"><a href="#cb104-1320"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb104-1321"><a href="#cb104-1321"></a>pm</span>
<span id="cb104-1322"><a href="#cb104-1322"></a><span class="in">```</span></span>
<span id="cb104-1323"><a href="#cb104-1323"></a></span>
<span id="cb104-1324"><a href="#cb104-1324"></a><span class="fu">#### custom functions</span></span>
<span id="cb104-1325"><a href="#cb104-1325"></a></span>
<span id="cb104-1328"><a href="#cb104-1328"></a><span class="in">```{r}</span></span>
<span id="cb104-1329"><a href="#cb104-1329"></a><span class="fu">data</span>(tips, <span class="at">package =</span> <span class="st">"reshape"</span>)</span>
<span id="cb104-1330"><a href="#cb104-1330"></a>my_bin <span class="ot">&lt;-</span> <span class="cf">function</span>(data, mapping, ..., <span class="at">low =</span> <span class="st">"#132B43"</span>, <span class="at">high =</span> <span class="st">"#56B1F7"</span>) {</span>
<span id="cb104-1331"><a href="#cb104-1331"></a>  <span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="at">mapping =</span> mapping) <span class="sc">+</span></span>
<span id="cb104-1332"><a href="#cb104-1332"></a>    <span class="fu">geom_bin2d</span>(...) <span class="sc">+</span></span>
<span id="cb104-1333"><a href="#cb104-1333"></a>    <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> low, <span class="at">high =</span> high) <span class="sc">+</span> </span>
<span id="cb104-1334"><a href="#cb104-1334"></a>    <span class="fu">theme</span>(</span>
<span id="cb104-1335"><a href="#cb104-1335"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"red"</span>)</span>
<span id="cb104-1336"><a href="#cb104-1336"></a>    )</span>
<span id="cb104-1337"><a href="#cb104-1337"></a>}</span>
<span id="cb104-1338"><a href="#cb104-1338"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb104-1339"><a href="#cb104-1339"></a>  tips, </span>
<span id="cb104-1340"><a href="#cb104-1340"></a>  <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"total_bill"</span>, <span class="st">"time"</span>, <span class="st">"tip"</span>), </span>
<span id="cb104-1341"><a href="#cb104-1341"></a>  <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb104-1342"><a href="#cb104-1342"></a>    <span class="at">continuous =</span> my_bin</span>
<span id="cb104-1343"><a href="#cb104-1343"></a>  )</span>
<span id="cb104-1344"><a href="#cb104-1344"></a>)</span>
<span id="cb104-1345"><a href="#cb104-1345"></a>pm</span>
<span id="cb104-1346"><a href="#cb104-1346"></a><span class="in">```</span></span>
<span id="cb104-1347"><a href="#cb104-1347"></a></span>
<span id="cb104-1350"><a href="#cb104-1350"></a><span class="in">```{r}</span></span>
<span id="cb104-1351"><a href="#cb104-1351"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb104-1352"><a href="#cb104-1352"></a>  tips, <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"total_bill"</span>, <span class="st">"time"</span>, <span class="st">"tip"</span>),</span>
<span id="cb104-1353"><a href="#cb104-1353"></a>  <span class="at">lower =</span> <span class="fu">list</span>(</span>
<span id="cb104-1354"><a href="#cb104-1354"></a>    <span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">binwidth =</span> <span class="dv">1</span>),</span>
<span id="cb104-1355"><a href="#cb104-1355"></a>    <span class="at">continuous =</span> <span class="fu">wrap</span>(my_bin, <span class="at">binwidth =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">0.5</span>), <span class="at">high =</span> <span class="st">"red"</span>)</span>
<span id="cb104-1356"><a href="#cb104-1356"></a>  )</span>
<span id="cb104-1357"><a href="#cb104-1357"></a>)</span>
<span id="cb104-1358"><a href="#cb104-1358"></a>pm</span>
<span id="cb104-1359"><a href="#cb104-1359"></a><span class="in">```</span></span>
<span id="cb104-1360"><a href="#cb104-1360"></a></span>
<span id="cb104-1361"><a href="#cb104-1361"></a><span class="fu">#### plot matrix subsetting</span></span>
<span id="cb104-1362"><a href="#cb104-1362"></a></span>
<span id="cb104-1365"><a href="#cb104-1365"></a><span class="in">```{r}</span></span>
<span id="cb104-1366"><a href="#cb104-1366"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(tips, <span class="at">columns =</span> <span class="fu">c</span>(<span class="st">"total_bill"</span>, <span class="st">"time"</span>, <span class="st">"tip"</span>))</span>
<span id="cb104-1367"><a href="#cb104-1367"></a>p  <span class="ot">&lt;-</span> pm[<span class="dv">3</span>, <span class="dv">1</span>]</span>
<span id="cb104-1368"><a href="#cb104-1368"></a>p  <span class="ot">&lt;-</span> p <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">color =</span> time)</span>
<span id="cb104-1369"><a href="#cb104-1369"></a>p</span>
<span id="cb104-1370"><a href="#cb104-1370"></a><span class="in">```</span></span>
<span id="cb104-1371"><a href="#cb104-1371"></a></span>
<span id="cb104-1374"><a href="#cb104-1374"></a><span class="in">```{r}</span></span>
<span id="cb104-1375"><a href="#cb104-1375"></a>pm[<span class="dv">3</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> p</span>
<span id="cb104-1376"><a href="#cb104-1376"></a>pm</span>
<span id="cb104-1377"><a href="#cb104-1377"></a><span class="in">```</span></span>
<span id="cb104-1378"><a href="#cb104-1378"></a></span>
<span id="cb104-1381"><a href="#cb104-1381"></a><span class="in">```{r}</span></span>
<span id="cb104-1382"><a href="#cb104-1382"></a>custom_car <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(mtcars[, <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"wt"</span>, <span class="st">"cyl"</span>)], </span>
<span id="cb104-1383"><a href="#cb104-1383"></a>                      <span class="at">upper =</span> <span class="st">"blank"</span>, <span class="at">title =</span> <span class="st">"Custom Example"</span>)</span>
<span id="cb104-1384"><a href="#cb104-1384"></a><span class="co"># ggplot example taken from example(geom_text)</span></span>
<span id="cb104-1385"><a href="#cb104-1385"></a>plot <span class="ot">&lt;-</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(mtcars, ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>wt, <span class="at">y=</span>mpg, <span class="at">label=</span><span class="fu">rownames</span>(mtcars)))</span>
<span id="cb104-1386"><a href="#cb104-1386"></a>plot <span class="ot">&lt;-</span> plot <span class="sc">+</span></span>
<span id="cb104-1387"><a href="#cb104-1387"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">colour=</span><span class="fu">factor</span>(cyl)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb104-1388"><a href="#cb104-1388"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_colour_discrete</span>(<span class="at">l=</span><span class="dv">40</span>)</span>
<span id="cb104-1389"><a href="#cb104-1389"></a>custom_car[<span class="dv">1</span>, <span class="dv">2</span>] <span class="ot">&lt;-</span> plot</span>
<span id="cb104-1390"><a href="#cb104-1390"></a>personal_plot <span class="ot">&lt;-</span> <span class="fu">ggally_text</span>(</span>
<span id="cb104-1391"><a href="#cb104-1391"></a>  <span class="st">"ggpairs allows you</span><span class="sc">\n</span><span class="st">to put in your</span><span class="sc">\n</span><span class="st">own plot.</span><span class="sc">\n</span><span class="st">Like that one.</span><span class="sc">\n</span><span class="st"> &lt;---"</span></span>
<span id="cb104-1392"><a href="#cb104-1392"></a>)</span>
<span id="cb104-1393"><a href="#cb104-1393"></a>custom_car[<span class="dv">1</span>, <span class="dv">3</span>] <span class="ot">&lt;-</span> personal_plot</span>
<span id="cb104-1394"><a href="#cb104-1394"></a>(custom_car)</span>
<span id="cb104-1395"><a href="#cb104-1395"></a><span class="in">```</span></span>
<span id="cb104-1396"><a href="#cb104-1396"></a></span>
<span id="cb104-1399"><a href="#cb104-1399"></a><span class="in">```{r}</span></span>
<span id="cb104-1400"><a href="#cb104-1400"></a><span class="do">## Remove binwidth warning from ggplot2</span></span>
<span id="cb104-1401"><a href="#cb104-1401"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(tips, <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">combo =</span> <span class="fu">wrap</span>(<span class="st">"facethist"</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>)))</span>
<span id="cb104-1402"><a href="#cb104-1402"></a>pm</span>
<span id="cb104-1403"><a href="#cb104-1403"></a></span>
<span id="cb104-1404"><a href="#cb104-1404"></a><span class="in">```</span></span>
<span id="cb104-1405"><a href="#cb104-1405"></a></span>
<span id="cb104-1408"><a href="#cb104-1408"></a><span class="in">```{r}</span></span>
<span id="cb104-1409"><a href="#cb104-1409"></a><span class="do">## Remove panel grid lines from correlation plots</span></span>
<span id="cb104-1410"><a href="#cb104-1410"></a>pm <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(</span>
<span id="cb104-1411"><a href="#cb104-1411"></a>  flea, <span class="at">columns =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb104-1412"><a href="#cb104-1412"></a>  <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">display_grid =</span> <span class="cn">FALSE</span>))</span>
<span id="cb104-1413"><a href="#cb104-1413"></a>)</span>
<span id="cb104-1414"><a href="#cb104-1414"></a>pm <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb104-1415"><a href="#cb104-1415"></a>  <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"black"</span>), </span>
<span id="cb104-1416"><a href="#cb104-1416"></a>  <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>))</span>
<span id="cb104-1417"><a href="#cb104-1417"></a><span class="in">```</span></span>
<span id="cb104-1418"><a href="#cb104-1418"></a></span>
<span id="cb104-1419"><a href="#cb104-1419"></a><span class="fu">### ggnetworkmap</span></span>
<span id="cb104-1420"><a href="#cb104-1420"></a></span>
<span id="cb104-1421"><a href="#cb104-1421"></a><span class="in">```{r eval=FALSE}</span></span>
<span id="cb104-1422"><a href="#cb104-1422"></a><span class="in">suppressMessages(library(ggplot2))</span></span>
<span id="cb104-1423"><a href="#cb104-1423"></a><span class="in">suppressMessages(library(maps))</span></span>
<span id="cb104-1424"><a href="#cb104-1424"></a><span class="in">suppressMessages(library(network))</span></span>
<span id="cb104-1425"><a href="#cb104-1425"></a><span class="in">suppressMessages(library(sna))</span></span>
<span id="cb104-1426"><a href="#cb104-1426"></a></span>
<span id="cb104-1427"><a href="#cb104-1427"></a><span class="in">airports &lt;- read.csv("http://datasets.flowingdata.com/tuts/maparcs/airports.csv", header = TRUE)</span></span>
<span id="cb104-1428"><a href="#cb104-1428"></a><span class="in">rownames(airports) &lt;- airports$iata</span></span>
<span id="cb104-1429"><a href="#cb104-1429"></a></span>
<span id="cb104-1430"><a href="#cb104-1430"></a><span class="in"># select some random flights</span></span>
<span id="cb104-1431"><a href="#cb104-1431"></a><span class="in">set.seed(1234)</span></span>
<span id="cb104-1432"><a href="#cb104-1432"></a><span class="in">flights &lt;- data.frame(</span></span>
<span id="cb104-1433"><a href="#cb104-1433"></a><span class="in">  origin = sample(airports[200:400, ]$iata, 200, replace = TRUE),</span></span>
<span id="cb104-1434"><a href="#cb104-1434"></a><span class="in">  destination = sample(airports[200:400, ]$iata, 200, replace = TRUE)</span></span>
<span id="cb104-1435"><a href="#cb104-1435"></a><span class="in">)</span></span>
<span id="cb104-1436"><a href="#cb104-1436"></a></span>
<span id="cb104-1437"><a href="#cb104-1437"></a><span class="in"># convert to network</span></span>
<span id="cb104-1438"><a href="#cb104-1438"></a><span class="in">flights &lt;- network(flights, directed = TRUE)</span></span>
<span id="cb104-1439"><a href="#cb104-1439"></a></span>
<span id="cb104-1440"><a href="#cb104-1440"></a><span class="in"># add geographic coordinates</span></span>
<span id="cb104-1441"><a href="#cb104-1441"></a><span class="in">flights %v% "lat" &lt;- airports[ network.vertex.names(flights), "lat" ]</span></span>
<span id="cb104-1442"><a href="#cb104-1442"></a><span class="in">flights %v% "lon" &lt;- airports[ network.vertex.names(flights), "long" ]</span></span>
<span id="cb104-1443"><a href="#cb104-1443"></a></span>
<span id="cb104-1444"><a href="#cb104-1444"></a><span class="in"># drop isolated airports</span></span>
<span id="cb104-1445"><a href="#cb104-1445"></a><span class="in">delete.vertices(flights, which(degree(flights) &lt; 2))</span></span>
<span id="cb104-1446"><a href="#cb104-1446"></a></span>
<span id="cb104-1447"><a href="#cb104-1447"></a><span class="in"># compute degree centrality</span></span>
<span id="cb104-1448"><a href="#cb104-1448"></a><span class="in">flights %v% "degree" &lt;- degree(flights, gmode = "digraph")</span></span>
<span id="cb104-1449"><a href="#cb104-1449"></a></span>
<span id="cb104-1450"><a href="#cb104-1450"></a><span class="in"># add random groups</span></span>
<span id="cb104-1451"><a href="#cb104-1451"></a><span class="in">flights %v% "mygroup" &lt;- sample(letters[1:4], network.size(flights), replace = TRUE)</span></span>
<span id="cb104-1452"><a href="#cb104-1452"></a></span>
<span id="cb104-1453"><a href="#cb104-1453"></a><span class="in"># create a map of the USA</span></span>
<span id="cb104-1454"><a href="#cb104-1454"></a><span class="in">usa &lt;- ggplot(map_data("usa"), aes(x = long, y = lat)) +</span></span>
<span id="cb104-1455"><a href="#cb104-1455"></a><span class="in">  geom_polygon(aes(group = group), color = "grey65",</span></span>
<span id="cb104-1456"><a href="#cb104-1456"></a><span class="in">               fill = "#f9f9f9", size = 0.2)</span></span>
<span id="cb104-1457"><a href="#cb104-1457"></a></span>
<span id="cb104-1458"><a href="#cb104-1458"></a><span class="in"># trim flights</span></span>
<span id="cb104-1459"><a href="#cb104-1459"></a><span class="in">delete.vertices(flights, which(flights %v% "lon" &lt; min(usa$data$long)))</span></span>
<span id="cb104-1460"><a href="#cb104-1460"></a><span class="in">delete.vertices(flights, which(flights %v% "lon" &gt; max(usa$data$long)))</span></span>
<span id="cb104-1461"><a href="#cb104-1461"></a><span class="in">delete.vertices(flights, which(flights %v% "lat" &lt; min(usa$data$lat)))</span></span>
<span id="cb104-1462"><a href="#cb104-1462"></a><span class="in">delete.vertices(flights, which(flights %v% "lat" &gt; max(usa$data$lat)))</span></span>
<span id="cb104-1463"><a href="#cb104-1463"></a></span>
<span id="cb104-1464"><a href="#cb104-1464"></a><span class="in"># overlay network data to map</span></span>
<span id="cb104-1465"><a href="#cb104-1465"></a><span class="in">ggnetworkmap(usa, flights, size = 4, great.circles = TRUE,</span></span>
<span id="cb104-1466"><a href="#cb104-1466"></a><span class="in">             node.group = mygroup, segment.color = "steelblue",</span></span>
<span id="cb104-1467"><a href="#cb104-1467"></a><span class="in">             ring.group = degree, weight = degree)</span></span>
<span id="cb104-1468"><a href="#cb104-1468"></a><span class="in">```</span></span>
<span id="cb104-1469"><a href="#cb104-1469"></a></span>
<span id="cb104-1470"><a href="#cb104-1470"></a><span class="fu">## gganimate</span></span>
<span id="cb104-1471"><a href="#cb104-1471"></a></span>
<span id="cb104-1472"><a href="#cb104-1472"></a><span class="co">[</span><span class="ot">github</span><span class="co">](https://gganimate.com/)</span></span>
<span id="cb104-1473"><a href="#cb104-1473"></a></span>
<span id="cb104-1474"><a href="#cb104-1474"></a><span class="in">```{r eval = FALSE}</span></span>
<span id="cb104-1475"><a href="#cb104-1475"></a><span class="in">library(gganimate)</span></span>
<span id="cb104-1476"><a href="#cb104-1476"></a></span>
<span id="cb104-1477"><a href="#cb104-1477"></a><span class="in">ggplot(mtcars, aes(factor(cyl), mpg)) + </span></span>
<span id="cb104-1478"><a href="#cb104-1478"></a><span class="in">  geom_boxplot() + </span></span>
<span id="cb104-1479"><a href="#cb104-1479"></a><span class="in">  transition_states(</span></span>
<span id="cb104-1480"><a href="#cb104-1480"></a><span class="in">    gear, </span></span>
<span id="cb104-1481"><a href="#cb104-1481"></a><span class="in">    transition_length = 2, </span></span>
<span id="cb104-1482"><a href="#cb104-1482"></a><span class="in">    state_length = 1</span></span>
<span id="cb104-1483"><a href="#cb104-1483"></a><span class="in">  ) + </span></span>
<span id="cb104-1484"><a href="#cb104-1484"></a><span class="in">  enter_fade() + </span></span>
<span id="cb104-1485"><a href="#cb104-1485"></a><span class="in">  exit_shrink() + </span></span>
<span id="cb104-1486"><a href="#cb104-1486"></a><span class="in">  ease_aes('sine-in-out')</span></span>
<span id="cb104-1487"><a href="#cb104-1487"></a><span class="in">```</span></span>
<span id="cb104-1488"><a href="#cb104-1488"></a></span>
<span id="cb104-1489"><a href="#cb104-1489"></a></span>
<span id="cb104-1490"><a href="#cb104-1490"></a></span>
<span id="cb104-1491"><a href="#cb104-1491"></a></span>
<span id="cb104-1492"><a href="#cb104-1492"></a></span>
<span id="cb104-1493"><a href="#cb104-1493"></a></span>
<span id="cb104-1494"><a href="#cb104-1494"></a></span>
<span id="cb104-1495"><a href="#cb104-1495"></a></span>
<span id="cb104-1496"><a href="#cb104-1496"></a><span class="fu">## waffle</span></span>
<span id="cb104-1497"><a href="#cb104-1497"></a></span>
<span id="cb104-1500"><a href="#cb104-1500"></a><span class="in">```{r}</span></span>
<span id="cb104-1501"><a href="#cb104-1501"></a><span class="fu">waffle</span>(<span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">25</span>, <span class="dv">20</span>, <span class="dv">5</span>), <span class="at">rows =</span> <span class="dv">8</span>)</span>
<span id="cb104-1502"><a href="#cb104-1502"></a><span class="in">```</span></span>
<span id="cb104-1503"><a href="#cb104-1503"></a></span>
<span id="cb104-1504"><a href="#cb104-1504"></a></span>
<span id="cb104-1505"><a href="#cb104-1505"></a></span>
<span id="cb104-1506"><a href="#cb104-1506"></a><span class="fu">## ggupset</span></span>
<span id="cb104-1509"><a href="#cb104-1509"></a><span class="in">```{r}</span></span>
<span id="cb104-1510"><a href="#cb104-1510"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-1511"><a href="#cb104-1511"></a><span class="fu">library</span>(ggupset)</span>
<span id="cb104-1512"><a href="#cb104-1512"></a><span class="fu">ggplot</span>(tidy_movies[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ], <span class="fu">aes</span>(<span class="at">x=</span>Genres)) <span class="sc">+</span></span>
<span id="cb104-1513"><a href="#cb104-1513"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb104-1514"><a href="#cb104-1514"></a>  <span class="fu">scale_x_upset</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>, <span class="at">sets=</span><span class="fu">c</span>(<span class="st">"Drama"</span>, <span class="st">"Action"</span>))</span>
<span id="cb104-1515"><a href="#cb104-1515"></a></span>
<span id="cb104-1516"><a href="#cb104-1516"></a> <span class="fu">ggplot</span>(tidy_movies[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ], <span class="fu">aes</span>(<span class="at">x=</span>Genres)) <span class="sc">+</span></span>
<span id="cb104-1517"><a href="#cb104-1517"></a>   <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb104-1518"><a href="#cb104-1518"></a>   <span class="fu">scale_x_upset</span>(<span class="at">n_intersections =</span> <span class="dv">5</span>, <span class="at">ytrans=</span><span class="st">"sqrt"</span>)</span>
<span id="cb104-1519"><a href="#cb104-1519"></a></span>
<span id="cb104-1520"><a href="#cb104-1520"></a> <span class="fu">ggplot</span>(tidy_movies[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ], <span class="fu">aes</span>(<span class="at">x=</span>Genres, <span class="at">y=</span>year)) <span class="sc">+</span></span>
<span id="cb104-1521"><a href="#cb104-1521"></a>   <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb104-1522"><a href="#cb104-1522"></a>   <span class="fu">scale_x_upset</span>(<span class="at">intersections =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">"Drama"</span>, <span class="st">"Comedy"</span>), <span class="fu">c</span>(<span class="st">"Short"</span>), <span class="fu">c</span>(<span class="st">"Short"</span>, <span class="st">"Animation"</span>)),</span>
<span id="cb104-1523"><a href="#cb104-1523"></a>                 <span class="at">sets =</span> <span class="fu">c</span>(<span class="st">"Drama"</span>, <span class="st">"Comedy"</span>, <span class="st">"Short"</span>, <span class="st">"Animation"</span>, <span class="st">"Horror"</span>))</span>
<span id="cb104-1524"><a href="#cb104-1524"></a><span class="in">```</span></span>
<span id="cb104-1525"><a href="#cb104-1525"></a></span>
<span id="cb104-1526"><a href="#cb104-1526"></a></span>
<span id="cb104-1527"><a href="#cb104-1527"></a><span class="fu">## Heat map with geom_tile</span></span>
<span id="cb104-1528"><a href="#cb104-1528"></a></span>
<span id="cb104-1529"><a href="#cb104-1529"></a><span class="fu">### Sample Data</span></span>
<span id="cb104-1530"><a href="#cb104-1530"></a></span>
<span id="cb104-1533"><a href="#cb104-1533"></a><span class="in">```{r}</span></span>
<span id="cb104-1534"><a href="#cb104-1534"></a><span class="fu">library</span>(reshape)</span>
<span id="cb104-1535"><a href="#cb104-1535"></a></span>
<span id="cb104-1536"><a href="#cb104-1536"></a><span class="co"># Data </span></span>
<span id="cb104-1537"><a href="#cb104-1537"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb104-1538"><a href="#cb104-1538"></a>m <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">round</span>(<span class="fu">rnorm</span>(<span class="dv">200</span>), <span class="dv">2</span>), <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb104-1539"><a href="#cb104-1539"></a><span class="fu">colnames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Col"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb104-1540"><a href="#cb104-1540"></a><span class="fu">rownames</span>(m) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Row"</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb104-1541"><a href="#cb104-1541"></a></span>
<span id="cb104-1542"><a href="#cb104-1542"></a><span class="co"># Transform the matrix in long format</span></span>
<span id="cb104-1543"><a href="#cb104-1543"></a>df <span class="ot">&lt;-</span> <span class="fu">melt</span>(m)</span>
<span id="cb104-1544"><a href="#cb104-1544"></a><span class="fu">colnames</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"value"</span>)</span>
<span id="cb104-1545"><a href="#cb104-1545"></a><span class="in">```</span></span>
<span id="cb104-1546"><a href="#cb104-1546"></a></span>
<span id="cb104-1547"><a href="#cb104-1547"></a></span>
<span id="cb104-1550"><a href="#cb104-1550"></a><span class="in">```{r}</span></span>
<span id="cb104-1551"><a href="#cb104-1551"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1552"><a href="#cb104-1552"></a>  <span class="fu">geom_tile</span>()</span>
<span id="cb104-1553"><a href="#cb104-1553"></a><span class="in">```</span></span>
<span id="cb104-1554"><a href="#cb104-1554"></a></span>
<span id="cb104-1555"><a href="#cb104-1555"></a></span>
<span id="cb104-1556"><a href="#cb104-1556"></a></span>
<span id="cb104-1559"><a href="#cb104-1559"></a><span class="in">```{r}</span></span>
<span id="cb104-1560"><a href="#cb104-1560"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1561"><a href="#cb104-1561"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span> </span>
<span id="cb104-1562"><a href="#cb104-1562"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb104-1563"><a href="#cb104-1563"></a><span class="in">```</span></span>
<span id="cb104-1564"><a href="#cb104-1564"></a></span>
<span id="cb104-1567"><a href="#cb104-1567"></a><span class="in">```{r}</span></span>
<span id="cb104-1568"><a href="#cb104-1568"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1569"><a href="#cb104-1569"></a>  <span class="fu">geom_tile</span>(</span>
<span id="cb104-1570"><a href="#cb104-1570"></a>    <span class="at">color =</span> <span class="st">"white"</span>, </span>
<span id="cb104-1571"><a href="#cb104-1571"></a>    <span class="at">lwd =</span> <span class="fl">1.5</span>, </span>
<span id="cb104-1572"><a href="#cb104-1572"></a>    <span class="at">linetype =</span> <span class="fl">1.</span></span>
<span id="cb104-1573"><a href="#cb104-1573"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1574"><a href="#cb104-1574"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb104-1575"><a href="#cb104-1575"></a><span class="in">```</span></span>
<span id="cb104-1576"><a href="#cb104-1576"></a></span>
<span id="cb104-1579"><a href="#cb104-1579"></a><span class="in">```{r}</span></span>
<span id="cb104-1580"><a href="#cb104-1580"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1581"><a href="#cb104-1581"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb104-1582"><a href="#cb104-1582"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> value), <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb104-1583"><a href="#cb104-1583"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb104-1584"><a href="#cb104-1584"></a><span class="in">```</span></span>
<span id="cb104-1585"><a href="#cb104-1585"></a></span>
<span id="cb104-1586"><a href="#cb104-1586"></a><span class="fu">### Color Palette</span></span>
<span id="cb104-1587"><a href="#cb104-1587"></a></span>
<span id="cb104-1590"><a href="#cb104-1590"></a><span class="in">```{r}</span></span>
<span id="cb104-1591"><a href="#cb104-1591"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1592"><a href="#cb104-1592"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb104-1593"><a href="#cb104-1593"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"red"</span>)</span>
<span id="cb104-1594"><a href="#cb104-1594"></a><span class="in">```</span></span>
<span id="cb104-1595"><a href="#cb104-1595"></a></span>
<span id="cb104-1596"><a href="#cb104-1596"></a></span>
<span id="cb104-1599"><a href="#cb104-1599"></a><span class="in">```{r}</span></span>
<span id="cb104-1600"><a href="#cb104-1600"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1601"><a href="#cb104-1601"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb104-1602"><a href="#cb104-1602"></a>  <span class="fu">scale_fill_gradient2</span>(</span>
<span id="cb104-1603"><a href="#cb104-1603"></a>    <span class="at">low =</span> <span class="st">"#075AFF"</span>, </span>
<span id="cb104-1604"><a href="#cb104-1604"></a>    <span class="at">mid =</span> <span class="st">"#FFFFCC"</span>, </span>
<span id="cb104-1605"><a href="#cb104-1605"></a>    <span class="at">high =</span> <span class="st">"#FF0000"</span></span>
<span id="cb104-1606"><a href="#cb104-1606"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1607"><a href="#cb104-1607"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb104-1608"><a href="#cb104-1608"></a><span class="in">```</span></span>
<span id="cb104-1609"><a href="#cb104-1609"></a></span>
<span id="cb104-1610"><a href="#cb104-1610"></a></span>
<span id="cb104-1611"><a href="#cb104-1611"></a></span>
<span id="cb104-1614"><a href="#cb104-1614"></a><span class="in">```{r}</span></span>
<span id="cb104-1615"><a href="#cb104-1615"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1616"><a href="#cb104-1616"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb104-1617"><a href="#cb104-1617"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">"RdYlGn"</span>)) <span class="sc">+</span></span>
<span id="cb104-1618"><a href="#cb104-1618"></a>  <span class="fu">coord_fixed</span>()</span>
<span id="cb104-1619"><a href="#cb104-1619"></a><span class="in">```</span></span>
<span id="cb104-1620"><a href="#cb104-1620"></a></span>
<span id="cb104-1621"><a href="#cb104-1621"></a><span class="fu">### Legend customization</span></span>
<span id="cb104-1622"><a href="#cb104-1622"></a></span>
<span id="cb104-1625"><a href="#cb104-1625"></a><span class="in">```{r}</span></span>
<span id="cb104-1626"><a href="#cb104-1626"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span> </span>
<span id="cb104-1627"><a href="#cb104-1627"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb104-1628"><a href="#cb104-1628"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span> </span>
<span id="cb104-1629"><a href="#cb104-1629"></a>  <span class="fu">guides</span>(</span>
<span id="cb104-1630"><a href="#cb104-1630"></a>    <span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">barwidth =</span> .<span class="dv">5</span>, <span class="at">barheight =</span> <span class="dv">20</span>)</span>
<span id="cb104-1631"><a href="#cb104-1631"></a>  )</span>
<span id="cb104-1632"><a href="#cb104-1632"></a><span class="in">```</span></span>
<span id="cb104-1633"><a href="#cb104-1633"></a></span>
<span id="cb104-1634"><a href="#cb104-1634"></a></span>
<span id="cb104-1635"><a href="#cb104-1635"></a></span>
<span id="cb104-1638"><a href="#cb104-1638"></a><span class="in">```{r}</span></span>
<span id="cb104-1639"><a href="#cb104-1639"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb104-1640"><a href="#cb104-1640"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-1641"><a href="#cb104-1641"></a></span>
<span id="cb104-1642"><a href="#cb104-1642"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb104-1643"><a href="#cb104-1643"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb104-1644"><a href="#cb104-1644"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb104-1645"><a href="#cb104-1645"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">title =</span> <span class="st">"Title"</span>)) </span>
<span id="cb104-1646"><a href="#cb104-1646"></a></span>
<span id="cb104-1647"><a href="#cb104-1647"></a><span class="in">```</span></span>
<span id="cb104-1648"><a href="#cb104-1648"></a></span>
<span id="cb104-1649"><a href="#cb104-1649"></a></span>
<span id="cb104-1652"><a href="#cb104-1652"></a><span class="in">```{r}</span></span>
<span id="cb104-1653"><a href="#cb104-1653"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb104-1654"><a href="#cb104-1654"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-1655"><a href="#cb104-1655"></a></span>
<span id="cb104-1656"><a href="#cb104-1656"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb104-1657"><a href="#cb104-1657"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb104-1658"><a href="#cb104-1658"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb104-1659"><a href="#cb104-1659"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colourbar</span>(<span class="at">label =</span> <span class="cn">FALSE</span>,</span>
<span id="cb104-1660"><a href="#cb104-1660"></a>                                <span class="at">ticks =</span> <span class="cn">FALSE</span>)) </span>
<span id="cb104-1661"><a href="#cb104-1661"></a> </span>
<span id="cb104-1662"><a href="#cb104-1662"></a></span>
<span id="cb104-1663"><a href="#cb104-1663"></a><span class="in">```</span></span>
<span id="cb104-1664"><a href="#cb104-1664"></a></span>
<span id="cb104-1665"><a href="#cb104-1665"></a></span>
<span id="cb104-1668"><a href="#cb104-1668"></a><span class="in">```{r}</span></span>
<span id="cb104-1669"><a href="#cb104-1669"></a><span class="co"># install.packages("ggplot2")</span></span>
<span id="cb104-1670"><a href="#cb104-1670"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-1671"><a href="#cb104-1671"></a></span>
<span id="cb104-1672"><a href="#cb104-1672"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb104-1673"><a href="#cb104-1673"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb104-1674"><a href="#cb104-1674"></a>  <span class="fu">coord_fixed</span>() <span class="sc">+</span></span>
<span id="cb104-1675"><a href="#cb104-1675"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>) </span>
<span id="cb104-1676"><a href="#cb104-1676"></a></span>
<span id="cb104-1677"><a href="#cb104-1677"></a><span class="in">```</span></span>
<span id="cb104-1678"><a href="#cb104-1678"></a></span>
<span id="cb104-1679"><a href="#cb104-1679"></a></span>
<span id="cb104-1680"><a href="#cb104-1680"></a><span class="fu">## Alluvial plot</span></span>
<span id="cb104-1681"><a href="#cb104-1681"></a></span>
<span id="cb104-1682"><a href="#cb104-1682"></a><span class="fu">### sample dataset</span></span>
<span id="cb104-1683"><a href="#cb104-1683"></a></span>
<span id="cb104-1686"><a href="#cb104-1686"></a><span class="in">```{r}</span></span>
<span id="cb104-1687"><a href="#cb104-1687"></a><span class="fu">data</span>(<span class="st">"vaccinations"</span>)</span>
<span id="cb104-1688"><a href="#cb104-1688"></a>vaccinations</span>
<span id="cb104-1689"><a href="#cb104-1689"></a><span class="in">```</span></span>
<span id="cb104-1690"><a href="#cb104-1690"></a></span>
<span id="cb104-1691"><a href="#cb104-1691"></a></span>
<span id="cb104-1692"><a href="#cb104-1692"></a><span class="fu">### plot</span></span>
<span id="cb104-1693"><a href="#cb104-1693"></a></span>
<span id="cb104-1694"><a href="#cb104-1694"></a>次の２つを使うことができるようになるのでコレを使うこと. 曲線の形は色々と選択することが可能である. </span>
<span id="cb104-1695"><a href="#cb104-1695"></a></span>
<span id="cb104-1696"><a href="#cb104-1696"></a><span class="ss">- </span>geom_alluvium</span>
<span id="cb104-1697"><a href="#cb104-1697"></a><span class="ss">- </span>geom_stratum</span>
<span id="cb104-1698"><a href="#cb104-1698"></a></span>
<span id="cb104-1701"><a href="#cb104-1701"></a><span class="in">```{r}</span></span>
<span id="cb104-1702"><a href="#cb104-1702"></a><span class="fu">ggplot</span>(</span>
<span id="cb104-1703"><a href="#cb104-1703"></a>  <span class="at">data =</span> vaccinations, </span>
<span id="cb104-1704"><a href="#cb104-1704"></a>  <span class="fu">aes</span>(</span>
<span id="cb104-1705"><a href="#cb104-1705"></a>    <span class="at">axis1 =</span> survey, </span>
<span id="cb104-1706"><a href="#cb104-1706"></a>    <span class="at">axis2 =</span> response, </span>
<span id="cb104-1707"><a href="#cb104-1707"></a>    <span class="at">y =</span> freq</span>
<span id="cb104-1708"><a href="#cb104-1708"></a>  )) <span class="sc">+</span> </span>
<span id="cb104-1709"><a href="#cb104-1709"></a>  <span class="fu">geom_alluvium</span>(<span class="fu">aes</span>(<span class="at">fill =</span> response), <span class="at">curve_type =</span> <span class="st">"sine"</span>) <span class="sc">+</span> </span>
<span id="cb104-1710"><a href="#cb104-1710"></a>  <span class="fu">geom_stratum</span>() <span class="sc">+</span> </span>
<span id="cb104-1711"><a href="#cb104-1711"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb104-1712"><a href="#cb104-1712"></a>    <span class="at">stat =</span> <span class="st">"stratum"</span>, </span>
<span id="cb104-1713"><a href="#cb104-1713"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(stratum))</span>
<span id="cb104-1714"><a href="#cb104-1714"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1715"><a href="#cb104-1715"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Survey"</span>, <span class="st">"Response"</span>), <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">05</span>)) <span class="sc">+</span></span>
<span id="cb104-1716"><a href="#cb104-1716"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb104-1717"><a href="#cb104-1717"></a></span>
<span id="cb104-1718"><a href="#cb104-1718"></a></span>
<span id="cb104-1719"><a href="#cb104-1719"></a></span>
<span id="cb104-1720"><a href="#cb104-1720"></a><span class="in">```</span></span>
<span id="cb104-1721"><a href="#cb104-1721"></a></span>
<span id="cb104-1722"><a href="#cb104-1722"></a></span>
<span id="cb104-1723"><a href="#cb104-1723"></a>もちろん色のカスタマイズも可能である.  </span>
<span id="cb104-1724"><a href="#cb104-1724"></a></span>
<span id="cb104-1727"><a href="#cb104-1727"></a><span class="in">```{r}</span></span>
<span id="cb104-1728"><a href="#cb104-1728"></a>colors <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="dv">4</span>, <span class="st">"Red-Blue"</span>)</span>
<span id="cb104-1729"><a href="#cb104-1729"></a></span>
<span id="cb104-1730"><a href="#cb104-1730"></a></span>
<span id="cb104-1731"><a href="#cb104-1731"></a><span class="fu">ggplot</span>(</span>
<span id="cb104-1732"><a href="#cb104-1732"></a>  <span class="at">data =</span> vaccinations, </span>
<span id="cb104-1733"><a href="#cb104-1733"></a>  <span class="fu">aes</span>(</span>
<span id="cb104-1734"><a href="#cb104-1734"></a>    <span class="at">axis1 =</span> survey, </span>
<span id="cb104-1735"><a href="#cb104-1735"></a>    <span class="at">axis2 =</span> response, </span>
<span id="cb104-1736"><a href="#cb104-1736"></a>    <span class="at">y =</span> freq</span>
<span id="cb104-1737"><a href="#cb104-1737"></a>  ) </span>
<span id="cb104-1738"><a href="#cb104-1738"></a>) <span class="sc">+</span> </span>
<span id="cb104-1739"><a href="#cb104-1739"></a>  <span class="fu">geom_alluvium</span>(<span class="fu">aes</span>(<span class="at">fill =</span> response)) <span class="sc">+</span> </span>
<span id="cb104-1740"><a href="#cb104-1740"></a>  <span class="fu">geom_stratum</span>() <span class="sc">+</span> </span>
<span id="cb104-1741"><a href="#cb104-1741"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb104-1742"><a href="#cb104-1742"></a>    <span class="at">stat =</span> <span class="st">"stratum"</span>, </span>
<span id="cb104-1743"><a href="#cb104-1743"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">after_stat</span>(stratum))</span>
<span id="cb104-1744"><a href="#cb104-1744"></a>  ) <span class="sc">+</span> </span>
<span id="cb104-1745"><a href="#cb104-1745"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">"Survey"</span>, <span class="st">"Response"</span>), <span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>, .<span class="dv">05</span>)) <span class="sc">+</span> </span>
<span id="cb104-1746"><a href="#cb104-1746"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colors) <span class="sc">+</span> </span>
<span id="cb104-1747"><a href="#cb104-1747"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb104-1748"><a href="#cb104-1748"></a>  </span>
<span id="cb104-1749"><a href="#cb104-1749"></a><span class="in">```</span></span>
<span id="cb104-1750"><a href="#cb104-1750"></a></span>
<span id="cb104-1753"><a href="#cb104-1753"></a><span class="in">```{r}</span></span>
<span id="cb104-1754"><a href="#cb104-1754"></a><span class="fu">hcl.colors</span>(<span class="dv">4</span>, <span class="st">"Red-Blue"</span>)</span>
<span id="cb104-1755"><a href="#cb104-1755"></a><span class="in">```</span></span>
<span id="cb104-1756"><a href="#cb104-1756"></a></span>
<span id="cb104-1757"><a href="#cb104-1757"></a></span>
<span id="cb104-1758"><a href="#cb104-1758"></a><span class="fu">## ggbumps</span></span>
<span id="cb104-1759"><a href="#cb104-1759"></a></span>
<span id="cb104-1762"><a href="#cb104-1762"></a><span class="in">```{r}</span></span>
<span id="cb104-1763"><a href="#cb104-1763"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-1764"><a href="#cb104-1764"></a><span class="fu">library</span>(ggbump)</span>
<span id="cb104-1765"><a href="#cb104-1765"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb104-1766"><a href="#cb104-1766"></a><span class="in">```</span></span>
<span id="cb104-1767"><a href="#cb104-1767"></a></span>
<span id="cb104-1768"><a href="#cb104-1768"></a></span>
<span id="cb104-1769"><a href="#cb104-1769"></a><span class="co">[</span><span class="ot">github</span><span class="co">](https://github.com/davidsjoberg/ggbump)</span></span>
<span id="cb104-1770"><a href="#cb104-1770"></a></span>
<span id="cb104-1773"><a href="#cb104-1773"></a><span class="in">```{r}</span></span>
<span id="cb104-1774"><a href="#cb104-1774"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">country =</span> <span class="fu">c</span>(<span class="st">"India"</span>, <span class="st">"India"</span>, <span class="st">"India"</span>, <span class="st">"Sweden"</span>, <span class="st">"Sweden"</span>, <span class="st">"Sweden"</span>, <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"Germany"</span>, <span class="st">"Finland"</span>, <span class="st">"Finland"</span>, <span class="st">"Finland"</span>),</span>
<span id="cb104-1775"><a href="#cb104-1775"></a>             <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>),</span>
<span id="cb104-1776"><a href="#cb104-1776"></a>             <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">492</span>, <span class="dv">246</span>, <span class="dv">246</span>, <span class="dv">369</span>, <span class="dv">123</span>, <span class="dv">492</span>, <span class="dv">246</span>, <span class="dv">369</span>, <span class="dv">123</span>, <span class="dv">123</span>, <span class="dv">492</span>, <span class="dv">369</span>))</span>
<span id="cb104-1777"><a href="#cb104-1777"></a></span>
<span id="cb104-1778"><a href="#cb104-1778"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb104-1779"><a href="#cb104-1779"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb104-1780"><a href="#cb104-1780"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(value, <span class="at">ties.method =</span> <span class="st">"random"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-1781"><a href="#cb104-1781"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb104-1782"><a href="#cb104-1782"></a></span>
<span id="cb104-1783"><a href="#cb104-1783"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(df))</span>
<span id="cb104-1784"><a href="#cb104-1784"></a><span class="in">```</span></span>
<span id="cb104-1785"><a href="#cb104-1785"></a></span>
<span id="cb104-1786"><a href="#cb104-1786"></a></span>
<span id="cb104-1787"><a href="#cb104-1787"></a></span>
<span id="cb104-1788"><a href="#cb104-1788"></a></span>
<span id="cb104-1789"><a href="#cb104-1789"></a></span>
<span id="cb104-1790"><a href="#cb104-1790"></a></span>
<span id="cb104-1791"><a href="#cb104-1791"></a></span>
<span id="cb104-1792"><a href="#cb104-1792"></a></span>
<span id="cb104-1793"><a href="#cb104-1793"></a></span>
<span id="cb104-1794"><a href="#cb104-1794"></a></span>
<span id="cb104-1795"><a href="#cb104-1795"></a></span>
<span id="cb104-1796"><a href="#cb104-1796"></a></span>
<span id="cb104-1797"><a href="#cb104-1797"></a></span>
<span id="cb104-1800"><a href="#cb104-1800"></a><span class="in">```{r}</span></span>
<span id="cb104-1801"><a href="#cb104-1801"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(year, rank, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb104-1802"><a href="#cb104-1802"></a>    <span class="fu">geom_bump</span>()</span>
<span id="cb104-1803"><a href="#cb104-1803"></a><span class="in">```</span></span>
<span id="cb104-1804"><a href="#cb104-1804"></a></span>
<span id="cb104-1807"><a href="#cb104-1807"></a><span class="in">```{r}</span></span>
<span id="cb104-1808"><a href="#cb104-1808"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, cowplot, wesanderson)</span>
<span id="cb104-1809"><a href="#cb104-1809"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(year, rank, <span class="at">color =</span> country)) <span class="sc">+</span></span>
<span id="cb104-1810"><a href="#cb104-1810"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb104-1811"><a href="#cb104-1811"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">min</span>(year)),</span>
<span id="cb104-1812"><a href="#cb104-1812"></a>            <span class="fu">aes</span>(<span class="at">x =</span> year <span class="sc">-</span> .<span class="dv">1</span>, <span class="at">label =</span> country), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb104-1813"><a href="#cb104-1813"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> <span class="fu">max</span>(year)),</span>
<span id="cb104-1814"><a href="#cb104-1814"></a>            <span class="fu">aes</span>(<span class="at">x =</span> year <span class="sc">+</span> .<span class="dv">1</span>, <span class="at">label =</span> country), <span class="at">size =</span> <span class="dv">5</span>, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb104-1815"><a href="#cb104-1815"></a>  <span class="fu">geom_bump</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">smooth =</span> <span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb104-1816"><a href="#cb104-1816"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">2010.6</span>, <span class="fl">2013.4</span>),</span>
<span id="cb104-1817"><a href="#cb104-1817"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2011</span>, <span class="dv">2013</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb104-1818"><a href="#cb104-1818"></a>  <span class="fu">theme_minimal_grid</span>(<span class="at">font_size =</span> <span class="dv">14</span>, <span class="at">line_size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb104-1819"><a href="#cb104-1819"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb104-1820"><a href="#cb104-1820"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb104-1821"><a href="#cb104-1821"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"RANK"</span>,</span>
<span id="cb104-1822"><a href="#cb104-1822"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb104-1823"><a href="#cb104-1823"></a>  <span class="fu">scale_y_reverse</span>() <span class="sc">+</span></span>
<span id="cb104-1824"><a href="#cb104-1824"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">name =</span> <span class="st">"GrandBudapest1"</span>))</span>
<span id="cb104-1825"><a href="#cb104-1825"></a><span class="in">```</span></span>
<span id="cb104-1826"><a href="#cb104-1826"></a></span>
<span id="cb104-1829"><a href="#cb104-1829"></a><span class="in">```{r}</span></span>
<span id="cb104-1830"><a href="#cb104-1830"></a><span class="co"># Original df</span></span>
<span id="cb104-1831"><a href="#cb104-1831"></a>df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">season =</span> <span class="fu">c</span>(<span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>, </span>
<span id="cb104-1832"><a href="#cb104-1832"></a>                        <span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>, </span>
<span id="cb104-1833"><a href="#cb104-1833"></a>                        <span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>,</span>
<span id="cb104-1834"><a href="#cb104-1834"></a>                        <span class="st">"Spring"</span>, <span class="st">"Pre-season"</span>, <span class="st">"Summer"</span>, <span class="st">"Season finale"</span>, <span class="st">"Autumn"</span>, <span class="st">"Winter"</span>),</span>
<span id="cb104-1835"><a href="#cb104-1835"></a>             <span class="at">rank =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>,</span>
<span id="cb104-1836"><a href="#cb104-1836"></a>                      <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>,</span>
<span id="cb104-1837"><a href="#cb104-1837"></a>                      <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">1</span>,</span>
<span id="cb104-1838"><a href="#cb104-1838"></a>                      <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb104-1839"><a href="#cb104-1839"></a>             <span class="at">player =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"David"</span>, <span class="dv">6</span>),</span>
<span id="cb104-1840"><a href="#cb104-1840"></a>                        <span class="fu">rep</span>(<span class="st">"Anna"</span>, <span class="dv">6</span>),</span>
<span id="cb104-1841"><a href="#cb104-1841"></a>                        <span class="fu">rep</span>(<span class="st">"Franz"</span>, <span class="dv">6</span>),</span>
<span id="cb104-1842"><a href="#cb104-1842"></a>                        <span class="fu">rep</span>(<span class="st">"Ika"</span>, <span class="dv">6</span>)))</span>
<span id="cb104-1843"><a href="#cb104-1843"></a></span>
<span id="cb104-1844"><a href="#cb104-1844"></a><span class="co"># Create factors and order factor</span></span>
<span id="cb104-1845"><a href="#cb104-1845"></a><span class="co"># チュートリアルでは文字列などでも描画出来ていたけどここではうまくいかなった</span></span>
<span id="cb104-1846"><a href="#cb104-1846"></a><span class="co"># x軸を数値に変更すると上手く描画できる</span></span>
<span id="cb104-1847"><a href="#cb104-1847"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb104-1848"><a href="#cb104-1848"></a>  <span class="fu">mutate</span>(<span class="at">season =</span> <span class="fu">factor</span>(season, <span class="at">levels =</span> <span class="fu">unique</span>(season), <span class="at">ordered =</span> <span class="cn">TRUE</span>)) </span>
<span id="cb104-1849"><a href="#cb104-1849"></a></span>
<span id="cb104-1850"><a href="#cb104-1850"></a><span class="co"># Add manual axis labels to plot</span></span>
<span id="cb104-1851"><a href="#cb104-1851"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(season, rank, <span class="at">color =</span> player)) <span class="sc">+</span></span>
<span id="cb104-1852"><a href="#cb104-1852"></a>  <span class="fu">geom_bump</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">smooth =</span> <span class="dv">20</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span></span>
<span id="cb104-1853"><a href="#cb104-1853"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">shape =</span> player)) <span class="sc">+</span></span>
<span id="cb104-1854"><a href="#cb104-1854"></a>  <span class="fu">theme_minimal_grid</span>(<span class="at">font_size =</span> <span class="dv">10</span>, <span class="at">line_size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb104-1855"><a href="#cb104-1855"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb104-1856"><a href="#cb104-1856"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb104-1857"><a href="#cb104-1857"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">name =</span> <span class="st">"IsleofDogs1"</span>))</span>
<span id="cb104-1858"><a href="#cb104-1858"></a><span class="in">```</span></span>
<span id="cb104-1859"><a href="#cb104-1859"></a></span>
<span id="cb104-1860"><a href="#cb104-1860"></a></span>
<span id="cb104-1861"><a href="#cb104-1861"></a></span>
<span id="cb104-1862"><a href="#cb104-1862"></a></span>
<span id="cb104-1863"><a href="#cb104-1863"></a><span class="fu">## ggridges</span></span>
<span id="cb104-1864"><a href="#cb104-1864"></a></span>
<span id="cb104-1865"><a href="#cb104-1865"></a><span class="co">[</span><span class="ot">公式ページ</span><span class="co">](https://cran.r-project.org/web/packages/ggridges/vignettes/introduction.html)</span>をみるのが１番．どのようなグラフが描けるのかは，サンプルを見て欲しい．グラフの幅が拡がること間違いなし．</span>
<span id="cb104-1866"><a href="#cb104-1866"></a></span>
<span id="cb104-1869"><a href="#cb104-1869"></a><span class="in">```{r}</span></span>
<span id="cb104-1870"><a href="#cb104-1870"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">2</span>))</span>
<span id="cb104-1871"><a href="#cb104-1871"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(x, y, <span class="at">height =</span> height)) <span class="sc">+</span> <span class="fu">geom_ridgeline</span>()</span>
<span id="cb104-1872"><a href="#cb104-1872"></a><span class="in">```</span></span>
<span id="cb104-1873"><a href="#cb104-1873"></a></span>
<span id="cb104-1874"><a href="#cb104-1874"></a></span>
<span id="cb104-1875"><a href="#cb104-1875"></a></span>
<span id="cb104-1878"><a href="#cb104-1878"></a><span class="in">```{r}</span></span>
<span id="cb104-1879"><a href="#cb104-1879"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">y =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb104-1880"><a href="#cb104-1880"></a>plot_base <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(x, y, <span class="at">height =</span> height))</span>
<span id="cb104-1881"><a href="#cb104-1881"></a></span>
<span id="cb104-1882"><a href="#cb104-1882"></a>plot_base <span class="sc">+</span> <span class="fu">geom_ridgeline</span>() <span class="sc">|</span> plot_base <span class="sc">+</span> <span class="fu">geom_ridgeline</span>(<span class="at">min_height =</span> <span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb104-1883"><a href="#cb104-1883"></a><span class="in">```</span></span>
<span id="cb104-1884"><a href="#cb104-1884"></a></span>
<span id="cb104-1885"><a href="#cb104-1885"></a></span>
<span id="cb104-1886"><a href="#cb104-1886"></a></span>
<span id="cb104-1889"><a href="#cb104-1889"></a><span class="in">```{r}</span></span>
<span id="cb104-1890"><a href="#cb104-1890"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Species, <span class="at">fill =</span> <span class="fu">factor</span>(<span class="fu">stat</span>(quantile)))) <span class="sc">+</span></span>
<span id="cb104-1891"><a href="#cb104-1891"></a>  <span class="fu">stat_density_ridges</span>(</span>
<span id="cb104-1892"><a href="#cb104-1892"></a>    <span class="at">geom =</span> <span class="st">"density_ridges_gradient"</span>, <span class="at">calc_ecdf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-1893"><a href="#cb104-1893"></a>    <span class="at">quantiles =</span> <span class="dv">4</span>, <span class="at">quantile_lines =</span> <span class="cn">TRUE</span></span>
<span id="cb104-1894"><a href="#cb104-1894"></a>  ) <span class="sc">+</span></span>
<span id="cb104-1895"><a href="#cb104-1895"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">name =</span> <span class="st">"Quartiles"</span>)</span>
<span id="cb104-1896"><a href="#cb104-1896"></a><span class="in">```</span></span>
<span id="cb104-1897"><a href="#cb104-1897"></a></span>
<span id="cb104-1898"><a href="#cb104-1898"></a></span>
<span id="cb104-1901"><a href="#cb104-1901"></a><span class="in">```{r}</span></span>
<span id="cb104-1902"><a href="#cb104-1902"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Species, <span class="at">fill =</span> <span class="fu">factor</span>(<span class="fu">stat</span>(quantile)))) <span class="sc">+</span></span>
<span id="cb104-1903"><a href="#cb104-1903"></a>  <span class="fu">stat_density_ridges</span>(</span>
<span id="cb104-1904"><a href="#cb104-1904"></a>    <span class="at">geom =</span> <span class="st">"density_ridges_gradient"</span>,</span>
<span id="cb104-1905"><a href="#cb104-1905"></a>    <span class="at">calc_ecdf =</span> <span class="cn">TRUE</span>,</span>
<span id="cb104-1906"><a href="#cb104-1906"></a>    <span class="at">quantiles =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>)</span>
<span id="cb104-1907"><a href="#cb104-1907"></a>  ) <span class="sc">+</span></span>
<span id="cb104-1908"><a href="#cb104-1908"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb104-1909"><a href="#cb104-1909"></a>    <span class="at">name =</span> <span class="st">"Probability"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#FF0000A0"</span>, <span class="st">"#A0A0A0A0"</span>, <span class="st">"#0000FFA0"</span>),</span>
<span id="cb104-1910"><a href="#cb104-1910"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"(0, 0.025]"</span>, <span class="st">"(0.025, 0.975]"</span>, <span class="st">"(0.975, 1]"</span>)</span>
<span id="cb104-1911"><a href="#cb104-1911"></a>  )</span>
<span id="cb104-1912"><a href="#cb104-1912"></a><span class="in">```</span></span>
<span id="cb104-1913"><a href="#cb104-1913"></a></span>
<span id="cb104-1916"><a href="#cb104-1916"></a><span class="in">```{r}</span></span>
<span id="cb104-1917"><a href="#cb104-1917"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Species)) <span class="sc">+</span></span>
<span id="cb104-1918"><a href="#cb104-1918"></a>  <span class="fu">geom_density_ridges</span>(</span>
<span id="cb104-1919"><a href="#cb104-1919"></a>    <span class="at">jittered_points =</span> <span class="cn">TRUE</span>, <span class="at">quantile_lines =</span> <span class="cn">TRUE</span>, <span class="at">scale =</span> <span class="fl">0.9</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>,</span>
<span id="cb104-1920"><a href="#cb104-1920"></a>    <span class="at">vline_size =</span> <span class="dv">1</span>, <span class="at">vline_color =</span> <span class="st">"red"</span>,</span>
<span id="cb104-1921"><a href="#cb104-1921"></a>    <span class="at">point_size =</span> <span class="fl">0.4</span>, <span class="at">point_alpha =</span> <span class="dv">1</span>,</span>
<span id="cb104-1922"><a href="#cb104-1922"></a>    <span class="at">position =</span> <span class="fu">position_raincloud</span>(<span class="at">adjust_vlines =</span> <span class="cn">TRUE</span>)</span>
<span id="cb104-1923"><a href="#cb104-1923"></a>  )</span>
<span id="cb104-1924"><a href="#cb104-1924"></a><span class="in">```</span></span>
<span id="cb104-1925"><a href="#cb104-1925"></a></span>
<span id="cb104-1926"><a href="#cb104-1926"></a></span>
<span id="cb104-1927"><a href="#cb104-1927"></a>スケールは縦スケールである．重なりを避けたい場合には小さくすればいいし，重なりがあっても強調したい場合には大きい値を設定すればよい. </span>
<span id="cb104-1928"><a href="#cb104-1928"></a></span>
<span id="cb104-1929"><a href="#cb104-1929"></a></span>
<span id="cb104-1932"><a href="#cb104-1932"></a><span class="in">```{r}</span></span>
<span id="cb104-1933"><a href="#cb104-1933"></a><span class="fu">ggplot</span>(lincoln_weather, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Mean Temperature [F]</span><span class="st">`</span>, <span class="at">y =</span> Month, <span class="at">fill =</span> <span class="fu">stat</span>(x))) <span class="sc">+</span></span>
<span id="cb104-1934"><a href="#cb104-1934"></a>  <span class="fu">geom_density_ridges_gradient</span>(<span class="at">scale =</span> <span class="dv">3</span>, <span class="at">rel_min_height =</span> <span class="fl">0.01</span>) <span class="sc">+</span></span>
<span id="cb104-1935"><a href="#cb104-1935"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">name =</span> <span class="st">"Temp. [F]"</span>, <span class="at">option =</span> <span class="st">"C"</span>) <span class="sc">+</span></span>
<span id="cb104-1936"><a href="#cb104-1936"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Temperatures in Lincoln NE in 2016'</span>)</span>
<span id="cb104-1937"><a href="#cb104-1937"></a><span class="in">```</span></span>
<span id="cb104-1938"><a href="#cb104-1938"></a></span>
<span id="cb104-1939"><a href="#cb104-1939"></a><span class="fu">## ggblend</span></span>
<span id="cb104-1940"><a href="#cb104-1940"></a></span>
<span id="cb104-1941"><a href="#cb104-1941"></a><span class="co">[</span><span class="ot">link</span><span class="co">](https://mjskay.github.io/ggblend/)</span></span>
<span id="cb104-1942"><a href="#cb104-1942"></a></span>
<span id="cb104-1943"><a href="#cb104-1943"></a>透過色でグラフを記述すると，レンダリングの順番でグラフの見え方が変わる. </span>
<span id="cb104-1944"><a href="#cb104-1944"></a>pngにしているとブレンドが機能しないとのことである. </span>
<span id="cb104-1945"><a href="#cb104-1945"></a>RStudioのレンダリングを<span class="in">`cario png`</span>にするとRStudio上でレンダリングすることが可能であった. </span>
<span id="cb104-1946"><a href="#cb104-1946"></a></span>
<span id="cb104-1949"><a href="#cb104-1949"></a><span class="in">```{r}</span></span>
<span id="cb104-1950"><a href="#cb104-1950"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb104-1951"><a href="#cb104-1951"></a><span class="fu">library</span>(ggblend)</span>
<span id="cb104-1952"><a href="#cb104-1952"></a><span class="fu">theme_set</span>(ggdist<span class="sc">::</span><span class="fu">theme_ggdist</span>() <span class="sc">+</span> <span class="fu">theme</span>(</span>
<span id="cb104-1953"><a href="#cb104-1953"></a>  <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="dv">1</span>), <span class="at">lineheight =</span> <span class="fl">1.1</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb104-1954"><a href="#cb104-1954"></a>  <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb104-1955"><a href="#cb104-1955"></a>  <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"gray75"</span>, <span class="at">fill =</span> <span class="cn">NA</span>)</span>
<span id="cb104-1956"><a href="#cb104-1956"></a>))</span>
<span id="cb104-1957"><a href="#cb104-1957"></a></span>
<span id="cb104-1958"><a href="#cb104-1958"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb104-1959"><a href="#cb104-1959"></a>df_a <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">0</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">1</span>), <span class="at">set =</span> <span class="st">"a"</span>)</span>
<span id="cb104-1960"><a href="#cb104-1960"></a>df_b <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">1</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">500</span>, <span class="dv">2</span>), <span class="at">set =</span> <span class="st">"b"</span>)</span>
<span id="cb104-1961"><a href="#cb104-1961"></a></span>
<span id="cb104-1962"><a href="#cb104-1962"></a>df_ab <span class="ot">=</span> <span class="fu">rbind</span>(df_a, df_b) <span class="sc">|&gt;</span></span>
<span id="cb104-1963"><a href="#cb104-1963"></a>  <span class="fu">transform</span>(<span class="at">order =</span> <span class="st">"draw a then b"</span>)</span>
<span id="cb104-1964"><a href="#cb104-1964"></a></span>
<span id="cb104-1965"><a href="#cb104-1965"></a>df_ba <span class="ot">=</span> <span class="fu">rbind</span>(df_b, df_a) <span class="sc">|&gt;</span></span>
<span id="cb104-1966"><a href="#cb104-1966"></a>  <span class="fu">transform</span>(<span class="at">order =</span> <span class="st">"draw b then a"</span>)</span>
<span id="cb104-1967"><a href="#cb104-1967"></a></span>
<span id="cb104-1968"><a href="#cb104-1968"></a>df <span class="ot">=</span> <span class="fu">rbind</span>(df_ab, df_ba)</span>
<span id="cb104-1969"><a href="#cb104-1969"></a><span class="in">```</span></span>
<span id="cb104-1970"><a href="#cb104-1970"></a></span>
<span id="cb104-1971"><a href="#cb104-1971"></a></span>
<span id="cb104-1972"><a href="#cb104-1972"></a></span>
<span id="cb104-1975"><a href="#cb104-1975"></a><span class="in">```{r}</span></span>
<span id="cb104-1976"><a href="#cb104-1976"></a>df <span class="sc">|&gt;</span></span>
<span id="cb104-1977"><a href="#cb104-1977"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> set)) <span class="sc">+</span></span>
<span id="cb104-1978"><a href="#cb104-1978"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb104-1979"><a href="#cb104-1979"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb104-1980"><a href="#cb104-1980"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> order) <span class="sc">+</span></span>
<span id="cb104-1981"><a href="#cb104-1981"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"geom_point() without blending"</span>, <span class="at">subtitle =</span> <span class="st">"Draw order matters."</span>)</span>
<span id="cb104-1982"><a href="#cb104-1982"></a><span class="in">```</span></span>
<span id="cb104-1983"><a href="#cb104-1983"></a></span>
<span id="cb104-1984"><a href="#cb104-1984"></a></span>
<span id="cb104-1987"><a href="#cb104-1987"></a><span class="in">```{r}</span></span>
<span id="cb104-1988"><a href="#cb104-1988"></a><span class="fu">options</span>(<span class="at">ggblend.check_blend =</span> <span class="cn">FALSE</span>)</span>
<span id="cb104-1989"><a href="#cb104-1989"></a>df <span class="sc">|&gt;</span></span>
<span id="cb104-1990"><a href="#cb104-1990"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y, <span class="at">color =</span> set)) <span class="sc">+</span></span>
<span id="cb104-1991"><a href="#cb104-1991"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span> <span class="fu">blend</span>(<span class="st">"multiply"</span>) <span class="sc">+</span></span>
<span id="cb104-1992"><a href="#cb104-1992"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb104-1993"><a href="#cb104-1993"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span> order) <span class="sc">+</span></span>
<span id="cb104-1994"><a href="#cb104-1994"></a>  <span class="fu">labs</span>(</span>
<span id="cb104-1995"><a href="#cb104-1995"></a>    <span class="at">title =</span> <span class="st">"geom_point(alpha = 0.5) |&gt; blend('multiply')"</span>,</span>
<span id="cb104-1996"><a href="#cb104-1996"></a>    <span class="at">subtitle =</span> <span class="st">"Draw order does not matter, but color is too dark."</span></span>
<span id="cb104-1997"><a href="#cb104-1997"></a>  )</span>
<span id="cb104-1998"><a href="#cb104-1998"></a><span class="in">```</span></span>
<span id="cb104-1999"><a href="#cb104-1999"></a></span>
<span id="cb104-2000"><a href="#cb104-2000"></a></span>
<span id="cb104-2001"><a href="#cb104-2001"></a></span>
<span id="cb104-2002"><a href="#cb104-2002"></a></span>
<span id="cb104-2003"><a href="#cb104-2003"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"descPosition":"bottom","loop":false,"closeEffect":"zoom","openEffect":"zoom","selector":".lightbox"});</script>




</body></html>