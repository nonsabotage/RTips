<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Working with Layouts and Composition – R Tips</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../contents/website/udemy_database-specialist/am-2-note.html" rel="next">
<link href="../../../contents/website/graphic_design_with_ggplot2/ch06_working_with_colors.html" rel="prev">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-029eb6d98d0d67994351ddf54abe5c11.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;800&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">R Tips</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-home" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Home</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-home">    
        <li>
    <a class="dropdown-item" href="../../../index.html">
 <span class="dropdown-text">Home</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-web-site" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Web Site</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-web-site">    
        <li class="dropdown-header">ALL</li>
        <li>
    <a class="dropdown-item" href="../../../contents/website/r4ds2e/index.html">
 <span class="dropdown-text">R for Data Science 2e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/leaflet4r/index.html">
 <span class="dropdown-text">Leaflet for R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/analizeUSCensus/index.html">
 <span class="dropdown-text">Analyzing US Census Data</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/graphic_design_with_ggplot2/index.html">
 <span class="dropdown-text">Graphic Design with ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/udemy_database-specialist/am-2-note.html">
 <span class="dropdown-text">Udemyデータベーススペシャリスト</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/website/quarto/guide/index.html">
 <span class="dropdown-text">QuartoDashboard</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-books" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">books</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-books">    
        <li class="dropdown-header">note</li>
        <li>
    <a class="dropdown-item" href="../../../contents/books/13_教員のため教育データ分析/index.html">
 <span class="dropdown-text">教員のための教育データ分析</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/14_入門統計学/index.html">
 <span class="dropdown-text">入門統計学</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/15_プロになるためのWeb技術入門/index.html">
 <span class="dropdown-text">プロになるためのWeb技術入門</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="../../../contents/books/01_Rによる実証分析_2e/index.html">
 <span class="dropdown-text">Rによる実証分析2e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/02_因果推論ミックステープ/index.html">
 <span class="dropdown-text">因果推論ミックステープ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/03_数値シミュレーションで身につける統計の仕組み/index.html">
 <span class="dropdown-text">数値シミュレーションで学ぶ統計の仕組み</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/05_統計的因果推論の理論と実際/index.html">
 <span class="dropdown-text">統計的因果推論の理論と実際</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Python</li>
        <li>
    <a class="dropdown-item" href="../../../contents/books/06_Pythonではじめる数理最適化/index.html">
 <span class="dropdown-text">Pythonではじめる数理最適化 2nd</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/07_NumpyInfinity/ch01_Pythonの基礎.html">
 <span class="dropdown-text">Numpy Infinity</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/08_handbook_lightgbm/cl02_データ理解.html">
 <span class="dropdown-text">LightGBMハンドブック</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/09_Pythonで学ぶ数理最適化/ch01-基礎編.html">
 <span class="dropdown-text">Pythonで学ぶ数理最適化</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/10_爆速Python/ch02_組込み機能のパフォーマンスを最大限に引き出す.html">
 <span class="dropdown-text">爆速Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/11_Pythonではじめる時系列分析入門/index.html">
 <span class="dropdown-text">Pythonではじめる時系列分析</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/books/12_いきなりPython/index.html">
 <span class="dropdown-text">いきなりPython</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-libs" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">libs</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-libs">    
        <li class="dropdown-header">R</li>
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/argparse/index.html">
 <span class="dropdown-text">argparse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/arrow/index.html">
 <span class="dropdown-text">arrow</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/assertr/index.html">
 <span class="dropdown-text">assertr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/base/working.html">
 <span class="dropdown-text">base</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/corrr/working.html">
 <span class="dropdown-text">corrr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ComplexHeatmap/working.html">
 <span class="dropdown-text">ComplexHeatmap</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/duckdb/working.html">
 <span class="dropdown-text">duckdb</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/dbplyr/working.html">
 <span class="dropdown-text">dbplyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/DBI/working.html">
 <span class="dropdown-text">DBI</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggspatial/working.html">
 <span class="dropdown-text">ggspatial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/GGally/working.html">
 <span class="dropdown-text">GGally</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggtext/working.html">
 <span class="dropdown-text">ggtext</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggfittext/working.html">
 <span class="dropdown-text">ggfittext</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/gganimate/working.html">
 <span class="dropdown-text">gganimate</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggmosaic/working.html">
 <span class="dropdown-text">ggmosaic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/ggplot2/index.html">
 <span class="dropdown-text">ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/legendry/index.html">
 <span class="dropdown-text">legendry</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/treemapify/working.html">
 <span class="dropdown-text">treemapify</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/tidyverse/index.html">
 <span class="dropdown-text">tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/sf/working.html">
 <span class="dropdown-text">sf</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/igraph/index.html">
 <span class="dropdown-text">igraph</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/patchwork/working.html">
 <span class="dropdown-text">pathcwork</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/plotly/index.html">
 <span class="dropdown-text">plotly</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/R/pointblank/index.html">
 <span class="dropdown-text">pointblank</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li class="dropdown-header">Python</li>
        <li>
    <a class="dropdown-item" href="../../../contents/libs/Python/pydantic/index.html">
 <span class="dropdown-text">pydantic</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/Python/pandera/index.html">
 <span class="dropdown-text">pandera</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/Python/duckdb/index.html">
 <span class="dropdown-text">duckdb</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/Python/sqlite3/index.html">
 <span class="dropdown-text">sqlite3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/libs/Python/plotnine/index.html">
 <span class="dropdown-text">plotnine</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-notes">    
        <li class="dropdown-header">Notes</li>
        <li>
    <a class="dropdown-item" href="../../../contents/notes/ggplot2/index.html">
 <span class="dropdown-text">ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/notes/development/index.html">
 <span class="dropdown-text">development</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/notes/development/index.html">
 <span class="dropdown-text">bash</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-utils" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Utils</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-utils">    
        <li class="dropdown-header">Utils</li>
        <li>
    <a class="dropdown-item" href="../../../contents/utils/01_写真GPS/index.html">
 <span class="dropdown-text">01_写真GPS</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sql" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">sql</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sql">    
        <li class="dropdown-header">DuckDB</li>
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/documentaion/index.html">
 <span class="dropdown-text">Documentaion</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/sql-bigdata/index.html">
 <span class="dropdown-text">ビッグデータレシピ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/mytips/01_.html">
 <span class="dropdown-text">My Tips</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/sql/duckdb/SpatialDataAnalysiswithDuckDB/working.html">
 <span class="dropdown-text">Spatial DataAnalysis with DuckDB</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-test" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Test</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-test">    
        <li class="dropdown-header">Test</li>
        <li>
    <a class="dropdown-item" href="../../../contents/test/bash/quick_sample.html">
 <span class="dropdown-text">Bash</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/R/renv.html">
 <span class="dropdown-text">R</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/R2/renv.html">
 <span class="dropdown-text">R2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../contents/test/python/notebook.html">
 <span class="dropdown-text">Python</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">ALL</li><li class="breadcrumb-item"><a href="../../../contents/website/graphic_design_with_ggplot2/index.html">Graphic Design with ggplot2</a></li><li class="breadcrumb-item"><a href="../../../contents/website/graphic_design_with_ggplot2/ch07_working_with_layouts_and_composition.html">Working with Layouts and Composition</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">ALL</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">R for Data Science 2e</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/r4ds2e/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Import</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/r4ds2e/Import/ch23_arrow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">23 Arrow</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Leaflet for R</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch01_map_object.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Map Widget</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch02_basemaps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basemap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch03_markers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Markers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch04_popups_and_shapes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Popups and Shapes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch05_lines_and_shapes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lines and Shapes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch06_geojson.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with GeoJSON and TopoJSON</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch07_raster_images.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Raster Images</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch08_shiny_integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Shiny Integration</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch09_Colors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Colors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch10_Legends.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Legends</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch11_show_hide_layers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Show/Hide Layers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch12_choropleths.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Choropleths</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/leaflet4r/chapters/ch13_projection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Projections</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Analyzing US Census Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/analizeUSCensus/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/analizeUSCensus/ch06_mapping_census_data_with_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mapping Census data with R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/analizeUSCensus/ch07_spatial_analysis_with_us_census_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Spatial analysis with US Census data</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Graphic Design with ggplot2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/graphic_design_with_ggplot2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/graphic_design_with_ggplot2/ch01_concepts_of_the_ggplot2_packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts of the ggplot2 Packages pt 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/graphic_design_with_ggplot2/ch02_concepts_of_the_ggplot2_part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Concepts of the ggplot2 Packages pt 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/graphic_design_with_ggplot2/ch03_data_communication.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data Communication</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/graphic_design_with_ggplot2/ch04_working_with_labels_and_annotations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Labels and Annotations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/graphic_design_with_ggplot2/ch06_working_with_colors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Working with Colors</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/graphic_design_with_ggplot2/ch07_working_with_layouts_and_composition.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Working with Layouts and Composition</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">Udemyデータベーススペシャリスト</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/udemy_database-specialist/am-2-note.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Udemy 午前2</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false">
 <span class="menu-text">QuartoDashboard</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/quarto/guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">はじめに</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../contents/website/quarto/guide/01_dashboard-sample-python.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Development Indicators by Continent</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup" id="toc-setup" class="nav-link active" data-scroll-target="#setup"><span class="header-section-number">1</span> Setup</a></li>
  <li><a href="#legend-placement-and-styling" id="toc-legend-placement-and-styling" class="nav-link" data-scroll-target="#legend-placement-and-styling"><span class="header-section-number">2</span> Legend Placement and Styling</a>
  <ul class="collapse">
  <li><a href="#discrete" id="toc-discrete" class="nav-link" data-scroll-target="#discrete"><span class="header-section-number">2.1</span> discrete</a></li>
  <li><a href="#continuous" id="toc-continuous" class="nav-link" data-scroll-target="#continuous"><span class="header-section-number">2.2</span> Continuous</a></li>
  <li><a href="#key-glyphs" id="toc-key-glyphs" class="nav-link" data-scroll-target="#key-glyphs"><span class="header-section-number">2.3</span> Key Glyphs</a></li>
  </ul></li>
  <li><a href="#composing-ggplot" id="toc-composing-ggplot" class="nav-link" data-scroll-target="#composing-ggplot"><span class="header-section-number">3</span> Composing ggplot</a>
  <ul class="collapse">
  <li><a href="#patchwork" id="toc-patchwork" class="nav-link" data-scroll-target="#patchwork"><span class="header-section-number">3.1</span> patchwork</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">ALL</li><li class="breadcrumb-item"><a href="../../../contents/website/graphic_design_with_ggplot2/index.html">Graphic Design with ggplot2</a></li><li class="breadcrumb-item"><a href="../../../contents/website/graphic_design_with_ggplot2/ch07_working_with_layouts_and_composition.html">Working with Layouts and Composition</a></li></ol></nav>
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Working with Layouts and Composition</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta column-body">

    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">October 6, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-1_e21b738ef135defaa1b634d9c2c769d8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>renv<span class="sc">::</span><span class="fu">activate</span>(here<span class="sc">::</span><span class="fu">here</span>())</span>
<span id="cb1-2"><a href="#cb1-2"></a>cur_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"contents/website/graphic_design_with_ggplot2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-2_4a0b09d7e4bfd8db9983d4bae13acd4b">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="st">"tidyverse"</span>, </span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="st">"magick"</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="st">"ggplot2"</span>, </span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="st">"readr"</span>, </span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="st">"tibble"</span>, </span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="st">"tidyr"</span>, </span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="st">"forcats"</span>, </span>
<span id="cb2-9"><a href="#cb2-9"></a>  <span class="st">"stringr"</span>,</span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="st">"lubridate"</span>, </span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="st">"here"</span>, </span>
<span id="cb2-12"><a href="#cb2-12"></a>  <span class="st">"systemfonts"</span>, </span>
<span id="cb2-13"><a href="#cb2-13"></a>  <span class="st">"magick"</span>, </span>
<span id="cb2-14"><a href="#cb2-14"></a>  <span class="st">"scales"</span>, </span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="st">"grid"</span>,</span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="st">"grDevices"</span>, </span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="st">"colorspace"</span>, </span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="st">"viridis"</span>, </span>
<span id="cb2-19"><a href="#cb2-19"></a>  <span class="st">"RColorBrewer"</span>, </span>
<span id="cb2-20"><a href="#cb2-20"></a>  <span class="st">"rcartocolor"</span>,</span>
<span id="cb2-21"><a href="#cb2-21"></a>  <span class="st">"scico"</span>, </span>
<span id="cb2-22"><a href="#cb2-22"></a>  <span class="st">"ggsci"</span>, </span>
<span id="cb2-23"><a href="#cb2-23"></a>  <span class="st">"ggthemes"</span>, </span>
<span id="cb2-24"><a href="#cb2-24"></a>  <span class="st">"nord"</span>, </span>
<span id="cb2-25"><a href="#cb2-25"></a>  <span class="st">"MetBrewer"</span>, </span>
<span id="cb2-26"><a href="#cb2-26"></a>  <span class="st">"ggrepel"</span>,</span>
<span id="cb2-27"><a href="#cb2-27"></a>  <span class="st">"ggforce"</span>,</span>
<span id="cb2-28"><a href="#cb2-28"></a>  <span class="st">"ggtext"</span>, </span>
<span id="cb2-29"><a href="#cb2-29"></a>  <span class="st">"ggfittext"</span>,</span>
<span id="cb2-30"><a href="#cb2-30"></a>  <span class="st">"ggdist"</span>, </span>
<span id="cb2-31"><a href="#cb2-31"></a>  <span class="st">"ggbeeswarm"</span>, </span>
<span id="cb2-32"><a href="#cb2-32"></a>  <span class="st">"gghalves"</span>, </span>
<span id="cb2-33"><a href="#cb2-33"></a>  <span class="st">"patchwork"</span>, </span>
<span id="cb2-34"><a href="#cb2-34"></a>  <span class="st">"palmerpenguins"</span>, </span>
<span id="cb2-35"><a href="#cb2-35"></a>  <span class="st">"rnaturalearth"</span>, </span>
<span id="cb2-36"><a href="#cb2-36"></a>  <span class="st">"sf"</span>, </span>
<span id="cb2-37"><a href="#cb2-37"></a>  <span class="st">"rmapshaper"</span>, </span>
<span id="cb2-38"><a href="#cb2-38"></a>  <span class="st">"devtools"</span>, </span>
<span id="cb2-39"><a href="#cb2-39"></a>  <span class="st">"extrafont"</span></span>
<span id="cb2-40"><a href="#cb2-40"></a>) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(\(x) <span class="fu">library</span>(x, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="fu">library</span>(colorblindr)</span>
<span id="cb2-43"><a href="#cb2-43"></a><span class="fu">library</span>(showtext)</span>
<span id="cb2-44"><a href="#cb2-44"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="fu">font_add_google</span>(<span class="st">"Noto Sans"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="setup" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Setup</h1>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-3_337e7333818f2d25d92abac813e8dd7b">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>bikes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb3-2"><a href="#cb3-2"></a>    <span class="fu">here</span>(cur_dir, <span class="st">"ggplot2-course-data/london-bikes-custom.csv"</span>), </span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="at">col_types =</span> <span class="st">"Dcfffilllddddc"</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>)</span>
<span id="cb3-5"><a href="#cb3-5"></a></span>
<span id="cb3-6"><a href="#cb3-6"></a>bikes<span class="sc">$</span>season <span class="ot">&lt;-</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(bikes<span class="sc">$</span>season)</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a><span class="fu">theme_set</span>(</span>
<span id="cb3-9"><a href="#cb3-9"></a>    <span class="fu">theme_light</span>(</span>
<span id="cb3-10"><a href="#cb3-10"></a>        <span class="at">base_size =</span> <span class="dv">14</span>, </span>
<span id="cb3-11"><a href="#cb3-11"></a>        <span class="at">base_family =</span> <span class="st">"Noto Sans"</span></span>
<span id="cb3-12"><a href="#cb3-12"></a>    )</span>
<span id="cb3-13"><a href="#cb3-13"></a>)</span>
<span id="cb3-14"><a href="#cb3-14"></a></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="fu">theme_update</span>(</span>
<span id="cb3-16"><a href="#cb3-16"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb3-18"><a href="#cb3-18"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>, </span>
<span id="cb3-19"><a href="#cb3-19"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>)</span>
<span id="cb3-21"><a href="#cb3-21"></a></span>
<span id="cb3-22"><a href="#cb3-22"></a></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="fu">glimpse</span>(bikes)</span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt; Rows: 1,454</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; Columns: 14</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">#&gt; $ date         &lt;date&gt; 2015-01-04, 2015-01-04, 2015-01-05, 2015-01-05, 2015-01-…</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">#&gt; $ day_night    &lt;chr&gt; "day", "night", "day", "night", "day", "night", "day", "n…</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt; $ year         &lt;fct&gt; 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 2015, 201…</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="co">#&gt; $ month        &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, …</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">#&gt; $ season       &lt;fct&gt; winter, winter, winter, winter, winter, winter, winter, w…</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">#&gt; $ count        &lt;int&gt; 6830, 2404, 14763, 5609, 14501, 6112, 16358, 4706, 9971, …</span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">#&gt; $ is_workday   &lt;lgl&gt; FALSE, FALSE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, T…</span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">#&gt; $ is_weekend   &lt;lgl&gt; TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">#&gt; $ is_holiday   &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, F…</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="co">#&gt; $ temp         &lt;dbl&gt; 2.166667, 2.791667, 8.958333, 7.125000, 9.000000, 6.70833…</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">#&gt; $ temp_feel    &lt;dbl&gt; -0.750000, 2.041667, 7.708333, 5.708333, 6.458333, 4.2083…</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co">#&gt; $ humidity     &lt;dbl&gt; 95.16667, 93.37500, 81.08333, 79.54167, 80.20833, 77.5833…</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="co">#&gt; $ wind_speed   &lt;dbl&gt; 10.416667, 4.583333, 8.666667, 9.041667, 19.208333, 12.79…</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">#&gt; $ weather_type &lt;chr&gt; "broken clouds", "clear", "broken clouds", "cloudy", "bro…</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="legend-placement-and-styling" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Legend Placement and Styling</h1>
<section id="discrete" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="discrete"><span class="header-section-number">2.1</span> discrete</h2>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-4_77dbca884ddddee4468672bddc530f44">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#3c89d9"</span>, <span class="st">"#1ec99b"</span>, <span class="st">"#F7B01B"</span>, <span class="st">"#a26e7c"</span>)</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="fu">ggplot</span>(</span>
<span id="cb4-4"><a href="#cb4-4"></a>    bikes,</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb4-6"><a href="#cb4-6"></a>        <span class="at">color =</span> season)</span>
<span id="cb4-7"><a href="#cb4-7"></a>  ) <span class="sc">+</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="continuous" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="continuous"><span class="header-section-number">2.2</span> Continuous</h2>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-5_2c85c570a684c736e45395775b99ae74">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb5-2"><a href="#cb5-2"></a>    bikes,</span>
<span id="cb5-3"><a href="#cb5-3"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb5-4"><a href="#cb5-4"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb5-5"><a href="#cb5-5"></a>  ) <span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-9"><a href="#cb5-9"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb5-10"><a href="#cb5-10"></a>      <span class="at">legend.justification =</span> <span class="st">"right"</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-5-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-6_17434a606b7df8bf6d118ce7a8f6e2a7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb6-2"><a href="#cb6-2"></a>    bikes,</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb6-4"><a href="#cb6-4"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb6-5"><a href="#cb6-5"></a>  ) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb6-8"><a href="#cb6-8"></a>      <span class="at">guide =</span> <span class="st">"colorbar"</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  ) <span class="sc">+</span> </span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="fu">theme</span>(</span>
<span id="cb6-11"><a href="#cb6-11"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>), </span>
<span id="cb6-12"><a href="#cb6-12"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb6-13"><a href="#cb6-13"></a>  )</span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; Warning: A numeric `legend.position` argument in `theme()` was deprecated in ggplot2</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; 3.5.0.</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; ℹ Please use the `legend.position.inside` argument of `theme()` instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>次は凡例を離散的に表現しているが、 プロットの色自体は色分けされていないことに注意する。</p>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-7_894ef7942e7a7f85f27f0f56ee4147e0">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb7-2"><a href="#cb7-2"></a>    bikes,</span>
<span id="cb7-3"><a href="#cb7-3"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb7-4"><a href="#cb7-4"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb7-5"><a href="#cb7-5"></a>  ) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb7-8"><a href="#cb7-8"></a>      <span class="at">guide =</span> <span class="st">"colorsteps"</span>,</span>
<span id="cb7-9"><a href="#cb7-9"></a>  ) <span class="sc">+</span> </span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-11"><a href="#cb7-11"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>), </span>
<span id="cb7-12"><a href="#cb7-12"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>次はプロットの色自体も離散的にしている。つまり、<code>viridis_b</code>を使っている。</p>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-8_3f9d7db19c86ffd206be21b95c5fd4f8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>bikes <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>    <span class="fu">ggplot</span>(</span>
<span id="cb8-3"><a href="#cb8-3"></a>        <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count, <span class="at">color =</span> humidity)</span>
<span id="cb8-4"><a href="#cb8-4"></a>    ) <span class="sc">+</span> </span>
<span id="cb8-5"><a href="#cb8-5"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="fu">scale_color_viridis_b</span>(</span>
<span id="cb8-7"><a href="#cb8-7"></a>        <span class="at">guide =</span> <span class="st">"colorsteps"</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>    ) <span class="sc">+</span> </span>
<span id="cb8-9"><a href="#cb8-9"></a>    <span class="fu">theme</span>(</span>
<span id="cb8-10"><a href="#cb8-10"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>), </span>
<span id="cb8-11"><a href="#cb8-11"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>細かく凡例を調整したいときには次のように<code>guide_colorsteps</code>を使う。</p>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-9_9d472d2b09de10d29c838e08d43f5ba8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb9-2"><a href="#cb9-2"></a>    bikes,</span>
<span id="cb9-3"><a href="#cb9-3"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb9-4"><a href="#cb9-4"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb9-5"><a href="#cb9-5"></a>  ) <span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">scale_color_viridis_b</span>(</span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">30</span>, <span class="dv">90</span>, <span class="dv">10</span>),</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">100</span>),</span>
<span id="cb9-10"><a href="#cb9-10"></a>    <span class="at">guide =</span> <span class="fu">guide_colorsteps</span>(</span>
<span id="cb9-11"><a href="#cb9-11"></a>      <span class="at">title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb9-12"><a href="#cb9-12"></a>      <span class="at">title.hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb9-13"><a href="#cb9-13"></a>      <span class="at">show.limits =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-14"><a href="#cb9-14"></a>      <span class="at">frame.colour =</span> <span class="st">"black"</span>,</span>
<span id="cb9-15"><a href="#cb9-15"></a>      <span class="at">frame.linewidth =</span> <span class="dv">3</span>,</span>
<span id="cb9-16"><a href="#cb9-16"></a>      <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">8</span>, <span class="st">"lines"</span>), </span>
<span id="cb9-17"><a href="#cb9-17"></a>      <span class="at">ticks.linewidth =</span> <span class="dv">1</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>    )</span>
<span id="cb9-19"><a href="#cb9-19"></a>  ) <span class="sc">+</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>  <span class="fu">theme</span>(</span>
<span id="cb9-21"><a href="#cb9-21"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>),</span>
<span id="cb9-22"><a href="#cb9-22"></a>    <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-10_ff79e52b449fa859bb92f0071eb357c2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb10-2"><a href="#cb10-2"></a>    bikes,</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb10-4"><a href="#cb10-4"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb10-5"><a href="#cb10-5"></a>  ) <span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="at">breaks =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">100</span>),</span>
<span id="cb10-10"><a href="#cb10-10"></a>    <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(</span>
<span id="cb10-11"><a href="#cb10-11"></a>      <span class="at">title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb10-12"><a href="#cb10-12"></a>      <span class="at">title.hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb10-13"><a href="#cb10-13"></a>      <span class="at">ticks =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-14"><a href="#cb10-14"></a>      <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">20</span>, <span class="st">"lines"</span>),</span>
<span id="cb10-15"><a href="#cb10-15"></a>      <span class="at">barheight =</span> <span class="fu">unit</span>(.<span class="dv">6</span>, <span class="st">"lines"</span>)</span>
<span id="cb10-16"><a href="#cb10-16"></a>    )</span>
<span id="cb10-17"><a href="#cb10-17"></a>  ) <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-19"><a href="#cb10-19"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb10-20"><a href="#cb10-20"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-10-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="key-glyphs" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="key-glyphs"><span class="header-section-number">2.3</span> Key Glyphs</h2>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-11_0a6b4673338c284f334617ffae11622f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb11-2"><a href="#cb11-2"></a>    bikes,</span>
<span id="cb11-3"><a href="#cb11-3"></a>    <span class="fu">aes</span>(<span class="at">x =</span> lubridate<span class="sc">::</span><span class="fu">week</span>(date),</span>
<span id="cb11-4"><a href="#cb11-4"></a>        <span class="at">y =</span> count,</span>
<span id="cb11-5"><a href="#cb11-5"></a>        <span class="at">color =</span> day_night)</span>
<span id="cb11-6"><a href="#cb11-6"></a>  ) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="at">fun =</span> sum,</span>
<span id="cb11-10"><a href="#cb11-10"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>  ) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb11-13"><a href="#cb11-13"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#28A87D"</span>, <span class="st">"#663399"</span>),</span>
<span id="cb11-14"><a href="#cb11-14"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>  ) <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16"></a>  <span class="fu">theme</span>(</span>
<span id="cb11-17"><a href="#cb11-17"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb11-18"><a href="#cb11-18"></a>  )</span>
<span id="cb11-19"><a href="#cb11-19"></a><span class="co">#&gt; Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.</span></span>
<span id="cb11-20"><a href="#cb11-20"></a><span class="co">#&gt; ℹ Please use `linewidth` instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-11-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-12_e3bb9395b9df40b102d04babbf0e2b1c">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb12-2"><a href="#cb12-2"></a>    bikes,</span>
<span id="cb12-3"><a href="#cb12-3"></a>    <span class="fu">aes</span>(<span class="at">x =</span> lubridate<span class="sc">::</span><span class="fu">week</span>(date),</span>
<span id="cb12-4"><a href="#cb12-4"></a>        <span class="at">y =</span> count,</span>
<span id="cb12-5"><a href="#cb12-5"></a>        <span class="at">color =</span> day_night)</span>
<span id="cb12-6"><a href="#cb12-6"></a>  ) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb12-8"><a href="#cb12-8"></a>    <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb12-9"><a href="#cb12-9"></a>    <span class="at">fun =</span> sum,</span>
<span id="cb12-10"><a href="#cb12-10"></a>    <span class="at">key_glyph =</span> <span class="st">"timeseries"</span>,</span>
<span id="cb12-11"><a href="#cb12-11"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>  ) <span class="sc">+</span></span>
<span id="cb12-13"><a href="#cb12-13"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#28A87D"</span>, <span class="st">"#663399"</span>),</span>
<span id="cb12-15"><a href="#cb12-15"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb12-16"><a href="#cb12-16"></a>  ) <span class="sc">+</span></span>
<span id="cb12-17"><a href="#cb12-17"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-18"><a href="#cb12-18"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb12-19"><a href="#cb12-19"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-12-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="composing-ggplot" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Composing ggplot</h1>
<section id="patchwork" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="patchwork"><span class="header-section-number">3.1</span> patchwork</h2>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-13_d566985692a0667f1ebc531a4ca03aa6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>theme_std <span class="ot">&lt;-</span> <span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">"Noto Sans"</span>))</span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="fu">theme_update</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">12</span>)),</span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">12</span>)),</span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> .<span class="dv">4</span>),</span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb13-10"><a href="#cb13-10"></a>  <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)),</span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"white"</span>)</span>
<span id="cb13-12"><a href="#cb13-12"></a>)</span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co">#&gt; Warning: The `size` argument of `element_line()` is deprecated as of ggplot2 3.4.0.</span></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="co">#&gt; ℹ Please use the `linewidth` argument instead.</span></span>
<span id="cb13-15"><a href="#cb13-15"></a></span>
<span id="cb13-16"><a href="#cb13-16"></a>bikes_sorted <span class="ot">&lt;-</span></span>
<span id="cb13-17"><a href="#cb13-17"></a>  bikes <span class="sc">%&gt;%</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weather_type)) <span class="sc">%&gt;%</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>  <span class="fu">group_by</span>(weather_type) <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb13-21"><a href="#cb13-21"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb13-22"><a href="#cb13-22"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-23"><a href="#cb13-23"></a>    <span class="at">weather_type =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(</span>
<span id="cb13-24"><a href="#cb13-24"></a>      <span class="fu">str_to_title</span>(<span class="fu">str_wrap</span>(weather_type, <span class="dv">5</span>)), sum</span>
<span id="cb13-25"><a href="#cb13-25"></a>    )</span>
<span id="cb13-26"><a href="#cb13-26"></a>  )</span>
<span id="cb13-27"><a href="#cb13-27"></a></span>
<span id="cb13-28"><a href="#cb13-28"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb13-29"><a href="#cb13-29"></a>    bikes_sorted,</span>
<span id="cb13-30"><a href="#cb13-30"></a>    <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">y =</span> count, <span class="at">color =</span> weather_type)</span>
<span id="cb13-31"><a href="#cb13-31"></a>  ) <span class="sc">+</span></span>
<span id="cb13-32"><a href="#cb13-32"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb13-33"><a href="#cb13-33"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb13-34"><a href="#cb13-34"></a>    <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">fun =</span> <span class="st">"sum"</span>, <span class="at">size =</span> <span class="dv">12</span></span>
<span id="cb13-35"><a href="#cb13-35"></a>  ) <span class="sc">+</span></span>
<span id="cb13-36"><a href="#cb13-36"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb13-37"><a href="#cb13-37"></a>    <span class="at">geom =</span> <span class="st">"linerange"</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">fun.max =</span> <span class="cf">function</span>(y) <span class="fu">sum</span>(y),</span>
<span id="cb13-38"><a href="#cb13-38"></a>    <span class="at">size =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb13-39"><a href="#cb13-39"></a>  ) <span class="sc">+</span></span>
<span id="cb13-40"><a href="#cb13-40"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb13-41"><a href="#cb13-41"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb13-42"><a href="#cb13-42"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8500000</span>),</span>
<span id="cb13-43"><a href="#cb13-43"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(<span class="at">scale =</span> .<span class="dv">0001</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)</span>
<span id="cb13-44"><a href="#cb13-44"></a>  ) <span class="sc">+</span></span>
<span id="cb13-45"><a href="#cb13-45"></a>  <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb13-46"><a href="#cb13-46"></a>    <span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>, <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-47"><a href="#cb13-47"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb13-48"><a href="#cb13-48"></a>  ) <span class="sc">+</span></span>
<span id="cb13-49"><a href="#cb13-49"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-50"><a href="#cb13-50"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sum of reported bike shares"</span>, <span class="at">tag =</span> <span class="st">"P1"</span>,</span>
<span id="cb13-51"><a href="#cb13-51"></a>  ) <span class="sc">+</span></span>
<span id="cb13-52"><a href="#cb13-52"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-53"><a href="#cb13-53"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb13-54"><a href="#cb13-54"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb13-55"><a href="#cb13-55"></a>                               <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">15</span>), <span class="at">lineheight =</span> .<span class="dv">9</span>)</span>
<span id="cb13-56"><a href="#cb13-56"></a>  )</span>
<span id="cb13-57"><a href="#cb13-57"></a></span>
<span id="cb13-58"><a href="#cb13-58"></a></span>
<span id="cb13-59"><a href="#cb13-59"></a>p2 <span class="ot">&lt;-</span> bikes_sorted <span class="sc">%&gt;%</span></span>
<span id="cb13-60"><a href="#cb13-60"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"winter"</span>, is_weekend <span class="sc">==</span> <span class="cn">TRUE</span>, day_night <span class="sc">==</span> <span class="st">"night"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-61"><a href="#cb13-61"></a>  <span class="fu">group_by</span>(weather_type, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-62"><a href="#cb13-62"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-63"><a href="#cb13-63"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb13-64"><a href="#cb13-64"></a>      <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">y =</span> id, <span class="at">color =</span> weather_type)</span>
<span id="cb13-65"><a href="#cb13-65"></a>    ) <span class="sc">+</span></span>
<span id="cb13-66"><a href="#cb13-66"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.5</span>) <span class="sc">+</span></span>
<span id="cb13-67"><a href="#cb13-67"></a>    <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb13-68"><a href="#cb13-68"></a>      <span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>, <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-69"><a href="#cb13-69"></a>      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb13-70"><a href="#cb13-70"></a>    ) <span class="sc">+</span></span>
<span id="cb13-71"><a href="#cb13-71"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-72"><a href="#cb13-72"></a>      <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Reported bike shares on</span><span class="sc">\n</span><span class="st">weekend winter nights"</span>, <span class="at">tag =</span> <span class="st">"P2"</span>,</span>
<span id="cb13-73"><a href="#cb13-73"></a>    ) <span class="sc">+</span></span>
<span id="cb13-74"><a href="#cb13-74"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="cn">NA</span>), <span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb13-75"><a href="#cb13-75"></a></span>
<span id="cb13-76"><a href="#cb13-76"></a></span>
<span id="cb13-77"><a href="#cb13-77"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#cc0000"</span>, <span class="st">"#000080"</span>)</span>
<span id="cb13-78"><a href="#cb13-78"></a></span>
<span id="cb13-79"><a href="#cb13-79"></a>p3 <span class="ot">&lt;-</span> bikes <span class="sc">%&gt;%</span></span>
<span id="cb13-80"><a href="#cb13-80"></a>  <span class="fu">group_by</span>(<span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">week</span>(date), day_night, year) <span class="sc">%&gt;%</span></span>
<span id="cb13-81"><a href="#cb13-81"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb13-82"><a href="#cb13-82"></a>  <span class="fu">group_by</span>(week, day_night) <span class="sc">%&gt;%</span></span>
<span id="cb13-83"><a href="#cb13-83"></a>  <span class="fu">mutate</span>(<span class="at">avg =</span> <span class="fu">mean</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb13-84"><a href="#cb13-84"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> count, <span class="at">group =</span> <span class="fu">interaction</span>(day_night, year))) <span class="sc">+</span></span>
<span id="cb13-85"><a href="#cb13-85"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"grey65"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-86"><a href="#cb13-86"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> avg, <span class="at">color =</span> day_night), <span class="at">stat =</span> <span class="st">"unique"</span>, <span class="at">size =</span> <span class="fl">1.7</span>) <span class="sc">+</span></span>
<span id="cb13-87"><a href="#cb13-87"></a>    <span class="fu">annotate</span>(</span>
<span id="cb13-88"><a href="#cb13-88"></a>      <span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Day"</span>, <span class="st">"Night"</span>), <span class="at">color =</span> my_colors,</span>
<span id="cb13-89"><a href="#cb13-89"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">18</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">125000</span>, <span class="dv">29000</span>), <span class="at">size =</span> <span class="dv">8</span>, <span class="at">fontface =</span> <span class="st">"bold"</span></span>
<span id="cb13-90"><a href="#cb13-90"></a>    ) <span class="sc">+</span></span>
<span id="cb13-91"><a href="#cb13-91"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb13-92"><a href="#cb13-92"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb13-93"><a href="#cb13-93"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_colors, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb13-94"><a href="#cb13-94"></a>    <span class="fu">labs</span>(</span>
<span id="cb13-95"><a href="#cb13-95"></a>      <span class="at">x =</span> <span class="st">"Week of the Year"</span>, <span class="at">y =</span> <span class="st">"Reported bike shares</span><span class="sc">\n</span><span class="st">(cumulative # per week)"</span>, <span class="at">tag =</span> <span class="st">"P3"</span>,</span>
<span id="cb13-96"><a href="#cb13-96"></a>    )</span>
<span id="cb13-97"><a href="#cb13-97"></a><span class="co">#&gt; `summarise()` has grouped output by 'week', 'day_night'. You can override using</span></span>
<span id="cb13-98"><a href="#cb13-98"></a><span class="co">#&gt; the `.groups` argument.</span></span>
<span id="cb13-99"><a href="#cb13-99"></a></span>
<span id="cb13-100"><a href="#cb13-100"></a></span>
<span id="cb13-101"><a href="#cb13-101"></a><span class="co"># install.packages("patchwork")</span></span>
<span id="cb13-102"><a href="#cb13-102"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb13-103"><a href="#cb13-103"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-13-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-14_30fbd7ac459ad751fc679c485d02ac96">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-15_5db1d2e8e2fcfa3ba24e94c430a9b911">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>((p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="st">"top"</span>)) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-15-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-16_3a46565b19bafcb2892ad29d3958c26c">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>))</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co">#&gt; Warning: The `size` argument of `element_rect()` is deprecated as of ggplot2 3.4.0.</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="co">#&gt; ℹ Please use the `linewidth` argument instead.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-16-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-17_33eb5fe8845bd464ef9a7fe57c300932">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a></span>
<span id="cb17-2"><a href="#cb17-2"></a>((p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">1</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-17-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-18_f310f9472ae34f90a27f76d93f647e27">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>picasso <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="st">AAAAAA#BBBB</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="st">CCCCCCCCC##</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="st">CCCCCCCCC##"</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> picasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-18-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-20_0e9515b0278461af49176287d4d04175">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>theme_std <span class="ot">&lt;-</span> <span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">"Noto Sans"</span>))</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">theme_update</span>(</span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-4"><a href="#cb19-4"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb19-5"><a href="#cb19-5"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">12</span>)),</span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">12</span>)),</span>
<span id="cb19-8"><a href="#cb19-8"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> .<span class="dv">4</span>),</span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)),</span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"white"</span>)</span>
<span id="cb19-12"><a href="#cb19-12"></a>)</span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a>bikes_sorted <span class="ot">&lt;-</span></span>
<span id="cb19-15"><a href="#cb19-15"></a>  bikes <span class="sc">%&gt;%</span></span>
<span id="cb19-16"><a href="#cb19-16"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weather_type)) <span class="sc">%&gt;%</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>  <span class="fu">group_by</span>(weather_type) <span class="sc">%&gt;%</span></span>
<span id="cb19-18"><a href="#cb19-18"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb19-19"><a href="#cb19-19"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-20"><a href="#cb19-20"></a>  <span class="fu">mutate</span>(</span>
<span id="cb19-21"><a href="#cb19-21"></a>    <span class="at">weather_type =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(</span>
<span id="cb19-22"><a href="#cb19-22"></a>      <span class="fu">str_to_title</span>(<span class="fu">str_wrap</span>(weather_type, <span class="dv">5</span>)), sum</span>
<span id="cb19-23"><a href="#cb19-23"></a>    )</span>
<span id="cb19-24"><a href="#cb19-24"></a>  )</span>
<span id="cb19-25"><a href="#cb19-25"></a></span>
<span id="cb19-26"><a href="#cb19-26"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb19-27"><a href="#cb19-27"></a>    bikes_sorted,</span>
<span id="cb19-28"><a href="#cb19-28"></a>    <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">y =</span> count, <span class="at">color =</span> weather_type)</span>
<span id="cb19-29"><a href="#cb19-29"></a>  ) <span class="sc">+</span></span>
<span id="cb19-30"><a href="#cb19-30"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb19-31"><a href="#cb19-31"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb19-32"><a href="#cb19-32"></a>    <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">fun =</span> <span class="st">"sum"</span>, <span class="at">size =</span> <span class="dv">12</span></span>
<span id="cb19-33"><a href="#cb19-33"></a>  ) <span class="sc">+</span></span>
<span id="cb19-34"><a href="#cb19-34"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb19-35"><a href="#cb19-35"></a>    <span class="at">geom =</span> <span class="st">"linerange"</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">fun.max =</span> <span class="cf">function</span>(y) <span class="fu">sum</span>(y),</span>
<span id="cb19-36"><a href="#cb19-36"></a>    <span class="at">size =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb19-37"><a href="#cb19-37"></a>  ) <span class="sc">+</span></span>
<span id="cb19-38"><a href="#cb19-38"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb19-39"><a href="#cb19-39"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb19-40"><a href="#cb19-40"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8500000</span>),</span>
<span id="cb19-41"><a href="#cb19-41"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(<span class="at">scale =</span> .<span class="dv">0001</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)</span>
<span id="cb19-42"><a href="#cb19-42"></a>  ) <span class="sc">+</span></span>
<span id="cb19-43"><a href="#cb19-43"></a>  <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb19-44"><a href="#cb19-44"></a>    <span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>, <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb19-45"><a href="#cb19-45"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb19-46"><a href="#cb19-46"></a>  ) <span class="sc">+</span></span>
<span id="cb19-47"><a href="#cb19-47"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-48"><a href="#cb19-48"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sum of reported bike shares"</span>, <span class="at">tag =</span> <span class="st">"P1"</span>,</span>
<span id="cb19-49"><a href="#cb19-49"></a>  ) <span class="sc">+</span></span>
<span id="cb19-50"><a href="#cb19-50"></a>  <span class="fu">theme</span>(</span>
<span id="cb19-51"><a href="#cb19-51"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-52"><a href="#cb19-52"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb19-53"><a href="#cb19-53"></a>                               <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">15</span>), <span class="at">lineheight =</span> .<span class="dv">9</span>)</span>
<span id="cb19-54"><a href="#cb19-54"></a>  )</span>
<span id="cb19-55"><a href="#cb19-55"></a></span>
<span id="cb19-56"><a href="#cb19-56"></a></span>
<span id="cb19-57"><a href="#cb19-57"></a>p2 <span class="ot">&lt;-</span> bikes_sorted <span class="sc">%&gt;%</span></span>
<span id="cb19-58"><a href="#cb19-58"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"winter"</span>, is_weekend <span class="sc">==</span> <span class="cn">TRUE</span>, day_night <span class="sc">==</span> <span class="st">"night"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-59"><a href="#cb19-59"></a>  <span class="fu">group_by</span>(weather_type, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-60"><a href="#cb19-60"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb19-61"><a href="#cb19-61"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb19-62"><a href="#cb19-62"></a>      <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">y =</span> id, <span class="at">color =</span> weather_type)</span>
<span id="cb19-63"><a href="#cb19-63"></a>    ) <span class="sc">+</span></span>
<span id="cb19-64"><a href="#cb19-64"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.5</span>) <span class="sc">+</span></span>
<span id="cb19-65"><a href="#cb19-65"></a>    <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb19-66"><a href="#cb19-66"></a>      <span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>, <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb19-67"><a href="#cb19-67"></a>      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb19-68"><a href="#cb19-68"></a>    ) <span class="sc">+</span></span>
<span id="cb19-69"><a href="#cb19-69"></a>    <span class="fu">labs</span>(</span>
<span id="cb19-70"><a href="#cb19-70"></a>      <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Reported bike shares on</span><span class="sc">\n</span><span class="st">weekend winter nights"</span>, <span class="at">tag =</span> <span class="st">"P2"</span>,</span>
<span id="cb19-71"><a href="#cb19-71"></a>    ) <span class="sc">+</span></span>
<span id="cb19-72"><a href="#cb19-72"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="cn">NA</span>), <span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb19-73"><a href="#cb19-73"></a></span>
<span id="cb19-74"><a href="#cb19-74"></a></span>
<span id="cb19-75"><a href="#cb19-75"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#cc0000"</span>, <span class="st">"#000080"</span>)</span>
<span id="cb19-76"><a href="#cb19-76"></a></span>
<span id="cb19-77"><a href="#cb19-77"></a>p3 <span class="ot">&lt;-</span> bikes <span class="sc">%&gt;%</span></span>
<span id="cb19-78"><a href="#cb19-78"></a>  <span class="fu">group_by</span>(<span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">week</span>(date), day_night, year) <span class="sc">%&gt;%</span></span>
<span id="cb19-79"><a href="#cb19-79"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb19-80"><a href="#cb19-80"></a>  <span class="fu">group_by</span>(week, day_night) <span class="sc">%&gt;%</span></span>
<span id="cb19-81"><a href="#cb19-81"></a>  <span class="fu">mutate</span>(<span class="at">avg =</span> <span class="fu">mean</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb19-82"><a href="#cb19-82"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> count, <span class="at">group =</span> <span class="fu">interaction</span>(day_night, year))) <span class="sc">+</span></span>
<span id="cb19-83"><a href="#cb19-83"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"grey65"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb19-84"><a href="#cb19-84"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> avg, <span class="at">color =</span> day_night), <span class="at">stat =</span> <span class="st">"unique"</span>, <span class="at">size =</span> <span class="fl">1.7</span>) <span class="sc">+</span></span>
<span id="cb19-85"><a href="#cb19-85"></a>    <span class="fu">annotate</span>(</span>
<span id="cb19-86"><a href="#cb19-86"></a>      <span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Day"</span>, <span class="st">"Night"</span>), <span class="at">color =</span> my_colors,</span>
<span id="cb19-87"><a href="#cb19-87"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">18</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">125000</span>, <span class="dv">29000</span>), <span class="at">size =</span> <span class="dv">8</span>, <span class="at">fontface =</span> <span class="st">"bold"</span></span>
<span id="cb19-88"><a href="#cb19-88"></a>    ) <span class="sc">+</span></span>
<span id="cb19-89"><a href="#cb19-89"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb19-90"><a href="#cb19-90"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb19-91"><a href="#cb19-91"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_colors, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb19-92"><a href="#cb19-92"></a>    <span class="fu">labs</span>(</span>
<span id="cb19-93"><a href="#cb19-93"></a>      <span class="at">x =</span> <span class="st">"Week of the Year"</span>, <span class="at">y =</span> <span class="st">"Reported bike shares</span><span class="sc">\n</span><span class="st">(cumulative # per week)"</span>, <span class="at">tag =</span> <span class="st">"P3"</span>,</span>
<span id="cb19-94"><a href="#cb19-94"></a>    )</span>
<span id="cb19-95"><a href="#cb19-95"></a><span class="co">#&gt; `summarise()` has grouped output by 'week', 'day_night'. You can override using</span></span>
<span id="cb19-96"><a href="#cb19-96"></a><span class="co">#&gt; the `.groups` argument.</span></span>
<span id="cb19-97"><a href="#cb19-97"></a></span>
<span id="cb19-98"><a href="#cb19-98"></a></span>
<span id="cb19-99"><a href="#cb19-99"></a><span class="co"># install.packages("patchwork")</span></span>
<span id="cb19-100"><a href="#cb19-100"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb19-101"><a href="#cb19-101"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-20-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-21_8e9e5023dded391d785f62ad128e1517">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-21-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-22_8db8f1eadd706cbbb8e98012b916a920">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>((p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="st">"top"</span>)) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-22-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-23_3f25da020bf38c5d72c465f734d3c3c4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-23-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-19"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-24_df5dbc595a8ffc967b86cc2db2d4a87e">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a></span>
<span id="cb23-2"><a href="#cb23-2"></a>((p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">1</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-24-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-20"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-25_175469ddca50ef2751cc9c46fd94c641">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>picasso <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="st">AAAAAA#BBBB</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="st">CCCCCCCCC##</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="st">CCCCCCCCC##"</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> picasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-25-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-21"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-26_1c5709923cce63ab8253723f389ee318">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a></span>
<span id="cb25-2"><a href="#cb25-2"></a>text <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">"Lorem ipsum dolor sit amet, **consectetur adipiscing elit**, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation &lt;b style='color:#000080;'&gt;ullamco laboris nisi&lt;/b&gt; ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat &lt;b style='color:#cc0000;'&gt;cupidatat non proident&lt;/b&gt;, sunt in culpa qui officia deserunt mollit anim id est laborum."</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>)</span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a>pt <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(text, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb25-7"><a href="#cb25-7"></a>  ggtext<span class="sc">::</span><span class="fu">geom_textbox</span>(</span>
<span id="cb25-8"><a href="#cb25-8"></a>    <span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb25-9"><a href="#cb25-9"></a>    <span class="at">box.color =</span> <span class="cn">NA</span>, <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">23</span>, <span class="st">"lines"</span>),</span>
<span id="cb25-10"><a href="#cb25-10"></a>    <span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">size =</span> <span class="fl">6.5</span>, <span class="at">lineheight =</span> <span class="fl">1.4</span></span>
<span id="cb25-11"><a href="#cb25-11"></a>  ) <span class="sc">+</span></span>
<span id="cb25-12"><a href="#cb25-12"></a>  <span class="fu">coord_cartesian</span>(<span class="at">expand =</span> <span class="cn">FALSE</span>, <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>  <span class="fu">theme_void</span>()</span>
<span id="cb25-14"><a href="#cb25-14"></a></span>
<span id="cb25-15"><a href="#cb25-15"></a>pt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-26-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-22"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-27_f20f1991f6c93e9f6005d416bbb7ebe1">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>(p1 <span class="sc">+</span> pt) <span class="sc">/</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-27-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-23"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-28_2bd6ca04ff5184f404824f04c4c41a84">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>p1 <span class="sc">+</span> <span class="fu">inset_element</span>(p2, <span class="at">l =</span> .<span class="dv">6</span>, <span class="at">b =</span> .<span class="dv">1</span>, <span class="at">r =</span> <span class="dv">1</span>, <span class="at">t =</span> .<span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-28-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-24"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="ch07_working_with_layouts_and_composition_cache/html/unnamed-chunk-29_5a191d582051b267eff68c59bc8d197f">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>(p1 <span class="sc">+</span> <span class="fu">inset_element</span>(p2, <span class="at">l =</span> .<span class="dv">6</span>, <span class="at">b =</span> .<span class="dv">1</span>, <span class="at">r =</span> <span class="dv">1</span>, <span class="at">t =</span> .<span class="dv">6</span>) <span class="sc">+</span> pt) <span class="sc">/</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-29-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-25"><img src="ch07_working_with_layouts_and_composition_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>
</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../../../contents/website/graphic_design_with_ggplot2/ch06_working_with_colors.html" class="pagination-link" aria-label="Working with Colors">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Working with Colors</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../../contents/website/udemy_database-specialist/am-2-note.html" class="pagination-link" aria-label="Udemy 午前2">
        <span class="nav-page-text">Udemy 午前2</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb29" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">---</span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="an">title:</span><span class="co"> "Working with Layouts and Composition"</span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="an">execute:</span><span class="co"> </span></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="co">  cache: true</span></span>
<span id="cb29-5"><a href="#cb29-5"></a><span class="an">date-modified:</span><span class="co"> last-modified</span></span>
<span id="cb29-6"><a href="#cb29-6"></a><span class="an">filters:</span></span>
<span id="cb29-7"><a href="#cb29-7"></a><span class="co">   - lightbox</span></span>
<span id="cb29-8"><a href="#cb29-8"></a><span class="an">lightbox:</span><span class="co"> auto</span></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="co">---</span></span>
<span id="cb29-10"><a href="#cb29-10"></a></span>
<span id="cb29-13"><a href="#cb29-13"></a><span class="in">```{r}</span></span>
<span id="cb29-14"><a href="#cb29-14"></a>renv<span class="sc">::</span><span class="fu">activate</span>(here<span class="sc">::</span><span class="fu">here</span>())</span>
<span id="cb29-15"><a href="#cb29-15"></a>cur_dir <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"contents/website/graphic_design_with_ggplot2"</span>)</span>
<span id="cb29-16"><a href="#cb29-16"></a><span class="in">```</span></span>
<span id="cb29-17"><a href="#cb29-17"></a></span>
<span id="cb29-20"><a href="#cb29-20"></a><span class="in">```{r}</span></span>
<span id="cb29-21"><a href="#cb29-21"></a><span class="co">#| warning: false</span></span>
<span id="cb29-22"><a href="#cb29-22"></a><span class="co">#| message: false</span></span>
<span id="cb29-23"><a href="#cb29-23"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb29-24"><a href="#cb29-24"></a>  <span class="st">"tidyverse"</span>, </span>
<span id="cb29-25"><a href="#cb29-25"></a>  <span class="st">"magick"</span>,</span>
<span id="cb29-26"><a href="#cb29-26"></a>  <span class="st">"ggplot2"</span>, </span>
<span id="cb29-27"><a href="#cb29-27"></a>  <span class="st">"readr"</span>, </span>
<span id="cb29-28"><a href="#cb29-28"></a>  <span class="st">"tibble"</span>, </span>
<span id="cb29-29"><a href="#cb29-29"></a>  <span class="st">"tidyr"</span>, </span>
<span id="cb29-30"><a href="#cb29-30"></a>  <span class="st">"forcats"</span>, </span>
<span id="cb29-31"><a href="#cb29-31"></a>  <span class="st">"stringr"</span>,</span>
<span id="cb29-32"><a href="#cb29-32"></a>  <span class="st">"lubridate"</span>, </span>
<span id="cb29-33"><a href="#cb29-33"></a>  <span class="st">"here"</span>, </span>
<span id="cb29-34"><a href="#cb29-34"></a>  <span class="st">"systemfonts"</span>, </span>
<span id="cb29-35"><a href="#cb29-35"></a>  <span class="st">"magick"</span>, </span>
<span id="cb29-36"><a href="#cb29-36"></a>  <span class="st">"scales"</span>, </span>
<span id="cb29-37"><a href="#cb29-37"></a>  <span class="st">"grid"</span>,</span>
<span id="cb29-38"><a href="#cb29-38"></a>  <span class="st">"grDevices"</span>, </span>
<span id="cb29-39"><a href="#cb29-39"></a>  <span class="st">"colorspace"</span>, </span>
<span id="cb29-40"><a href="#cb29-40"></a>  <span class="st">"viridis"</span>, </span>
<span id="cb29-41"><a href="#cb29-41"></a>  <span class="st">"RColorBrewer"</span>, </span>
<span id="cb29-42"><a href="#cb29-42"></a>  <span class="st">"rcartocolor"</span>,</span>
<span id="cb29-43"><a href="#cb29-43"></a>  <span class="st">"scico"</span>, </span>
<span id="cb29-44"><a href="#cb29-44"></a>  <span class="st">"ggsci"</span>, </span>
<span id="cb29-45"><a href="#cb29-45"></a>  <span class="st">"ggthemes"</span>, </span>
<span id="cb29-46"><a href="#cb29-46"></a>  <span class="st">"nord"</span>, </span>
<span id="cb29-47"><a href="#cb29-47"></a>  <span class="st">"MetBrewer"</span>, </span>
<span id="cb29-48"><a href="#cb29-48"></a>  <span class="st">"ggrepel"</span>,</span>
<span id="cb29-49"><a href="#cb29-49"></a>  <span class="st">"ggforce"</span>,</span>
<span id="cb29-50"><a href="#cb29-50"></a>  <span class="st">"ggtext"</span>, </span>
<span id="cb29-51"><a href="#cb29-51"></a>  <span class="st">"ggfittext"</span>,</span>
<span id="cb29-52"><a href="#cb29-52"></a>  <span class="st">"ggdist"</span>, </span>
<span id="cb29-53"><a href="#cb29-53"></a>  <span class="st">"ggbeeswarm"</span>, </span>
<span id="cb29-54"><a href="#cb29-54"></a>  <span class="st">"gghalves"</span>, </span>
<span id="cb29-55"><a href="#cb29-55"></a>  <span class="st">"patchwork"</span>, </span>
<span id="cb29-56"><a href="#cb29-56"></a>  <span class="st">"palmerpenguins"</span>, </span>
<span id="cb29-57"><a href="#cb29-57"></a>  <span class="st">"rnaturalearth"</span>, </span>
<span id="cb29-58"><a href="#cb29-58"></a>  <span class="st">"sf"</span>, </span>
<span id="cb29-59"><a href="#cb29-59"></a>  <span class="st">"rmapshaper"</span>, </span>
<span id="cb29-60"><a href="#cb29-60"></a>  <span class="st">"devtools"</span>, </span>
<span id="cb29-61"><a href="#cb29-61"></a>  <span class="st">"extrafont"</span></span>
<span id="cb29-62"><a href="#cb29-62"></a>) <span class="sc">|&gt;</span> <span class="fu">lapply</span>(\(x) <span class="fu">library</span>(x, <span class="at">character.only =</span> <span class="cn">TRUE</span>))</span>
<span id="cb29-63"><a href="#cb29-63"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb29-64"><a href="#cb29-64"></a><span class="fu">library</span>(colorblindr)</span>
<span id="cb29-65"><a href="#cb29-65"></a><span class="fu">library</span>(showtext)</span>
<span id="cb29-66"><a href="#cb29-66"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb29-67"><a href="#cb29-67"></a><span class="fu">font_add_google</span>(<span class="st">"Noto Sans"</span>)</span>
<span id="cb29-68"><a href="#cb29-68"></a><span class="in">```</span></span>
<span id="cb29-69"><a href="#cb29-69"></a></span>
<span id="cb29-70"><a href="#cb29-70"></a></span>
<span id="cb29-71"><a href="#cb29-71"></a><span class="fu"># Setup </span></span>
<span id="cb29-72"><a href="#cb29-72"></a></span>
<span id="cb29-75"><a href="#cb29-75"></a><span class="in">```{r}</span></span>
<span id="cb29-76"><a href="#cb29-76"></a>bikes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb29-77"><a href="#cb29-77"></a>    <span class="fu">here</span>(cur_dir, <span class="st">"ggplot2-course-data/london-bikes-custom.csv"</span>), </span>
<span id="cb29-78"><a href="#cb29-78"></a>    <span class="at">col_types =</span> <span class="st">"Dcfffilllddddc"</span></span>
<span id="cb29-79"><a href="#cb29-79"></a>)</span>
<span id="cb29-80"><a href="#cb29-80"></a></span>
<span id="cb29-81"><a href="#cb29-81"></a>bikes<span class="sc">$</span>season <span class="ot">&lt;-</span> forcats<span class="sc">::</span><span class="fu">fct_inorder</span>(bikes<span class="sc">$</span>season)</span>
<span id="cb29-82"><a href="#cb29-82"></a></span>
<span id="cb29-83"><a href="#cb29-83"></a><span class="fu">theme_set</span>(</span>
<span id="cb29-84"><a href="#cb29-84"></a>    <span class="fu">theme_light</span>(</span>
<span id="cb29-85"><a href="#cb29-85"></a>        <span class="at">base_size =</span> <span class="dv">14</span>, </span>
<span id="cb29-86"><a href="#cb29-86"></a>        <span class="at">base_family =</span> <span class="st">"Noto Sans"</span></span>
<span id="cb29-87"><a href="#cb29-87"></a>    )</span>
<span id="cb29-88"><a href="#cb29-88"></a>)</span>
<span id="cb29-89"><a href="#cb29-89"></a></span>
<span id="cb29-90"><a href="#cb29-90"></a><span class="fu">theme_update</span>(</span>
<span id="cb29-91"><a href="#cb29-91"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb29-92"><a href="#cb29-92"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>), </span>
<span id="cb29-93"><a href="#cb29-93"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>, </span>
<span id="cb29-94"><a href="#cb29-94"></a>    <span class="at">plot.title.position =</span> <span class="st">"plot"</span></span>
<span id="cb29-95"><a href="#cb29-95"></a>)</span>
<span id="cb29-96"><a href="#cb29-96"></a></span>
<span id="cb29-97"><a href="#cb29-97"></a></span>
<span id="cb29-98"><a href="#cb29-98"></a><span class="fu">glimpse</span>(bikes)</span>
<span id="cb29-99"><a href="#cb29-99"></a></span>
<span id="cb29-100"><a href="#cb29-100"></a></span>
<span id="cb29-101"><a href="#cb29-101"></a><span class="in">```</span></span>
<span id="cb29-102"><a href="#cb29-102"></a></span>
<span id="cb29-103"><a href="#cb29-103"></a></span>
<span id="cb29-104"><a href="#cb29-104"></a><span class="fu"># Legend Placement and Styling</span></span>
<span id="cb29-105"><a href="#cb29-105"></a></span>
<span id="cb29-106"><a href="#cb29-106"></a><span class="fu">## discrete</span></span>
<span id="cb29-107"><a href="#cb29-107"></a></span>
<span id="cb29-110"><a href="#cb29-110"></a><span class="in">```{r}</span></span>
<span id="cb29-111"><a href="#cb29-111"></a>pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#3c89d9"</span>, <span class="st">"#1ec99b"</span>, <span class="st">"#F7B01B"</span>, <span class="st">"#a26e7c"</span>)</span>
<span id="cb29-112"><a href="#cb29-112"></a></span>
<span id="cb29-113"><a href="#cb29-113"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-114"><a href="#cb29-114"></a>    bikes,</span>
<span id="cb29-115"><a href="#cb29-115"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb29-116"><a href="#cb29-116"></a>        <span class="at">color =</span> season)</span>
<span id="cb29-117"><a href="#cb29-117"></a>  ) <span class="sc">+</span></span>
<span id="cb29-118"><a href="#cb29-118"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-119"><a href="#cb29-119"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> pal)</span>
<span id="cb29-120"><a href="#cb29-120"></a><span class="in">```</span></span>
<span id="cb29-121"><a href="#cb29-121"></a></span>
<span id="cb29-122"><a href="#cb29-122"></a></span>
<span id="cb29-123"><a href="#cb29-123"></a><span class="fu">## Continuous</span></span>
<span id="cb29-124"><a href="#cb29-124"></a></span>
<span id="cb29-127"><a href="#cb29-127"></a><span class="in">```{r}</span></span>
<span id="cb29-128"><a href="#cb29-128"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-129"><a href="#cb29-129"></a>    bikes,</span>
<span id="cb29-130"><a href="#cb29-130"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb29-131"><a href="#cb29-131"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb29-132"><a href="#cb29-132"></a>  ) <span class="sc">+</span></span>
<span id="cb29-133"><a href="#cb29-133"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-134"><a href="#cb29-134"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span> </span>
<span id="cb29-135"><a href="#cb29-135"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-136"><a href="#cb29-136"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>, </span>
<span id="cb29-137"><a href="#cb29-137"></a>      <span class="at">legend.justification =</span> <span class="st">"right"</span></span>
<span id="cb29-138"><a href="#cb29-138"></a>  )</span>
<span id="cb29-139"><a href="#cb29-139"></a><span class="in">```</span></span>
<span id="cb29-140"><a href="#cb29-140"></a></span>
<span id="cb29-143"><a href="#cb29-143"></a><span class="in">```{r}</span></span>
<span id="cb29-144"><a href="#cb29-144"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-145"><a href="#cb29-145"></a>    bikes,</span>
<span id="cb29-146"><a href="#cb29-146"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb29-147"><a href="#cb29-147"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb29-148"><a href="#cb29-148"></a>  ) <span class="sc">+</span></span>
<span id="cb29-149"><a href="#cb29-149"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-150"><a href="#cb29-150"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb29-151"><a href="#cb29-151"></a>      <span class="at">guide =</span> <span class="st">"colorbar"</span></span>
<span id="cb29-152"><a href="#cb29-152"></a>  ) <span class="sc">+</span> </span>
<span id="cb29-153"><a href="#cb29-153"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-154"><a href="#cb29-154"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>), </span>
<span id="cb29-155"><a href="#cb29-155"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb29-156"><a href="#cb29-156"></a>  )</span>
<span id="cb29-157"><a href="#cb29-157"></a><span class="in">```</span></span>
<span id="cb29-158"><a href="#cb29-158"></a></span>
<span id="cb29-159"><a href="#cb29-159"></a></span>
<span id="cb29-160"><a href="#cb29-160"></a>次は凡例を離散的に表現しているが、</span>
<span id="cb29-161"><a href="#cb29-161"></a>プロットの色自体は色分けされていないことに注意する。</span>
<span id="cb29-162"><a href="#cb29-162"></a></span>
<span id="cb29-165"><a href="#cb29-165"></a><span class="in">```{r}</span></span>
<span id="cb29-166"><a href="#cb29-166"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-167"><a href="#cb29-167"></a>    bikes,</span>
<span id="cb29-168"><a href="#cb29-168"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb29-169"><a href="#cb29-169"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb29-170"><a href="#cb29-170"></a>  ) <span class="sc">+</span></span>
<span id="cb29-171"><a href="#cb29-171"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-172"><a href="#cb29-172"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb29-173"><a href="#cb29-173"></a>      <span class="at">guide =</span> <span class="st">"colorsteps"</span>,</span>
<span id="cb29-174"><a href="#cb29-174"></a>  ) <span class="sc">+</span> </span>
<span id="cb29-175"><a href="#cb29-175"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-176"><a href="#cb29-176"></a>      <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>), </span>
<span id="cb29-177"><a href="#cb29-177"></a>      <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb29-178"><a href="#cb29-178"></a>  )</span>
<span id="cb29-179"><a href="#cb29-179"></a><span class="in">```</span></span>
<span id="cb29-180"><a href="#cb29-180"></a></span>
<span id="cb29-181"><a href="#cb29-181"></a></span>
<span id="cb29-182"><a href="#cb29-182"></a>次はプロットの色自体も離散的にしている。つまり、<span class="in">`viridis_b`</span>を使っている。</span>
<span id="cb29-183"><a href="#cb29-183"></a></span>
<span id="cb29-186"><a href="#cb29-186"></a><span class="in">```{r}</span></span>
<span id="cb29-187"><a href="#cb29-187"></a>bikes <span class="sc">|&gt;</span> </span>
<span id="cb29-188"><a href="#cb29-188"></a>    <span class="fu">ggplot</span>(</span>
<span id="cb29-189"><a href="#cb29-189"></a>        <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count, <span class="at">color =</span> humidity)</span>
<span id="cb29-190"><a href="#cb29-190"></a>    ) <span class="sc">+</span> </span>
<span id="cb29-191"><a href="#cb29-191"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb29-192"><a href="#cb29-192"></a>    <span class="fu">scale_color_viridis_b</span>(</span>
<span id="cb29-193"><a href="#cb29-193"></a>        <span class="at">guide =</span> <span class="st">"colorsteps"</span></span>
<span id="cb29-194"><a href="#cb29-194"></a>    ) <span class="sc">+</span> </span>
<span id="cb29-195"><a href="#cb29-195"></a>    <span class="fu">theme</span>(</span>
<span id="cb29-196"><a href="#cb29-196"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>), </span>
<span id="cb29-197"><a href="#cb29-197"></a>        <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb29-198"><a href="#cb29-198"></a>    )</span>
<span id="cb29-199"><a href="#cb29-199"></a><span class="in">```</span></span>
<span id="cb29-200"><a href="#cb29-200"></a></span>
<span id="cb29-201"><a href="#cb29-201"></a>細かく凡例を調整したいときには次のように<span class="in">`guide_colorsteps`</span>を使う。</span>
<span id="cb29-202"><a href="#cb29-202"></a></span>
<span id="cb29-205"><a href="#cb29-205"></a><span class="in">```{r}</span></span>
<span id="cb29-206"><a href="#cb29-206"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-207"><a href="#cb29-207"></a>    bikes,</span>
<span id="cb29-208"><a href="#cb29-208"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb29-209"><a href="#cb29-209"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb29-210"><a href="#cb29-210"></a>  ) <span class="sc">+</span></span>
<span id="cb29-211"><a href="#cb29-211"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-212"><a href="#cb29-212"></a>  <span class="fu">scale_color_viridis_b</span>(</span>
<span id="cb29-213"><a href="#cb29-213"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">30</span>, <span class="dv">90</span>, <span class="dv">10</span>),</span>
<span id="cb29-214"><a href="#cb29-214"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">100</span>),</span>
<span id="cb29-215"><a href="#cb29-215"></a>    <span class="at">guide =</span> <span class="fu">guide_colorsteps</span>(</span>
<span id="cb29-216"><a href="#cb29-216"></a>      <span class="at">title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb29-217"><a href="#cb29-217"></a>      <span class="at">title.hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb29-218"><a href="#cb29-218"></a>      <span class="at">show.limits =</span> <span class="cn">TRUE</span>,</span>
<span id="cb29-219"><a href="#cb29-219"></a>      <span class="at">frame.colour =</span> <span class="st">"black"</span>,</span>
<span id="cb29-220"><a href="#cb29-220"></a>      <span class="at">frame.linewidth =</span> <span class="dv">3</span>,</span>
<span id="cb29-221"><a href="#cb29-221"></a>      <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">8</span>, <span class="st">"lines"</span>), </span>
<span id="cb29-222"><a href="#cb29-222"></a>      <span class="at">ticks.linewidth =</span> <span class="dv">1</span></span>
<span id="cb29-223"><a href="#cb29-223"></a>    )</span>
<span id="cb29-224"><a href="#cb29-224"></a>  ) <span class="sc">+</span></span>
<span id="cb29-225"><a href="#cb29-225"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-226"><a href="#cb29-226"></a>    <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">85</span>),</span>
<span id="cb29-227"><a href="#cb29-227"></a>    <span class="at">legend.direction =</span> <span class="st">"horizontal"</span></span>
<span id="cb29-228"><a href="#cb29-228"></a>  )</span>
<span id="cb29-229"><a href="#cb29-229"></a><span class="in">```</span></span>
<span id="cb29-230"><a href="#cb29-230"></a></span>
<span id="cb29-233"><a href="#cb29-233"></a><span class="in">```{r}</span></span>
<span id="cb29-234"><a href="#cb29-234"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-235"><a href="#cb29-235"></a>    bikes,</span>
<span id="cb29-236"><a href="#cb29-236"></a>    <span class="fu">aes</span>(<span class="at">x =</span> temp_feel, <span class="at">y =</span> count,</span>
<span id="cb29-237"><a href="#cb29-237"></a>        <span class="at">color =</span> humidity)</span>
<span id="cb29-238"><a href="#cb29-238"></a>  ) <span class="sc">+</span></span>
<span id="cb29-239"><a href="#cb29-239"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb29-240"><a href="#cb29-240"></a>  <span class="fu">scale_color_viridis_c</span>(</span>
<span id="cb29-241"><a href="#cb29-241"></a>    <span class="at">breaks =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">10</span>,</span>
<span id="cb29-242"><a href="#cb29-242"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">100</span>),</span>
<span id="cb29-243"><a href="#cb29-243"></a>    <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(</span>
<span id="cb29-244"><a href="#cb29-244"></a>      <span class="at">title.position =</span> <span class="st">"top"</span>,</span>
<span id="cb29-245"><a href="#cb29-245"></a>      <span class="at">title.hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb29-246"><a href="#cb29-246"></a>      <span class="at">ticks =</span> <span class="cn">FALSE</span>,</span>
<span id="cb29-247"><a href="#cb29-247"></a>      <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">20</span>, <span class="st">"lines"</span>),</span>
<span id="cb29-248"><a href="#cb29-248"></a>      <span class="at">barheight =</span> <span class="fu">unit</span>(.<span class="dv">6</span>, <span class="st">"lines"</span>)</span>
<span id="cb29-249"><a href="#cb29-249"></a>    )</span>
<span id="cb29-250"><a href="#cb29-250"></a>  ) <span class="sc">+</span></span>
<span id="cb29-251"><a href="#cb29-251"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-252"><a href="#cb29-252"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span></span>
<span id="cb29-253"><a href="#cb29-253"></a>  )</span>
<span id="cb29-254"><a href="#cb29-254"></a><span class="in">```</span></span>
<span id="cb29-255"><a href="#cb29-255"></a></span>
<span id="cb29-256"><a href="#cb29-256"></a><span class="fu">## Key Glyphs</span></span>
<span id="cb29-257"><a href="#cb29-257"></a></span>
<span id="cb29-260"><a href="#cb29-260"></a><span class="in">```{r}</span></span>
<span id="cb29-261"><a href="#cb29-261"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-262"><a href="#cb29-262"></a>    bikes,</span>
<span id="cb29-263"><a href="#cb29-263"></a>    <span class="fu">aes</span>(<span class="at">x =</span> lubridate<span class="sc">::</span><span class="fu">week</span>(date),</span>
<span id="cb29-264"><a href="#cb29-264"></a>        <span class="at">y =</span> count,</span>
<span id="cb29-265"><a href="#cb29-265"></a>        <span class="at">color =</span> day_night)</span>
<span id="cb29-266"><a href="#cb29-266"></a>  ) <span class="sc">+</span></span>
<span id="cb29-267"><a href="#cb29-267"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb29-268"><a href="#cb29-268"></a>    <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb29-269"><a href="#cb29-269"></a>    <span class="at">fun =</span> sum,</span>
<span id="cb29-270"><a href="#cb29-270"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb29-271"><a href="#cb29-271"></a>  ) <span class="sc">+</span></span>
<span id="cb29-272"><a href="#cb29-272"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb29-273"><a href="#cb29-273"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#28A87D"</span>, <span class="st">"#663399"</span>),</span>
<span id="cb29-274"><a href="#cb29-274"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb29-275"><a href="#cb29-275"></a>  ) <span class="sc">+</span></span>
<span id="cb29-276"><a href="#cb29-276"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-277"><a href="#cb29-277"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb29-278"><a href="#cb29-278"></a>  )</span>
<span id="cb29-279"><a href="#cb29-279"></a><span class="in">```</span></span>
<span id="cb29-280"><a href="#cb29-280"></a></span>
<span id="cb29-281"><a href="#cb29-281"></a></span>
<span id="cb29-284"><a href="#cb29-284"></a><span class="in">```{r}</span></span>
<span id="cb29-285"><a href="#cb29-285"></a><span class="fu">ggplot</span>(</span>
<span id="cb29-286"><a href="#cb29-286"></a>    bikes,</span>
<span id="cb29-287"><a href="#cb29-287"></a>    <span class="fu">aes</span>(<span class="at">x =</span> lubridate<span class="sc">::</span><span class="fu">week</span>(date),</span>
<span id="cb29-288"><a href="#cb29-288"></a>        <span class="at">y =</span> count,</span>
<span id="cb29-289"><a href="#cb29-289"></a>        <span class="at">color =</span> day_night)</span>
<span id="cb29-290"><a href="#cb29-290"></a>  ) <span class="sc">+</span></span>
<span id="cb29-291"><a href="#cb29-291"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb29-292"><a href="#cb29-292"></a>    <span class="at">geom =</span> <span class="st">"line"</span>,</span>
<span id="cb29-293"><a href="#cb29-293"></a>    <span class="at">fun =</span> sum,</span>
<span id="cb29-294"><a href="#cb29-294"></a>    <span class="at">key_glyph =</span> <span class="st">"timeseries"</span>,</span>
<span id="cb29-295"><a href="#cb29-295"></a>    <span class="at">size =</span> <span class="dv">1</span></span>
<span id="cb29-296"><a href="#cb29-296"></a>  ) <span class="sc">+</span></span>
<span id="cb29-297"><a href="#cb29-297"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb29-298"><a href="#cb29-298"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#28A87D"</span>, <span class="st">"#663399"</span>),</span>
<span id="cb29-299"><a href="#cb29-299"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb29-300"><a href="#cb29-300"></a>  ) <span class="sc">+</span></span>
<span id="cb29-301"><a href="#cb29-301"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-302"><a href="#cb29-302"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>)</span>
<span id="cb29-303"><a href="#cb29-303"></a>  )</span>
<span id="cb29-304"><a href="#cb29-304"></a><span class="in">```</span></span>
<span id="cb29-305"><a href="#cb29-305"></a></span>
<span id="cb29-306"><a href="#cb29-306"></a></span>
<span id="cb29-307"><a href="#cb29-307"></a><span class="fu"># Composing ggplot</span></span>
<span id="cb29-308"><a href="#cb29-308"></a></span>
<span id="cb29-309"><a href="#cb29-309"></a><span class="fu">## patchwork</span></span>
<span id="cb29-310"><a href="#cb29-310"></a></span>
<span id="cb29-311"><a href="#cb29-311"></a></span>
<span id="cb29-314"><a href="#cb29-314"></a><span class="in">```{r}</span></span>
<span id="cb29-315"><a href="#cb29-315"></a>theme_std <span class="ot">&lt;-</span> <span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">18</span>, <span class="at">base_family =</span> <span class="st">"Noto Sans"</span>))</span>
<span id="cb29-316"><a href="#cb29-316"></a><span class="fu">theme_update</span>(</span>
<span id="cb29-317"><a href="#cb29-317"></a>  <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-318"><a href="#cb29-318"></a>  <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb29-319"><a href="#cb29-319"></a>  <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey40"</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb29-320"><a href="#cb29-320"></a>  <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">t =</span> <span class="dv">12</span>)),</span>
<span id="cb29-321"><a href="#cb29-321"></a>  <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">12</span>)),</span>
<span id="cb29-322"><a href="#cb29-322"></a>  <span class="at">axis.line =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> .<span class="dv">4</span>),</span>
<span id="cb29-323"><a href="#cb29-323"></a>  <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb29-324"><a href="#cb29-324"></a>  <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">40</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">b =</span> <span class="dv">15</span>)),</span>
<span id="cb29-325"><a href="#cb29-325"></a>  <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"white"</span>, <span class="at">color =</span> <span class="st">"white"</span>)</span>
<span id="cb29-326"><a href="#cb29-326"></a>)</span>
<span id="cb29-327"><a href="#cb29-327"></a></span>
<span id="cb29-328"><a href="#cb29-328"></a>bikes_sorted <span class="ot">&lt;-</span></span>
<span id="cb29-329"><a href="#cb29-329"></a>  bikes <span class="sc">%&gt;%</span></span>
<span id="cb29-330"><a href="#cb29-330"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weather_type)) <span class="sc">%&gt;%</span></span>
<span id="cb29-331"><a href="#cb29-331"></a>  <span class="fu">group_by</span>(weather_type) <span class="sc">%&gt;%</span></span>
<span id="cb29-332"><a href="#cb29-332"></a>  <span class="fu">mutate</span>(<span class="at">sum =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb29-333"><a href="#cb29-333"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-334"><a href="#cb29-334"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-335"><a href="#cb29-335"></a>    <span class="at">weather_type =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(</span>
<span id="cb29-336"><a href="#cb29-336"></a>      <span class="fu">str_to_title</span>(<span class="fu">str_wrap</span>(weather_type, <span class="dv">5</span>)), sum</span>
<span id="cb29-337"><a href="#cb29-337"></a>    )</span>
<span id="cb29-338"><a href="#cb29-338"></a>  )</span>
<span id="cb29-339"><a href="#cb29-339"></a></span>
<span id="cb29-340"><a href="#cb29-340"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb29-341"><a href="#cb29-341"></a>    bikes_sorted,</span>
<span id="cb29-342"><a href="#cb29-342"></a>    <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">y =</span> count, <span class="at">color =</span> weather_type)</span>
<span id="cb29-343"><a href="#cb29-343"></a>  ) <span class="sc">+</span></span>
<span id="cb29-344"><a href="#cb29-344"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"grey80"</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb29-345"><a href="#cb29-345"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb29-346"><a href="#cb29-346"></a>    <span class="at">geom =</span> <span class="st">"point"</span>, <span class="at">fun =</span> <span class="st">"sum"</span>, <span class="at">size =</span> <span class="dv">12</span></span>
<span id="cb29-347"><a href="#cb29-347"></a>  ) <span class="sc">+</span></span>
<span id="cb29-348"><a href="#cb29-348"></a>  <span class="fu">stat_summary</span>(</span>
<span id="cb29-349"><a href="#cb29-349"></a>    <span class="at">geom =</span> <span class="st">"linerange"</span>, <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">fun.max =</span> <span class="cf">function</span>(y) <span class="fu">sum</span>(y),</span>
<span id="cb29-350"><a href="#cb29-350"></a>    <span class="at">size =</span> <span class="dv">2</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span></span>
<span id="cb29-351"><a href="#cb29-351"></a>  ) <span class="sc">+</span></span>
<span id="cb29-352"><a href="#cb29-352"></a>  <span class="fu">coord_flip</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>), <span class="at">clip =</span> <span class="st">"off"</span>) <span class="sc">+</span></span>
<span id="cb29-353"><a href="#cb29-353"></a>  <span class="fu">scale_y_continuous</span>(</span>
<span id="cb29-354"><a href="#cb29-354"></a>    <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8500000</span>),</span>
<span id="cb29-355"><a href="#cb29-355"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>(<span class="at">scale =</span> .<span class="dv">0001</span>, <span class="at">suffix =</span> <span class="st">"K"</span>)</span>
<span id="cb29-356"><a href="#cb29-356"></a>  ) <span class="sc">+</span></span>
<span id="cb29-357"><a href="#cb29-357"></a>  <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb29-358"><a href="#cb29-358"></a>    <span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>, <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb29-359"><a href="#cb29-359"></a>    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb29-360"><a href="#cb29-360"></a>  ) <span class="sc">+</span></span>
<span id="cb29-361"><a href="#cb29-361"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-362"><a href="#cb29-362"></a>    <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sum of reported bike shares"</span>, <span class="at">tag =</span> <span class="st">"P1"</span>,</span>
<span id="cb29-363"><a href="#cb29-363"></a>  ) <span class="sc">+</span></span>
<span id="cb29-364"><a href="#cb29-364"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-365"><a href="#cb29-365"></a>    <span class="at">axis.line.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb29-366"><a href="#cb29-366"></a>    <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey50"</span>, <span class="at">face =</span> <span class="st">"bold"</span>,</span>
<span id="cb29-367"><a href="#cb29-367"></a>                               <span class="at">margin =</span> <span class="fu">margin</span>(<span class="at">r =</span> <span class="dv">15</span>), <span class="at">lineheight =</span> .<span class="dv">9</span>)</span>
<span id="cb29-368"><a href="#cb29-368"></a>  )</span>
<span id="cb29-369"><a href="#cb29-369"></a></span>
<span id="cb29-370"><a href="#cb29-370"></a></span>
<span id="cb29-371"><a href="#cb29-371"></a>p2 <span class="ot">&lt;-</span> bikes_sorted <span class="sc">%&gt;%</span></span>
<span id="cb29-372"><a href="#cb29-372"></a>  <span class="fu">filter</span>(season <span class="sc">==</span> <span class="st">"winter"</span>, is_weekend <span class="sc">==</span> <span class="cn">TRUE</span>, day_night <span class="sc">==</span> <span class="st">"night"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-373"><a href="#cb29-373"></a>  <span class="fu">group_by</span>(weather_type, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-374"><a href="#cb29-374"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb29-375"><a href="#cb29-375"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb29-376"><a href="#cb29-376"></a>      <span class="fu">aes</span>(<span class="at">x =</span> weather_type, <span class="at">y =</span> id, <span class="at">color =</span> weather_type)</span>
<span id="cb29-377"><a href="#cb29-377"></a>    ) <span class="sc">+</span></span>
<span id="cb29-378"><a href="#cb29-378"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">4.5</span>) <span class="sc">+</span></span>
<span id="cb29-379"><a href="#cb29-379"></a>    <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb29-380"><a href="#cb29-380"></a>      <span class="at">option =</span> <span class="st">"magma"</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">begin =</span> .<span class="dv">1</span>, <span class="at">end =</span> .<span class="dv">9</span>, <span class="at">name =</span> <span class="cn">NULL</span>,</span>
<span id="cb29-381"><a href="#cb29-381"></a>      <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>))</span>
<span id="cb29-382"><a href="#cb29-382"></a>    ) <span class="sc">+</span></span>
<span id="cb29-383"><a href="#cb29-383"></a>    <span class="fu">labs</span>(</span>
<span id="cb29-384"><a href="#cb29-384"></a>      <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Reported bike shares on</span><span class="sc">\n</span><span class="st">weekend winter nights"</span>, <span class="at">tag =</span> <span class="st">"P2"</span>,</span>
<span id="cb29-385"><a href="#cb29-385"></a>    ) <span class="sc">+</span></span>
<span id="cb29-386"><a href="#cb29-386"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="cn">NA</span>), <span class="at">clip =</span> <span class="st">"off"</span>)</span>
<span id="cb29-387"><a href="#cb29-387"></a></span>
<span id="cb29-388"><a href="#cb29-388"></a></span>
<span id="cb29-389"><a href="#cb29-389"></a>my_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#cc0000"</span>, <span class="st">"#000080"</span>)</span>
<span id="cb29-390"><a href="#cb29-390"></a></span>
<span id="cb29-391"><a href="#cb29-391"></a>p3 <span class="ot">&lt;-</span> bikes <span class="sc">%&gt;%</span></span>
<span id="cb29-392"><a href="#cb29-392"></a>  <span class="fu">group_by</span>(<span class="at">week =</span> lubridate<span class="sc">::</span><span class="fu">week</span>(date), day_night, year) <span class="sc">%&gt;%</span></span>
<span id="cb29-393"><a href="#cb29-393"></a>  <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb29-394"><a href="#cb29-394"></a>  <span class="fu">group_by</span>(week, day_night) <span class="sc">%&gt;%</span></span>
<span id="cb29-395"><a href="#cb29-395"></a>  <span class="fu">mutate</span>(<span class="at">avg =</span> <span class="fu">mean</span>(count)) <span class="sc">%&gt;%</span></span>
<span id="cb29-396"><a href="#cb29-396"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> count, <span class="at">group =</span> <span class="fu">interaction</span>(day_night, year))) <span class="sc">+</span></span>
<span id="cb29-397"><a href="#cb29-397"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"grey65"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-398"><a href="#cb29-398"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> avg, <span class="at">color =</span> day_night), <span class="at">stat =</span> <span class="st">"unique"</span>, <span class="at">size =</span> <span class="fl">1.7</span>) <span class="sc">+</span></span>
<span id="cb29-399"><a href="#cb29-399"></a>    <span class="fu">annotate</span>(</span>
<span id="cb29-400"><a href="#cb29-400"></a>      <span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Day"</span>, <span class="st">"Night"</span>), <span class="at">color =</span> my_colors,</span>
<span id="cb29-401"><a href="#cb29-401"></a>      <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">18</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">125000</span>, <span class="dv">29000</span>), <span class="at">size =</span> <span class="dv">8</span>, <span class="at">fontface =</span> <span class="st">"bold"</span></span>
<span id="cb29-402"><a href="#cb29-402"></a>    ) <span class="sc">+</span></span>
<span id="cb29-403"><a href="#cb29-403"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span><span class="sc">*</span><span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb29-404"><a href="#cb29-404"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()) <span class="sc">+</span></span>
<span id="cb29-405"><a href="#cb29-405"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_colors, <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb29-406"><a href="#cb29-406"></a>    <span class="fu">labs</span>(</span>
<span id="cb29-407"><a href="#cb29-407"></a>      <span class="at">x =</span> <span class="st">"Week of the Year"</span>, <span class="at">y =</span> <span class="st">"Reported bike shares</span><span class="sc">\n</span><span class="st">(cumulative # per week)"</span>, <span class="at">tag =</span> <span class="st">"P3"</span>,</span>
<span id="cb29-408"><a href="#cb29-408"></a>    )</span>
<span id="cb29-409"><a href="#cb29-409"></a></span>
<span id="cb29-410"><a href="#cb29-410"></a></span>
<span id="cb29-411"><a href="#cb29-411"></a><span class="co"># install.packages("patchwork")</span></span>
<span id="cb29-412"><a href="#cb29-412"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb29-413"><a href="#cb29-413"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3</span>
<span id="cb29-414"><a href="#cb29-414"></a></span>
<span id="cb29-415"><a href="#cb29-415"></a><span class="in">```</span></span>
<span id="cb29-416"><a href="#cb29-416"></a></span>
<span id="cb29-417"><a href="#cb29-417"></a></span>
<span id="cb29-420"><a href="#cb29-420"></a><span class="in">```{r}</span></span>
<span id="cb29-421"><a href="#cb29-421"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span>
<span id="cb29-422"><a href="#cb29-422"></a><span class="in">```</span></span>
<span id="cb29-423"><a href="#cb29-423"></a></span>
<span id="cb29-424"><a href="#cb29-424"></a></span>
<span id="cb29-425"><a href="#cb29-425"></a></span>
<span id="cb29-428"><a href="#cb29-428"></a><span class="in">```{r}</span></span>
<span id="cb29-429"><a href="#cb29-429"></a>((p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="st">"top"</span>)) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">"collect"</span>)</span>
<span id="cb29-430"><a href="#cb29-430"></a><span class="in">```</span></span>
<span id="cb29-431"><a href="#cb29-431"></a></span>
<span id="cb29-432"><a href="#cb29-432"></a></span>
<span id="cb29-435"><a href="#cb29-435"></a><span class="in">```{r}</span></span>
<span id="cb29-436"><a href="#cb29-436"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>))</span>
<span id="cb29-437"><a href="#cb29-437"></a><span class="in">```</span></span>
<span id="cb29-438"><a href="#cb29-438"></a></span>
<span id="cb29-439"><a href="#cb29-439"></a></span>
<span id="cb29-442"><a href="#cb29-442"></a><span class="in">```{r}</span></span>
<span id="cb29-443"><a href="#cb29-443"></a>((p1 <span class="sc">+</span> p2) <span class="sc">/</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)) <span class="sc">+</span></span>
<span id="cb29-444"><a href="#cb29-444"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">1</span>), <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb29-445"><a href="#cb29-445"></a></span>
<span id="cb29-446"><a href="#cb29-446"></a></span>
<span id="cb29-447"><a href="#cb29-447"></a><span class="in">```</span></span>
<span id="cb29-448"><a href="#cb29-448"></a></span>
<span id="cb29-451"><a href="#cb29-451"></a><span class="in">```{r}</span></span>
<span id="cb29-452"><a href="#cb29-452"></a>picasso <span class="ot">&lt;-</span> <span class="st">"</span></span>
<span id="cb29-453"><a href="#cb29-453"></a><span class="st">AAAAAA#BBBB</span></span>
<span id="cb29-454"><a href="#cb29-454"></a><span class="st">CCCCCCCCC##</span></span>
<span id="cb29-455"><a href="#cb29-455"></a><span class="st">CCCCCCCCC##"</span></span>
<span id="cb29-456"><a href="#cb29-456"></a>(p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)) <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">design =</span> picasso)</span>
<span id="cb29-457"><a href="#cb29-457"></a></span>
<span id="cb29-458"><a href="#cb29-458"></a><span class="in">```</span></span>
<span id="cb29-459"><a href="#cb29-459"></a></span>
<span id="cb29-462"><a href="#cb29-462"></a><span class="in">```{r}</span></span>
<span id="cb29-463"><a href="#cb29-463"></a><span class="st">```</span><span class="at">{r}</span></span>
<span id="cb29-464"><a href="#cb29-464"></a><span class="at">theme_std &lt;- theme_set(theme_minimal(base_size = 18, base_family = "Noto Sans"))</span></span>
<span id="cb29-465"><a href="#cb29-465"></a><span class="at">theme_update(</span></span>
<span id="cb29-466"><a href="#cb29-466"></a><span class="at">  panel.grid = element_blank(),</span></span>
<span id="cb29-467"><a href="#cb29-467"></a><span class="at">  axis.text = element_text(color = "grey50", size = 12),</span></span>
<span id="cb29-468"><a href="#cb29-468"></a><span class="at">  axis.title = element_text(color = "grey40", face = "bold"),</span></span>
<span id="cb29-469"><a href="#cb29-469"></a><span class="at">  axis.title.x = element_text(margin = margin(t = 12)),</span></span>
<span id="cb29-470"><a href="#cb29-470"></a><span class="at">  axis.title.y = element_text(margin = margin(r = 12)),</span></span>
<span id="cb29-471"><a href="#cb29-471"></a><span class="at">  axis.line = element_line(color = "grey80", size = .4),</span></span>
<span id="cb29-472"><a href="#cb29-472"></a><span class="at">  legend.text = element_text(color = "grey50", size = 12),</span></span>
<span id="cb29-473"><a href="#cb29-473"></a><span class="at">  plot.tag = element_text(size = 40, margin = margin(b = 15)),</span></span>
<span id="cb29-474"><a href="#cb29-474"></a><span class="at">  plot.background = element_rect(fill = "white", color = "white")</span></span>
<span id="cb29-475"><a href="#cb29-475"></a><span class="at">)</span></span>
<span id="cb29-476"><a href="#cb29-476"></a></span>
<span id="cb29-477"><a href="#cb29-477"></a><span class="at">bikes_sorted &lt;-</span></span>
<span id="cb29-478"><a href="#cb29-478"></a><span class="at">  bikes %&gt;%</span></span>
<span id="cb29-479"><a href="#cb29-479"></a><span class="at">  filter(!is.na(weather_type)) %&gt;%</span></span>
<span id="cb29-480"><a href="#cb29-480"></a><span class="at">  group_by(weather_type) %&gt;%</span></span>
<span id="cb29-481"><a href="#cb29-481"></a><span class="at">  mutate(sum = sum(count)) %&gt;%</span></span>
<span id="cb29-482"><a href="#cb29-482"></a><span class="at">  ungroup() %&gt;%</span></span>
<span id="cb29-483"><a href="#cb29-483"></a><span class="at">  mutate(</span></span>
<span id="cb29-484"><a href="#cb29-484"></a><span class="at">    weather_type = forcats::fct_reorder(</span></span>
<span id="cb29-485"><a href="#cb29-485"></a><span class="at">      str_to_title(str_wrap(weather_type, 5)), sum</span></span>
<span id="cb29-486"><a href="#cb29-486"></a><span class="at">    )</span></span>
<span id="cb29-487"><a href="#cb29-487"></a><span class="at">  )</span></span>
<span id="cb29-488"><a href="#cb29-488"></a></span>
<span id="cb29-489"><a href="#cb29-489"></a><span class="at">p1 &lt;- ggplot(</span></span>
<span id="cb29-490"><a href="#cb29-490"></a><span class="at">    bikes_sorted,</span></span>
<span id="cb29-491"><a href="#cb29-491"></a><span class="at">    aes(x = weather_type, y = count, color = weather_type)</span></span>
<span id="cb29-492"><a href="#cb29-492"></a><span class="at">  ) +</span></span>
<span id="cb29-493"><a href="#cb29-493"></a><span class="at">  geom_hline(yintercept = 0, color = "grey80", size = .4) +</span></span>
<span id="cb29-494"><a href="#cb29-494"></a><span class="at">  stat_summary(</span></span>
<span id="cb29-495"><a href="#cb29-495"></a><span class="at">    geom = "point", fun = "sum", size = 12</span></span>
<span id="cb29-496"><a href="#cb29-496"></a><span class="at">  ) +</span></span>
<span id="cb29-497"><a href="#cb29-497"></a><span class="at">  stat_summary(</span></span>
<span id="cb29-498"><a href="#cb29-498"></a><span class="at">    geom = "linerange", ymin = 0, fun.max = function(y) sum(y),</span></span>
<span id="cb29-499"><a href="#cb29-499"></a><span class="at">    size = 2, show.legend = FALSE</span></span>
<span id="cb29-500"><a href="#cb29-500"></a><span class="at">  ) +</span></span>
<span id="cb29-501"><a href="#cb29-501"></a><span class="at">  coord_flip(ylim = c(0, NA), clip = "off") +</span></span>
<span id="cb29-502"><a href="#cb29-502"></a><span class="at">  scale_y_continuous(</span></span>
<span id="cb29-503"><a href="#cb29-503"></a><span class="at">    expand = c(0, 0), limits = c(0, 8500000),</span></span>
<span id="cb29-504"><a href="#cb29-504"></a><span class="at">    labels = scales::comma_format(scale = .0001, suffix = "K")</span></span>
<span id="cb29-505"><a href="#cb29-505"></a><span class="at">  ) +</span></span>
<span id="cb29-506"><a href="#cb29-506"></a><span class="at">  scale_color_viridis_d(</span></span>
<span id="cb29-507"><a href="#cb29-507"></a><span class="at">    option = "magma", direction = -1, begin = .1, end = .9, name = NULL,</span></span>
<span id="cb29-508"><a href="#cb29-508"></a><span class="at">    guide = guide_legend(override.aes = list(size = 7))</span></span>
<span id="cb29-509"><a href="#cb29-509"></a><span class="at">  ) +</span></span>
<span id="cb29-510"><a href="#cb29-510"></a><span class="at">  labs(</span></span>
<span id="cb29-511"><a href="#cb29-511"></a><span class="at">    x = NULL, y = "Sum of reported bike shares", tag = "P1",</span></span>
<span id="cb29-512"><a href="#cb29-512"></a><span class="at">  ) +</span></span>
<span id="cb29-513"><a href="#cb29-513"></a><span class="at">  theme(</span></span>
<span id="cb29-514"><a href="#cb29-514"></a><span class="at">    axis.line.y = element_blank(),</span></span>
<span id="cb29-515"><a href="#cb29-515"></a><span class="at">    axis.text.y = element_text(color = "grey50", face = "bold",</span></span>
<span id="cb29-516"><a href="#cb29-516"></a><span class="at">                               margin = margin(r = 15), lineheight = .9)</span></span>
<span id="cb29-517"><a href="#cb29-517"></a><span class="at">  )</span></span>
<span id="cb29-518"><a href="#cb29-518"></a></span>
<span id="cb29-519"><a href="#cb29-519"></a></span>
<span id="cb29-520"><a href="#cb29-520"></a><span class="at">p2 &lt;- bikes_sorted %&gt;%</span></span>
<span id="cb29-521"><a href="#cb29-521"></a><span class="at">  filter(season == "winter", is_weekend == TRUE, day_night == "night") %&gt;%</span></span>
<span id="cb29-522"><a href="#cb29-522"></a><span class="at">  group_by(weather_type, .drop = FALSE) %&gt;%</span></span>
<span id="cb29-523"><a href="#cb29-523"></a><span class="at">  mutate(id = row_number()) %&gt;%</span></span>
<span id="cb29-524"><a href="#cb29-524"></a><span class="at">  ggplot(</span></span>
<span id="cb29-525"><a href="#cb29-525"></a><span class="at">      aes(x = weather_type, y = id, color = weather_type)</span></span>
<span id="cb29-526"><a href="#cb29-526"></a><span class="at">    ) +</span></span>
<span id="cb29-527"><a href="#cb29-527"></a><span class="at">    geom_point(size = 4.5) +</span></span>
<span id="cb29-528"><a href="#cb29-528"></a><span class="at">    scale_color_viridis_d(</span></span>
<span id="cb29-529"><a href="#cb29-529"></a><span class="at">      option = "magma", direction = -1, begin = .1, end = .9, name = NULL,</span></span>
<span id="cb29-530"><a href="#cb29-530"></a><span class="at">      guide = guide_legend(override.aes = list(size = 7))</span></span>
<span id="cb29-531"><a href="#cb29-531"></a><span class="at">    ) +</span></span>
<span id="cb29-532"><a href="#cb29-532"></a><span class="at">    labs(</span></span>
<span id="cb29-533"><a href="#cb29-533"></a><span class="at">      x = NULL, y = "Reported bike shares on</span><span class="sc">\n</span><span class="at">weekend winter nights", tag = "P2",</span></span>
<span id="cb29-534"><a href="#cb29-534"></a><span class="at">    ) +</span></span>
<span id="cb29-535"><a href="#cb29-535"></a><span class="at">    coord_cartesian(ylim = c(.5, NA), clip = "off")</span></span>
<span id="cb29-536"><a href="#cb29-536"></a></span>
<span id="cb29-537"><a href="#cb29-537"></a></span>
<span id="cb29-538"><a href="#cb29-538"></a><span class="at">my_colors &lt;- c("#cc0000", "#000080")</span></span>
<span id="cb29-539"><a href="#cb29-539"></a></span>
<span id="cb29-540"><a href="#cb29-540"></a><span class="at">p3 &lt;- bikes %&gt;%</span></span>
<span id="cb29-541"><a href="#cb29-541"></a><span class="at">  group_by(week = lubridate::week(date), day_night, year) %&gt;%</span></span>
<span id="cb29-542"><a href="#cb29-542"></a><span class="at">  summarize(count = sum(count)) %&gt;%</span></span>
<span id="cb29-543"><a href="#cb29-543"></a><span class="at">  group_by(week, day_night) %&gt;%</span></span>
<span id="cb29-544"><a href="#cb29-544"></a><span class="at">  mutate(avg = mean(count)) %&gt;%</span></span>
<span id="cb29-545"><a href="#cb29-545"></a><span class="at">  ggplot(aes(x = week, y = count, group = interaction(day_night, year))) +</span></span>
<span id="cb29-546"><a href="#cb29-546"></a><span class="at">    geom_line(color = "grey65", size = 1) +</span></span>
<span id="cb29-547"><a href="#cb29-547"></a><span class="at">    geom_line(aes(y = avg, color = day_night), stat = "unique", size = 1.7) +</span></span>
<span id="cb29-548"><a href="#cb29-548"></a><span class="at">    annotate(</span></span>
<span id="cb29-549"><a href="#cb29-549"></a><span class="at">      geom = "text", label = c("Day", "Night"), color = my_colors,</span></span>
<span id="cb29-550"><a href="#cb29-550"></a><span class="at">      x = c(5, 18), y = c(125000, 29000), size = 8, fontface = "bold"</span></span>
<span id="cb29-551"><a href="#cb29-551"></a><span class="at">    ) +</span></span>
<span id="cb29-552"><a href="#cb29-552"></a><span class="at">    scale_x_continuous(breaks = c(1, 1:10*5)) +</span></span>
<span id="cb29-553"><a href="#cb29-553"></a><span class="at">    scale_y_continuous(labels = scales::comma_format()) +</span></span>
<span id="cb29-554"><a href="#cb29-554"></a><span class="at">    scale_color_manual(values = my_colors, guide = "none") +</span></span>
<span id="cb29-555"><a href="#cb29-555"></a><span class="at">    labs(</span></span>
<span id="cb29-556"><a href="#cb29-556"></a><span class="at">      x = "Week of the Year", y = "Reported bike shares</span><span class="sc">\n</span><span class="at">(cumulative # per week)", tag = "P3",</span></span>
<span id="cb29-557"><a href="#cb29-557"></a><span class="at">    )</span></span>
<span id="cb29-558"><a href="#cb29-558"></a></span>
<span id="cb29-559"><a href="#cb29-559"></a></span>
<span id="cb29-560"><a href="#cb29-560"></a><span class="at"># install.packages("patchwork")</span></span>
<span id="cb29-561"><a href="#cb29-561"></a><span class="at">library(patchwork)</span></span>
<span id="cb29-562"><a href="#cb29-562"></a><span class="at">(p1 + p2) / p3</span></span>
<span id="cb29-563"><a href="#cb29-563"></a></span>
<span id="cb29-564"><a href="#cb29-564"></a><span class="st">```</span></span>
<span id="cb29-565"><a href="#cb29-565"></a></span>
<span id="cb29-566"><a href="#cb29-566"></a></span>
<span id="cb29-569"><a href="#cb29-569"></a><span class="in">```{r}</span></span>
<span id="cb29-570"><a href="#cb29-570"></a><span class="at">(p1 + p2) / p3 + plot_layout(guides = "collect")</span></span>
<span id="cb29-571"><a href="#cb29-571"></a><span class="st">```</span></span>
<span id="cb29-572"><a href="#cb29-572"></a></span>
<span id="cb29-573"><a href="#cb29-573"></a></span>
<span id="cb29-574"><a href="#cb29-574"></a></span>
<span id="cb29-577"><a href="#cb29-577"></a><span class="in">```{r}</span></span>
<span id="cb29-578"><a href="#cb29-578"></a><span class="at">((p1 + p2) / p3 &amp; theme(legend.justification = "top")) + plot_layout(guides = "collect")</span></span>
<span id="cb29-579"><a href="#cb29-579"></a><span class="st">```</span></span>
<span id="cb29-580"><a href="#cb29-580"></a></span>
<span id="cb29-581"><a href="#cb29-581"></a></span>
<span id="cb29-584"><a href="#cb29-584"></a><span class="in">```{r}</span></span>
<span id="cb29-585"><a href="#cb29-585"></a><span class="at">(p1 + p2) / p3 &amp; theme(legend.position = "none", plot.background = element_rect(color = "black", size = 3))</span></span>
<span id="cb29-586"><a href="#cb29-586"></a><span class="st">```</span></span>
<span id="cb29-587"><a href="#cb29-587"></a></span>
<span id="cb29-588"><a href="#cb29-588"></a></span>
<span id="cb29-591"><a href="#cb29-591"></a><span class="in">```{r}</span></span>
<span id="cb29-592"><a href="#cb29-592"></a><span class="at">((p1 + p2) / p3 &amp; theme(legend.position = "none")) +</span></span>
<span id="cb29-593"><a href="#cb29-593"></a><span class="at">  plot_layout(heights = c(.2, .1), widths = c(2, 1))</span></span>
<span id="cb29-594"><a href="#cb29-594"></a></span>
<span id="cb29-595"><a href="#cb29-595"></a></span>
<span id="cb29-596"><a href="#cb29-596"></a><span class="st">```</span></span>
<span id="cb29-597"><a href="#cb29-597"></a></span>
<span id="cb29-600"><a href="#cb29-600"></a><span class="in">```{r}</span></span>
<span id="cb29-601"><a href="#cb29-601"></a><span class="at">picasso &lt;- "</span></span>
<span id="cb29-602"><a href="#cb29-602"></a><span class="at">AAAAAA#BBBB</span></span>
<span id="cb29-603"><a href="#cb29-603"></a><span class="at">CCCCCCCCC##</span></span>
<span id="cb29-604"><a href="#cb29-604"></a><span class="at">CCCCCCCCC##"</span></span>
<span id="cb29-605"><a href="#cb29-605"></a><span class="at">(p1 + p2 + p3 &amp; theme(legend.position = "none")) + plot_layout(design = picasso)</span></span>
<span id="cb29-606"><a href="#cb29-606"></a></span>
<span id="cb29-607"><a href="#cb29-607"></a><span class="st">```</span></span>
<span id="cb29-608"><a href="#cb29-608"></a></span>
<span id="cb29-609"><a href="#cb29-609"></a></span>
<span id="cb29-610"><a href="#cb29-610"></a></span>
<span id="cb29-611"><a href="#cb29-611"></a></span>
<span id="cb29-612"><a href="#cb29-612"></a></span>
<span id="cb29-615"><a href="#cb29-615"></a><span class="in">```{r}</span></span>
<span id="cb29-616"><a href="#cb29-616"></a><span class="at">text &lt;- tibble(</span></span>
<span id="cb29-617"><a href="#cb29-617"></a><span class="at">  x = 0, y = 0, label = "Lorem ipsum dolor sit amet, **consectetur adipiscing elit**, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation &lt;b style='color:#000080;'&gt;ullamco laboris nisi&lt;/b&gt; ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat &lt;b style='color:#cc0000;'&gt;cupidatat non proident&lt;/b&gt;, sunt in culpa qui officia deserunt mollit anim id est laborum."</span></span>
<span id="cb29-618"><a href="#cb29-618"></a><span class="at">)</span></span>
<span id="cb29-619"><a href="#cb29-619"></a></span>
<span id="cb29-620"><a href="#cb29-620"></a><span class="at">pt &lt;- ggplot(text, aes(x = x, y = y)) +</span></span>
<span id="cb29-621"><a href="#cb29-621"></a><span class="at">  ggtext::geom_textbox(</span></span>
<span id="cb29-622"><a href="#cb29-622"></a><span class="at">    aes(label = label),</span></span>
<span id="cb29-623"><a href="#cb29-623"></a><span class="at">    box.color = NA, width = unit(23, "lines"),</span></span>
<span id="cb29-624"><a href="#cb29-624"></a><span class="at">    color = "grey40", size = 6.5, lineheight = 1.4</span></span>
<span id="cb29-625"><a href="#cb29-625"></a><span class="at">  ) +</span></span>
<span id="cb29-626"><a href="#cb29-626"></a><span class="at">  coord_cartesian(expand = FALSE, clip = "off") +</span></span>
<span id="cb29-627"><a href="#cb29-627"></a><span class="at">  theme_void()</span></span>
<span id="cb29-628"><a href="#cb29-628"></a></span>
<span id="cb29-629"><a href="#cb29-629"></a><span class="at">pt</span></span>
<span id="cb29-630"><a href="#cb29-630"></a><span class="st">```</span></span>
<span id="cb29-631"><a href="#cb29-631"></a></span>
<span id="cb29-634"><a href="#cb29-634"></a><span class="in">```{r}</span></span>
<span id="cb29-635"><a href="#cb29-635"></a><span class="at">(p1 + pt) / p3</span></span>
<span id="cb29-636"><a href="#cb29-636"></a></span>
<span id="cb29-637"><a href="#cb29-637"></a><span class="st">```</span></span>
<span id="cb29-638"><a href="#cb29-638"></a></span>
<span id="cb29-639"><a href="#cb29-639"></a></span>
<span id="cb29-642"><a href="#cb29-642"></a><span class="in">```{r}</span></span>
<span id="cb29-643"><a href="#cb29-643"></a><span class="at">p1 + inset_element(p2, l = .6, b = .1, r = 1, t = .6)</span></span>
<span id="cb29-644"><a href="#cb29-644"></a><span class="st">```</span></span>
<span id="cb29-645"><a href="#cb29-645"></a></span>
<span id="cb29-646"><a href="#cb29-646"></a></span>
<span id="cb29-649"><a href="#cb29-649"></a><span class="in">```{r}</span></span>
<span id="cb29-650"><a href="#cb29-650"></a><span class="at">(p1 + inset_element(p2, l = .6, b = .1, r = 1, t = .6) + pt) / p3</span></span>
<span id="cb29-651"><a href="#cb29-651"></a></span>
<span id="cb29-652"><a href="#cb29-652"></a><span class="st">```</span></span>
<span id="cb29-653"><a href="#cb29-653"></a></span>
<span id="cb29-654"><a href="#cb29-654"></a></span>
<span id="cb29-655"><a href="#cb29-655"></a></span>
<span id="cb29-656"><a href="#cb29-656"></a></span>
<span id="cb29-657"><a href="#cb29-657"></a></span>
<span id="cb29-658"><a href="#cb29-658"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>